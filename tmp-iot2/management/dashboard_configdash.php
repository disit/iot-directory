<?php
    /* Dashboard Builder.
   Copyright (C) 2017 DISIT Lab https://www.disit.org - University of Florence

   This program is free software; you can redistribute it and/or
   modify it under the terms of the GNU General Public License
   as published by the Free Software Foundation; either version 2
   of the License, or (at your option) any later version.
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA. */
   
   include('process-form.php');
   header("Cache-Control: private, max-age=$cacheControlMaxAge");
   session_start();
   
   if(!isset($_SESSION['loggedRole']))
   {
        header("location: unauthorizedUser.php");
   }
   
   //?openNotificator=1&dashId=" . $id_dashboard2 ."&widgetTitle=" . $title_widget_m
?>

<!DOCTYPE HTML>
<html>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Dashboard Management System</title>

    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles_gridster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../css/jquery.gridster.css">
    <!--<link rel="stylesheet" type="text/css" href="../css/new/jquery.gridster.css">-->
    <link rel="stylesheet" href="../css/style_widgets.css?v=<?php echo time();?>" type="text/css" />
    <link href="../css/bootstrap-colorpicker.min.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link href="https://fonts.googleapis.com/css?family=Cabin:400,500,600,700|Catamaran|Varela+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">-->
    
    <!-- jQuery -->
    <script src="../js/jquery-1.10.1.min.js"></script>
    
    <!-- Bootstrap Core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>

    <!-- Gridster -->
    <script src="../js/jquery.gridster.js" type="text/javascript" charset="utf-8"></script>

    <!-- CKEditor --> 
    <script src="../js/ckeditor/ckeditor.js"></script>
    <link rel="stylesheet" href="../js/ckeditor/skins/moono/editor.css">
    
     <!-- Filestyle -->
    <script type="text/javascript" src="../js/filestyle/src/bootstrap-filestyle.min.js"></script>
    
    <!-- JQUERY UI -->
    <script src="../js/jqueryUi/jquery-ui.js"></script>
    
    <!-- Font awesome icons -->
    <link rel="stylesheet" href="../js/fontAwesome/css/font-awesome.min.css">

    <!-- Bootstrap colorpicker -->
    <script src="../js/bootstrap-colorpicker.min.js"></script>
    
    <!-- Modernizr -->
    <script src="../js/modernizr-custom.js"></script>
    
    <!-- Highcharts -->
    <script src="../js/highcharts/code/highcharts.js"></script>
    <script src="../js/highcharts/code/modules/exporting.js"></script>
    <script src="../js/highcharts/code/highcharts-more.js"></script>
    <script src="../js/highcharts/code/modules/solid-gauge.js"></script>
    <script src="../js/highcharts/code/highcharts-3d.js"></script>
    
    <!-- Bootstrap editable tables -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
    
    <!-- TinyColors -->
    <script src="../js/tinyColor.js" type="text/javascript" charset="utf-8"></script>
    
    <!-- Bootstrap select -->
    <link href="../bootstrapSelect/css/bootstrap-select.css" rel="stylesheet"/>
    <script src="../bootstrapSelect/js/bootstrap-select.js"></script>
    
    <!-- Moment -->
    <script type="text/javascript" src="../moment/moment.js"></script>
    
    <!-- Bootstrap datetimepicker -->
    <script src="../datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <link rel="stylesheet" href="../datetimepicker/build/css/bootstrap-datetimepicker.min.css">
    
    <!-- Bootstrap toggle button -->
   <link href="../bootstrapToggleButton/css/bootstrap-toggle.min.css" rel="stylesheet">
   <script src="../bootstrapToggleButton/js/bootstrap-toggle.min.js"></script>
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
   integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
   crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
   integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
   crossorigin=""></script>
   
   <!-- Leaflet marker cluster plugin -->
   <!--<link rel="stylesheet" href="../leaflet-markercluster/MarkerCluster.css" />
   <link rel="stylesheet" href="../leaflet-markercluster/MarkerCluster.Default.css" />
   <link rel="stylesheet" href="../leaflet-markercluster/leaflet.markercluster-src.js" />-->
    
   <!-- Dot dot dot -->
   <script src="../dotdotdot/jquery.dotdotdot.js" type="text/javascript"></script>
   
   <!-- Bootstrap slider -->
   <script src="../bootstrapSlider/bootstrap-slider.js"></script>
   <link href="../bootstrapSlider/css/bootstrap-slider.css" rel="stylesheet"/>
   
   <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
   
   <!-- Weather icons -->
    <link rel="stylesheet" href="../img/meteoIcons/singleColor/css/weather-icons.css?v=<?php echo time();?>">
    
    <!-- Custom CSS -->
    <link href="../css/dashboard.css?v=<?php echo time();?>" rel="stylesheet">
   
    <script src="../js/widgetsCommonFunctions.js?v=<?php echo time();?>" type="text/javascript" charset="utf-8"></script>
    <script src="../js/dashboard_configdash.js?v=<?php echo time();?>" type="text/javascript" charset="utf-8"></script>
    <script src="../widgets/trafficEventsTypes.js?v=<?php echo time();?>" type="text/javascript" charset="utf-8"></script>
    <script src="../widgets/alarmTypes.js?v=<?php echo time();?>" type="text/javascript" charset="utf-8"></script>
    <script src="../widgets/fakeGeoJsons.js?v=<?php echo time();?>" type="text/javascript" charset="utf-8"></script>
    
</head>

<body> 
    <?php
        if(canEditDashboard() == false)
        {
            echo '<script type="text/javascript">';
            echo 'window.location.href = "unauthorizedUser.php";';
            echo '</script>';
        }
    ?>
    
    <?php include "sessionExpiringPopup.php" ?>
   
    <div id="editDashboardMenu" class="container-fluid centerWithFlex">
       <div class="mainMenuItemContainer">
          <a id="link_add_widget" href="#" data-toggle="modal"> 
             <div class="mainMenuIconContainer centerWithFlex">
                <img src="../img/editDashMenu/add.png" width="25" height="25">
             </div>
             <div class="mainMenuTextContainer centerWithFlex">
                add a<br>widget
             </div>
          </a>
       </div>
       <div class="mainMenuItemContainer">
          <a id ="link_modifyDash" href="#" data-toggle="modal" data-target="#modalEditDashboard">
             <div class="mainMenuIconContainer centerWithFlex">
                <img src="../img/editDashMenu/edit.png" width="25" height="25">
             </div>
             <div class="mainMenuTextContainer centerWithFlex">
                dashboard<br>properties
             </div>
          </a>
       </div>
       <div class="mainMenuItemContainer">
          <a id ="link_save_configuration" class="internalLink" href="#">
             <div class="mainMenuIconContainer centerWithFlex">
                <img src="../img/editDashMenu/save.png" width="25" height="25">
             </div>
             <div class="mainMenuTextContainer centerWithFlex">
                save widgets'<br>position
             </div>
          </a>
       </div>
       <div class="mainMenuItemContainer">
          <a id ="link_duplicate_dash" href="#">
             <div class="mainMenuIconContainer centerWithFlex">
                <img src="../img/editDashMenu/duplicate.png" width="25" height="25">
             </div>
             <div class="mainMenuTextContainer centerWithFlex">
                duplicate<br>dashboard
             </div>
          </a>
       </div>
       <div class="mainMenuItemContainer">
          <a id="dashboardViewLink" href="#" target="blank">
             <div class="mainMenuIconContainer centerWithFlex">
                <img src="../img/editDashMenu/view.png" width="25" height="25">
             </div>
             <div class="mainMenuTextContainer centerWithFlex">
                dashboard<br>view
             </div>
          </a>
       </div>
       <div class="mainMenuItemContainer"> 
          <a id ="embedCodeBtn" href="#" data-toggle="modal">
             <div class="mainMenuIconContainer centerWithFlex">
                 <img src="../img/editDashMenu/embed.png" width="25" height="25">
             </div>
             <div class="mainMenuTextContainer centerWithFlex">
                html for<br>embedding
             </div>
          </a>
       </div>
       <div class="mainMenuItemContainer">
          <a id ="link_exit" href="#" class="internalLink">
             <div class="mainMenuIconContainer centerWithFlex">
                <img src="../img/editDashMenu/exit.png" width="25" height="25">
             </div>
             <div class="mainMenuTextContainer centerWithFlex">
                back to<br>main menu
             </div>
          </a>
       </div> 
    </div> 
    
    <div id="wrapper-dashboard-cfg">
        <nav id="navbarDashboard" class="navbar navbar-inverse navbar-fixed-top noBorder" role="navigation">
            <div id="navbarDashboardHeader">
                <div class="dashboardHeaderLeft">
                    <div id="dashboardTitle"></div>
                    <div id="dashboardSubtitle"></div>
                </div>
            </div>
            <div id="headerLogo">
                <img id="headerLogoImg"/>
            </div>
            <div id="clock"><?php include('../widgets/time.php'); ?></div>    
        </nav>
        
        <div id="pageWrapperCfg">
            <div id="editDashboardMainContainerFluid" class="container-fluid">
                <div id="container-widgets-cfg" class="gridster"> 
                    <ul id="containerUl"></ul>  
                </div>
                <div id="embedAutoLogoContainer">
                    <a title="Km4City" href="https://www.km4city.org" target="_new"><img id="embedAutoLogo" src="../img/PoweredByKm4City1Line.png" /></a>
                </div>
                <div id="logos" class="footerLogos">
                    <a id="disitLogo" title="Disit" href="https://www.disit.org" target="_new" class="footerLogo"><img src="../img/disitLogo.png" /></a>
                </div>
            </div><!-- Fine container-fluid -->
        </div><!-- Fine pageWrapperCfg  -->
    </div>
        
    <!-- Inizio dei modali -->
        
    <!-- Modale aggiunta widget -->
    <div class="modal fade" id="modal-add-widget" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modalDialogWidget" role="document" id="adding01">
            <div class="modal-content modalContentWidgetForm">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Add new widget to dashboard</h4>
                </div>
                <div id="modal-add-widget-body" class="modal-body">
                    <form id="form-setting-widget" class="form-horizontal" name="form-setting-widget" role="form" method="post" action="" enctype="multipart/form-data" data-toggle="validator"> <!-- novalidate -->
                        <div class="well wellCustom2left" id="metricAndWidgetChoice">
                            <legend class="legend-form-group">Metric and widget choice</legend> 
                            <div id="metricAndWidgetChoiceContent" class="form-group">
                                <div class="row">
                                    <label for="widgetCategory" class="col-md-4 control-label">Widget category</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetCategory" name="widgetCategory">
                                                <option value="actuator">Actuator</option>
                                                <option value="viewer">Data viewer</option>
                                            </select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Campi per gli widget attuatori -->
                                <div class="row" id="widgetEntityRow">
                                    <label for="widgetCategory" class="col-md-4 control-label">Entity</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetEntity" name="widgetEntity"></select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row" id="widgetAttributeRow">
                                    <label for="widgetAttribute" class="col-md-4 control-label">Attribute</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetAttribute" name="widgetAttribute"></select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row" id="widgetActuatorTypeRow">
                                    <label for="widgetActuatorType" class="col-md-4 control-label">Widget type</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetActuatorType" name="widgetActuatorType"></select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                
                                
                                <!-- Campi per gli widget che mostrano dati -->
                                <div class="row" id="selectMetricRow">
                                    <label for="select-metric" class="col-md-4 control-label">Metric</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="select-metric" name="select-metric"></select> 
                                            <span class="input-group-btn">
                                                <button id="button_add_metric_widget" class="btn btn-default" name="button_add_metric_widget" type="button">Add</button>                                            
                                            </span>                                        
                                        </div>
                                    </div>
                                </div>

                                <div class="row" id="metricDescRow">
                                    <label for="textarea-metric" class="col-md-4 control-label">Metric description</label>
                                    <div class="col-md-6">
                                        <textarea id ="textarea-metric-c" class="form-control textarea-metric" name="textarea-metric" rows="3"></textarea>
                                    </div>
                                </div>
                                
                                <div id ="inputComuneRow" class="row">    
                                    <label for="inputComuneWidget" class="col-md-4 control-label">Context</label>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <input type="text" class="form-control autocomplete" id="inputComuneWidget" name="inputComuneWidget" novalidate>
                                            <div class="input-group-btn">
                                                <button type="button" id="link_help_modal-add-widget" class="btn btn-default link_help_modal-add-widget" aria-label="Help">
                                                    <span class="glyphicon glyphicon-question-sign"></span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>  
                                </div>
                                
                                <div class="row" id="widgetTypeRow">
                                    <label for="select-widget" class="col-md-4 control-label">Widget type</label>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select name="select-widget" class="form-control" id="select-widget">
                                            </select>
                                            <div id="add-n-metrcis-widget" class="input-group-addon"></div>
                                        </div>    
                                    </div>
                                </div>

                                <div class="row" id="selectedMetricRow">
                                    <label for="textarea-selected-metrics" class="col-md-4 control-label">Selected metrics</label>
                                    <div class="col-md-6">
                                        <textarea id ="textarea-selected-metrics" class="form-control textarea-metric" name="textarea-selected-metrics" rows="2" readonly></textarea>
                                    </div>
                                </div>
                                
                                <div class="row" id="widgetLinkRow">
                                    <label for="inputUrlWidget" class="col-md-4 control-label">Widget link</label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="inputUrlWidget" name="inputUrlWidget">
                                    </div>
                                </div>

                                <div id ="schedulerRow" class="row">
                                    <label for="inputSchedulerWidget" class="col-md-4 control-label" style="display: none">Scheduler</label>
                                    <div id="inputSchedulerWidgetDiv" class="col-md-6" style="display: none">
                                        <div id="inputSchedulerWidgetGroupDiv"class="input-group" style="display: none">
                                            <select class="form-control" id="inputSchedulerWidget" name="inputSchedulerWidget" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>    
                                <div id ="jobsAreasRow" class="row">    
                                <label for="inputJobsAreasWidget" class="col-md-4 control-label" style="display: none">Jobs areas</label>
                                    <div id="inputJobsAreasWidgetDiv" class="col-md-6" style="display: none">
                                        <div id="inputJobsAreasWidgetGroupDiv"class="input-group" style="display: none">
                                            <select class="form-control" id="inputJobsAreasWidget" name="inputJobsAreasWidget" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>

                                <div id ="jobsGroupsRow" class="row">    
                                <label for="inputJobsGroupsWidget" class="col-md-4 control-label" style="display: none">Jobs groups</label>
                                    <div id="inputJobsGroupsWidgetDiv" class="col-md-6" style="display: none">
                                        <div id="inputJobsGroupsWidgetGroupDiv"class="input-group" style="display: none">
                                            <select class="form-control" id="inputJobsGroupsWidget" name="inputJobsGroupsWidget" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>

                                <div id ="jobsNamesRow" class="row">    
                                <label for="inputJobsNamesWidget" class="col-md-4 control-label" style="display: none">Jobs names</label>
                                    <div id="inputJobsNamesWidgetDiv" class="col-md-6" style="display: none">
                                        <div id="inputJobsNamesWidgetGroupDiv"class="input-group" style="display: none">
                                            <select class="form-control" id="inputJobsNamesWidget" name="inputJobsNamesWidget" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" id="firstFreeRowInput" name="firstFreeRowInput">
                                <input type="hidden" id="schedulerName" name="schedulerName">
                                <input type="hidden" id="host" name="host">
                                <input type="hidden" id="user" name="user">
                                <input type="hidden" id="pass" name="pass">
                                <input type="hidden" id="jobArea" name="jobArea">
                                <input type="hidden" id="jobGroup" name="jobGroup">
                                <input type="hidden" id="jobName" name="jobName">
                                <input type="hidden" id="serviceUri" name="serviceUri">
                                <input type="hidden" id="hospitalList" name="hospitalList">
                            </div>
                        </div>
                        
                        <div class="well wellCustom2right" style="height: 416px" id="genericWidgetPropertiesDiv">
                            <legend class="legend-form-group">Generic widget properties</legend>
                            <div class="form-group">
                                <div class="row">
                                    <label id="titleLabel" for="inputTitleWidget" class="col-md-2 control-label addWidgetParLabel">Title</label> 
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputTitleWidget" name="inputTitleWidget">
                                    </div>
                                    
                                    <label id="bckColorLabel" for="inputColorWidget" class="col-md-3 control-label addWidgetParLabel">Background color</label>
                                    <div class="col-md-3">
                                        <div class="input-group color-choice">
                                            <input type="text" class="form-control demo-1 demo-auto" id="inputColorWidget" name="inputColorWidget" value="#FFFFFF" required>
                                            <span class="input-group-addon"><i id="color_widget"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="inputFontSize" class="col-md-2 control-label addWidgetParLabel">Content<br/>font size</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputFontSize" name="inputFontSize" >
                                    </div>
                                    
                                    <label for="inputFontColor" class="col-md-3 control-label addWidgetParLabel">Content font color</label>
                                    <div class="col-md-3">
                                        <div class="input-group color-choice">
                                            <input type="text" class="form-control demo-1 demo-auto" id="inputFontColor" name="inputFontColor" value="#000000">
                                            <span class="input-group-addon"><i id="widgetFontColor"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="inputFrameColorWidget" class="col-md-2 control-label addWidgetParLabel">Header <br/>color</label>
                                    <div class="col-md-3">
                                        <div class="input-group color-choice">
                                            <input type="text" class="form-control demo-1 demo-auto" id="inputFrameColorWidget" name="inputFrameColorWidget" value="#eeeeee" required>
                                            <span class="input-group-addon"><i></i></span>
                                        </div>
                                    </div>
                                    <label for="inputHeaderFontColorWidget" class="col-md-3 control-label addWidgetParLabel">Header text color</label>
                                    <div class="col-md-3">
                                        <div class="input-group color-choice">
                                            <input type="text" class="form-control demo-1 demo-auto" id="inputHeaderFontColorWidget" name="inputHeaderFontColorWidget" value="#000000" required>
                                            <span class="input-group-addon"><i id="widgetHeaderFontColor"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="select-IntTemp-Widget" class="col-md-2 control-label addWidgetParLabel">Period</label>
                                    <div class="col-md-3">
                                        <select name="select-IntTemp-Widget" class="form-control" id="select-IntTemp-Widget" required>
                                            <option value="Nessuno">No</option>
                                            <option value="4 Ore">4 Hours</option>
                                            <option value="12 Ore">12 Hours</option>
                                            <option value="Giornaliera">Day</option>
                                            <option value="Settimanale">Week</option>
                                            <option value="Mensile">Month</option>
                                            <option value="Annuale">Year</option>       
                                        </select>
                                    </div>
                                    <label for="inputFreqWidget" class="col-md-3 control-label addWidgetParLabel">Refresh rate (s)</label>

                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputFreqWidget" name="inputFreqWidget" placeholder="" required>
                                    </div>
                                </div>                     
                                <div class="row">
                                    <label for="inputSizeRowsWidget" class="col-md-2 control-label addWidgetParLabel">Height</label>
                                    <div class="col-md-3">
                                        <select class="form-control" id="inputSizeRowsWidget" name="inputSizeRowsWidget" placeholder="">                                            
                                        </select>
                                    </div>
                                    <label for="inputSizeColumnsWidget" class="col-md-3 control-label addWidgetParLabel">Width</label>
                                    <div class="col-md-3">
                                        <select class="form-control" id="inputSizeColumnsWidget" name="inputSizeColumnsWidget" placeholder="">                                           
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="inputUdmWidget" class="col-md-2 control-label addWidgetParLabel">U/M</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputUdmWidget" name="inputUdmWidget">
                                    </div>
                                    
                                    <label for="inputUdmWidget" class="col-md-3 control-label addWidgetParLabel">U/M position</label>
                                    <div class="col-md-3">
                                        <select name="inputUdmPosition" class="form-control" id="inputUdmPosition" required>
                                            <option value="next">Next to value</option>
                                            <option value="below">Below value</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="inputUdmWidget" class="col-md-2 control-label addWidgetParLabel">Show header</label>
                                    <div class="col-md-3">
                                        <select id="inputShowTitle" name="inputShowTitle" class="form-control" required>
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                    <label for="inputFontFamilyWidget" class="col-md-3 control-label addWidgetParLabel">Font type (autosuggestion)</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control autocomplete" id="inputFontFamilyWidget" name="inputFontFamilyWidget" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="well wellCustom2left" id="specificWidgetPropertiesDiv">
                            <legend class="legend-form-group">Specific widget properties</legend>
                            <div class="form-group">
                                <!-- NON CANCELLARE -->
                                <input type="hidden" id="parameters" name="parameters">
                                <!-- NON CANCELLARE -->
                                <input type="hidden" id="barsColors" name="barsColors">
                            </div>
                        </div>
                        
                        <div class="well wellCustom2right" id="infoTextareaDiv">
                            <legend class="legend-form-group">Widget detailed informations</legend>
                            <div class="row">
                                <label for="infoMainSelect" class="col-sm-1 control-label">Target</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="infoMainSelect" name="infoMainSelect">       
                                    </select>                                                                     
                                </div>
                                <label for="infoAxisSelect" class="col-sm-1 control-label">Set</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="infoAxisSelect" name="infoAxisSelect">       
                                    </select>                                                                     
                                </div>
                                <label for="infoFieldSelect" class="col-sm-1 control-label">Field</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="infoFieldSelect" name="infoFieldSelect">       
                                    </select>                                                                     
                                </div> 
                            </div>
                            <div id="widgetInfoCkEditorTitleRow" class="row centerWithFlex">
                                <h5 id="widgetInfoCkEditorTitle"></h5>
                            </div>
                            <input type="hidden" id="infoNamesJsonFirstAxis" name="infoNamesJsonFirstAxis">
                            <input type="hidden" id="infoNamesJsonSecondAxis" name="infoNamesJsonSecondAxis">
                        </div>
                        
                        <div class="well wellCustomFooter">
                            <button id="button_add_widget" name="add_widget" type="submit" class="btn btn-primary widgetFormButton internalLink" disabled>Confirm</button>
                            <button id="button_close_popup" type="button" class="btn btn-default widgetFormButton widgetFormButtonMargin internalLink" data-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div> 
    <!-- Fine modale aggiunta widget -->
    
    <!-- Modale modifica dashboard -->
    <div class="modal fade" id="modalEditDashboard" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog" role="document">
            <form id="editDashboardForm" class="form-horizontal" name="editDashboardForm" role="form" method="post" action="" data-toggle="validator" enctype="multipart/form-data">  
            <div class="modal-content">
                  <div class="modalHeader centerWithFlex">
                      Edit dashboard
                  </div>
                  <div id="editDashboardModalBody" class="modal-body modalBody">
                  <ul class="nav nav-tabs nav-justified">
                      <li class="active"><a data-toggle="tab" href="#measuresTab">Measures</a></li>
                      <li><a data-toggle="tab" href="#headerTab">Header</a></li>
                      <li><a data-toggle="tab" href="#bodyTab">Body</a></li>
                      <li><a data-toggle="tab" href="#visibilityTab">Visibility</a></li>
                      <li><a data-toggle="tab" href="#embeddabilityTab">Embeddability</a></li>
                  </ul>

                  <div class="tab-content">
                      <!-- Measures tab -->
                      <div id="measuresTab" class="tab-pane fade in active">
                          <div class="row">
                              <div class="col-xs-12 col-md-12 modalCell">
                                  <div class="modalFieldCnt">
                                       <input id="inputWidthDashboard" name="inputWidthDashboard" data-slider-id="inputWidthDashboardSlider" type="text" data-slider-min="1" data-slider-max="100" data-slider-step="1"/>
                                  </div>
                                  <div class="modalFieldLabelCnt">Width (cells)</div>
                              </div>
                              <div class="col-xs-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <input type="text" class="modalInputTxt" name="pixelWidth" id="pixelWidth" disabled> 
                                  </div>
                                  <div class="modalFieldLabelCnt">Pixel width</div>
                              </div>
                              <div class="col-xs-6 modalCell">
                                  <div class="modalFieldCnt">
                                       <input type="text" class="modalInputTxt" name="percentWidth" id="percentWidth" disabled> 
                                  </div>
                                  <div class="modalFieldLabelCnt">Width (%) on your screen</div>
                              </div>
                          </div>
                      </div>
                      <!-- Header tab -->
                      <div id="headerTab" class="tab-pane fade">
                          <div class="row">
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                       <input type="text" class="modalInputTxt" name="inputTitleDashboard" id="inputTitleDashboard" required> 
                                  </div>
                                  <div class="modalFieldLabelCnt">Title</div>
                              </div>
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <input type="text" class="modalInputTxt" name="inputSubTitleDashboard" id="inputSubTitleDashboard"> 
                                  </div>
                                  <div class="modalFieldLabelCnt">Subtitle</div>
                              </div>
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <div class="input-group customColorChoice">
                                          <input type="text" class="modalInputTxt" id="inputColorDashboard" name="inputColorDashboard" required>
                                          <span class="input-group-addon"><i></i></span>
                                      </div>
                                  </div>
                                  <div class="modalFieldLabelCnt">Header color</div>
                              </div>
                              <div class="col-xs-12 col-md-2 col-md-offset-2 modalCell">
                                  <div class="modalFieldCnt">
                                      <input id="headerVisible" name="headerVisible" type="checkbox">
                                  </div>
                                  <div class="modalFieldLabelCnt">Show header</div>
                              </div>
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <input id="headerFontSize" name="headerFontSize" data-slider-id="headerFontSizeSlider" type="text" data-slider-min="1" data-slider-max="36" data-slider-step="1"/>
                                  </div>
                                  <div class="modalFieldLabelCnt">Header font size</div>
                              </div>
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <div class="input-group customColorChoice">
                                          <input type="text" class="modalInputTxt" id="headerFontColor" name="headerFontColor">
                                          <span class="input-group-addon"><i id="color_hf"></i></span>
                                      </div>
                                  </div>
                                  <div class="modalFieldLabelCnt">Header font color</div>
                              </div>
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <input id="dashboardLogoInput" name="dashboardLogoInput" type="file" class="filestyle modalInputTxt" data-badge="false" data-input ="true" data-size="nr" data-buttonName="btn-primary" data-buttonText="File">
                                  </div>
                                  <div class="modalFieldLabelCnt">Header logo</div>
                              </div>
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                       <input type="text" class="modalInputTxt" name="dashboardLogoLinkInput" id="dashboardLogoLinkInput"> 
                                  </div>
                                  <div class="modalFieldLabelCnt">Header logo link</div>
                              </div>
                          </div>
                      </div>

                      <!-- Body tab -->
                      <div id="bodyTab" class="tab-pane fade">
                          <div class="row">
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <div class="input-group customColorChoice">
                                          <input type="text" class="modalInputTxt" id="inputColorBackgroundDashboard" name="inputColorBackgroundDashboard" required>
                                          <span class="input-group-addon"><i></i></span>
                                      </div> 
                                  </div>
                                  <div class="modalFieldLabelCnt">Widgets area color</div>
                              </div>
                              <div class="col-xs-12 col-md-6 modalCell">
                                  <div class="modalFieldCnt">
                                      <div class="input-group customColorChoice">
                                          <input type="text" class="modalInputTxt" id="inputExternalColorDashboard" name="inputExternalColorDashboard" required>
                                          <span class="input-group-addon"><i></i></span>
                                      </div>
                                  </div>
                                  <div class="modalFieldLabelCnt">External frame color</div>
                              </div>
                              <div class="col-xs-12 col-md-4 col-md-offset-1 modalCell">
                                  <input id="widgetsBorders" name="widgetsBorders" type="checkbox">
                                  <div class="modalFieldLabelCnt">Widgets borders</div>
                              </div>
                              <div class="col-xs-12 col-md-6 col-md-offset-1 modalCell">
                                  <div class="modalFieldCnt">
                                      <div class="input-group customColorChoice">
                                          <input type="text" class="modalInputTxt" id="inputWidgetsBordersColor" name="inputWidgetsBordersColor" required>
                                          <span class="input-group-addon"><i></i></span>
                                      </div>
                                  </div>
                                  <div class="modalFieldLabelCnt">Widgets borders color</div>
                              </div>
                          </div>    
                      </div>

                      <!-- Visibility tab -->
                      <div id="visibilityTab" class="tab-pane fade">
                          <div class="row">
                              <div class="col-xs-12 modalCell">
                                  <div class="modalFieldCnt">
                                      <select name="inputDashboardVisibility" class="modalInputTxt" id="inputDashboardVisibility" required>
                                          <option value="author">Dashboard author only</option>
                                          <option value="restrict">Author and selected users</option>
                                          <option value="public">Everybody (public)</option>
                                      </select>
                                  </div>
                                  <!--<div class="modalFieldLabelCnt">Permission type</div>-->
                              </div>
                              <div class="col-xs-12 modalCell">
                                  <div class="modalFieldCnt">
                                      <table id="inputDashboardVisibilityUsersTable">
                                          <th class="selectCell">Select</th>
                                          <th class="usernameCell">Username</th>
                                      </table>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- Embeddability tab -->
                      <div id="embeddabilityTab" class="tab-pane fade">
                          <div class="row">
                              <div class="col-xs-12 modalCell">
                                  <div class="modalFieldCnt">
                                      <table id="authorizedPagesTable">
                                          <thead>
                                              <th>Authorized pages</th>
                                              <th><i id="addAuthorizedPageBtn" class="fa fa-plus"></i></th>
                                          </thead>
                                          <tbody></tbody>
                                      </table> 
                                  </div>
                                  <input type="hidden" id="authorizedPagesJson" name="authorizedPagesJson" />
                              </div>
                          </div>
                      </div>
                  </div>
                  <div id="editDashboardModalFooter" class="modal-footer">
                    <button type="button" id="editDashboardCancelBtn" class="btn cancelBtn" data-dismiss="modal">Cancel</button>
                    <button type="submit" id="editDashboardConfirmBtn" name="editDashboard" class="btn confirmBtn internalLink">Confirm</button>
                  </div>
            </div>
          </form>  
          </div>
      </div>
    </div>    
    <!-- Fine modale modifica dashboard -->    
    
    <!-- Modale duplicazione dashboard -->
    <div class="modal fade" id="cloneDashboardModal" tabindex="-1" role="dialog" aria-labelledby="modalAddWidgetTypeLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modalHeader centerWithFlex">
              Dashboard duplication
            </div>
            <form id="cloneDashboardForm" class="form-horizontal" name="cloneDashboardForm" role="form" method="post" action="" data-toggle="validator">
                <div id="cloneDashboardModalBody" class="modal-body modalBody">
                    <div class="row" id="cloningDashboardFormRow">
                        <div class="col-xs-12 col-md-6 modalCell">
                            <div class="modalFieldCnt">
                                <input type="text" id="currentDashboardTitle" name="NameDashboard" class="modalInputTxt" disabled>
                            </div>
                            <div class="modalFieldLabelCnt">Original dashboard title</div>
                        </div>
                        <div class="col-xs-12 col-md-6 modalCell">
                            <div class="modalFieldCnt">
                                <input type="text" class="modalInputTxt" id="newDashboardTitle" name="NameNewDashboard" required> 
                            </div>
                            <div class="modalFieldLabelCnt">Cloned dashboard title</div>
                            <div id="cloneDashboardTitleMsg" class="modalFieldLabelCnt">Title can't be less than 4 characters long</div>
                        </div>
                    </div>
                    <div class="row" id="duplicateDashboardLoadingTitlesRow">
                        <div class="col-xs-12 centerWithFlex">Retrieving current dashboards titles, please wait</div>
                        <div class="col-xs-12 centerWithFlex"><i class="fa fa-circle-o-notch fa-spin" style="font-size:36px;"></i></div>
                    </div>
                    <div class="row" id="duplicateDashboardLoadingTitlesKoRow">
                        <div class="col-xs-12 centerWithFlex">Error retrieving current dashboards titles, please try again</div>
                        <div class="col-xs-12 centerWithFlex"><i class="fa fa-thumbs-o-down" style="font-size:36px"></i></div>
                    </div>
                    <div class="row" id="duplicateDashboardLoadingRow">
                        <div class="col-xs-12 centerWithFlex">Cloning dashboard, please wait</div>
                        <div class="col-xs-12 centerWithFlex"><i class="fa fa-circle-o-notch fa-spin" style="font-size:36px;"></i></div>
                    </div>
                    <div class="row" id="duplicateDashboardOkRow">
                        <div class="col-xs-12 centerWithFlex">Dashboard cloned successfully</div>
                        <div class="col-xs-12 centerWithFlex"><i class="fa fa-thumbs-o-up" style="font-size:36px"></i></div>
                    </div>
                    <div class="row" id="duplicateDashboardWarningRow">
                        <div class="col-xs-12 centerWithFlex"></div>
                        <div class="col-xs-12 centerWithFlex"><i class="fa fa-exclamation-triangle" style="font-size:36px"></i></div>
                    </div>
                    <div class="row" id="duplicateDashboardKoRow">
                        <div class="col-xs-12 centerWithFlex">Error while cloning dashboard, please try again</div>
                        <div class="col-xs-12 centerWithFlex"><i class="fa fa-thumbs-o-down" style="font-size:36px"></i></div>
                    </div>
                </div>
                <div id="cloneDashboardModalFooter" class="modal-footer">
                  <button type="button" id="duplicateDashboardCancelBtn" class="btn cancelBtn" data-dismiss="modal">Cancel</button>
                  <button type="button" id="duplicateDashboardBtn" class="btn confirmBtn internalLink" disabled>Confirm</button>
                </div>
            </form>    
          </div>
        </div>
    </div>
    <!-- Fine modale duplicazione dashboard -->
    
    <!-- Modale informazioni widget -->
    <div class="modal fade" tabindex="-1" id="dialog-information-widget" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document" id="info01"> 
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" id="titolo_info">Description:</h4>
                </div>
                <div class="modal-body">
                    <form id="form-information-widget" class="form-horizontal" name="form-information-widget" role="form" method="post" action="" data-toggle="validator">
                        <div id="contenuto_infomazioni"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>
    <!-- Fine modale informazioni widget -->
    
    <!-- Modale informazioni campi widget -->
    <div class="modal fade" tabindex="-1" id="modalWidgetFieldsInfo" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document" id="info01"> 
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" id="modalWidgetFieldsInfoTitle"></h4>
                </div>
                <div class="modal-body">
                    <form id="modalWidgetFieldsInfoForm" class="form-horizontal" name="modalWidgetFieldsInfoForm" role="form" method="post" action="" data-toggle="validator">
                        <div id="modalWidgetFieldsInfoContent"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Fine modale informazioni campi widget -->
    
    <!-- Modale impossibilità di apertura link in nuovo tab per widgetExternalContent -->
    <div class="modal fade" tabindex="-1" id="newTabLinkOpenImpossibile" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document"> 
            <div class="modal-content">
                <div class="modal-header centerWithFlex">
                    <h4 class="modal-title">External content</h4>
                </div>
                <div class="modal-body">
                    <div id="newTabLinkOpenImpossibileMsg"></div>
                    <div id="newTabLinkOpenImpossibileIcon">
                         <i class="fa fa-frown-o"></i>           
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Fine modale impossibilità di apertura link in nuovo tab per widgetExternalContent -->
    
    <!-- Modale cambio stato evacuation plan -->
    <div class="modal fade" tabindex="-1" id="modalChangePlanStatus" role="dialog" aria-labelledby="myModalLabel">
        <div id="modalChangePlanStatusDialog" class="modal-dialog modal-lg" role="document"> 
            <div class="modal-content">
                <div id="modalChangePlanStatusModalTitle" class="modal-header centerWithFlex">
                    evacuation plan status management
                </div>
                <div id="modalChangePlanStatusMain" class="modal-body container-fluid">
                    <div class="row">
                        <div class="col-sm-6 centerWithFlex modalChangePlanStatusLabel">
                            plan identifier
                        </div> 
                        <div class="col-sm-6 centerWithFlex modalChangePlanStatusLabel">
                            current approval status
                        </div>
                    </div>
                    <div class="row">
                       <div class="col-sm-6 centerWithFlex" id="modalChangePlanStatusTitle" ></div> 
                       <div class="col-sm-4 col-sm-offset-1 centerWithFlex" id="modalChangePlanStatusStatus"></div>
                    </div>

                    <div class="row">
                       <div class="col-sm-6 col-sm-offset-3 centerWithFlex modalChangePlanStatusLabel">
                           new approval status 
                       </div> 
                    </div>
                    <div class="row">
                       <div class="col-sm-4 col-sm-offset-4 centerWithFlex">
                           <select class="form-control" id="modalChangePlanStatusSelect" name="modalChangePlanStatusSelect" required></select> 
                       </div> 
                    </div>
                </div>
                <div id="modalChangePlanStatusWait" class="modal-body container-fluid">
                    <div class="row">
                        <div class="col-sm-6 col-sm-offset-3 centerWithFlex">
                            updating status, please wait
                        </div> 
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-sm-offset-3 centerWithFlex">
                            <i class="fa fa-spinner fa-spin" style="font-size:84px"></i>
                        </div> 
                    </div>
                </div>
                <div id="modalChangePlanStatusOk" class="modal-body container-fluid">
                    <div class="row">
                        <div class="col-sm-10 col-sm-offset-1 centerWithFlex">
                            status successfully updated
                        </div> 
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-sm-offset-3 centerWithFlex">
                            <i class="fa fa-thumbs-o-up" style="font-size:84px"></i>
                        </div> 
                    </div>
                </div>
                <div id="modalChangePlanStatusKo" class="modal-body container-fluid">
                    <div class="row">
                        <div class="col-sm-12 centerWithFlex">
                            error while trying to send new status to server, please try again
                        </div> 
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-sm-offset-3 centerWithFlex">
                            <i class="fa fa-thumbs-down" style="font-size:84px"></i>
                        </div> 
                    </div>
                </div>

                <input type="hidden" id="modalChangePlanStatusPlanId" />
                <input type="hidden" id="modalChangePlanStatusCurrentStatus" />

                <div id="modalChangePlanStatusFooter" class="modal-footer centerWithFlex">
                   <button type="button" class="btn btn-secondary" id="modalChangePlanStatusCancelBtn">cancel</button>
                   <button type="button" class="btn btn-primary" id="modalChangePlanStatusConfirmBtn">confirm</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Fine modale cambio stato evacuation plan -->
    
    <!-- Modale modifica widget -->
    <div class="modal fade" id="modal-modify-widget" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modalDialogWidget" role="document" id="modify01">
            <div class="modal-content modalContentWidgetForm">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Modify widget</h4>
                </div>
                <div class="modal-body">
                    <form id="form-modify-widget" class="form-horizontal" name="form-modify-widget" role="form" method="post" action="" enctype="multipart/form-data" data-toggle="validator">
                        <!-- Nuovo codice -->
                        <div class="well wellCustom2left" id="metricAndWidgetChoiceM">
                            <legend class="legend-form-group">Metric and widget choice</legend>
                            <div class="form-group">
                                <div class="row">
                                    <label for="widgetCategoryM" class="col-md-4 control-label">Widget category</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetCategoryM" name="widgetCategoryM" disabled>
                                                <option value="actuator">Actuator</option>
                                                <option value="viewer">Data viewer</option>
                                            </select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Campi per gli widget attuatori -->
                                <div class="row" id="widgetEntityRowM">
                                    <label for="widgetEntityM" class="col-md-4 control-label">Entity</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetEntityM" name="widgetEntityM"></select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row" id="widgetAttributeRowM">
                                    <label for="widgetAttributeM" class="col-md-4 control-label">Attribute</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetAttributeM" name="widgetAttributeM"></select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row" id="widgetActuatorTypeRowM">
                                    <label for="widgetActuatorTypeM" class="col-md-4 control-label">Widget type</label>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select class="form-control" id="widgetActuatorTypeM" name="widgetActuatorTypeM"></select>                                         
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Campi per gli widget data viewer -->
                                <div class="row" id="metricWidgetMRow">
                                    <label for="metricWidgetM" class="col-md-4 control-label">Metric</label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="metricWidgetM" name="metricWidgetM" readonly>
                                    </div>
                                </div>
                                <div class="row" id="inputNameWidgetMRow">
                                    <label for="inputNameWidgetM" class="col-md-4 control-label">Widget name</label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="inputNameWidgetM" name="inputNameWidgetM" placeholder="Title" readonly>                                 
                                    </div>
                                </div>
                                <div class="row" id="select-widget-mRow">
                                    <label for="select-widget-m" class="col-md-4 control-label">Widget type</label>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <select name="select-widget-m" class="form-control" id="select-widget-m"></select>
                                            <div id="mod-n-metrcis-widget" class="input-group-addon"></div>
                                        </div>   
                                    </div>
                                </div>   
                                <div id="inputComuneRowM" class="row">
                                    <label for="inputComuneWidgetM" class="col-md-4 control-label">Context</label>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="inputComuneWidgetM" name="inputComuneWidgetM">
                                            <div class="input-group-btn">
                                                <button type="button" id="link_help_modal-add-widget-m" class="btn btn-default link_help_modal-add-widget" aria-label="Help">
                                                    <span class="glyphicon glyphicon-question-sign"></span>
                                                </button>
                                            </div>

                                        </div>
                                    </div> 
                                </div>
                                <div id="urlWidgetMRow" class="row">
                                    <label for="urlWidgetM" class="col-md-4 control-label">Widget link</label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="urlWidgetM" name="urlWidgetM">
                                    </div>
                                </div>
                                <div id="textarea-metric-widget-mRow" class="row">
                                    <label for="textarea-metric-widget-m" class="col-md-4 control-label">Metric description</label>
                                    <div class="col-md-6">
                                        <textarea id ="textarea-metric-widget-m" class="form-control textarea-metric" name="textarea-metric-widget-m" rows="3"></textarea>
                                    </div>
                                </div>
                                <div id="schedulerRowM" class="row">
                                    <label for="inputSchedulerWidgetM" class="col-md-4 control-label" style="display: none">Scheduler</label>
                                    <div id="inputSchedulerWidgetDivM" class="col-md-6" style="display: none">
                                        <div id="inputSchedulerWidgetGroupDivM"class="input-group" style="display: none">
                                            <select class="form-control" id="inputSchedulerWidgetM" name="inputSchedulerWidgetM" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>    
                                <div id="jobsAreasRowM" class="row">    
                                    <label for="inputJobsAreasWidgetM" class="col-md-4 control-label">Jobs areas</label>
                                    <div id="inputJobsAreasWidgetDivM" class="col-md-6" style="display: none">
                                        <div id="inputJobsAreasWidgetGroupDivM"class="input-group" style="display: none">
                                            <select class="form-control" id="inputJobsAreasWidgetM" name="inputJobsAreasWidgetM" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>
                                <div id="jobsGroupsRowM" class="row">    
                                    <label for="inputJobsGroupsWidgetM" class="col-md-4 control-label" style="display: none">Jobs groups</label>
                                    <div id="inputJobsGroupsWidgetDivM" class="col-md-6" style="display: none">
                                        <div id="inputJobsGroupsWidgetGroupDivM"class="input-group" style="display: none">
                                            <select class="form-control" id="inputJobsGroupsWidgetM" name="inputJobsGroupsWidgetM" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>
                                <div id="jobsNamesRowM" class="row">    
                                    <label for="inputJobsNamesWidgetM" class="col-md-4 control-label" style="display: none">Jobs names</label>
                                    <div id="inputJobsNamesWidgetDivM" class="col-md-6" style="display: none">
                                        <div id="inputJobsNamesWidgetGroupDivM"class="input-group" style="display: none">
                                            <select class="form-control" id="inputJobsNamesWidgetM" name="inputJobsNamesWidgetM" style="display: none"></select>
                                        </div>
                                    </div>
                                </div>
                                
                                <input type="hidden" id="widgetIdM" name="widgetIdM">
                                <input type="hidden" id="widgetCategoryHiddenM" name="widgetCategoryHiddenM">
                                <input type="hidden" id="schedulerNameM" name="schedulerNameM">
                                <input type="hidden" id="hostM" name="hostM">
                                <input type="hidden" id="userM" name="userM">
                                <input type="hidden" id="passM" name="passM">
                                <input type="hidden" id="jobAreaM" name="jobAreaM">
                                <input type="hidden" id="jobGroupM" name="jobGroupM">
                                <input type="hidden" id="jobNameM" name="jobNameM">
                                <input type="hidden" id="serviceUriM" name="serviceUriM">
                                <input type="hidden" id="hospitalListM" name="hospitalListM">
                            </div>
                        </div>
                        <div class="well wellCustom2right" style="height: 386px" id="genericWidgetPropertiesDivM">
                            <legend class="legend-form-group">Generic widget properties</legend>
                            <div class="form-group">
                                <div class="row">
                                    <label for="inputTitleWidgetM" class="col-md-2 control-label addWidgetParLabel">Title</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputTitleWidgetM" name="inputTitleWidgetM">
                                    </div>
                                    <label for="inputColorWidgetM" class="col-md-3 addWidgetParLabel control-label">Backgound color</label>
                                    <div class="col-md-3">
                                        <div id="widgetColorPickerContainer" class="input-group"> <!-- color-choice -->
                                            <input type="text" class="form-control demo-1 demo-auto" id="inputColorWidgetM" name="inputColorWidgetM" required>  <!-- value="#FFFFFF" -->
                                            <span class="input-group-addon"><i id="color_widget_M"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="inputFontSizeM" class="col-md-2 addWidgetParLabel control-label">Content<br/>font size</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputFontSizeM" name="inputFontSizeM">
                                    </div>
                                    <label for="inputFontColorM" class="col-md-3 addWidgetParLabel control-label">Content font color</label>
                                    <div class="col-md-3">
                                        <div id="widgetFontColorPickerContainerM" class="input-group color-choice">
                                            <input type="text" class="form-control demo-1 demo-auto" id="inputFontColorM" name="inputFontColorM">
                                            <span class="input-group-addon"><i id="widgetFontColorM"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="select-frameColor-Widget-m" class="col-md-2 addWidgetParLabel control-label">Header color</label>
                                    <div class="col-md-3">
                                        <div id="widgetFrameColorPickerContainer" class="input-group"> <!-- color-choice -->
                                            <input type="text" class="form-control demo-1 demo-auto" id="select-frameColor-Widget-m" name="select-frameColor-Widget-m" required> <!-- value="#eeeeee" -->
                                            <span class="input-group-addon"><i id="color_fm"></i></span>
                                        </div>
                                    </div>
                                    <label for="inputHeaderFontColorWidgetM" class="col-md-3 control-label addWidgetParLabel">Header text color</label>
                                    <div class="col-md-3">
                                        <div id="widgetFrameFontColorPickerContainer" class="input-group">
                                            <input type="text" class="form-control demo-1 demo-auto" id="inputHeaderFontColorWidgetM" name="inputHeaderFontColorWidgetM" required>
                                            <span class="input-group-addon"><i id="widgetHeaderFontColorM"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="select-IntTemp-Widget-m" class="col-md-2 addWidgetParLabel control-label">Period</label>
                                    <div class="col-md-3">
                                        <select name="select-IntTemp-Widget-m" class="form-control" id="select-IntTemp-Widget-m">
                                            <option value="Nessuno">No</option>                                           
                                            <option value="4 Ore">4 Hours</option>
                                            <option value="12 Ore">12 Hours</option>
                                            <option value="Giornaliera">Day</option>
                                            <option value="Settimanale">Week</option>
                                            <option value="Mensile">Month</option>
                                            <option value="Annuale">Year</option>   
                                        </select>
                                    </div>
                                    <label for="inputFreqWidgetM" class="col-md-3 addWidgetParLabel control-label">Refresh rate (s)</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputFreqWidgetM" name="inputFreqWidgetM" placeholder="" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="input-rows-m" class="col-md-2 addWidgetParLabel control-label">Height</label>
                                    <div class="col-md-3">
                                        <select class="form-control" id="inputRows-m" name="inputRows-m" placeholder="">                                            
                                        </select>
                                    </div>
                                    <label for="input-Column" class="col-md-3 addWidgetParLabel control-label">Width</label>
                                    <div class="col-md-3">
                                        <select class="form-control" id="inputColumn-m" name="inputColumn-m" placeholder="">                                            
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="inputUdmWidgetM" class="col-md-2 control-label addWidgetParLabel">U/M</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="inputUdmWidgetM" name="inputUdmWidgetM">
                                    </div>
                                    
                                    <label for="inputUdmPositionM" class="col-md-3 control-label addWidgetParLabel">U/M position</label>
                                    <div class="col-md-3">
                                        <select name="inputUdmPositionM" class="form-control" id="inputUdmPositionM" required>
                                            <option value="next">Next to value</option>
                                            <option value="below">Below value</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <label for="inputShowTitleM" class="col-md-2 control-label addWidgetParLabel">Show header</label>
                                    <div class="col-md-3">
                                        <select id="inputShowTitleM" name="inputShowTitleM" class="form-control" required>
                                                <option value="yes">Yes</option>
                                                <option value="no">No</option>
                                        </select>
                                    </div>
                                    
                                    <label for="inputFontFamilyWidgetM" class="col-md-3 control-label addWidgetParLabel">Font type (autosuggestion)</label>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control autocomplete" id="inputFontFamilyWidgetM" name="inputFontFamilyWidgetM" required>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        <div class="well wellCustom2left" id="specificParamsM">
                            <legend class="legend-form-group">Specific widget properties</legend>
                            <!--NON CANCELLARE -->
                            <input type="hidden" id="parametersM" name="parametersM" />
                            <input type="hidden" id="parametersDiff" name="parametersDiff" />
                            <input type="hidden" id="barsColorsM" name="barsColorsM" />
                        </div>
                        <div class="well wellCustom2right" id="infoTextareaDivM">
                            <legend class="legend-form-group">Widget detailed informations</legend>
                            <div class="row">
                                <label for="infoMainSelectM" class="col-sm-1 control-label">Target</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="infoMainSelectM" name="infoMainSelectM">       
                                    </select>                                                                     
                                </div>
                                <label for="infoAxisSelectM" class="col-sm-1 control-label">Set</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="infoAxisSelectM" name="infoAxisSelectM">       
                                    </select>                                                                     
                                </div>
                                <label for="infoFieldSelectM" class="col-sm-1 control-label">Field</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="infoFieldSelectM" name="infoFieldSelectM">       
                                    </select>                                                                     
                                </div> 
                            </div>
                            <div id="widgetInfoCkEditorTitleRowM" class="row centerWithFlex">
                                <h5 id="widgetInfoCkEditorTitleM"></h5>
                            </div>
                            <input type="hidden" id="infoNamesJsonFirstAxisM" name="infoNamesJsonFirstAxisM">
                            <input type="hidden" id="infoNamesJsonSecondAxisM" name="infoNamesJsonSecondAxisM">
                        </div>
                        
                        
                        <div class="well wellCustomFooter">
                            <button id="button_modify_widget" name="modify_widget" class="btn btn-primary widgetFormButton" type="submit">Confirm</button>
                            <button id="closeModifyWidgetBtn" type="button" class="btn btn-default widgetFormButton widgetFormButtonMargin" data-dismiss="modal">Cancel</button>   
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Fine modale modifica widget -->
        
    <!-- Modale embed previewer -->
    <div class="modal fade" id="embedDashboardModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modalHeader centerWithFlex">
              Embed this dashboard
            </div>
            
            <div id="embedDashboardModalBody" class="modal-body modalBody">
                <div class="row" id="modalEmbedDasboardBodyContent">
                    <div class="col-xs-12 col-md-3 embedDashboardModalColumn">
                        <div class="col-xs-12 embedDashboardModalColumnInner"> <!-- Serve solo per separazione grafica -->
                            <div class="col-xs-12 mainContentRowDesc centerWithFlex">Iframe markup generation</div>
                            <div class="col-xs-12 modalCell">
                                <div class="modalFieldCnt">
                                    <select id="embedPolicy" name="embedPolicy" class="modalInputTxt">
                                        <option value="auto">Automatic</option>
                                        <option value="manual">Manual</option>
                                    </select>
                                </div>
                                <div class="modalFieldLabelCnt">Embed mode</div>
                            </div>
                            <div class="col-xs-12 col-md-6 modalCell" for="embedShowHeader">
                                <div class="modalFieldCnt">
                                    <select id="embedShowHeader" name="embedShowHeader" class="modalInputTxt">
                                        <option value="yes">Yes</option>
                                        <option value="no">No</option>
                                    </select>
                                </div>
                                <div class="modalFieldLabelCnt">Show header</div>
                            </div>
                            <div class="col-xs-12 col-md-6 modalCell" for="embedAutofit">
                                <div class="modalFieldCnt">
                                    <select id="embedAutofit" name="embedAutofit" class="modalInputTxt">
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>
                                <div class="modalFieldLabelCnt">Autofit</div>
                            </div>
                            <div class="col-xs-12 col-md-6 modalCell" for="embedIframeW">
                                <div class="modalFieldCnt">
                                    <input type="text" id="embedIframeW" class="modalInputTxt" value="800" />
                                </div>
                                <div class="modalFieldLabelCnt">Iframe width (px)</div>
                            </div>
                            <div class="col-xs-12 col-md-6 modalCell" for="embedIframeH">
                                <div class="modalFieldCnt">
                                    <input type="text" id="embedIframeH" class="modalInputTxt" value="600" />
                                </div>
                                <div class="modalFieldLabelCnt">Iframe height (px)</div>
                            </div>
                            <div class="col-xs-12 modalCell" for="embedDashboardCode">
                                <textarea class="modalInputTxtArea" rows="5" name="embedDashboardCode" id="embedDashboardCode"></textarea>
                                <div class="modalFieldLabelCnt">Code to embed this dashboard</div>
                            </div>
                            <!--<div id="embedDashboardModalSaveMarkupRow" class="col-xs-12 mainContentRowDesc centerWithFlex">Save iframe markup</div>-->
                            <div class="col-xs-12 col-md-6 centerWithFlex">
                                <a href="javascript:void(0)" id="saveTxtMarkup"><button class="btn btn-primary">Save in txt file</button></a>
                            </div>
                            <div class="col-xs-12 col-md-6 centerWithFlex">
                                <a href="javascript:void(0)" id="saveHtmlMarkup"><button class="btn btn-info">Save in html file</button></a>
                            </div>
                        </div>    
                    </div>
                    
                    <div class="col-xs-12 col-md-9 embedDashboardModalColumn">
                        <div class="col-xs-12 embedDashboardModalColumnInner"> <!-- Serve solo per separazione grafica -->
                            <div class="col-xs-12 mainContentRowDesc centerWithFlex">Iframe preview</div>
                            <div id="embedPreviewContainer" class="col-xs-12">
                                <iframe id="embedPreviewIframe"></iframe>
                            </div>
                        </div>
                    </div>    
                </div>
            </div>
            <div id="embedDashboardModalFooter" class="modal-footer">
              <button type="button" id="addWidgetTypeCancelBtn" class="btn cancelBtn" data-dismiss="modal">Cancel</button>
              <button type="button" id="addWidgetTypeConfirmBtn" name="addWidgetType" class="btn confirmBtn internalLink">Confirm</button>
            </div>
          </div>
        </div>
    </div>
    <!-- Fine modale embed previewer -->
    
    <!-- Fine dei modali -->
            <script type='text/javascript'>
                var gridster, num_cols, indicatore, datoTitle, datoSubtitle, datoColor, datoWidth, datoRemains, nuovaDashboard, headerFontSize, headerModFontSize, subtitleFontSize, clockFontSizeMod, dashboardName, logoFilename, logoLink, temp, widgetsArray, nomeComune, metricType = null;
                var array_metrics = new Array();
                var informazioni = new Array();
                var elencoScheduler = new Array();
                var elencoJobsGroupsPerScheduler = [[],[],[]];
                var firstFreeRow = 1;
                var comuniLammaArray = new Array();
                var addWidgetConditionsArray = new Array();
                var editWidgetConditionsArray = null; //Lascialo così, il vettore viene istanziato ad ogni apertura di modale.
                
                $("#button_close_popup").click(function()
                {
                    location.reload();
                });
                
                $("#closeModifyWidgetBtn").click(function()
                {
                    location.reload();
                });
                
                $(document).ready(function ()
                {
                    var widgetsBorders = null; 
                    var widgetsBordersColor = null; 
                    var hospitalList = null; 
                    var gisTargetCenterMapDiv = null; 
                    var gisTargetCenterMapDivRef = null; 
                    var gisTargetCenterMapDivRefM = null; 
                    var gisTargetCenterMapDivM = null;
                    var headerVisible = null;
                    var editorsArray = new Array();
                    var editorsArrayM = new Array();
                    var authorizedPages = null;
                    var embedViewUrl, sampleIframe = null;
                    var defaultFontFamilyArray = ["Auto", "Arial", "Calibri", "Comic Sans MS", "Courier New", "Open Sans", "Times New Roman", "Verdana"];
                    var fontFamilyArray = [];
                    var queryFieldFromDb = null;
                    var internalDest = false;
                    var dashboardTitlesList = null;
                    
                    var sessionEndTime = "<?php echo $_SESSION['sessionEndTime']; ?>";
                    $('#sessionExpiringPopup').css("top", parseInt($(window).height() - $('#sessionExpiringPopup').height()) + "px");
                    $('#sessionExpiringPopup').css("left", parseInt($(window).width() - $('#sessionExpiringPopup').width()) + "px");
                    
                    $(window).resize(function(){
                        $('#sessionExpiringPopup').css("top", parseInt($(window).height() - $('#sessionExpiringPopup').height()) + "px");
                        $('#sessionExpiringPopup').css("left", parseInt($(window).width() - $('#sessionExpiringPopup').width()) + "px");
                    });
                    
                    $('#widgetCategory').val(-1);
                    
                    $.ajax({
                        url: "iframeProxy.php",
                        data: {
                            action: "getOrionEntityList",
                        },
                        type: "GET",
                        async: true,
                        dataType: 'json',
                        success: function(data)
                        {
                            for(var i = 0; i < data.length; i++)
                            {
                                $('#widgetEntity').append('<option value="' + data[i].id + '">' + data[i].id + '</option>');
                                $('#widgetEntityM').append('<option value="' + data[i].id + '">' + data[i].id + '</option>');
                            }
                            
                            $('#widgetEntity').val(-1);
                        },
                        error: function(data)
                        {
                            console.log("Ko");
                            console.log(data);
                        }
                    });

                    setInterval(function(){
                        var now = parseInt(new Date().getTime() / 1000);
                        var difference = sessionEndTime - now;

                        if(difference === 300)
                        {
                            $('#sessionExpiringPopupTime').html("5 minutes");
                            $('#sessionExpiringPopup').show();
                            $('#sessionExpiringPopup').css("opacity", "1");
                            setTimeout(function(){
                                $('#sessionExpiringPopup').css("opacity", "0");
                                setTimeout(function(){
                                    $('#sessionExpiringPopup').hide();
                                }, 1000);
                            }, 4000);
                        }

                        if(difference === 120)
                        {
                            $('#sessionExpiringPopupTime').html("2 minutes");
                            $('#sessionExpiringPopup').show();
                            $('#sessionExpiringPopup').css("opacity", "1");
                            setTimeout(function(){
                                $('#sessionExpiringPopup').css("opacity", "0");
                                setTimeout(function(){
                                    $('#sessionExpiringPopup').hide();
                                }, 1000);
                            }, 4000);
                        }

                        if((difference > 0)&&(difference <= 60))
                        {
                            $('#sessionExpiringPopup').show();
                            $('#sessionExpiringPopup').css("opacity", "1");
                            $('#sessionExpiringPopupTime').html(difference + " seconds");
                        }

                        if(difference <= 0)
                        {
                            //console.log("Logout");
                            location.href = "logout.php?sessionExpired=true";
                        }
                        /*else
                        {
                            console.log("Keep in");
                        }*/
                    }, 1000);
                    
                    $('#link_duplicate_dash').click(function(){
                        $('#cloneDashboardModal').modal('show');
                        
                        $.ajax({
                            url: "process-form.php",
                            data: {
                                getDashboardTitlesList: true,
                            },
                            type: "GET",
                            async: true,
                            dataType: 'json',
                            success: function(data)
                            {
                                if(data.detail !== 'Ok')
                                {
                                    console.log("Error getting dashboards titles list");
                                    console.log(data);
                                    $('#duplicateDashboardLoadingTitlesRow').hide();
                                    $('#duplicateDashboardLoadingTitlesKoRow').show();
                                    
                                    setTimeout(function(){
                                        $('#cloneDashboardModal').modal('hide');
                                        setTimeout(function(){
                                            $('#duplicateDashboardLoadingTitlesKoRow').hide();
                                            $('#duplicateDashboardLoadingTitlesRow').show();
                                        }, 300);
                                    }, 3500);
                                }
                                else
                                {
                                    dashboardTitlesList = data.titles;
                                    $('#duplicateDashboardLoadingTitlesRow').hide();
                                    $('#cloningDashboardFormRow').show();
                                    $('#cloneDashboardModalFooter').show();
                                    $('#newDashboardTitle').on('input', function(){
                                        if($('#newDashboardTitle').val().trim().length < 4)
                                        {
                                            $('#cloneDashboardTitleMsg').html("Title can't be less than 4 characters long");
                                            $('#cloneDashboardTitleMsg').css("color", "red");
                                            $('#duplicateDashboardBtn').attr("disabled", true);
                                        }
                                        else
                                        {
                                            if(dashboardTitlesList.indexOf($('#newDashboardTitle').val().trim()) > 0)
                                            {
                                                $('#cloneDashboardTitleMsg').html("Title already in use");
                                                $('#cloneDashboardTitleMsg').css("color", "red");
                                                $('#duplicateDashboardBtn').attr("disabled", true);
                                            }
                                            else
                                            {
                                                $('#cloneDashboardTitleMsg').html("Ok");
                                                $('#cloneDashboardTitleMsg').css("color", "rgba(0, 162, 211, 1)");
                                                $('#duplicateDashboardBtn').attr("disabled", false);
                                            }
                                        }
                                    });
                                }
                            },
                            error: function(errorData)
                            {
                                console.log("Error getting dashboards titles list");
                                console.log(errorData);
                                $('#duplicateDashboardLoadingTitlesRow').hide();
                                $('#duplicateDashboardLoadingTitlesKoRow').show();

                                setTimeout(function(){
                                    $('#cloneDashboardModal').modal('hide');
                                    setTimeout(function(){
                                        $('#duplicateDashboardLoadingTitlesKoRow').hide();
                                        $('#duplicateDashboardLoadingTitlesRow').show();
                                    }, 300);
                                }, 3500);
                            }
                        });
                        
                    });
                    
                    <?php
                        if(isset($_REQUEST['openNotificator'])&&isset($_REQUEST['dashId'])&&isset($_REQUEST['widgetTitle'])){
                            if($_REQUEST['openNotificator'] == "1"){
                    ?>
                            var win = window.open('<?php echo $notificatorLink. "?usr=" . $_SESSION['loggedUsername'] . "&showAlerts=" . md5("Dashboard Manager" . "|" . $_REQUEST['widgetTitle'] . "|" . $_SESSION['dashboardTitle']); ?>', '_blank');
                            if(win) 
                            {
                                win.focus();
                            } 
                            else 
                            {
                                alert('New window opening blocked by your browser: please allow it to automatically open Notificator');
                            }
                    <?php
                            }
                        } 
                    ?>     
    
                    fontFamilyArray = defaultFontFamilyArray;
                    
                    $.fn.editable.defaults.mode = 'inline';
                    setAddWidgetConditionsArray(addWidgetConditionsArray);
                    
                    $('#saveTxtMarkup').parent().css("padding-top", "15px");
                    $('#saveTxtMarkup').parent().css("padding-bottom", "15px");
                    $('#saveHtmlMarkup').parent().css("padding-top", "15px");
                    $('#saveHtmlMarkup').parent().css("padding-bottom", "15px");
                    //$('#modal-add-widget .row').css('margin-bottom', '10px');
                    //$('#modal-modify-widget .row').css('margin-bottom', '10px');
                    
                    var dashboardId = "<?= $_SESSION['dashboardId'] ?>";
                    var dashboardIdEncoded = window.btoa(dashboardId);
                    $("#dashboardViewLink").attr("href", "../view/index.php?iddasboard=" + dashboardIdEncoded);
                    
                    var iconH = $("div.mainMenuItemContainer").height();
                    $("div.mainMenuIconContainer").css("height", iconH + "px");
                    
                    $('#inputFontFamilyWidget').attr('autocomplete', 'on');
                            
                    $('#inputFontFamilyWidget').autocomplete({
                        source: fontFamilyArray,
                        autoFocus: true,
                        minLength: 0,
                        create: function( event, ui ) {
                            $(this).val("Auto");
                        }
                    }).data("ui-autocomplete")._renderItem = function(ul, item){
                        return $( "<li>" )
                        .attr("data-value", item.value)
                        .append('<span style="font-family: ' + item.label + '">' + item.label + '</span>')
                        .appendTo(ul);
                    };
                    
                    $('#inputFontFamilyWidget').autocomplete().data("ui-autocomplete")._resizeMenu = function(){
                        var ul = this.menu.element;
                        ul.outerWidth(this.element.outerWidth() + 30);
                        ul.css("max-height", "300px");
                        ul.css("overflow-x", "auto");
                        ul.css("overflow-y", "auto");
                        ul.find('li').off('hover');
                        ul.find('li').hover(function(){
                            $(this).css("cursor", "pointer");
                            $(this).css("background-color", "#b3e0ff");
                        }, function(){
                            $(this).css("cursor", "default");
                            $(this).css("background-color", "transparent");
                        });
                    };
                    
                    $('#inputFontFamilyWidgetM').attr('autocomplete', 'on');
                            
                    $('#inputFontFamilyWidgetM').autocomplete({
                        source: fontFamilyArray,
                        autoFocus: false,
                        minLength: 1,
                        delay: 500,
                        create: function( event, ui ) {
                            $(this).val("Auto");
                        }
                    }).data("ui-autocomplete")._renderItem = function(ul, item){
                        return $( "<li>" )
                        .attr("data-value", item.value)
                        .append('<span style="font-family: ' + item.label + '">' + item.label + '</span>')
                        .appendTo(ul);
                    };
                    
                    $('#inputFontFamilyWidgetM').autocomplete().data("ui-autocomplete")._resizeMenu = function(){
                        var ul = this.menu.element;
                        ul.outerWidth(this.element.outerWidth() + 30);
                        ul.css("max-height", "300px");
                        ul.css("overflow-x", "auto");
                        ul.css("overflow-y", "auto");
                        ul.find('li').off('hover');
                        ul.find('li').hover(function(){
                            $(this).css("cursor", "pointer");
                            $(this).css("background-color", "#b3e0ff");
                        }, function(){
                            $(this).css("cursor", "default");
                            $(this).css("background-color", "transparent");
                        });
                    };
                    
                    $('div[for=embedShowHeader]').hide();
                    $('div[for=embedAutofit]').hide();
                    $('#embedShowHeader').hide();
                    $('#embedAutofit').hide();
                    $('#embedAutofit').val('no');
                    
                    $('#embedCodeBtn').click(function(){
                        embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&embedPreview=true";
                        
                        sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                        $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        $('#embedDashboardModal').modal('show');
                        setTimeout(function(){
                            $('#embedDashboardModal div.well').css('height', $('#embedDashboardModal div.modal-body').height());
                            $('#embedPreviewIframe').attr('width', $('#embedIframeW').val());
                            $('#embedPreviewIframe').attr('height', $('#embedIframeH').val());
                            $('#embedPreviewIframe').attr('src', embedViewUrl);
                            $('#embedPreviewContainer').css('height', $('#embedDashboardModal div.modal-body').height() - 100);
                        }, 250);
                    });
                    
                    $(window).resize(function(){
                        $('#embedDashboardModal div.well').css('height', $('#embedDashboardModal div.modal-body').height());
                        $('#embedPreviewContainer').css('height', $('#embedDashboardModal div.modal-body').height() - 100);
                    });
                    
                    $('#embedPolicy').change(function(){
                        if($(this).val() === 'auto') 
                        {
                            $('div[for=embedShowHeader]').hide();
                            $('div[for=embedAutofit]').hide();
                            $('#embedShowHeader').hide();
                            $('#embedAutofit').hide();
                            embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() +"&embedPreview=true";
                            sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                            $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        }
                        else
                        {
                            $('div[for=embedShowHeader]').show();
                            $('div[for=embedAutofit]').show();
                            $('#embedShowHeader').show();
                            $('#embedAutofit').show();
                            $('#embedAutofit').val('no');
                            embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&showHeader=" + $('#embedShowHeader').val() + "&autofit=" + $('#embedAutofit').val() + "&embedPreview=true";
                            sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                            $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        }
                        $('#embedPreviewIframe').attr('width', $('#embedIframeW').val());
                        $('#embedPreviewIframe').attr('height', $('#embedIframeH').val());
                        $('#embedPreviewIframe').attr('src', embedViewUrl);
                    });
                    
                    $('#embedShowHeader').change(function(){
                        embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&showHeader=" + $('#embedShowHeader').val() + "&autofit=" + $('#embedAutofit').val() + "&embedPreview=true";
                        sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                        $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        
                        $('#embedPreviewIframe').attr('width', $('#embedIframeW').val());
                        $('#embedPreviewIframe').attr('height', $('#embedIframeH').val());
                        $('#embedPreviewIframe').attr('src', embedViewUrl);
                    });
                    
                    $('#embedAutofit').change(function(){
                        embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&showHeader=" + $('#embedShowHeader').val() + "&autofit=" + $('#embedAutofit').val() + "&embedPreview=true";
                        sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                        $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        
                        $('#embedPreviewIframe').attr('width', $('#embedIframeW').val());
                        $('#embedPreviewIframe').attr('height', $('#embedIframeH').val());
                        $('#embedPreviewIframe').attr('src', embedViewUrl);
                    });
                    
                    $('#embedIframeW').on('input', function(){
                        if($('#embedPolicy').val() === 'auto') 
                        {
                            embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&embedPreview=true";
                            sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                            $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        }
                        else
                        {
                            embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&showHeader=" + $('#embedShowHeader').val() + "&autofit=" + $('#embedAutofit').val() + "&embedPreview=true";
                            sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                            $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        }
                        
                        $('#embedPreviewIframe').attr('width', $('#embedIframeW').val());
                        $('#embedPreviewIframe').attr('height', $('#embedIframeH').val());
                        $('#embedPreviewIframe').attr('src', embedViewUrl);
                    });
                    
                    $('#embedIframeH').on('input', function(){
                        if($('#embedPolicy').val() === 'auto') 
                        {
                            embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&embedPreview=true";
                            sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                            $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                        }
                        else
                        {
                            embedViewUrl = '<?php echo $appUrl; ?>' + "/view/index.php?iddasboard=" + dashboardIdEncoded + "&embedPolicy=" + $('#embedPolicy').val() + "&showHeader=" + $('#embedShowHeader').val() + "&autofit=" + $('#embedAutofit').val() + "&embedPreview=true";
                            sampleIframe = '<iframe width="' + $('#embedIframeW').val() + '" height="' + $('#embedIframeH').val() + '" src="' + embedViewUrl + '"></iframe>';
                            $('#embedDashboardCode').val(sampleIframe.replace("&embedPreview=true", ""));
                            
                        }
                        
                        $('#embedPreviewIframe').attr('width', $('#embedIframeW').val());
                        $('#embedPreviewIframe').attr('height', $('#embedIframeH').val());
                        $('#embedPreviewIframe').attr('src', embedViewUrl);
                    });
                    
                    $('#saveTxtMarkup').click(function(){
                       var file = new Blob([$('#embedDashboardCode').val()], {type: 'text/plain'});
                       $(this).attr('href', URL.createObjectURL(file));
                       $(this).attr('download', 'embedCode.txt');
                    });
                    
                    $('#saveHtmlMarkup').click(function(){
                       var markup = '<!DOCTYPE html>' +
                                    '<html>' + 
                                        '<head>' +
                                            '<title>Choose page title</title>' +
                                            '<meta charset="UTF-8">' +
                                            '<meta name="viewport" content="width=device-width, initial-scale=1.0">' +
                                        '</head>' +
                                        '<body>' +
                                            $('#embedDashboardCode').val() +
                                        '</body>' +
                                    '</html>'; 
                        
                       var file = new Blob([markup], {type: 'text/html'});
                       $(this).attr('href', URL.createObjectURL(file));
                       $(this).attr('download', 'embedCode.html');
                    });
                    
                    $('#embedDashboardCloseBtn').click(function(){
                        $('#embedDashboardModal').modal('hide');
                        setTimeout(function(){
                            $('div[for=embedShowHeader]').hide();
                            $('div[for=embedAutofit]').hide();
                            $('div[for=embedShowHeader]').parent().hide();
                            $('#embedShowHeader').hide();
                            $('#embedAutofit').hide();
                            $('#embedShowHeader').parent().parent().hide();
                            $('#embedPolicy').val('auto');
                        }, 250);
                    });
                    
                    $("#link_add_widget").click(function()
                    {
                       $("#modal-add-widget").modal("show");
                       //addWidgetConditionsArray["selectedMetricAndWidget"] = false;
                       $('#button_add_metric_widget').css("color", "red");
                       addWidgetConditionsArray["title"] = false;
                       $("label[for=inputTitleWidget]").css("color", "red");
                       addWidgetConditionsArrayLocal["thrs"] = true;
                       
                       //Controllo presenza titolo
                       $("#inputTitleWidget").off();
                       $("#inputTitleWidget").on('input', function(){
                           var pattern = /^$/; 
                           
                           if($("#select-widget").val() !== 'widgetProtezioneCivile')
                           {
                                if(pattern.test($(this).val()))
                                {
                                    addWidgetConditionsArray["title"] = false;
                                    $("label[for=inputTitleWidget]").css("color", "red");
                                }
                                else
                                {
                                   var newTitle = $(this).val();

                                   if($("div.titleDiv").length > 0)
                                   {
                                      $("div.titleDiv").each(function(i)
                                      {
                                         if($(this).html() === newTitle)
                                         {
                                            addWidgetConditionsArray["title"] = false;
                                            $("label[for=inputTitleWidget]").css("color", "red");
                                            return false;
                                         }
                                         else
                                         {
                                            addWidgetConditionsArray["title"] = true;
                                            $("label[for=inputTitleWidget]").css("color", "black");
                                         }
                                      });
                                   }
                                   else
                                   {
                                      addWidgetConditionsArray["title"] = true;
                                      $("label[for=inputTitleWidget]").css("color", "black");
                                   }
                                }
                           }
                           else
                           {
                               addWidgetConditionsArray["title"] = true;
                               $("label[for=inputTitleWidget]").css("color", "black");
                           }
                           
                           checkAddWidgetConditions();
                       });
                    });
                    
                    $('#inputDashboardVisibility').change(function(){
                        if($(this).val() === 'restrict') 
                        {
                            $('#inputDashboardVisibilityUsersTable').show();
                        }
                        else
                        {
                            $('#inputDashboardVisibilityUsersTable').hide();
                        }
                     });
                     
                     $.ajax({
                        url: "getUserVisibilitySetForEditDash.php",
                        type: "GET",
                        async: true,
                        dataType: 'json',
                        cache: false, 
                        success: function (data) 
                        {
                            $("#inputDashboardVisibility").val(data.visibility);
                            $('#inputDashboardVisibility').trigger("change");
        
                            for(var i = 0; i < data.users.length; i++)
                            {
                                if(data.users[i].consultationSetUser === data.users[i].enabledViewUser)
                                {
                                    $("#inputDashboardVisibilityUsersTable").append('<tr><td><input type="checkbox" name="selectedVisibilityUsers[]" checked="checked" value="' + data.users[i].consultationSetUser + '"/></td><td>' + data.users[i].username + '</td></tr>'); 
                                }
                                else
                                {
                                    $("#inputDashboardVisibilityUsersTable").append('<tr><td><input type="checkbox" name="selectedVisibilityUsers[]" value="' + data.users[i].consultationSetUser + '"/></td><td>' + data.users[i].username + '</td></tr>'); 
                                }
                            }
                            
                            //Metodo apposito per settare/desettare gli attributi checked sulle checkbox
                            $('#inputDashboardVisibilityUsersTable input[type="checkbox"').off('click');
                            $('#inputDashboardVisibilityUsersTable input[type="checkbox"').click(function(){
                                if($(this).attr("checked") === "checked")
                                {
                                    $(this).removeAttr("checked");
                                }
                                else
                                {
                                    $(this).attr("checked", "true");
                                }
                            });
                        },
                        error: function (data) 
                        {
                            console.log("KO: " + JSON.stringify(data));
                        }
                    });
                    
                    $.ajax({
                        url: "<?=$serviceMapUrlPrefix?>api/v1/?selection=43.81224123241114;11.25284173812866&categories=First_aid&maxResults=100&maxDists=200&format=json&lang=it",
                        type: "GET",
                        async: true,
                        dataType: 'json',
                        success: function (data) 
                        {
                           hospitalList = data;
                        },
                        error: function (data)
                        {
                           console.log("Error retrieving hospital list");
                           console.log(JSON.stringify(data));
                        }
                     });
                    
                    $('#inputWidthDashboard').on('slide',function(e)
                    {
                        var cols = parseInt(e.value);
                        var px = parseInt(cols*78 + 10);
                        var percent = parseInt(px/screen.width*100);
                        $('#pixelWidth').css("background-color", "white");
                        $('#percentWidth').css("background-color", "white");
                        $('#pixelWidth').val(px + " px");
                        $('#percentWidth').val(percent + " %");
                    });
                    
                    $.ajax({
                        url: "https://servicemap.km4city.org/WebAppGrafo/sparql?query=select+distinct+%3Fn+%3Fs+%7B%0D%0A%3Fs+a+km4c%3AMunicipality.%0D%0A%3Fs+foaf%3Aname+%3Fn%0D%0A%7D+order+by+%3Fn&format=json",
                        type: "GET",
                        async: true,
                        dataType: 'json',
                        success: function (data) 
                        {
                            for(var i = 0; i < data.results.bindings.length; i++)
                            {
                                comuniLammaArray.push(data.results.bindings[i].n.value);
                            }
                        },
                        error: function (data) 
                        {
                            console.log("Errore nella chiamata Sparql per reperimento comuni Lamma");
                        }
                    });

                    $.ajax({
                        url: "get_data.php",
                        data: {action: "get_param_dashboard"},
                        type: "GET",
                        async: true,
                        cache: false,
                        dataType: 'json',
                        success: function (data) {
                            for(var i = 0; i < data.length; i++)
                            {
                                $("#headerLogoImg").css("display", "none");
                                dashboardId = data[i].Id;
                                dashboardName = data[i].name_dashboard;
                                logoFilename = data[i].logoFilename;
                                logoLink = data[i].logoLink;
                                widgetsBorders = data[i].widgetsBorders;
                                widgetsBordersColor = data[i].widgetsBordersColor;
                                headerVisible = data[i].headerVisible;
                                
                                if((data[i].authorizedPagesJson !== '')&&(data[i].authorizedPagesJson !== null)&&(data[i].authorizedPagesJson !== 'NULL')&&(data[i].authorizedPagesJson !== '[]'))
                                {
                                    var row = null;
                                    authorizedPages = JSON.parse(data[i].authorizedPagesJson);
                                    $('#authorizedPagesJson').val(data[i].authorizedPagesJson);
                                    
                                    for(var j = 0; j < authorizedPages.length; j++)
                                    {
                                       row = $('<tr><td><a href="#" class="toBeEdited" data-type="text" data-mode="popup"></a></td><td><i class="fa fa-minus"></i></td></tr>');
                                       $('#authorizedPagesTable tbody').append(row); 
                                       
                                       row.find('a').editable({
                                            emptytext: "Empty",
                                            value: authorizedPages[j],
                                            display: function(value, response){
                                                if(value.length > 35)
                                                {
                                                    $(this).html(value.substring(0, 32) + "...");
                                                }
                                                else
                                                {
                                                   $(this).html(value); 
                                                }
                                            }
                                        });
                                        
                                        row.find('i.fa-minus').click(function(){
                                            var rowIndex = $(this).parents('tr').index();
                                            $('#authorizedPagesTable tbody tr').eq(rowIndex).remove();
                                            authorizedPages.splice(rowIndex, 1);
                                            $('#authorizedPagesJson').val(JSON.stringify(authorizedPages));
                                        });

                                        row.find('a.toBeEdited').on('save', function(e, params){
                                            var rowIndex = $(this).parents('tr').index();
                                            authorizedPages[rowIndex] = params.newValue;
                                            $('#authorizedPagesJson').val(JSON.stringify(authorizedPages));
                                        });
                                    }
                                }
                                else
                                {
                                    authorizedPages = [];
                                    $('#authorizedPagesJson').val(JSON.stringify(authorizedPages));
                                }
                                
                                $('#addAuthorizedPageBtn').click(function(){
                                    var row = $('<tr><td><a href="#" class="toBeEdited" data-type="text" data-mode="popup"></a></td><td><i class="fa fa-minus"></i></td></tr>');
                                    $('#authorizedPagesTable tbody').append(row);

                                    var rowIndex = row.index();

                                    row.find('a').editable({
                                       emptytext: "Empty",
                                       display: function(value, response){
                                           if(value.length > 35)
                                           {
                                               $(this).html(value.substring(0, 32) + "...");
                                           }
                                           else
                                           {
                                              $(this).html(value); 
                                           }
                                       }
                                   });

                                   authorizedPages[rowIndex] = null;
                                   $('#authorizedPagesJson').val(JSON.stringify(authorizedPages));

                                   row.find('i.fa-minus').click(function(){
                                       var rowIndex = $(this).parents('tr').index();
                                       $('#authorizedPagesTable tbody tr').eq(rowIndex).remove();
                                       authorizedPages.splice(rowIndex, 1);
                                       $('#authorizedPagesJson').val(JSON.stringify(authorizedPages));
                                   });

                                   row.find('a.toBeEdited').on('save', function(e, params){
                                       var rowIndex = $(this).parents('tr').index();
                                       authorizedPages[rowIndex] = params.newValue;
                                       $('#authorizedPagesJson').val(JSON.stringify(authorizedPages));
                                   });
                               });
                                
                                
                                //Le parti commentate sono da spunto per futura modifica che toglie i marginin dx e sx, ma questo sconvolge tutte le dashboard esistenti, si farà in futuro
                                var wrapperWidth = parseInt(data[i].width) + 40;
                                $("#wrapper-dashboard-cfg").css("width", wrapperWidth);
                                $("#container-widgets-cfg").css("width", /*wrapperWidth*/data[i].width);
                                $("#logos-cfg").css("width", data[i].width);
                                $("#wrapper-dashboard-cfg").css("margin", "0 auto");
                                $("#navbarDashboard").css("background-color", data[i].color_header);
                                
                                /*$('#pageWrapperCfg div.container-fluid').css('padding-left', '0px');
                                $('#pageWrapperCfg div.container-fluid').css('padding-right', '0px');*/
                                
                                var headerFontColor = data[i].headerFontColor;
                                headerFontSize = data[i].headerFontSize;
                                subtitleFontSize = parseInt(data[i].headerFontSize * 0.22);
                                if(subtitleFontSize < 20)
                                {
                                    subtitleFontSize = 20;
                                }
                                
                                $("#dashboardTitle").css("font-size", headerFontSize + "pt");
                                $("#dashboardTitle").css("color", headerFontColor);
                                $("#dashboardTitle").text(data[i].title_header);
                                $("#clock").css("color", headerFontColor);
                                
                                var a = $('#dashboardTitle').prop("offsetWidth");
                                var b = $("#clock").prop("offsetWidth");

                                if(a > 912)
                                {
                                    headerModFontSize = headerFontSize;
                                    subtitleModFontSize = subtitleFontSize;
                                }
                                else
                                {
                                    if(a > 768)
                                    {
                                        headerModFontSize = parseInt((headerFontSize*0.9));
                                        subtitleModFontSize = parseInt((subtitleFontSize*0.8));    
                                    }
                                    else
                                    {

                                        if(a > 320)
                                        {
                                            headerModFontSize = parseInt((headerFontSize*0.75));
                                            subtitleModFontSize = parseInt((subtitleFontSize*0.65));
                                        }
                                        else
                                        {
                                            headerModFontSize = parseInt((headerFontSize*0.55));
                                            subtitleModFontSize = parseInt((subtitleFontSize*0.45));
                                        }
                                    }
                                }
                                if(b > 288)
                                {
                                    clockFontSizeMod = 18;
                                }
                                else
                                {
                                    if(b > 217)
                                    {
                                        clockFontSizeMod = parseInt((18*0.8));
                                    }
                                    else
                                    {
                                        if(b >= 188)
                                        {
                                            clockFontSizeMod = parseInt((18*0.7));
                                        }
                                        else
                                        {
                                            if(b >= 136)
                                            {
                                                clockFontSizeMod = parseInt((18*0.55));
                                            }
                                            else
                                            {
                                                clockFontSizeMod = parseInt((18*0.43));
                                            }
                                        }
                                    }
                                }

                                $("#dashboardTitle").css("font-size", headerModFontSize + "pt");
                                $("#dashboardTitle").css("color", headerFontColor);
                                $("#dashboardTitle").text(data[i].title_header);
                                $("#clock").css("color", headerFontColor);
                                $("#clock").css("font-size", clockFontSizeMod + "pt");

                                var whiteSpaceRegex = '^[ t]+';
                                if((data[i].subtitle_header === "") || (data[i].subtitle_header === null) ||(typeof data[i].subtitle_header === 'undefined') || (data[i].subtitle_header.match(whiteSpaceRegex)))
                                {
                                    $("#dashboardTitle").css("height", "100%");
                                    $("#dashboardSubtitle").css("display", "none");
                                }
                                else
                                {
                                    $("#dashboardTitle").css("height", "70%");
                                    $("#dashboardSubtitle").css("height", "30%");
                                    $("#dashboardSubtitle").css("display", "");
                                    $("#dashboardSubtitle").css("font-size", subtitleModFontSize + "pt");
                                    $("#dashboardSubtitle").css("color", headerFontColor);
                                    $("#dashboardSubtitle").text(data[i].subtitle_header);
                                }
                                
                                if(logoFilename !== null)
                                {
                                    $("#headerLogoImg").prop("src", "../img/dashLogos/dashboard" + dashboardId + "/" + logoFilename);
                                    $("#headerLogoImg").prop("alt", "Dashboard logo");
                                    $("#headerLogoImg").show();
                                    
                                    if((logoLink !== null) && (logoLink !== ''))
                                    {
                                       var logoImage = $('#headerLogoImg');
                                       var logoLinkElement = $('<a href="' + logoLink + '" target="_blank" class="pippo">'); 
                                       logoImage.wrap(logoLinkElement);
                                       $('#dashboardLogoLinkInput').val(logoLink);
                                       $('#dashboardLogoLinkInput').removeAttr('disabled');
                                    }
                                }
                                
                                if(headerVisible === '1')
                                {
                                   $("#navbarDashboard").show();
                                   $("#navbarDashboard").css("margin-bottom", "100px");
                                   $("#headerSpacer").show();
                                   //$("#showHideHeader i").attr("class", "fa fa-compress");
                                   //$("#showHideHeader").attr("title", "Hide dashboard header");
                                }
                                else
                                {
                                   $("#navbarDashboard").hide();
                                   $("#navbarDashboard").css("margin-bottom", "0px");
                                   $("#headerSpacer").hide();
                                   $('#editDashboardMenu').css("margin-top", "0px");
                                   //$("#showHideHeader i").attr("class", "fa fa-expand");
                                   //$("#showHideHeader").attr("title", "Show dashboard header");
                                }
                                
                                //Aggiunta delle impostazioni della Dashboard nel Menu Modify
                                $("#inputTitleDashboard").val(data[i].title_header);
                                $('#headerFontColor').parent().colorpicker({
                                    format: "rgba",
                                    color: data[i].headerFontColor
                                });
                                
                                if(data[i].headerVisible === "1")
                                {
                                    $('#headerVisible').attr("checked", true);
                                }
                                
                                $('#headerVisible').bootstrapToggle({
                                    on: 'Yes',
                                    off: 'No',
                                    onstyle: 'info',
                                    offstyle: 'default',
                                    size: 'normal'
                                });
                                

                                $('#headerFontSize').bootstrapSlider({
                                    tooltip_position: 'top',
                                    value: data[i].headerFontSize
                                });
                                
                                if(widgetsBorders === "yes")
                                {
                                    $("#widgetsBorders").attr("checked", true);
                                }

                                $('#widgetsBorders').bootstrapToggle({
                                    on: 'Yes',
                                    off: 'No',
                                    onstyle: 'info',
                                    offstyle: 'default',
                                    size: 'normal'
                                });
                                
                                $("#inputSubTitleDashboard").attr("placeholder", data[i].subtitle_header);
                                $("#inputSubTitleDashboard").val(data[i].subtitle_header);
                                
                                $('#inputColorDashboard').parent().colorpicker({
                                    format: "rgba",
                                    color: data[i].color_header
                                });
                                
                                $("#inputWidthDashboard").val(data[i].num_columns);
                                $('#inputWidthDashboard').bootstrapSlider({
                                    tooltip_position: 'top',
                                    tooltip: 'always',
                                    value: data[i].num_columns
                                });

                                var cols = parseInt($('#inputWidthDashboard').val());
                                var px = parseInt(cols*78 + 10);
                                var percent = parseInt(px/screen.width*100);
                                $('#pixelWidth').val(px + " px");
                                $('#percentWidth').val(percent + " %");
                                
                                $("#inputWidgetsBordersColor").val(widgetsBordersColor);
                                $('#inputWidgetsBordersColor').parent().colorpicker({
                                    format: "rgba",
                                    color: widgetsBordersColor
                                });
                                $("#inputPickerWidgetsBorderColor").css("background-color", widgetsBordersColor);
                                $("#myModalLabelDas").text("Modify current Dashboard: " + data[i].name_dashboard);
                                $("#inputDashCol").val(data[i].color_header);
                                $("#remainsWidthDashboard").val(data[i].remains_width);
                                //Attribuisci nome dell'attuale Dashboard al menu di duplicazione
                                $('#currentDashboardTitle').val(data[i].title_header);
                                //fine duplicazione
                                
                                datoTitle = data[i].title_header;
                                datoSubtitle = data[i].subtitle_header;
                                datoColor = data[i].color_header;
                                num_cols = data[i].num_columns;
                                dato_back = data[i].color_background;
                                external_color = data[i].external_frame_color;
                                
                                $('body').css("background-color", external_color);
                                $('#pageWrapperCfg').css("background-color", external_color);
                                $('#inputDashExtCol').val(external_color);
                                $('#inputExternalColorDashboard').parent().colorpicker({
                                    format: "rgba",
                                    color: external_color
                                });
                                $('.logos-bar').css("background-color", external_color);
                                $('#color_e').css("background-color", external_color);
                                $('#container-widgets-cfg').css("background-color", dato_back);
                                $('#inputColorBackgroundDashboard').parent().colorpicker({
                                    format: "rgba",
                                    color: dato_back
                                });
                                $('#container-widgets-cfg').css("border-top-color", dato_back);
                                $('#container-widgets-cfg').css("border-color", dato_back);
                                $('#color_b').css("background-color", dato_back);
                                $('#color_h').css("background-color", datoColor);
                            }

                            $.ajax({
                                url: "get_data.php",
                                data: {action: "get_widgets_dashboard"},
                                type: "GET",
                                async: true,
                                cache: false,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    widgetsArray = data;
                                    for(var j = 0; j < widgetsArray.length; j++) 
                                    {
                                        informazioni[j] = widgetsArray[j].message_widget;
                                    }
                                    
                                    var gridsterCellW = 76;
                                    var gridsterCellH = 38;
                                    
                                    jQuery("#container-widgets-cfg ul").gridster({
                                        widget_base_dimensions: [gridsterCellW, gridsterCellH],
                                        widget_margins: [1, 1],
                                        min_cols: num_cols,
                                        max_size_x: 30,
                                        max_rows: 50,
                                        extra_rows: 50,
                                        draggable: {
                                            //ignore_dragging: true,
                                            stop: function(){
                                                firstFreeRow = 1;
                                                $(".gridsterCell").each(function() 
                                                {
                                                    temp = parseInt(parseInt($(this).attr('data-row')) + parseInt($(this).attr('data-sizey')));
                                                    if(temp > firstFreeRow)
                                                    {
                                                        firstFreeRow = temp;
                                                    }
                                                });
                                            }
                                        },
                                        serialize_params: function (w, wgd) 
                                        {
                                            return {
                                                id: w.attr('id'),
                                                col: wgd.col,
                                                row: wgd.row,
                                                size_x: wgd.size_x,
                                                size_y: wgd.size_y
                                            };
                                        } 
                                    });
                                    
                                    if(widgetsArray.length > 0) 
                                    {
                                        gridster = $("#container-widgets-cfg ul").gridster().data('gridster');
                                        for(var i = 0; i < widgetsArray.length; i++)
                                        {
                                            var name_w = data[i]['name_widget'];
                                            var time = 0;
                                            if(data[i]['temporal_range_widget'] !== "" && widgetsArray[i]['temporal_range_widget'] === "Mensile") 
                                            {
                                                time = "30/DAY";
                                            } 
                                            else if (data[i]['temporal_range_widget'] !== "" && widgetsArray[i]['temporal_range_widget'] === "Annuale") 
                                            {
                                                time = "365/DAY";
                                            } 
                                            else if (data[i]['temporal_range_widget'] !== "" && widgetsArray[i]['temporal_range_widget'] === "Settimanale") 
                                            {
                                                time = "7/DAY";
                                            } 
                                            else if (data[i]['temporal_range_widget'] !== "" && widgetsArray[i]['temporal_range_widget'] === "Giornaliera") 
                                            {
                                                time = "1/DAY";
                                            } 
                                            else if (data[i]['temporal_range_widget'] !== "" && widgetsArray[i]['temporal_range_widget'] === "4 Ore") 
                                            {
                                                time = "4/HOUR";
                                            } 
                                            else if (data[i]['temporal_range_widget'] !== "" && widgetsArray[i]['temporal_range_widget'] === "12 Ore") 
                                            {
                                                time = "12/HOUR";
                                            }
                                            
                                            temp = parseInt(parseInt(widgetsArray[i]['n_row_widget']) + parseInt(widgetsArray[i]['size_rows_widget']));
                                            if(temp > firstFreeRow)
                                            {
                                                firstFreeRow = temp;
                                            }
                                            
                                            gridster.add_widget('<li data-widgetId="' + widgetsArray[i]['id_widget'] + '" id="' + name_w + '" class="gridsterCell"></li>', widgetsArray[i]['size_columns_widget'], widgetsArray[i]['size_rows_widget'], widgetsArray[i]['n_column_widget'], widgetsArray[i]['n_row_widget']);
                                           
                                            var type_metric = new Array();
                                            var source_metric = new Array();
                                            var info_message = new Array();
                                            for(var k = 0; k < widgetsArray[i]['metrics_prop'].length; k++) 
                                            {
                                                type_metric.push(widgetsArray[i]['metrics_prop'][k]['type_metric']);
                                                source_metric.push(widgetsArray[i]['metrics_prop'][k]['source_metric']);
                                                info_message.push(informazioni[i]);
                                            }

                                            $("#containerUl").find("li#" + name_w).load("../widgets/" + encodeURIComponent(widgetsArray[i]['source_file_widget']) + "?name=" + encodeURIComponent(name_w) + "&hostFile=config" + "&idWidget=" + encodeURIComponent(data[i]['id_widget']) + "&metric=" + encodeURIComponent(data[i]['id_metric_widget']) + "&embedWidget=false&embedWidgetPolicy=auto" +
                                                    "&freq=" + encodeURIComponent(widgetsArray[i]['frequency_widget']) + "&title=" + encodeURIComponent(widgetsArray[i]['title_widget']) + "&color=" + encodeURIComponent(widgetsArray[i]['color_widget']) + "&source=" + encodeURIComponent(source_metric) +
                                                    "&fontColor=" + encodeURIComponent(widgetsArray[i]['fontColor']) + "&fontSize=" + encodeURIComponent(widgetsArray[i]['fontSize']) + "&type_metric=" + encodeURIComponent(type_metric) + "&tmprange=" + encodeURIComponent(time) + "&city=" + encodeURIComponent(widgetsArray[i]['municipality_widget']) + /*"&info=" + encodeURIComponent(info_message) +*/ "&link_w=" + encodeURIComponent(widgetsArray[i]['link_w']) + "&frame_color=" + encodeURIComponent(widgetsArray[i]['frame_color']) +
                                                    "&headerFontColor=" + encodeURIComponent(widgetsArray[i]['headerFontColor']) + "&numCols=" + encodeURIComponent(num_cols) + "&sizeX=" + encodeURIComponent(widgetsArray[i]['size_columns_widget']) + "&sizeY=" + encodeURIComponent(widgetsArray[i]['size_rows_widget']) + "&controlsPosition=" + encodeURIComponent(widgetsArray[i]['controlsPosition']) + "&zoomControlsColor=" + encodeURIComponent(widgetsArray[i]['zoomControlsColor']) + "&showTitle=" + encodeURIComponent(widgetsArray[i]['showTitle']) + "&controlsVisibility=" + encodeURIComponent(widgetsArray[i]['controlsVisibility']) + "&zoomFactor=" + encodeURIComponent(widgetsArray[i]['zoomFactor']) + "&defaultTab=" + encodeURIComponent(widgetsArray[i]['defaultTab']) + "&scaleX=" + encodeURIComponent(widgetsArray[i]['scaleX']) + "&scaleY=" + encodeURIComponent(widgetsArray[i]['scaleY']), function () {
                                                $(this).find(".icons-modify-widget").css("display", "inline");
                                                $(this).find(".modifyWidgetGenContent").css("display", "block");
                                                $(this).find(".pcCountdownContainer").css("display", "none");
                                                $(this).find(".iconsModifyPcWidget").css("display", "flex");
                                                $(this).find(".iconsModifyPcWidget").css("align-items", "center");
                                                $(this).find(".iconsModifyPcWidget").css("justify-content", "flex-end");
                                            });
                                        }
                                    }
                                    //Applicazione bordi dei widgets
                                    if(widgetsBorders === 'yes')
                                    {
                                        $(".gridster .gs_w").css("border", "1px solid " + widgetsBordersColor);
                                    }
                                    else
                                    {
                                        $(".gridster .gs_w").css("border", "none");
                                    }
                                    $('#firstFreeRowInput').val(firstFreeRow);
                                },
                                error: function(data) 
                                {
                                    console.log("Errore in chiamata di get_data.php --> get_widgets_dashboard");
                                    console.log(JSON.stringify(data));
                                }
                            });
                        }
                    });
                    
                    $('#dashboardLogoInput').change(function ()
                    {
                        $('#dashboardLogoLinkInput').removeAttr('disabled');
                    });
                    
                    $('#link_modifyDash').click(function ()
                    {
                        if($('#headerLogoImg').css("display") !== 'none')
                        {
                            $('#dashboardLogoLinkInput').removeAttr('disabled');
                        }
                    });
                    
                    $(window).resize(function() 
                    {
                        var a = $('#dashboardTitle').prop("offsetWidth");
                        var b = $("#clock").prop("offsetWidth");

                        if(a > 912)
                        {
                            headerModFontSize = headerFontSize;
                            subtitleModFontSize = subtitleFontSize;
                        }
                        else
                        {
                            if(a > 768)
                            {
                                headerModFontSize = parseInt((headerFontSize*0.9));
                                subtitleModFontSize = parseInt((subtitleFontSize*0.9));    
                            }
                            else
                            {
                                if(a > 320)
                                {
                                    headerModFontSize = parseInt((headerFontSize*0.75));
                                    subtitleModFontSize = parseInt((subtitleFontSize*0.75));
                                }
                                else
                                {
                                    headerModFontSize = parseInt((headerFontSize*0.55));
                                    subtitleModFontSize = parseInt((subtitleFontSize*0.55));
                                }
                            }
                        }
                        if(b > 288)
                        {
                            clockFontSizeMod = 18;
                        }
                        else
                        {
                            if(b > 217)
                            {
                                clockFontSizeMod = parseInt((18*0.8));
                            }
                            else
                            {
                                if(b >= 188)
                                {
                                    clockFontSizeMod = parseInt((18*0.7));
                                }
                                else
                                {
                                    if(b >= 136)
                                    {
                                        clockFontSizeMod = parseInt((18*0.55));
                                    }
                                    else
                                    {
                                        clockFontSizeMod = parseInt((18*0.43));
                                    }
                                }

                            }
                        }
                        $("#dashboardTitle").css("font-size", headerModFontSize + "pt");
                        $("#dashboardSubtitle").css("font-size", subtitleModFontSize + "pt");
                        $("#clock").css("font-size", clockFontSizeMod + "pt");
                    });
                    
                    //Reperimento elenco degli schedulers
                    $.ajax({
                        url: "get_data.php",
                        data: {action: "getSchedulers"},
                        type: "GET",
                        async: true,
                        dataType: 'json',
                        success: function (data) {
                            for(var i = 0; i < data.length; i++) 
                            {
                                elencoScheduler[i] = data[i];
                                $('#inputSchedulerWidget').append('<option>' + elencoScheduler[i].name + '</option>');
                                $('#inputSchedulerWidgetM').append('<option>' + elencoScheduler[i].name + '</option>');
                            }
                        }
                    });
                    
                    //Listener modifica dashboard attuale
                    /*$('#editDashboardConfirmBtn').click(function() 
                    {
                        var subtitleSize = null;
                        var form = $('#form-modify-dashboard');
                        var formData = new FormData(form);
                        
                        console.log("Form data");
                        console.log(form);
                        
                        if(formData.get('inputTitleDashboard') === '') 
                        {
                            formData.set('inputTitleDashboard', datoTitle);
                        } 
                        
                        if(formData.get('headerFontColor') === '')
                        {
                            formData.set('headerFontColor', '#ffffff');
                        }

                        if(formData.get('inputSubTitleDashboard') === '') 
                        {
                            formData.set('inputSubTitleDashboard', datoSubtitle);
                        }
                        
                        if(formData.get('inputDashCol') === '') 
                        {
                            formData.set('inputDashCol', datoColor);
                        } 
                        
                        if(formData.get('inputWidthDashboard') === '') 
                        {
                            formData.set('inputWidthDashboard', num_cols);
                        } 

                        if(formData.get('inputDashBckCol') === '') 
                        {
                            formData.set('inputDashBckCol', dato_back);
                        } 

                        if (formData.get('inputDashExtCol') === '') 
                        {
                            formData.set('inputDashExtCol', external_color);
                        } 
                        
                        formData.set('dashboardIdFromRequest', indicatore);
                        
                        jQuery.ajax({
                            url: 'save_config_dash.php',
                            data: formData,
                            processData: false,
                            contentType: false,  
                            type: 'POST',
                            success: function(data)
                            {
                                console.log("Success");
                                console.log(data);
                                //location.reload(true);
                            },
                            error:function (error) 
                            {
                               console.log("Errore in chiamata di save_config_dash.php");
                               console.log(error);
                            }
                        });
                    });*/

                    $.ajax({
                        url: "get_data.php",
                        data: {action: "get_metrics"},
                        type: "GET",
                        async: true,
                        dataType: 'json',
                        success: function (data) 
                        {
                            for (var i = 0; i < data.length; i++)
                            {
                                array_metrics[i] = {desc: data[i]['descMetric'],
                                    descShort: data[i]['descShortMetric'],
                                    id: data[i]['idMetric'],
                                    type: data[i]['typeMetric'],
                                    area: data[i]['areaMetric'],
                                    source: data[i]['sourceMetric'],
                                    freq: data[i]['freqMetric'],
                                    status: data[i]['statusMetric'],
                                    widgets: data[i]['widgets'],
                                    municipalityOption: data[i]['municipalityOptionMetric'],
                                    timeRangeOption: data[i]['timeRangeOptionMetric'],
                                    colorDefault: data[i]['colorDefaultMetric'],
                                    processType: data[i]['processTypeMetric'],
                                    query: data[i]['queryMetric']};

                                //24/02/2017 - Workaround per impedire di associare il widget StateRideAtaf a metriche diverse dalla sua e per impedire di associare il widget SmartDS a metriche diverse dalla sua
                                if(array_metrics[i].type === 'Percentuale')
                                {
                                    for(var z = array_metrics[i].widgets.length - 1; z >= 0; z--)
                                    {
                                        if((array_metrics[i].widgets[z].id_type_widget === 'widgetStateRideAtaf')&&(array_metrics[i].id !== 'Bus_State_Lines'))
                                        {
                                            array_metrics[i].widgets.splice(z, 1);
                                        }
                                    }
                                    
                                    for(var z = array_metrics[i].widgets.length - 1; z >= 0; z--)
                                    {
                                        if((array_metrics[i].widgets[z].id_type_widget !== 'widgetStateRideAtaf')&&(array_metrics[i].widgets[z].id_type_widget !== 'widgetPieChart')&&(array_metrics[i].id === 'Bus_State_Lines'))
                                        {
                                            array_metrics[i].widgets.splice(z, 1);
                                        } 
                                    }
                                    
                                    for(var z = array_metrics[i].widgets.length - 1; z >= 0; z--)
                                    {
                                        if((array_metrics[i].widgets[z].id_type_widget === 'widgetSmartDS')&&(array_metrics[i].id !== 'SmartDS_Process'))
                                        {
                                            array_metrics[i].widgets.splice(z, 1);
                                        } 
                                    }
                                    
                                    for(var z = array_metrics[i].widgets.length - 1; z >= 0; z--)
                                    {
                                        if((array_metrics[i].widgets[z].id_type_widget !== 'widgetSmartDS')&&(array_metrics[i].widgets[z].id_type_widget !== 'widgetPieChart')&&(array_metrics[i].id === 'SmartDS_Process'))
                                        {
                                            array_metrics[i].widgets.splice(z, 1);
                                        } 
                                    }
                                }
                                    
                                $('#select-metric').append('<option value="' + array_metrics[i]['id'] + '">' + array_metrics[i]['id'] + '</option>');
                            }
                            $('#select-metric').val(-1);

                        },
                        error: function (error) 
                        {
                           console.log("Errore in chiamata di get_data.php --> get_metrics");
                           console.log(error);
                        }
                    });

                    $('#modal-add-widget').on('shown.bs.modal', function () {
                        updateSelectedMetric();
                    });

                    //Listener cambio categoria widget (attuatore o data viewer) in aggiunta widget
                    $('#widgetCategory').change(function(){
                        if($(this).val() === 'actuator')
                        {
                            $('#widgetEntityRow').show();
                            $('#widgetAttributeRow').show();   
                            $('#widgetActuatorTypeRow').show();
                                    
                            
                            $('#selectMetricRow').hide();
                            $('#metricDescRow').hide();
                            $('#widgetTypeRow').hide();
                            $('#widgetTypeRow').hide();
                            $('#selectedMetricRow').hide();
                            $('#widgetLinkRow').hide();
                        }
                        else
                        {
                            $('#widgetEntityRow').hide();
                            $('#widgetAttributeRow').hide();
                            $('#widgetActuatorTypeRow').hide();
                            
                            $('#selectMetricRow').show();
                            $('#metricDescRow').show();
                            $('#widgetTypeRow').show();
                            $('#widgetTypeRow').show();
                            $('#selectedMetricRow').show();
                            $('#widgetLinkRow').show();
                        }
                    });
                    
                    //Listener cambio entità (per widget attuatori)
                    $('#widgetEntity').change(function(){
                        $.ajax({
                                url: "iframeProxy.php",
                                data: {
                                    action: "getOrionEntityAttributes", 
                                    entity: $('#widgetEntity').val()
                                },
                                type: "GET",
                                async: true,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    $('#widgetAttribute').empty();
                                    
                                    for(var key in data)
                                    {
                                        $('#widgetAttribute').append('<option value="' + key + '" data-type="' + data[key].type + '">' + key + '</option>');
                                    }
                                    
                                    $('#widgetAttribute').val(-1);
                                },
                                error: function(data)
                                {
                                    console.log("Ko");
                                    console.log(data);
                                }
                            });
                    });
                    
                    $('#widgetEntityM').change(function(){
                        $.ajax({
                                url: "iframeProxy.php",
                                data: {
                                    action: "getOrionEntityAttributes", 
                                    entity: $('#widgetEntityM').val()
                                },
                                type: "GET",
                                async: true,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    $('#widgetAttributeM').empty();
                                    
                                    for(var key in data)
                                    {
                                        $('#widgetAttributeM').append('<option value="' + key + '" data-type="' + data[key].type + '">' + key + '</option>');
                                    }
                                    
                                    $('#widgetAttributeM').val(-1);
                                },
                                error: function(data)
                                {
                                    console.log("Ko");
                                    console.log(data);
                                }
                            });
                    });
                    
                    $('#widgetAttribute').change(function(){
                        $.ajax({
                            url: "iframeProxy.php",
                            data: {
                                action: "getActuatorWidgetTypes", 
                                type: $('#widgetAttribute option:selected').attr('data-type')
                            },
                            type: "GET",
                            async: true,
                            dataType: 'json',
                            success: function (data) 
                            {
                                $('#widgetActuatorType').empty();
                                
                                for(var key in data.list)
                                {
                                    $('#widgetActuatorType').append('<option value="' + data.list[key].id_type_widget + '" data-min_row="' + data.list[key].min_row + '" + data-max_row="' + data.list[key].max_row + '" data-min_col="' + data.list[key].min_col + '" data-max_col="' + data.list[key].max_col + '">' + data.list[key].id_type_widget + '</option>')
                                }
                                
                                $('#widgetActuatorType').val(-1);
                            },
                            error: function(data)
                            {
                                console.log("Ko");
                                console.log(data);
                            }
                        });    
                    });
                    
                    $('#widgetAttributeM').change(function(){
                        $.ajax({
                            url: "iframeProxy.php",
                            data: {
                                action: "getActuatorWidgetTypes", 
                                type: $('#widgetAttributeM option:selected').attr('data-type')
                            },
                            type: "GET",
                            async: true,
                            dataType: 'json',
                            success: function (data) 
                            {
                                $('#widgetActuatorTypeM').empty();
                                
                                for(var key in data.list)
                                {
                                    $('#widgetActuatorTypeM').append('<option value="' + data.list[key].id_type_widget + '" data-min_row="' + data.list[key].min_row + '" + data-max_row="' + data.list[key].max_row + '" data-min_col="' + data.list[key].min_col + '" data-max_col="' + data.list[key].max_col + '">' + data.list[key].id_type_widget + '</option>')
                                }
                                
                                $('#widgetActuatorTypeM').val(-1);
                            },
                            error: function(data)
                            {
                                console.log("Ko");
                                console.log(data);
                            }
                        });    
                    });
                    
                    $('#widgetActuatorType').change(function(){
                        var minRow, maxRow, minCol, maxCol = null;
                        minRow = parseInt($('#widgetActuatorType option:selected').attr("data-min_row"));
                        maxRow = parseInt($('#widgetActuatorType option:selected').attr("data-max_row"));
                        minCol = parseInt($('#widgetActuatorType option:selected').attr("data-min_col"));
                        maxCol = parseInt($('#widgetActuatorType option:selected').attr("data-max_col"));
                        
                        $('#inputSizeRowsWidget').empty();
                        
                        for(var i = minRow; i <= maxRow; i++)
                        {
                            $('#inputSizeRowsWidget').append('<option value="' + i + '">' + i + '</option>');
                        }
                        
                        $('#inputSizeColumnsWidget').empty();
                        
                        for(var i = minCol; i <= maxCol; i++)
                        {
                            $('#inputSizeColumnsWidget').append('<option value="' + i + '">' + i + '</option>');
                        }
                    });
                    
                    $('#widgetActuatorTypeM').change(function(){
                        var minRow, maxRow, minCol, maxCol = null;
                        minRow = parseInt($('#widgetActuatorTypeM option:selected').attr("data-min_row"));
                        maxRow = parseInt($('#widgetActuatorTypeM option:selected').attr("data-max_row"));
                        minCol = parseInt($('#widgetActuatorTypeM option:selected').attr("data-min_col"));
                        maxCol = parseInt($('#widgetActuatorTypeM option:selected').attr("data-max_col"));
                        
                        $('#inputRows-m').empty();
                        
                        for(var i = minRow; i <= maxRow; i++)
                        {
                            $('#inputRows-m').append('<option value="' + i + '">' + i + '</option>');
                        }
                        
                        $('#inputColumn-m').empty();
                        
                        for(var i = minCol; i <= maxCol; i++)
                        {
                            $('#inputColumn-m').append('<option value="' + i + '">' + i + '</option>');
                        }
                    });

                    //Listener cambio metrica in aggiunta widget
                    $('#select-metric').change(updateSelectedMetric = function () 
                    {
                        var str = "";
                        $("#select-metric option:selected").each(function () {
                            str += $(this).text();
                        });
                        var value_text = "";
                        for (var j = 0; j < array_metrics.length; j++) 
                        {
                            if(array_metrics[j]['id'] == str) 
                            {
                                value_text += "Description: " + array_metrics[j]['desc'] + ".\n";
                                value_text += "Metric Typology: " + array_metrics[j]['type'] + ".\n";
                                metricType = array_metrics[j]['type'];
                                value_text += "Data Area: " + array_metrics[j]['area'] + ".\n";
                                value_text += "Data Source: " + array_metrics[j]['source'] + ".\n";
                                value_text += "Refresh rate: " + array_metrics[j]['freq'] + " s\n";
                                value_text += "Status: " + array_metrics[j]['status'] + ".";
                                $("#textarea-metric-c").val(value_text);
                                $("#inputFreqWidget").val(array_metrics[j]['freq']);
                                if((array_metrics[j]['type'] === 'isAlive')&&(array_metrics[j]['processType'] === 'checkStatus'))
                                {                        
                                    queryFieldFromDb = JSON.parse(array_metrics[j]['query']).url;                              
                                }
                                else
                                {
                                    console.log("Type: " + array_metrics[j]['type'] + " - Process type: " + array_metrics[j]['processType']);
                                }

                                if ($("#select-widget").is(':enabled')) 
                                {
                                    $("#select-widget").find('option').remove().end();
                                    for (var k = 0; k < array_metrics[j]['widgets'].length; k++) 
                                    {
                                        $("#select-widget").append('<option>' + array_metrics[j]['widgets'][k]['id_type_widget'] + '</option>');
                                    }
                                    
                                    //02/02/2017: commentato per testing, introduce bug sui ckeditor delle info
                                    update_select_widget();
                                    //$("#select-widget").val(-1);
                                }
                            }
                        }
                    }).change();
                    
                    
                    $('#inputSchedulerWidget').change(update_select_scheduler = function () 
                    {
                        if($('#inputSchedulerWidget').css("display") !== "none")
                        {
                            var selectedIndex = $('#inputSchedulerWidget').prop('selectedIndex');
                            switch(selectedIndex)
                            {
                                case 0:
                                    $('#inputUrlWidget').val('https://192.168.0.69/sce/');
                                    break;
                                    
                                case 1:
                                    $('#inputUrlWidget').val('https://192.168.0.23/sce/');
                                    break;
                                    
                                case 2:
                                    $('#inputUrlWidget').val('https://192.168.0.71/sce/');
                                    break;
                            }
                            $("#schedulerName").val(elencoScheduler[selectedIndex].name);
                            $("#host").val(elencoScheduler[selectedIndex].ip);
                            $("#user").val(elencoScheduler[selectedIndex].user);
                            $("#pass").val(elencoScheduler[selectedIndex].pass);
                            $.ajax({
                                url: "get_data.php",
                                data: {action: "getJobAreas", schedulerId: elencoScheduler[selectedIndex].id},
                                type: "GET",
                                async: false,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    $('#inputJobsAreasWidget').empty();
                                    $('#inputJobsGroupsWidget').empty();
                                    $('#inputJobsNamesWidget').empty();
                                    if(data[0].id === "none")
                                    {
                                        //Nessuna JOBS AREA
                                        $('#jobsAreasRow').css("display", "none");
                                        $("label[for='inputJobsAreasWidget']").css("display", "none");
                                        $('#inputJobsAreasWidgetDiv').css("display", "none");
                                        $('#inputJobsAreasWidgetGroupDiv').css("display", "none");
                                        $('#inputJobsAreasWidget').css("display", "none");
                                        
                                        //Caricamento dei jobs groups per lo scheduler selezionato.
                                        for(var i = 0; i < elencoJobsGroupsPerScheduler[selectedIndex].length; i++)
                                        {
                                            $('#inputJobsGroupsWidget').append('<option>' + elencoJobsGroupsPerScheduler[selectedIndex][i] + '</option>');
                                        }
                                        
                                        //Viene mostrato il campo per i jobs groups dello scheduler selezionato
                                        $('#jobsGroupsRow').css("display", "");
                                        $('#inputJobsGroupsWidgetGroupDiv').css("display", "");
                                        $('#inputJobsGroupsWidgetDiv').css("display", "");
                                        $("label[for='inputJobsGroupsWidget']").css("display", "");
                                        $('#inputJobsGroupsWidget').css("display", "");
                                        $('#inputJobsGroupsWidget').prop('selectedIndex', -1);
                                        
                                        //Viene mostrato il campo dei jobs names per il group selezionato
                                        $('#jobsNamesRow').css("display", "");
                                        $('#inputJobsNamesWidgetDiv').css("display", "");
                                        $('#inputJobsNamesWidgetGroupDiv').css("display", "");
                                        $("label[for='inputJobsNamesWidget']").css("display", "");
                                        $('#inputJobsNamesWidget').css("display", "");
                                        $('#inputJobsNamesWidget').prop('selectedIndex', -1);
                                    }
                                    else
                                    {
                                        //Ramo con le jobs areas
                                        
                                        //Non mostrare i job groups per scheduler
                                        $('#jobsGroupsRow').css("display", "none");
                                        $('#inputJobsGroupsWidgetGroupDiv').css("display", "none");
                                        $('#inputJobsGroupsWidgetDiv').css("display", "none");
                                        $("label[for='inputJobsGroupsWidget']").css("display", "none");
                                        $('#inputJobsGroupsWidget').css("display", "none");
                                        
                                        //Mostrare le JOBS AREAS
                                        $('#jobsAreasRow').css("display", "");
                                        $("label[for='inputJobsAreasWidget']").css("display", "");
                                        $('#inputJobsAreasWidgetDiv').css("display", "");
                                        $('#inputJobsAreasWidgetGroupDiv').css("display", "");
                                        $('#inputJobsAreasWidget').css("display", "");
                                        for(var i = 0; i < data.length; i++)
                                        {
                                            $('#inputJobsAreasWidget').append('<option>' + data[i]['name'] + '</option>');
                                        }
                                        $('#inputJobsAreasWidget').prop("selectedIndex", -1);
                                        
                                        //Viene mostrato il campo per i jobs groups della job area selezionata
                                        $('#jobsGroupsRow').css("display", "");
                                        $('#inputJobsGroupsWidgetGroupDiv').css("display", "");
                                        $('#inputJobsGroupsWidgetDiv').css("display", "");
                                        $("label[for='inputJobsGroupsWidget']").css("display", "");
                                        $('#inputJobsGroupsWidget').css("display", "");
                                        $('#inputJobsGroupsWidget').prop('selectedIndex', -1);
                                    }

                                },
                                error: function(errorMsg) 
                                {
                                   console.log("Error calling get_data.php --> getJobAreas");
                                   console.log(errorMsg);
                                }
                            });    
                        }
                    }).change();
                    
                    
                    $('#inputJobsAreasWidget').change(update_select_scheduler = function ()
                    {
                       if($('#inputJobsAreasWidget').css("display") !== "none")
                       {
                           $("#jobArea").val($('#inputJobsAreasWidget').val());
                           $('#inputJobsGroupsWidget').empty();
                           var selectedSchedulerIndex = $('#inputSchedulerWidget').prop('selectedIndex');
                           var areaSelected = $('#inputJobsAreasWidget').val();
                           var keyword = null;
                           switch(areaSelected)
                           {
                                case "Stato linee ATAF":
                                   keyword = "linea";
                                   break;
                                   
                                case "Check RT":
                                   keyword = "check";
                                   break;
                                   
                                case "Eventi a Firenze":
                                   keyword = "Eventi";
                                   break;
                                   
                                case "Parcheggi":
                                   keyword = "parcheggi";
                                   break;
                                   
                                case "Previsioni meteo":
                                   keyword = "meteo";
                                   break;
                                   
                                case "Sensori":
                                   keyword = "sensori";
                                   break;   
                           }
                           $.ajax({
                                url: "getJobs.php",
                                data: {action: "getJobGroupsForJobArea", 
                                       host: elencoScheduler[selectedSchedulerIndex].ip, 
                                       user: elencoScheduler[selectedSchedulerIndex].user, 
                                       pass: elencoScheduler[selectedSchedulerIndex].pass,
                                       keyword: keyword
                                   },
                                type: "POST",
                                async: false,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    for(var j = 0; j < data.length; j++) 
                                    {
                                        $('#inputJobsGroupsWidget').append('<option>' + data[j].jobGroup + '</option>');
                                    }
                                    $('#inputJobsGroupsWidget').prop('selectedIndex', -1);
                                    //Viene mostrato il campo dei jobs names per il group selezionato
                                    $('#jobsNamesRow').css("display", "");
                                    $('#inputJobsNamesWidgetDiv').css("display", "");
                                    $('#inputJobsNamesWidgetGroupDiv').css("display", "");
                                    $("label[for='inputJobsNamesWidget']").css("display", "");
                                    $('#inputJobsNamesWidget').css("display", "");
                                    $('#inputJobsNamesWidget').prop('selectedIndex', -1);
                                }
                            });
                           
                       }
                    }).change();
                    
                    
                    $('#inputJobsGroupsWidget').change(update_select_scheduler = function () 
                    {
                        if($('#inputJobsGroupsWidget').css("display") !== "none")
                        {
                            $('#inputJobsNamesWidget').empty();
                            var selectedScheduler = $('#inputSchedulerWidget').prop('selectedIndex');
                            var selectedGroup = $('#inputJobsGroupsWidget').val();
                            $("#jobGroup").val(selectedGroup);
                            
                            //Reperimento elenco dei jobs names per il job group selezionato
                            $.ajax({
                                url: "getJobs.php",
                                data: {
                                    action: "getJobNamesForJobGroup", 
                                    host: elencoScheduler[selectedScheduler].ip, 
                                    user: elencoScheduler[selectedScheduler].user, 
                                    pass: elencoScheduler[selectedScheduler].pass,
                                    jobGroup: selectedGroup
                                },
                                type: "POST",
                                async: false,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    for(var j = 0; j < data.length; j++) 
                                    {
                                        $('#inputJobsNamesWidget').append('<option>' + data[j].jobName + '</option>');
                                    }
                                    $('#inputJobsNamesWidget').prop('selectedIndex', -1);
                                },
                                error: function (errorMsg) 
                                {
                                   console.log("Error calling get_data.php --> getJobNamesForJobGroup");
                                   console.log(errorMsg);
                                }
                            });
                        }
                    }).change();
                    
                   
                    $('#inputJobsNamesWidget').change(update_select_scheduler = function () 
                    {
                        if($('#inputJobsNamesWidget').css("display") !== "none")
                        {
                            $('#jobName').val($('#inputJobsNamesWidget').val());
                        }
                    }).change();
                    
                    //Listener aggiunta widget per cambio widget selezionato per widgets actuator
                    $('#widgetActuatorType').change(function(){
                        $("#inputUdmPosition").val(-1);
                        //Titolo obbligatorio per tutti
                        $('#inputTitleWidget').prop('required', true);
                        
                        
                        switch($('#widgetActuatorType').val())
                        {
                            case "widgetKnob":
                                $('#inputUrlWidget').val('none');
                                $('#inputFontSize').val("12");
                                $('#inputFontSize').attr("disabled", true);
                                $('#inputFontColor').val("#000000");
                                $('#widgetFontColor').css("background-color", "#eeeeee");
                                $("#titleLabel").html("Title");
                                $("#bckColorLabel").html("Background color");
                                $('#link_help_modal-add-widget').css("display", "");
                                $('#inputFrameColorWidget').attr('disabled', false);
                                $('#inputFrameColorWidget').val('#eeeeee');
                                $('#inputFrameColorWidget').prop('required', false);
                                $('#select-IntTemp-Widget').attr('disabled', true);
                                $('#select-IntTemp-Widget').prop('required', false);
                                $('#inputFreqWidget').attr('disabled', false);
                                $('#inputFreqWidget').val(60);
                                $('#inputFreqWidget').prop('required', true);
                                $('#inputHeaderFontColorWidget').attr('disabled', false);
                                $('#inputHeaderFontColorWidget').prop('required', true);
                                $('#inputHeaderFontColorWidget').val("#000000");
                                $('#widgetHeaderFontColor').css("background-color", "#000000");
                                $('#inputUdmWidget').prop("required", false);
                                $('#inputUdmWidget').attr("disabled", true);
                                $('#inputUdmPosition').prop("required", false);
                                $('#inputUdmPosition').attr("disabled", true);
                                $('#addWidgetFirstAidHospital').attr("disabled", true);
                                $('#addWidgetFirstAidHospital').prop("required", false);
                                $('#addWidgetFirstAidHospital').val(-1);
                                $('#inputFirstAidRow').hide();

                                showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                //Parametri specifici del widget
                                $('#specificWidgetPropertiesDiv .row').remove();

                                $('#inputComuneWidget').attr('disabled', false);

                                //Rimozione eventuali campi del subform general per widget process
                                removeWidgetProcessGeneralFields("addWidget");
                                
                                newFormRow = $('<div class="row"></div>');
                                newLabel = $('<label for="addKnobStartAngle" class="col-md-2 control-label">Start angle</label>');
                                newInnerDiv = $('<div class="col-md-4"></div>');
                                newInput = $('<input type="text" name="addKnobStartAngle" class="form-control" id="addKnobStartAngle" value="230"/>');
                                newInnerDiv.append(newInput);
                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                
                                newLabel = $('<label for="addKnobEndAngle" class="col-md-2 control-label">End angle</label>');
                                newInnerDiv = $('<div class="col-md-4"></div>');
                                newInput = $('<input type="text" name="addKnobEndAngle" class="form-control" id="addKnobEndAngle" value="130"/>');
                                newInnerDiv.append(newInput);
                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                
                                $('#specificWidgetPropertiesDiv').append(newFormRow);
                                
                                newFormRow = $('<div class="row"></div>');
                                newLabel = $('<label for="addKnobDomainType" class="col-md-2 control-label">Domain type</label>');
                                newInnerDiv = $('<div class="col-md-4"></div>');
                                newInput = $('<select name="addKnobDomainType" id="addKnobDomainType" class="form-control"/>');
                                newInput.append('<option value="continuous">Continuous</option>');
                                newInput.append('<option value="discreet">Discreet</option>');
                                newInnerDiv.append(newInput);
                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                $('#specificWidgetPropertiesDiv').append(newFormRow);
                                
                                newFormRow = $('<div class="row"></div>');
                                newLabel = $('<label for="addKnobMinValue" class="col-md-2 control-label">Min value</label>');
                                newInnerDiv = $('<div class="col-md-4"></div>');
                                newInput = $('<input type="text" name="addKnobMinValue" class="form-control" id="addKnobMinValue" value="0"/>');
                                newInnerDiv.append(newInput);
                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                
                                newLabel = $('<label for="addKnobMaxValue" class="col-md-2 control-label">Max value</label>');
                                newInnerDiv = $('<div class="col-md-4"></div>');
                                newInput = $('<input type="text" name="addKnobMaxValue" class="form-control" id="addKnobMaxValue" value="100"/>');
                                newInnerDiv.append(newInput);
                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                
                                $('#specificWidgetPropertiesDiv').append(newFormRow);
                                
                                //Contenitore per tabella delle soglie
                                var addKnobColorsTableContainer = $('<div id="addKnobColorsTableContainer" class="row rowCenterContent"></div>');
                                var addKnobColorsTable = $("<table id='addKnobColorsTable' class='table table-bordered table-condensed thrRangeTable'><col style='width:25%'><col style='width:25%'><col style='width:40%'><col style='width:10%'><tr><td>Min</td><td>Max</td><td>Range color</td><td><a href='#'><i class='fa fa-plus' style='font-size:24px;color:#337ab7'></i></a></td></tr></table>");
                                addKnobColorsTableContainer.append(addKnobColorsTable);
                                $("#specificWidgetPropertiesDiv").append(addKnobColorsTableContainer);

                                //$("#addKnobColorsTable i.fa-plus").click(addThrRangeSingleValueWidget);
                                break;
                                
                            default: 

                                break;
                        }
                    });
                    
                    //Listener aggiunta widget per cambio widget selezionato per widgets data viewer
                    $('#select-widget').change(update_select_widget = function () 
                    {
                        var dimMapRaw, dimMap = null;
                        
                            //Quando si cambia il widget selezionato di default le righe delle dimensioni devono essere vuote per impedire che si accumulino valori. Tanto si rimepie ad ogni change
                            $("#inputSizeRowsWidget").empty();
                            $("#inputSizeColumnsWidget").empty();
                            
                            $("#inputComuneRow").hide();
                            $("#inputUdmPosition").val(-1);
                            
                            $("#inputFirstAidRow").hide();
                            $("#inputFirstAidRow").val(-1);
                            
                            var str = "";
                            $("#select-metric option:selected").each(function () {
                                str += $(this).text();
                            });

                            var str2 = "";
                            $("#select-widget option:selected").each(function () {
                                str2 += $(this).text();
                            });

                            for (var i = 0; i < array_metrics.length; i++) 
                            {
                                if (array_metrics[i]['id'] === str) {
                                    for (var k = 0; k < array_metrics[i]['widgets'].length; k++) 
                                    {
                                        if (array_metrics[i]['widgets'][k]['id_type_widget'] === str2) 
                                        {
                                            //creare un elenco di dimensioni minime e massime di colonne dei widget
                                            var minR = parseInt(array_metrics[i]['widgets'][k]['size_rows_widget']);
                                            var maxR = parseInt(array_metrics[i]['widgets'][k]['max_rows_widget']);
                                            var minC = parseInt(array_metrics[i]['widgets'][k]['size_columns_widget']);
                                            var maxC = parseInt(array_metrics[i]['widgets'][k]['max_columns_widget']);
                                            var range_value = parseInt(array_metrics[i]['widgets'][k]['numeric_range']);
                                            dimMapRaw = (array_metrics[i]['widgets'][k]['dimMap']);
                                            if((dimMapRaw !== null) && (dimMapRaw !== "null") && (typeof dimMapRaw !== "undefined") && (dimMapRaw !== ""))
                                            {
                                                dimMap = JSON.parse(dimMapRaw);
                                            }


                                            if(dimMap === null)
                                            {
                                                $("#inputSizeRowsWidget").off();
                                                if (minR === maxR)
                                                {
                                                    $("#inputSizeRowsWidget").append('<option>' + minR + '</option>');
                                                } 
                                                else
                                                {
                                                    for (var n = minR; n <= maxR; n++)
                                                    {
                                                        $("#inputSizeRowsWidget").append('<option>' + n + '</option>');
                                                    }

                                                }
                                                if (minC === maxC)
                                                {
                                                    $("#inputSizeColumnsWidget").append('<option>' + minC + '</option>');
                                                } 
                                                else
                                                {
                                                    for (var p = minC; p <= maxC; p++)
                                                    {
                                                        $("#inputSizeColumnsWidget").append('<option>' + p + '</option>');
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                var z;
                                                var selectedIndex = null;
                                                $("#inputSizeRowsWidget").empty();
                                                $("#inputSizeColumnsWidget").empty();
                                                for(z = 0; z < dimMap.dimMap.length; z++)
                                                {
                                                    $("#inputSizeRowsWidget").append('<option>' + dimMap.dimMap[z].rows + '</option>');
                                                }

                                                $("#inputSizeColumnsWidget").append('<option>' + dimMap.dimMap[0].cols + '</option>');

                                                $("#inputSizeRowsWidget").off();

                                                $("#inputSizeRowsWidget").change(function() {
                                                    selectedIndex = $("#inputSizeRowsWidget").prop("selectedIndex");
                                                    $("#inputSizeColumnsWidget").empty();
                                                    $("#inputSizeColumnsWidget").append('<option>' + dimMap.dimMap[selectedIndex].cols + '</option>');
                                                });

                                            }

                                            $("#add-n-metrcis-widget").text("max " + array_metrics[i]['widgets'][k]['number_metrics_widget'] + " metrics");

                                            if ((str2 === "widgetTimeTrend") || (str2 === "widgetTimeTrendCompare")) 
                                            {
                                                $('#select-IntTemp-Widget').empty();
                                                $('#select-IntTemp-Widget').append('<option value="4 Ore">4 Hours</option>');
                                                $('#select-IntTemp-Widget').append('<option value="12 Ore">12 Hours</option>');
                                                $('#select-IntTemp-Widget').append('<option value="Giornaliera">Daily</option>');
                                                $('#select-IntTemp-Widget').append('<option value="Settimanale">Weekly</option>');
                                                $('#select-IntTemp-Widget').append('<option value="Mensile">Monthly</option>');
                                                $('#select-IntTemp-Widget').append('<option value="Annuale">Annually</option>');
                                            } 
                                            else 
                                            {
                                                $('#select-IntTemp-Widget').empty();
                                                $('#select-IntTemp-Widget').append('<option value="Nessuno">No</option>');
                                            }
                                        }
                                    }
                                }
                            }//Fine del for

                            //Nuovo codice per form personalizzato: espanderlo con altri case via via che si implementa il form personalizzato.
                            //Titolo obbligatorio per tutti
                            $('#inputTitleWidget').prop('required', true);
                            
                            
                            //Opzioni menu aggiunta widget
                            switch($('#select-widget').val())
                            {
                               case "widgetServerStatus":
                                    $("label[for='inputComuneWidget']").css("display", "");
                                    $("#bckColorLabel").html("Background color");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUrlWidget').attr('disabled', false);
                                    $('#inputUrlWidget').prop('required', true);
                                    $('#inputUrlWidget').val(queryFieldFromDb);
                                    //console.log("URL: " + query);
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $("#schedulerRow").show();
                                    $("label[for='inputSchedulerWidget']").hide();
                                    $('#inputSchedulerWidgetDiv').hide();
                                    $('#inputSchedulerWidgetGroupDiv').hide();
                                    $('#inputSchedulerWidget').hide();
                                    $('#inputSchedulerWidget').prop('selectedIndex', -1);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFontSize').val("");
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();
                                    
                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    
                                    addWidgetServerStatusNotificatorAndThresholdFields();
                                    break; 
                                
                                
                               case "widgetSelector":
                                $('#inputTitleWidget').val('');
                                $('#inputUrlWidget').val('none');
                                $("#titleLabel").html("Title");
                                $("#bckColorLabel").html("Background color");
                                $('#inputFontSize').val("16");
                                $('#inputFontSize').attr('disabled', false);
                                $('#inputFontSize').prop('required', true);
                                $('#inputFontColor').val("#000000");
                                $('#inputFontColor').attr('disabled', false);
                                $('#inputFontColor').prop('required', true);
                                $('#widgetFontColor').css("background-color", "#000000");
                                $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                $('#link_help_modal-add-widget').css("display", "");
                                $('#inputFrameColorWidget').attr('disabled', false);
                                $('#inputFrameColorWidget').val('#eeeeee');
                                $('#inputFrameColorWidget').prop('required', false);
                                $('#select-IntTemp-Widget').val(-1);
                                $('#select-IntTemp-Widget').attr('disabled', true);
                                $('#select-IntTemp-Widget').prop('required', false);
                                $('#inputFreqWidget').attr('disabled', true);
                                $('#inputFreqWidget').val("");
                                $('#inputFreqWidget').prop('required', false);
                                $('#inputHeaderFontColorWidget').attr('disabled', false);
                                $('#inputHeaderFontColorWidget').prop('required', true);
                                $('#inputHeaderFontColorWidget').val("#000000");
                                $('#widgetHeaderFontColor').css("background-color", "#000000");
                                $('#inputUdmWidget').prop("required", false);
                                $('#inputUdmWidget').attr("disabled", true);
                                $('#inputUdmPosition').prop("required", false);
                                $('#inputUdmPosition').attr("disabled", true);
                                $('#addWidgetFirstAidHospital').attr("disabled", true);
                                $('#addWidgetFirstAidHospital').prop("required", false);
                                $('#addWidgetFirstAidHospital').val(-1);
                                $('#inputFirstAidRow').hide();

                                showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                //Parametri specifici del widget
                                $('#specificWidgetPropertiesDiv .row').remove();

                                //Rimozione eventuali campi del subform general per widget process
                                removeWidgetProcessGeneralFields("addWidget");
                                
                                var addGisParameters = {
                                    queries: [],
                                    targets: []
                                };
                                setAddGisParameters(addGisParameters);
                                $("#parameters").val(JSON.stringify(addGisParameters));
                                
                                //Target widgets geolocation
                                newFormRow = $('<div class="row"></div>');
                                newLabel = $('<label for="addGisGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                newInnerDiv = $('<div class="col-md-4"></div>');
                                newSelect = $('<select name="addGisGeolocationWidgets" class="form-control" id="addGisGeolocationWidgets" multiple></select>');

                                var widgetId, widgetTitle = null;
                                var widgetsNumber = 0;
                                var targetsJson = [];

                                $("li.gs_w").each(function(){
                                    if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "gisTarget"))
                                    {
                                      widgetId = $(this).attr("id");
                                      widgetTitle = $(this).find("div.titleDiv").html();
                                      newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                      widgetsNumber++;
                                    }
                                });

                                if(widgetsNumber > 0)
                                {
                                    newInnerDiv.append(newSelect);
                                }
                                else
                                {
                                    newInnerDiv.append("None");
                                }

                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                $("#specificWidgetPropertiesDiv").append(newFormRow);

                                if(widgetsNumber > 0)
                                {
                                    $('#addGisGeolocationWidgets').selectpicker({
                                       actionsBox: true, 
                                       width: "auto"
                                    });

                                    $('#addGisGeolocationWidgets').on('changed.bs.select', function (e) 
                                    {
                                        if($(this).val() === null)
                                        {
                                            addGisParameters.targets = [];
                                        }
                                        else
                                        {
                                            addGisParameters.targets = $(this).val();
                                        }
                                        $("#parameters").val(JSON.stringify(addGisParameters));
                                    });
                                }
                                
                                newLabel = $('<label for="addGisRectDim" class="col-md-2 control-label">Rectangles height</label>');
                                newInnerDiv = $('<div class="col-md-3"></div>');
                                var newControl = $('<input id="addGisRectDim" name="addGisRectDim" data-slider-ticks="[1, 2, 3, 4]" data-slider-id="addGisRectDimSlider" type="text" data-slider-min="1" data-slider-max="4" data-slider-step="1" data-slider-value="1"/>');
                                newInnerDiv.append(newControl);
                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                
                                $('#addGisRectDim').bootstrapSlider({
                                    ticks_labels: ["small", "mid", "large", "fit"],
                                    value: 4,
                                    formatter: function(value) {
                                       switch(value)
                                       {
                                            case 1:
                                               return "25px";
                                               break;
                                               
                                            case 2:
                                                return "50px";
                                                break;
                                                
                                            case 3:
                                                return "75px";
                                                break;
                                                
                                            case 4:
                                                return "Rectangles fit widget's height";
                                                break;    
                                       }
                                    }
                                });
                                
                                //Nuova riga
                                //Colore testo quando picker attivo
                                newFormRow = $('<div class="row"></div>');
                                newLabel = $('<label for="addGisActiveQueriesFontColor" class="col-md-2 control-label">Active queries font color</label>');
                                newInnerDiv = $('<div class="col-md-4"></div>');
                                var newColorPicker = $('<div id="addGisActiveQueriesFontColorContainer" class="input-group colorpicker-component"><input id="addGisActiveQueriesFontColor" name="addGisActiveQueriesFontColor" type="text" class="form-control input"/><span class="input-group-addon"><i></i></span></div>');
                                newInnerDiv.append(newColorPicker);
                                newFormRow.append(newLabel);
                                newFormRow.append(newInnerDiv);
                                $("#specificWidgetPropertiesDiv").append(newFormRow);
                                
                                $('#addGisActiveQueriesFontColorContainer').colorpicker({
                                    format: "rgba",
                                    color: "#000000"
                                });
                                
                                //Nuova riga
                                //Contenitore per tabella delle query
                                var addGisQueryTableContainer = $('<div id="addGisQueryTableContainer" class="row rowCenterContent"></div>');
                                var addGisQueryTable = $("<table id='addGisQueryTable' class='table table-bordered table-condensed thrRangeTable'><col style='width:64px'><col style='width:64px'><col style='width:64px'><col style='width:128px'><col style='width:76px'><col style='width:128px'><col style='width:128px'><col style='width:128px'><col style='width:50px'><tr><td>Symbol mode</td><td>Symbol choice</td><td>Symbol preview</td><td>Description</td><td>Query</td><td>Color1</td><td>Color2</td><td>Data widgets</td><td><a href='#'><i class='fa fa-plus' style='font-size:24px;color:#337ab7'></i></a></td></tr></table>");
                                addGisQueryTableContainer.append(addGisQueryTable);
                                $("#specificWidgetPropertiesDiv").append(addGisQueryTableContainer);
                                $("#addGisQueryTable i.fa-plus").click(addGisQuery);
                                break; 
                                
                               case "widgetClock":
                                 $('#inputUrlWidget').val('none');
                                 $("#titleLabel").html("Title");
                                 $("#bckColorLabel").html("Background color");
                                 $('#inputFontSize').val(16);
                                 $('#inputFontSize').attr('disabled', false);
                                 $('#inputFontSize').prop('required', true);
                                 $('#inputFontColor').val("#000000");
                                 $('#widgetFontColor').css("background-color", "#000000");
                                 $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                 $('#link_help_modal-add-widget').css("display", "");
                                 $('#inputFrameColorWidget').attr('disabled', false);
                                 $('#inputFrameColorWidget').val('#eeeeee');
                                 $('#inputFrameColorWidget').prop('required', false);
                                 $('#select-IntTemp-Widget').attr('disabled', true);
                                 $('#select-IntTemp-Widget').prop('required', false);
                                 $('#inputFreqWidget').attr('disabled', true);
                                 $('#inputFreqWidget').val('');
                                 $('#inputFreqWidget').prop('required', false);
                                 $('#inputHeaderFontColorWidget').attr('disabled', false);
                                 $('#inputHeaderFontColorWidget').prop('required', true);
                                 $('#inputHeaderFontColorWidget').val("#000000");
                                 $('#widgetHeaderFontColor').css("background-color", "#000000");
                                 $('#inputUdmWidget').prop("required", false);
                                 $('#inputUdmWidget').attr("disabled", true);
                                 $('#inputUdmPosition').prop("required", false);
                                 $('#inputUdmPosition').attr("disabled", true);
                                 $('#inputUdmWidget').val("");
                                 $("#inputUdmPosition").val(-1);
                                 $('#addWidgetFirstAidHospital').attr("disabled", true);
                                 $('#addWidgetFirstAidHospital').prop("required", false);
                                 $('#addWidgetFirstAidHospital').val(-1);
                                 $('#inputFirstAidRow').hide();

                                 showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                 //Parametri specifici del widget
                                 $('#specificWidgetPropertiesDiv .row').remove();

                                 //Rimozione eventuali campi del subform general per widget process
                                 removeWidgetProcessGeneralFields("addWidget");
                                 var newFormRow, newLabel, newInnerDiv, newSelect, newInput = null;
                                 
                                 //Nuova riga
                                 //Clock data e clock font type
                                 newFormRow = $('<div class="row"></div>');
                                 newLabel = $('<label for="addWidgetClockData" class="col-md-2 control-label">Shown data</label>');
                                 newInnerDiv = $('<div class="col-md-3"></div>');
                                 newSelect = $('<select name="addWidgetClockData" class="form-control" id="addWidgetClockData"></select>');
                                 newSelect.append('<option value="date">Date</option>');
                                 newSelect.append('<option value="time">Time</option>');
                                 newSelect.append('<option value="dateTime">Date and time</option>');
                                 newSelect.val("dateTime");
                                 newInnerDiv.append(newSelect);
                                 newFormRow.append(newLabel);
                                 newFormRow.append(newInnerDiv);
                                 
                                 newLabel = $('<label for="addWidgetClockFont" class="col-md-2 control-label">Font type</label>');
                                 newInnerDiv = $('<div class="col-md-3"></div>');
                                 newSelect = $('<select name="addWidgetClockFont" class="form-control" id="addWidgetClockFont"></select>');
                                 newSelect.append('<option value="normal">Normal</option>');
                                 newSelect.append('<option value="lcd">LCD like</option>');
                                 newInnerDiv.append(newSelect);
                                 newFormRow.append(newLabel);
                                 newFormRow.append(newInnerDiv);
                                 
                                 $("#specificWidgetPropertiesDiv").append(newFormRow);
                                 break;
                               
                               case "widgetNetworkAnalysis":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("12");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Target widgets geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    newLabel = $('<label for="addWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select name="addWidgetGeolocationWidgets" class="form-control" id="addWidgetGeolocationWidgets" multiple></select>');

                                    var widgetId, widgetTitle = null;
                                    var widgetsNumber = 0;
                                    var targetsJson = [];

                                    $("li.gs_w").each(function(){
                                       if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          widgetsNumber++;
                                       }
                                    });

                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append("None");
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       $('#addWidgetGeolocationWidgets').selectpicker({
                                          actionsBox: true, 
                                          width: "auto"
                                       });
                                       
                                       $('#addWidgetGeolocationWidgets').on('changed.bs.select', function (e) 
                                       {
                                          if($(this).val() === null)
                                          {
                                             targetsJson = [];
                                          }
                                          else
                                          {
                                             targetsJson = $(this).val();
                                          }
                                          $("#parameters").val(JSON.stringify(targetsJson));
                                       });
                                    }
                                    break;  
                               
                                case "widgetResources":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("12");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Target widgets geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    newLabel = $('<label for="addWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select name="addWidgetGeolocationWidgets" class="form-control" id="addWidgetGeolocationWidgets" multiple></select>');

                                    var widgetId, widgetTitle = null;
                                    var widgetsNumber = 0;
                                    var targetsJson = [];

                                    $("li.gs_w").each(function(){
                                       if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          widgetsNumber++;
                                       }
                                    });

                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append("None");
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       $('#addWidgetGeolocationWidgets').selectpicker({
                                          actionsBox: true, 
                                          width: "auto"
                                       });
                                       
                                       $('#addWidgetGeolocationWidgets').on('changed.bs.select', function (e) 
                                       {
                                          if($(this).val() === null)
                                          {
                                             targetsJson = [];
                                          }
                                          else
                                          {
                                             targetsJson = $(this).val();
                                          }
                                          $("#parameters").val(JSON.stringify(targetsJson));
                                       });
                                    }
                                    break;  
                                
                                 case "widgetEvacuationPlans":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("12");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Target widgets geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newLabel = $('<label for="addWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="addWidgetGeolocationWidgets" name="addWidgetGeolocationWidgets"></select>');
                                    
                                    var widgetId, widgetTitle = null;
                                    var widgetsNumber = 0;
                                    //JSON degli eventi da mostrare su ogni widget target di questo widget events: privo di eventi all'inizio
                                    var targetEventsJson = {};
                                    
                                    $("li.gs_w").each(function()
                                    {
                                       if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          targetEventsJson[widgetId] = new Array(); 
                                          widgetsNumber++;
                                       }
                                    });
                                    
                                    $("#parameters").val(JSON.stringify(targetEventsJson));
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append("None");
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newSelect.show();
                                       newSelect.val(-1);
                                       newLabel = $('<label for="addWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       var eventTypeSelect = $('<select name="addWidgetEventTypes" class="form-control" id="addWidgetEventTypes" multiple></select>');
                                       
                                       eventTypeSelect.append('<option value="approved">Approved</option>');
                                       eventTypeSelect.append('<option value="closed">Closed</option>');
                                       eventTypeSelect.append('<option value="in_progress">In progress</option>');
                                       eventTypeSelect.append('<option value="proposed">Proposed</option>');
                                       eventTypeSelect.append('<option value="rejected">Rejected</option>');
                                       
                                       eventTypeSelect.val(-1);
                                       newFormRow.append(newLabel);
                                       newInnerDiv.append(eventTypeSelect);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.hide();
                                       newInnerDiv.hide();
                                       
                                       $('#addWidgetEventTypes').selectpicker({
                                          actionsBox: true, 
                                          width: "auto"
                                       });
                                       
                                       $('#addWidgetEventTypes').on('changed.bs.select', function (e) 
                                       {
                                          if($(this).val() === null)
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = [];
                                          }
                                          else
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = $(this).val();
                                          }
                                          $("#parameters").val(JSON.stringify(targetEventsJson));
                                       });
                                       
                                       $("#addWidgetGeolocationWidgets").change(function(){
                                          newLabel.show();
                                          newInnerDiv.show();
                                          $('#addWidgetEventTypes').selectpicker('val', targetEventsJson[$("#addWidgetGeolocationWidgets").val()]);
                                       });
                                    }
                                    break;  
                               
                                 case "widgetAlarms":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("12");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Target widgets geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newLabel = $('<label for="addWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="addWidgetGeolocationWidgets" name="addWidgetGeolocationWidgets"></select>');
                                    
                                    var widgetId, widgetTitle = null;
                                    var widgetsNumber = 0;
                                    //JSON degli eventi da mostrare su ogni widget target di questo widget events: privo di eventi all'inizio
                                    var targetEventsJson = {};
                                    
                                    $("li.gs_w").each(function()
                                    {
                                       if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          targetEventsJson[widgetId] = new Array(); 
                                          widgetsNumber++;
                                       }
                                    });
                                    
                                    $("#parameters").val(JSON.stringify(targetEventsJson));
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append("None");
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newSelect.show();
                                       newSelect.val(-1);
                                       newLabel = $('<label for="addWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       var eventTypeSelect = $('<select name="addWidgetEventTypes" class="form-control" id="addWidgetEventTypes" multiple></select>');
                                       for(var key in alarmTypes)
                                       {
                                          eventTypeSelect.append('<option value="' + key + '">' + alarmTypes[key].desc + '</option>');
                                       }
                                       
                                       eventTypeSelect.val(-1);
                                       newFormRow.append(newLabel);
                                       newInnerDiv.append(eventTypeSelect);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.hide();
                                       newInnerDiv.hide();
                                       
                                       $('#addWidgetEventTypes').selectpicker({
                                          actionsBox: true, 
                                          width: "auto"
                                       });
                                       
                                       $('#addWidgetEventTypes').on('changed.bs.select', function (e) 
                                       {
                                          if($(this).val() === null)
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = [];
                                          }
                                          else
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = $(this).val();
                                          }
                                          $("#parameters").val(JSON.stringify(targetEventsJson));
                                       });
                                       
                                       $("#addWidgetGeolocationWidgets").change(function(){
                                          newLabel.show();
                                          newInnerDiv.show();
                                          $('#addWidgetEventTypes').selectpicker('val', targetEventsJson[$("#addWidgetGeolocationWidgets").val()]);
                                       });
                                    }
                                    break; 
                               
                                 case "widgetTrafficEvents":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("12");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Target widgets geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newLabel = $('<label for="addWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="addWidgetGeolocationWidgets" name="addWidgetGeolocationWidgets"></select>');
                                    
                                    var widgetId, widgetTitle = null;
                                    var widgetsNumber = 0;
                                    //JSON degli eventi da mostrare su ogni widget target di questo widget events: privo di eventi all'inizio
                                    var targetEventsJson = {};
                                    
                                    $("li.gs_w").each(function()
                                    {
                                       if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          targetEventsJson[widgetId] = new Array(); 
                                          widgetsNumber++;
                                       }
                                    });
                                    
                                    $("#parameters").val(JSON.stringify(targetEventsJson));
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append("None");
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newSelect.show();
                                       newSelect.val(-1);
                                       newLabel = $('<label for="addWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       var eventTypeSelect = $('<select name="addWidgetEventTypes" class="form-control" id="addWidgetEventTypes" multiple></select>');
                                       var eventTypeNum = null;
                                       for(var key in trafficEventTypes)
                                       {
                                          eventTypeNum = key.replace("type", "");
                                          eventTypeSelect.append('<option value="' + eventTypeNum + '">' + trafficEventTypes[key].desc + '</option>');
                                       }
                                       
                                       /*eventTypeSelect.append('<option value="1">Incident</option>');
                                       eventTypeSelect.append('<option value="25">Road works</option>');
                                       eventTypeSelect.append('<option value="others">Others</option>');*/
                                       eventTypeSelect.val(-1);
                                       newFormRow.append(newLabel);
                                       newInnerDiv.append(eventTypeSelect);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.hide();
                                       newInnerDiv.hide();
                                       
                                       $('#addWidgetEventTypes').selectpicker({
                                          actionsBox: true, 
                                          width: "auto"
                                       });
                                       
                                       $('#addWidgetEventTypes').on('changed.bs.select', function (e) 
                                       {
                                          if($(this).val() === null)
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = [];
                                          }
                                          else
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = $(this).val();
                                          }
                                          $("#parameters").val(JSON.stringify(targetEventsJson));
                                       });
                                       
                                       $("#addWidgetGeolocationWidgets").change(function(){
                                          newLabel.show();
                                          newInnerDiv.show();
                                          $('#addWidgetEventTypes').selectpicker('val', targetEventsJson[$("#addWidgetGeolocationWidgets").val()]);
                                       });
                                    }
                                    break;
      
                                 case "widgetFirstAid":
                                    var currentParams, i, k, currentFieldIndex, currentSeriesIndex = null;
                                    var thrTables1 = new Array();
                                    var thrTables2 = new Array();
                                    
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("10");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#inputFirstAidRow').show();
                                    $('#addWidgetFirstAidHospital').attr("disabled", false);
                                    $('#addWidgetFirstAidHospital').prop("required", true);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    
                                    //Proprietà specifiche del widget
                                    //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Visualizzazione campi specifici per questo widget
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newLabel = $('<label for="addWidgetFirstAidMode" class="col-md-2 control-label">Visualization mode</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="addWidgetFirstAidMode" name="addWidgetFirstAidMode" required></select>');
                                    newSelect.append('<option value="singleSummary">Single hospital - Totals only</option>');
                                    newSelect.append('<option value="singleDetails">Single hospital - Details</option>');
                                    newSelect.append('<option value="hospitalsOverview">Multiple hospitals overview</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    var hospitalSelect = '<label for="addWidgetFirstAidHospital" class="col-md-2 control-label">First aid</label>' +
                                    '<div class="col-md-3">' +
                                        '<div class="input-group">' +
                                            '<select name="addWidgetFirstAidHospital" class="form-control" id="addWidgetFirstAidHospital">' + 
                                            '</select>' +
                                        '</div>' +
                                    '</div>';
                            
                                    var multipleHospitalSelect = '<label for="addWidgetFirstAidHospitals" class="col-md-2 control-label">First aids</label>' +
                                            '<div class="col-md-3">' +
                                                '<div class="input-group">' +
                                                    '<select name="addWidgetFirstAidHospitals" class="form-control" id="addWidgetFirstAidHospitals" multiple>' + 
                                                    '</select>' +
                                                '</div>' +
                                            '</div>';
                                    
                                    newFormRow.append(hospitalSelect);
                                    $('label[for=addWidgetFirstAidHospital]').show();
                                    $('#addWidgetFirstAidHospital').parent().parent().show();
                                    
                                    newFormRow.append(multipleHospitalSelect);
                                    $('label[for=addWidgetFirstAidHospitals]').hide();
                                    $('#addWidgetFirstAidHospitals').parent().parent().hide();
                                    
                                    var hospitalName, hospitalUrl = null;
                                    
                                    for(var i = 0; i < hospitalList.Services.features.length; i++)
                                    {
                                       hospitalName = hospitalList.Services.features[i].properties.name;
                                       hospitalUrl = hospitalList.Services.features[i].properties.serviceUri;
                                       
                                       hospitalName = hospitalName.replace("PRONTO SOCCORSO", "PS");
                                       hospitalName = hospitalName.replace("PRIMO INTERVENTO", "PI");
                                       hospitalName = hospitalName.replace("AZIENDA OSPEDALIERA", "AO");
                                       hospitalName = hospitalName.replace("PRESIDIO OSPEDALIERO", "PO");
                                       hospitalName = hospitalName.replace("ISTITUTO DI PUBBLICA ASSISTENZA", "IPA");
                                       hospitalName = hospitalName.replace("ASSOCIAZIONE DI PUBBLICA ASSISTENZA", "APA");
                                       hospitalName = hospitalName.replace("OSPEDALE DI", "");
                                       hospitalName = hospitalName.replace("OSPEDALE DEL", "");
                                       hospitalName = hospitalName.replace("OSPEDALE DELL'", "");
                                       hospitalName = hospitalName.replace("OSPEDALE DELLA", "");
                                       hospitalName = hospitalName.replace("DELL'OSPEDALE", "");
                                       hospitalName = hospitalName.replace("OSPEDALE", "");
                                       hospitalName = hospitalName.replace("ITALIANA", "");

                                       if($("#addWidgetFirstAidHospital").find('option[value="' + hospitalUrl + '"]').length <= 0)
                                       {
                                          $("#addWidgetFirstAidHospital").append('<option value="' + hospitalUrl + '">' + hospitalName + '</option>');
                                       }
                                       
                                       if($("#addWidgetFirstAidHospitals").find('option[value="' + hospitalUrl + '"]').length <= 0)
                                       {
                                          $("#addWidgetFirstAidHospitals").append('<option value="' + hospitalUrl + '">' + hospitalName + '</option>');
                                       }
                                    }

                                    $("#serviceUri").val($("#addWidgetFirstAidHospital").val());
                                    
                                    var series = {  
                                       "firstAxis":{  
                                          "desc":"Priority",
                                          "labels":[  
                                             "Red code",
                                             "Yellow code",
                                             "Green code",
                                             "Blue code",
                                             "White code"
                                          ]
                                       },
                                       "secondAxis":{  
                                          "desc":"Status",
                                          "labels":[  
                                             "Totals"
                                          ],
                                          "series":[]
                                       }
                                    };
                                    
                                    $("#addWidgetFirstAidMode").change(function()
                                    {
                                       $("#infoMainSelect").val(-1);
                                       
                                       switch($(this).val())
                                       {
                                          case "singleSummary": 
                                                $("#serviceUri").val($("#addWidgetFirstAidHospital").val());
                                                $('label[for=addWidgetFirstAidHospitals]').hide();
                                                $('#addWidgetFirstAidHospitals').parent().parent().hide();
                                                $('label[for=addWidgetFirstAidHospital]').show();
                                                $('#addWidgetFirstAidHospital').parent().parent().show();
                                                series = {  
                                                   "firstAxis":{  
                                                      "desc":"Priority",
                                                      "labels":[  
                                                         "Red code",
                                                         "Yellow code",
                                                         "Green code",
                                                         "Blue code",
                                                         "White code"
                                                      ]
                                                   },
                                                   "secondAxis":{  
                                                      "desc":"Status",
                                                      "labels":[
                                                         "Totals"
                                                      ],
                                                      "series":[]
                                                   }
                                                };
                                                
                                                $('label[for="alrAxisSel"]').hide();
                                                $("#alrAxisSel").hide();
                                                $('label[for="alrFieldSel"]').hide();
                                                $("#alrFieldSel").hide();
                                                $("#alrAxisSel").empty();
                                                $("#alrAxisSel").append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                                $("#alrAxisSel").val(-1);
                                                $("#addWidgetRangeTableContainer").hide();
                                                $("#alrThrSel").val("no");
                                                $("#alrThrSel").attr("disabled", false);
                                                $("#alrThrSel").prop("required", true);
                                                
                                                $("#showTableFirstCell").val(-1);
                                                $("#showTableFirstCell").prop("required", false);
                                                $("#showTableFirstCell").attr("disabled", true);

                                                $("#tableFirstCellFontSize").val("");
                                                $("#tableFirstCellFontSize").prop("required", false);
                                                $("#tableFirstCellFontSize").attr("disabled", true);	

                                                $("#widgetFirstCellFontColor").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                                $("#tableFirstCellFontColor").val("");
                                                $("#tableFirstCellFontColor").prop("required", false);
                                                $("#tableFirstCellFontColor").attr("disabled", true);	

                                                $("#rowsLabelsFontSize").val("");
                                                $("#rowsLabelsFontSize").prop("required", false);
                                                $("#rowsLabelsFontSize").attr("disabled", true);	

                                                $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                                $("#rowsLabelsFontColor").val("");
                                                $("#rowsLabelsFontColor").prop("required", false);
                                                $("#rowsLabelsFontColor").attr("disabled", true);

                                                $("#widgetRowsLabelsBckColor").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                                $("#rowsLabelsBckColor").val("");
                                                $("#rowsLabelsBckColor").prop("required", false);
                                                $("#rowsLabelsBckColor").attr("disabled", true);
                                                break;
                                                
                                          case "singleDetails":
                                                $("#serviceUri").val($("#addWidgetFirstAidHospital").val());
                                                $('label[for=addWidgetFirstAidHospitals]').hide();
                                                $('#addWidgetFirstAidHospitals').parent().parent().hide();
                                                $('label[for=addWidgetFirstAidHospital]').show();
                                                $('#addWidgetFirstAidHospital').parent().parent().show();
                                                series = {  
                                                   "firstAxis":{  
                                                      "desc":"Priority",
                                                      "labels":[  
                                                         "Red code",
                                                         "Yellow code",
                                                         "Green code",
                                                         "Blue code",
                                                         "White code"
                                                      ]
                                                   },
                                                   "secondAxis":{  
                                                      "desc":"Status",
                                                      "labels":[  
                                                         "Addressed",
                                                         "Waiting",
                                                         "In visit",
                                                         "In observation",
                                                         "Totals"
                                                      ],
                                                      "series":[]
                                                   }
                                                };
                                                
                                                $('label[for="alrAxisSel"]').hide();
                                                $("#alrAxisSel").hide();
                                                $('label[for="alrFieldSel"]').hide();
                                                $("#alrFieldSel").hide();
                                                $("#alrAxisSel").empty();
                                                $("#alrAxisSel").append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                                //$("#alrAxisSel").append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                                $("#alrAxisSel").val(-1);
                                                $("#addWidgetRangeTableContainer").hide();
                                                $("#alrThrSel").val("no");
                                                $("#alrThrSel").attr("disabled", false);
                                                $("#alrThrSel").prop("required", true);
                                                
                                                $("#showTableFirstCell").val("yes");
                                                $("#showTableFirstCell").prop("required", true);
                                                $("#showTableFirstCell").attr("disabled", false);

                                                $("#tableFirstCellFontSize").val("10");
                                                $("#tableFirstCellFontSize").prop("required", true);
                                                $("#tableFirstCellFontSize").attr("disabled", false);	

                                                $("#widgetFirstCellFontColor").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#tableFirstCellFontColor").val("#000000");
                                                $("#tableFirstCellFontColor").prop("required", true);
                                                $("#tableFirstCellFontColor").attr("disabled", false);	

                                                $("#rowsLabelsFontSize").val("10");
                                                $("#rowsLabelsFontSize").prop("required", true);
                                                $("#rowsLabelsFontSize").attr("disabled", false);	

                                                $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#rowsLabelsFontColor").val("#000000");
                                                $("#rowsLabelsFontColor").prop("required", true);
                                                $("#rowsLabelsFontColor").attr("disabled", false);

                                                $("#widgetRowsLabelsBckColor").parent().parent().parent().colorpicker("setValue","#FFFFFF");
                                                $("#rowsLabelsBckColor").val("#FFFFFF");
                                                $("#rowsLabelsBckColor").prop("required", true);
                                                $("#rowsLabelsBckColor").attr("disabled", false);
                                                break;      
                                          
                                          case "hospitalsOverview":
                                                $("#serviceUri").val("");
                                                $('label[for=addWidgetFirstAidHospital]').hide();
                                                $('#addWidgetFirstAidHospital').parent().parent().hide();
                                                $('label[for=addWidgetFirstAidHospitals]').show();
                                                $('#addWidgetFirstAidHospitals').parent().parent().show();
                                                $('#addWidgetFirstAidHospitals').selectpicker({
                                                   actionsBox: true, 
                                                   width: "auto"
                                                });
                                                
                                                series = {  
                                                   "firstAxis":{  
                                                      "desc":"Priority",
                                                      "labels":[  
                                                         "Red code",
                                                         "Yellow code",
                                                         "Green code",
                                                         "Blue code",
                                                         "White code"
                                                      ]
                                                   },
                                                   "secondAxis":{  
                                                      "desc":"Hospital",
                                                      "labels":[],
                                                      "series":[]
                                                   }
                                                };
                                                
                                                $('#addWidgetFirstAidHospitals').on('changed.bs.select', function (e) 
                                                {
                                                   $("#hospitalList").val(JSON.stringify($(this).val()));
                                                   
                                                   var labelsString = $('button[data-id="addWidgetFirstAidHospitals"] span').eq(0).html().replace(/  /g, " ");
                                                   var labels = labelsString.split(", ");
                                                   series.secondAxis.labels = labels;
                                                   showInfoWCkeditors($('#select-widget').val(), editorsArray, series);
                                                });
                                                
                                                $('label[for="alrAxisSel"]').hide();
                                                $("#alrAxisSel").hide();
                                                $('label[for="alrFieldSel"]').hide();
                                                $("#alrFieldSel").hide();
                                                $("#alrAxisSel").empty();
                                                $("#alrAxisSel").append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                                $("#alrAxisSel").append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                                $("#alrAxisSel").val(-1);
                                                $("#addWidgetRangeTableContainer").hide();
                                                $("#alrThrSel").val("no");
                                                $("#alrThrSel").attr("disabled", true);
                                                
                                                $("#showTableFirstCell").val("yes");
                                                $("#showTableFirstCell").prop("required", true);
                                                $("#showTableFirstCell").attr("disabled", false);

                                                $("#tableFirstCellFontSize").val("10");
                                                $("#tableFirstCellFontSize").prop("required", true);
                                                $("#tableFirstCellFontSize").attr("disabled", false);	

                                                $("#widgetFirstCellFontColor").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#tableFirstCellFontColor").val("#000000");
                                                $("#tableFirstCellFontColor").prop("required", true);
                                                $("#tableFirstCellFontColor").attr("disabled", false);	

                                                $("#rowsLabelsFontSize").val("10");
                                                $("#rowsLabelsFontSize").prop("required", true);
                                                $("#rowsLabelsFontSize").attr("disabled", false);	

                                                $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#rowsLabelsFontColor").val("#000000");
                                                $("#rowsLabelsFontColor").prop("required", true);
                                                $("#rowsLabelsFontColor").attr("disabled", false);

                                                $("#widgetRowsLabelsBckColor").parent().parent().parent().colorpicker("setValue","#FFFFFF");
                                                $("#rowsLabelsBckColor").val("#FFFFFF");
                                                $("#rowsLabelsBckColor").prop("required", true);
                                                $("#rowsLabelsBckColor").attr("disabled", false);
                                                
                                             break;
                                       }
                                       
                                       //Distruzione e ricostruzione dei CKEDITOR perché a seconda del tipo di visualizzazione si mostra o si nasconde la possibilità di aggiungere info sul secondo asse
                                       showInfoWCkeditors($('#select-widget').val(), editorsArray, series);
                                       
                                       //Distruzione thr tables
                                       thrTables1 = new Array();
                                       thrTables2 = new Array();

                                       //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                       setGlobals(null, thrTables1, thrTables2, series, $('#select-widget').val());

                                       //Costruzione THRTables vuote
                                       buildEmptyThrTables();
                                    });

                                    $("#addWidgetFirstAidHospital").change(function()
                                    {
                                       $("#serviceUri").val($(this).val());
                                    });
                                    
                                    //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                    setGlobals(null, thrTables1, thrTables2, series, $('#select-widget').val());
                                    
                                    //Costruzione THRTables vuote
                                    buildEmptyThrTables();
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Nuova riga
                                    //Target widgets geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    //Select show first cell
                                    newLabel = $('<label for="showTableFirstCell" class="col-md-2 control-label">Show first cell</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="showTableFirstCell" name="showTableFirstCell" required></select>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    $("#showTableFirstCell").val(-1);
                                    $("#showTableFirstCell").prop("required", false);
                                    $("#showTableFirstCell").attr("disabled", true);
                                    
                                    //Nuova riga
                                    //First cell font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="tableFirstCellFontSize" class="col-md-2 control-label">First cell font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="tableFirstCellFontSize" name="tableFirstCellFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    $("#tableFirstCellFontSize").val("");
                                    $("#tableFirstCellFontSize").prop("required", false);
                                    $("#tableFirstCellFontSize").attr("disabled", true);
                                    
                                    //First cell font color
                                    newLabel = $('<label for="tableFirstCellFontColor" class="col-md-2 control-label">First cell font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="tableFirstCellFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableFirstCellFontColor" name="tableFirstCellFontColor" required><span class="input-group-addon"><i id="widgetFirstCellFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#tableFirstCellFontColorContainer').show();
                                    $('#tableFirstCellFontColor').show();
                                    $("#widgetFirstCellFontColor").css('display', 'block');
                                    $("#widgetFirstCellFontColor").parent().parent().parent().colorpicker({color: "#eeeeee", format: "rgba"});
                                    $("#tableFirstCellFontColor").val("");
                                    $("#tableFirstCellFontColor").prop("required", false);
                                    $("#tableFirstCellFontColor").attr("disabled", true);
                                    
                                    
                                    //Nuova riga
                                    //Rows labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="rowsLabelsFontSize" class="col-md-2 control-label">Rows labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSize" name="rowsLabelsFontSize" value="10" required> ');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    $("#rowsLabelsFontSize").val("");
                                    $("#rowsLabelsFontSize").prop("required", false);
                                    $("#rowsLabelsFontSize").attr("disabled", true);
                                    
                                    //Rows labels font color
                                    newLabel = $('<label for="rowsLabelsFontColor" class="col-md-2 control-label">Rows labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="rowsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColor" name="rowsLabelsFontColor" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#rowsLabelsFontColorContainer').show();
                                    $('#rowsLabelsFontColor').show();
                                    $("#widgetRowsLabelsFontColor").css('display', 'block');
                                    $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker({color: "#eeeeee", format: "rgba"});
                                    $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                    $("#rowsLabelsFontColor").val("");
                                    $("#rowsLabelsFontColor").prop("required", false);
                                    $("#rowsLabelsFontColor").attr("disabled", true);
                                    
                                    //Nuova riga
                                    //Cols labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="colsLabelsFontSize" class="col-md-2 control-label">Cols labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="colsLabelsFontSize" name="colsLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Cols labels font color
                                    newLabel = $('<label for="colsLabelsFontColor" class="col-md-2 control-label">Cols labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="colsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColor" name="colsLabelsFontColor" required><span class="input-group-addon"><i id="widgetColsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#colsLabelsFontColorContainer').show();
                                    $('#colsLabelsFontColor').show();
                                    $("#widgetColsLabelsFontColor").css('display', 'block');
                                    $("#widgetColsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Rows labels background color
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="rowsLabelsBckColor" class="col-md-2 control-label">Rows labels background color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="rowsLabelsBckColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsBckColor" name="rowsLabelsBckColor" required><span class="input-group-addon"><i id="widgetRowsLabelsBckColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#rowsLabelsBckColorContainer').show();
                                    $('#rowsLabelsBckColor').show();
                                    $("#widgetRowsLabelsBckColor").css('display', 'block');
                                    $("#widgetRowsLabelsBckColor").parent().parent().parent().colorpicker({color: "#FFFFFF", format: "rgba"});
                                    $("#rowsLabelsBckColor").val("");
                                    $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                    $("#rowsLabelsFontColor").val("");
                                    $("#rowsLabelsBckColor").prop("required", false);
                                    $("#rowsLabelsBckColor").attr("disabled", true);
                                    
                                    //Nuova riga
                                    //Table borders
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="tableBorders" class="col-md-2 control-label">Table borders</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="tableBorders" name="tableBorders"></select>');
                                    newSelect.append('<option value="no">No borders</option>');
                                    newSelect.append('<option value="horizontal">Horizontal borders only</option>');
                                    newSelect.append('<option value="all">All borders</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Table borders color
                                    newLabel = $('<label for="tableBordersColor" class="col-md-2 control-label">Table borders color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="tableBordersColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableBordersColor" name="tableBordersColor" required><span class="input-group-addon"><i id="widgetTableBordersColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#tableBordersColorContainer').show();
                                    $('#tableBordersColor').show();
                                    $("#widgetTableBordersColor").css('display', 'block');
                                    $("#widgetTableBordersColor").parent().parent().parent().colorpicker({color: "#EEEEEE", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Set thresholds
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrThrSel" class="col-md-2 control-label">Set thresholds</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="alrThrSel" name="alrThrSel" required>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val('no');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                    $('#alrThrSel').change(alrThrSelListener);
                                    
                                    //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                    newLabel = $('<label for="alrAxisSel" class="col-md-2 control-label">Thresholds target set</label>');
                                    newSelect = $('<select class="form-control" id="alrAxisSel" name="alrAxisSel"></select>');
                                    newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                    //newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                    newSelect.val(-1);
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Nuova riga
                                    //Threshold field select
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrFieldSel" class="col-md-2 control-label">Thresholds target field</label>');
                                    newSelect = $('<select class="form-control" id="alrFieldSel" name="alrFieldSel">');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Contenitore per tabella delle soglie
                                    addWidgetRangeTableContainer = $('<div id="addWidgetRangeTableContainer" class="row rowCenterContent"></div>');
                                    $("#specificWidgetPropertiesDiv").append(addWidgetRangeTableContainer);
                                    addWidgetRangeTableContainer.hide(); 

                                    //Funzione che crea e mostra i ckeditors per i campi info del widget
                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, series);
                                    
                                    removeWidgetProcessGeneralFields("addWidget");
                                 break;
      
      
                                 case "widgetRadarSeries":    
                                    var currentParams, i, k, currentFieldIndex, currentSeriesIndex, row, cell, descName = null;
                                    var metricId = $('#select-metric').val();
                                    var metricData = getMetricData(metricId);
                                    var seriesString = metricData.data[0].commit.author.series;
                                    var series = jQuery.parseJSON(seriesString);
                                    
                                    //Costruzione THRTable vuota
                                    var thrTable = $("<table class='thrRangeTableRadar table table-bordered'></table>");
                                    row = $('<tr></tr>');
                                    cell = $('<td><a href="#"><i class="fa fa-plus" style="font-size:24px;color:#337ab7"></i></a></td>');
                                    row.append(cell);
                                    cell = $('<td>Color</td>');
                                    row.append(cell);
                                    cell = $('<td>Short description</td>');
                                    row.append(cell);
                                    
                                    //Colonne per i limiti sup di ogni campo
                                    for(var i in series.firstAxis.labels)
                                    {
                                        if(series.firstAxis.labels[i].length > 8)
                                        {
                                            descName = series.firstAxis.labels[i].substr(0,8) + "...";
                                        }
                                        else
                                        {
                                            descName = series.firstAxis.labels[i];
                                        }

                                        cell = $('<td class="boundDesc"><b>' + descName + '</b><br/>limit</td>');
                                        row.append(cell);
                                    }
                                    
                                    thrTable.append(row);
                                    
                                    //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                    setGlobalsRadar(null, thrTable, series, $('#select-widget').val());
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').prop("required", false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("10");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();
                                    
                                    
                                    //Proprietà specifiche del widget
                                    //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Proprietà specifiche
                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, series);
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Rows labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="rowsLabelsFontSize" class="col-md-2 control-label">X-Axis labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSize" name="rowsLabelsFontSize" value="10" required> ');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Rows labels font color
                                    newLabel = $('<label for="rowsLabelsFontColor" class="col-md-2 control-label">X-Axis labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="rowsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColor" name="rowsLabelsFontColor" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#rowsLabelsFontColorContainer').show();
                                    $('#rowsLabelsFontColor').show();
                                    $("#widgetRowsLabelsFontColor").css('display', 'block');
                                    $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Cols labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="colsLabelsFontSize" class="col-md-2 control-label">Y-Axis labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="colsLabelsFontSize" name="colsLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Cols labels font color
                                    newLabel = $('<label for="colsLabelsFontColor" class="col-md-2 control-label">Y-Axis labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="colsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColor" name="colsLabelsFontColor" required><span class="input-group-addon"><i id="widgetColsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#colsLabelsFontColorContainer').show();
                                    $('#colsLabelsFontColor').show();
                                    $("#widgetColsLabelsFontColor").css('display', 'block');
                                    $("#widgetColsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Data labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="dataLabelsFontSize" class="col-md-2 control-label">Data labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="dataLabelsFontSize" name="dataLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Data labels font color
                                    newLabel = $('<label for="dataLabelsFontColor" class="col-md-2 control-label">Data labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="dataLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="dataLabelsFontColor" name="dataLabelsFontColor" required><span class="input-group-addon"><i id="widgetDataLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#dataLabelsFontColorContainer').show();
                                    $('#dataLabelsFontColor').show();
                                    $("#widgetDataLabelsFontColor").css('display', 'block');
                                    $("#widgetDataLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Legend font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="legendFontSize" class="col-md-2 control-label">Legend font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="legendFontSize" name="legendFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Legend font color
                                    newLabel = $('<label for="legendFontColor" class="col-md-2 control-label">Legend font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="legendFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColor" name="legendFontColor" required><span class="input-group-addon"><i id="widgetLegendFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#legendFontColorContainer').show();
                                    $('#legendFontColor').show();
                                    $("#widgetLegendFontColor").css('display', 'block');
                                    $("#widgetLegendFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Grid lines width
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="gridLinesWidth" class="col-md-2 control-label">Grid lines width</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="gridLinesWidth" name="gridLinesWidth" value="1" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Grid lines color
                                    newLabel = $('<label for="gridLinesColor" class="col-md-2 control-label">Grid lines color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="gridLinesColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="gridLinesColor" name="gridLinesColor" required><span class="input-group-addon"><i id="widgetGridLinesColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#gridLinesColorContainer').show();
                                    $('#gridLinesColor').show();
                                    $("#widgetGridLinesColor").css('display', 'block');
                                    $("#widgetGridLinesColor").parent().parent().parent().colorpicker({color: "#e6e6e6", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Lines width
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="linesWidth" class="col-md-2 control-label">Lines width</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="linesWidth" name="linesWidth" value="1" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Lines colors
                                    newLabel = $('<label for="barsColorsSelect" class="col-md-2 control-label">Lines colors</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="barsColorsSelect" name="barsColorsSelect"></select>');
                                    newSelect.append('<option value="auto">Automatic</option>');
                                    newSelect.append('<option value="manual">Manual</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Contenitore per tabella dei colori
                                    barsColorsTableContainer = $('<div id="barsColorsTableContainer" class="row rowCenterContent"></div>');
                                    $("#specificWidgetPropertiesDiv").append(barsColorsTableContainer);
                                    barsColorsTableContainer.hide();

                                    //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                    var colorsTable, newRow, newCell = null;
                                    var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                    var colorsArray = new Array();

                                    function updateWidgetBarSeriesColors(e, params)
                                    {
                                        var newColor = $(this).colorpicker('getValue');
                                        var index = parseInt($(this).parents('tr').index() - 1);
                                        colorsArray[index] = newColor;
                                        $("#barsColors").val(JSON.stringify(colorsArray));
                                    }

                                    colorsTable = $("<table id ='colorsTable' class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                    for(var i in series.secondAxis.labels)
                                    {
                                        newRow = $('<tr></tr>');
                                        newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                        newRow.append(newCell);
                                        newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                        newRow.append(newCell);
                                        newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                        newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColors); 
                                        colorsArray.push(defaultColorsArray[i%10]);
                                        colorsTable.append(newRow);
                                    }

                                    $("#barsColors").val(JSON.stringify(colorsArray));
                                    $('#barsColorsTableContainer').append(colorsTable);

                                    $('#barsColorsSelect').change(function () 
                                    {
                                        if($('#barsColorsSelect').val() === "manual")
                                        {
                                            $('#barsColorsTableContainer').show();
                                        }
                                        else
                                        {
                                            $('#barsColorsTableContainer').hide();
                                        }
                                    });


                                    //Codice di creazione soglie
                                    //Nuova riga
                                    //Set thresholds
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrThrSel" class="col-md-2 control-label">Set thresholds</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="alrThrSel" name="alrThrSel" required>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val('no');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Thresholds lines width
                                    newLabel = $('<label for="alrThrLinesWidth" class="col-md-2 control-label">Thresholds lines width</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="alrThrLinesWidth" name="alrThrLinesWidth" value="1" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newInput.hide();
                                    
                                    //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                    $('#alrThrSel').change(alrThrSelListenerRadar);
                                    
                                    //Contenitore per tabella delle soglie
                                    addWidgetRangeTableContainer = $('<div id="addWidgetRangeTableContainer" class="row  thrRangeTableRadarContainer"></div>');  //rowCenterContent
                                    $("#specificWidgetPropertiesDiv").append(addWidgetRangeTableContainer);
                                    addWidgetRangeTableContainer.hide();
                                    break;
        
                                case "widgetLineSeries": case "widgetCurvedLineSeries":
                                    var currentParams, i, k, currentFieldIndex, currentSeriesIndex = null;
                                    var metricId = $('#select-metric').val();
                                    var metricData = getMetricData(metricId);
                                    var seriesString = metricData.data[0].commit.author.series;
                                    var series = jQuery.parseJSON(seriesString);
                                    var thrTables1 = new Array();
                                    var thrTables2 = new Array(); 
                                    
                                    //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                    setGlobals(null, thrTables1, thrTables2, series, $('#select-widget').val());
                                    
                                    //Costruzione THRTables vuote
                                    buildEmptyThrTables();
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                        
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').prop("required", false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("10");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    //Proprietà specifiche del widget
                                    //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Proprietà specifiche
                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, series);

                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //X-Axis dataset
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="xAxisDataset" class="col-md-2 control-label">X-Axis dataset</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="xAxisDataset" name="xAxisDataset" required>');
                                    newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                    newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Line width
                                    newLabel = $('<label for="lineWidth" class="col-md-2 control-label">Line width</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="lineWidth" name="lineWidth" value="2" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Nuova riga
                                    //X-Axis labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="rowsLabelsFontSize" class="col-md-2 control-label">X-Axis labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSize" name="rowsLabelsFontSize" value="10" required> ');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //X-Axis labels font color
                                    newLabel = $('<label for="rowsLabelsFontColor" class="col-md-2 control-label">X-Axis labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="rowsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColor" name="rowsLabelsFontColor" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#rowsLabelsFontColorContainer').show();
                                    $('#rowsLabelsFontColor').show();
                                    $("#widgetRowsLabelsFontColor").css('display', 'block');
                                    $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Y-Axis labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="colsLabelsFontSize" class="col-md-2 control-label">Y-Axis labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="colsLabelsFontSize" name="colsLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Y-Axis labels font color
                                    newLabel = $('<label for="colsLabelsFontColor" class="col-md-2 control-label">Y-Axis labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="colsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColor" name="colsLabelsFontColor" required><span class="input-group-addon"><i id="widgetColsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#colsLabelsFontColorContainer').show();
                                    $('#colsLabelsFontColor').show();
                                    $("#widgetColsLabelsFontColor").css('display', 'block');
                                    $("#widgetColsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Data labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="dataLabelsFontSize" class="col-md-2 control-label">Data labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="dataLabelsFontSize" name="dataLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Data labels font color
                                    newLabel = $('<label for="dataLabelsFontColor" class="col-md-2 control-label">Data labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="dataLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="dataLabelsFontColor" name="dataLabelsFontColor" required><span class="input-group-addon"><i id="widgetDataLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#dataLabelsFontColorContainer').show();
                                    $('#dataLabelsFontColor').show();
                                    $("#widgetDataLabelsFontColor").css('display', 'block');
                                    $("#widgetDataLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Legend font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="legendFontSize" class="col-md-2 control-label">Legend font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="legendFontSize" name="legendFontSize" value="10" required>  ');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Legend font color
                                    newLabel = $('<label for="legendFontColor" class="col-md-2 control-label">Legend font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="legendFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColor" name="legendFontColor" required><span class="input-group-addon"><i id="widgetLegendFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#legendFontColorContainer').show();
                                    $('#legendFontColor').show();
                                    $("#widgetLegendFontColor").css('display', 'block');
                                    $("#widgetLegendFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Lines colors
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="barsColorsSelect" class="col-md-2 control-label">Lines colors</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="barsColorsSelect" name="barsColorsSelect"></select>');
                                    newSelect.append('<option value="auto">Automatic</option>');
                                    newSelect.append('<option value="manual">Manual</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Chart type
                                    newLabel = $('<label for="chartType" class="col-md-2 control-label">Chart type</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="chartType" name="chartType"></select>');
                                    newSelect.append("<option value='lines'>Simple lines</option>");
                                    newSelect.append("<option value='area'>Area lines</option>");
                                    newSelect.append("<option value='stacked'>Stacked area lines</option>");
                                    newSelect.val("lines");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Nuova riga
                                    //Data labels
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="dataLabels" class="col-md-2 control-label">Data labels</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="dataLabels" name="dataLabels"> ');
                                    newSelect.append('<option value="no">No data labels</option>');
                                    newSelect.append('<option value="value">Value only</option>');
                                    newSelect.append('<option value="full">Field name and value</option>');
                                    newSelect.val("value");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Contenitore per tabella dei colori
                                    barsColorsTableContainer = $('<div id="barsColorsTableContainer" class="row rowCenterContent"></div>');
                                    $("#specificWidgetPropertiesDiv").append(barsColorsTableContainer);
                                    barsColorsTableContainer.hide();

                                    //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                    var colorsTable, newRow, newCell = null;
                                    var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                    var colorsArray = new Array();
                                    
                                    function updateXAxisSelect()
                                    {
                                        var colorsTarget = null;
                                        colorsTable.find('tr').remove();
                                        colorsTable.append("<tr><td>Series</td><td>Color</td></tr>");
                                        
                                        $('#alrAxisSel').empty();
                                    
                                        if($("#xAxisDataset").val() === series.firstAxis.desc)
                                        {
                                            //Grafico non trasposto
                                            colorsTarget = series.secondAxis.labels;
                                            $('#alrAxisSel').append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        }
                                        else
                                        {
                                            //Grafico trasposto
                                            colorsTarget = series.firstAxis.labels;
                                            $('#alrAxisSel').append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                        }
                                        
                                        alrAxisSelListener();

                                        for(var i in colorsTarget)
                                        {
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>' + colorsTarget[i] + '</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColors); 
                                            colorsArray.push(defaultColorsArray[i%10]);
                                            colorsTable.append(newRow);
                                        }
                                        $('label[for="alrFieldSel"]').hide();
                                        $('#alrFieldSel').hide();
                                        $('#alrFieldSel').parent().hide();
                                        $('label[for="alrAxisSel"]').hide();
                                        $('#alrAxisSel').hide();
                                        $('#alrAxisSel').parent().hide();
                                        $('#alrThrSel').val("no");
                                    }
            
                                    function updateWidgetBarSeriesColors(e, params)
                                    {
                                        var newColor = $(this).colorpicker('getValue');
                                        var index = parseInt($(this).parents('tr').index() - 1);
                                        colorsArray[index] = newColor;
                                        $("#barsColors").val(JSON.stringify(colorsArray));
                                    }
                                    
                                    $("#xAxisDataset").off();
                                    $("#xAxisDataset").on("change", updateXAxisSelect);

                                    colorsTable = $("<table id ='colorsTable' class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                    
                                    updateXAxisSelect();

                                    $("#barsColors").val(JSON.stringify(colorsArray));
                                    $('#barsColorsTableContainer').append(colorsTable);

                                    $('#barsColorsSelect').change(function() 
                                    {
                                        if($('#barsColorsSelect').val() === "manual")
                                        {
                                            $('#barsColorsTableContainer').show();
                                        }
                                        else
                                        {
                                            $('#barsColorsTableContainer').hide();
                                        }
                                    });

                                    //Codice costruzione soglie
                                    //Nuova riga
                                    //Set thresholds
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrThrSel" class="col-md-2 control-label">Set thresholds</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="alrThrSel" name="alrThrSel" required>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val('no');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                    $('#alrThrSel').change(alrThrSelListener);
                                    
                                    //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                    newLabel = $('<label for="alrAxisSel" class="col-md-2 control-label">Thresholds target set</label>');
                                    newSelect = $('<select class="form-control" id="alrAxisSel" name="alrAxisSel"></select>');
                                    if($("#xAxisDataset").val() === series.firstAxis.desc)
                                    {
                                        //No trasposizione
                                        newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                    }
                                    else
                                    {
                                        //Trasposizione
                                        newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                    }
                                    alrAxisSelListener();
                                    newSelect.val(-1);
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Nuova riga
                                    //Threshold field select
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrFieldSel" class="col-md-2 control-label">Thresholds target field</label>');
                                    newSelect = $('<select class="form-control" id="alrFieldSel" name="alrFieldSel">');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Threshold look&feel
                                    newLabel = $('<label for="alrLook" class="col-md-2 control-label">Thresholds look&feel</label>');
                                    newSelect = $('<select class="form-control" id="alrLook" name="alrLook">');
                                    newSelect.append('<option value="none">Tooltip only</option>');
                                    newSelect.append('<option value="lines">Lines</option>');
                                    newSelect.append('<option value="areas">Background areas</option>');
                                    newSelect.val("lines");
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Contenitore per tabella delle soglie
                                    addWidgetRangeTableContainer = $('<div id="addWidgetRangeTableContainer" class="row rowCenterContent"></div>');
                                    $("#specificWidgetPropertiesDiv").append(addWidgetRangeTableContainer);
                                    addWidgetRangeTableContainer.hide();
                                    break;
        
                                case "widgetScatterSeries":
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').prop("required", false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("10");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Proprietà specifiche del widget
                                    //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Proprietà specifiche
                                    var currentParams = null;
                                    var metricId = $('#select-metric').val();
                                    var metricData = getMetricData(metricId);
                                    var seriesString = metricData.data[0].commit.author.series;
                                    var series = jQuery.parseJSON(seriesString);
                                    var thrTables1 = new Array();
                                    var thrTables2 = new Array();
                                    var i, k, currentFieldIndex, currentSeriesIndex = null;

                                    //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                    setGlobals(currentParams, thrTables1, thrTables2, series, $('#select-widget').val());

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, series);

                                    removeWidgetProcessGeneralFields("addWidget");
                                    removeWidgetTableListeners("addWidget");  removeWidgetBarSeriesListeners("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    $("label[for='rowsLabelsFontSize']").parent().show();
                                    $("label[for='rowsLabelsFontSize']").show();
                                    $("#rowsLabelsFontSize").show();

                                    $("label[for='rowsLabelsFontColor']").show();
                                    $("#rowsLabelsFontColor").show();
                                    //Questa falla con css sennò la mostra inline e non viene colorato!
                                    $("#widgetRowsLabelsFontColor").css('display', 'block');
                                    $("#widgetRowsLabelsFontColor").parent().parent().colorpicker({color: '#000000', format: "rgba"});

                                    $("label[for='colsLabelsFontSize']").parent().show();
                                    $("label[for='colsLabelsFontSize']").show();
                                    $("#colsLabelsFontSize").show();

                                    $("label[for='colsLabelsFontColor']").show();
                                    $("#colsLabelsFontColor").show();
                                    //Questa falla con css sennò la mostra inline e non viene colorato!
                                    $("#widgetColsLabelsFontColor").css('display', 'block');
                                    $("#widgetColsLabelsFontColor").parent().parent().colorpicker({color: '#000000', format: "rgba"});

                                    $("label[for='dataLabelsFontSize']").parent().show();
                                    $("label[for='dataLabelsFontSize']").show();
                                    $("#dataLabelsFontSize").show();

                                    $("label[for='dataLabelsFontColor']").show();
                                    $("#dataLabelsFontColor").show();
                                    //Questa falla con css sennò la mostra inline e non viene colorato!
                                    $("#widgetDataLabelsFontColor").css('display', 'block');
                                    $("#widgetDataLabelsFontColor").parent().parent().colorpicker({color: '#000000', format: "rgba"});

                                    $("label[for='legendFontSize']").parent().show();
                                    $("label[for='legendFontSize']").show();
                                    $("#legendFontSize").show();

                                    $("label[for='legendFontColor']").show();
                                    $("#legendFontColor").show();
                                    //Questa falla con css sennò la mostra inline e non viene colorato!
                                    $("#widgetLegendFontColor").css('display', 'block');
                                    $("#widgetLegendFontColor").parent().parent().colorpicker({color: '#000000', format: "rgba"});

                                    $("label[for='barsColorsSelect']").html("Markers colors");
                                    $("label[for='barsColorsSelect']").parent().show();
                                    $("label[for='barsColorsSelect']").show();
                                    $("#barsColorsSelect").val("auto");
                                    $("#barsColorsSelect").show();

                                    $("label[for='chartType']").show();
                                    $("#chartType").val("horizontal");
                                    $("#chartType").show();
                                    
                                    $("label[for='dataLabels']").parent().show();
                                    $("label[for='dataLabels']").show();
                                    $("#dataLabels").val("value");
                                    $("#dataLabels").show();
                                    
                                    $("label[for='dataLabelsRotation']").show();
                                    $("#dataLabelsRotation").val("horizontal");
                                    $("#dataLabelsRotation").show();
                                    
                                    $("#xAxisDataset").off();
                                    
                                    $("#xAxisDataset").prop('required', false);
                                    $("#lineWidth").prop('required', false);
                                    $("#alrLook").prop('required', false);

                                    //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                    var colorsTable, newRow, newCell = null;
                                    var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                    var colorsArray = new Array();

                                    function updateWidgetBarSeriesColors(e, params)
                                    {
                                        var newColor = $(this).colorpicker('getValue');
                                        var index = parseInt($(this).parents('tr').index() - 1);
                                        colorsArray[index] = newColor;
                                        $("#barsColors").val(JSON.stringify(colorsArray));
                                    }

                                    colorsTable = $("<table id ='colorsTable' class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                    for(var i in series.secondAxis.labels)
                                    {
                                        newRow = $('<tr></tr>');
                                        newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                        newRow.append(newCell);
                                        newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                        newRow.append(newCell);
                                        newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                        newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColors); 
                                        colorsArray.push(defaultColorsArray[i%10]);
                                        colorsTable.append(newRow);
                                    }

                                    $("#barsColors").val(JSON.stringify(colorsArray));

                                    $('#barsColorsTableContainer').append(colorsTable);

                                    $('#barsColorsSelect').change(function () 
                                    {
                                        if($('#barsColorsSelect').val() === "manual")
                                        {
                                            $('#barsColorsTableContainer').show();
                                        }
                                        else
                                        {
                                            $('#barsColorsTableContainer').hide();
                                        }
                                    });

                                    $("label[for='alrThrFlag']").parent().show();
                                    $('#alrThrFlag').val("no");
                                    $('#alrThrFlag').show();
                                    $("label[for='alrThrFlag']").show();

                                    //Codice di creazione soglie
                                    //Popolamento del select per gli assi
                                    $('#alrAxisSel').empty();
                                    $('#alrAxisSel').append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");

                                    //Costruzione THRTables vuote
                                    buildEmptyThrTables();

                                    //Listener per settaggio/desettaggio soglie
                                    $('#alrThrFlag').change(alrThrFlagListener);

                                    //Listener per settaggio/desettaggio campi in base ad asse selezionato
                                    $('#alrAxisSel').change(alrAxisSelListener);

                                    //Listener per selezione campo
                                    $('#alrFieldSel').change(alrFieldSelListener);
                                    //Fine proprietà specifiche del widget
                                    break;
        
                                case "widgetBarSeries":
                                    var currentParams, i, k, currentFieldIndex, currentSeriesIndex = null;
                                    var metricId = $('#select-metric').val();
                                    var metricData = getMetricData(metricId);
                                    var seriesString = metricData.data[0].commit.author.series;
                                    var series = jQuery.parseJSON(seriesString);
                                    var thrTables1 = new Array();
                                    var thrTables2 = new Array();
                                    
                                    //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                    setGlobals(null, thrTables1, thrTables2, series, $('#select-widget').val());
                                    
                                    //Costruzione THRTables vuote
                                    buildEmptyThrTables();
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').prop("required", false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("10");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    //Proprietà specifiche del widget
                                    //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Proprietà specifiche
                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, series);
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Rows labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="rowsLabelsFontSize" class="col-md-2 control-label">Rows labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSize" name="rowsLabelsFontSize" value="10" required> ');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Rows labels font color
                                    newLabel = $('<label for="rowsLabelsFontColor" class="col-md-2 control-label">Rows labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="rowsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColor" name="rowsLabelsFontColor" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#rowsLabelsFontColorContainer').show();
                                    $('#rowsLabelsFontColor').show();
                                    $("#widgetRowsLabelsFontColor").css('display', 'block');
                                    $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Cols labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="colsLabelsFontSize" class="col-md-2 control-label">Cols labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="colsLabelsFontSize" name="colsLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Cols labels font color
                                    newLabel = $('<label for="colsLabelsFontColor" class="col-md-2 control-label">Cols labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="colsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColor" name="colsLabelsFontColor" required><span class="input-group-addon"><i id="widgetColsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#colsLabelsFontColorContainer').show();
                                    $('#colsLabelsFontColor').show();
                                    $("#widgetColsLabelsFontColor").css('display', 'block');
                                    $("#widgetColsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Data labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="dataLabelsFontSize" class="col-md-2 control-label">Data labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="dataLabelsFontSize" name="dataLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Data labels font color
                                    newLabel = $('<label for="dataLabelsFontColor" class="col-md-2 control-label">Data labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="dataLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="dataLabelsFontColor" name="dataLabelsFontColor" required><span class="input-group-addon"><i id="widgetDataLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#dataLabelsFontColorContainer').show();
                                    $('#dataLabelsFontColor').show();
                                    $("#widgetDataLabelsFontColor").css('display', 'block');
                                    $("#widgetDataLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Legend font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="legendFontSize" class="col-md-2 control-label">Legend font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="legendFontSize" name="legendFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Legend font color
                                    newLabel = $('<label for="legendFontColor" class="col-md-2 control-label">Legend font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="legendFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColor" name="legendFontColor" required><span class="input-group-addon"><i id="widgetLegendFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#legendFontColorContainer').show();
                                    $('#legendFontColor').show();
                                    $("#widgetLegendFontColor").css('display', 'block');
                                    $("#widgetLegendFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Bars colors
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="barsColorsSelect" class="col-md-2 control-label">Bars colors</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="barsColorsSelect" name="barsColorsSelect"></select>');
                                    newSelect.append('<option value="auto">Automatic</option>');
                                    newSelect.append('<option value="manual">Manual</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Chart type
                                    newLabel = $('<label for="chartType" class="col-md-2 control-label">Chart type</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="chartType" name="chartType"></select>');
                                    newSelect.append('<option value="horizontal">Horizontal bars</option>');
                                    newSelect.append('<option value="horizontalStacked">Horizontal stacked bars</option>');
                                    newSelect.append('<option value="vertical">Vertical bars</option>');
                                    newSelect.append('<option value="verticalStacked">Vertical stacked bars</option>');
                                    newSelect.val("horizontal");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Nuova riga
                                    //Data labels
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="dataLabels" class="col-md-2 control-label">Data labels</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="dataLabels" name="dataLabels">');
                                    newSelect.append('<option value="no">No data labels</option>');
                                    newSelect.append('<option value="value">Value only</option>');
                                    newSelect.append('<option value="full">Field name and value</option>');
                                    newSelect.val("value");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Data labels rotation
                                    newLabel = $('<label for="dataLabelsRotation" class="col-md-2 control-label">Data labels rotation</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="dataLabelsRotation" name="dataLabelsRotation">');
                                    newSelect.append('<option value="horizontal">Horizontal</option>');
                                    newSelect.append('<option value="verticalAsc">Vertical ascending</option>');
                                    newSelect.append('<option value="verticalDesc">Vertical descending</option>');
                                    newSelect.val("horizontal");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Contenitore per tabella dei colori
                                    barsColorsTableContainer = $('<div id="barsColorsTableContainer" class="row rowCenterContent"></div>');
                                    $("#specificWidgetPropertiesDiv").append(barsColorsTableContainer);
                                    barsColorsTableContainer.hide();

                                    //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                    var colorsTable, newRow, newCell = null;
                                    var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                    var colorsArray = new Array();

                                    function updateWidgetBarSeriesColors(e, params)
                                    {
                                        var newColor = $(this).colorpicker('getValue');
                                        var index = parseInt($(this).parents('tr').index() - 1);
                                        colorsArray[index] = newColor;
                                        $("#barsColors").val(JSON.stringify(colorsArray));
                                    }

                                    colorsTable = $("<table id ='colorsTable' class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                    for(var i in series.secondAxis.labels)
                                    {
                                        newRow = $('<tr></tr>');
                                        newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                        newRow.append(newCell);
                                        newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                        newRow.append(newCell);
                                        newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                        newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColors); 
                                        colorsArray.push(defaultColorsArray[i%10]);
                                        colorsTable.append(newRow);
                                    }

                                    $("#barsColors").val(JSON.stringify(colorsArray));
                                    $('#barsColorsTableContainer').append(colorsTable);

                                    $('#barsColorsSelect').change(function () 
                                    {
                                        if($('#barsColorsSelect').val() === "manual")
                                        {
                                            $('#barsColorsTableContainer').show();
                                        }
                                        else
                                        {
                                            $('#barsColorsTableContainer').hide();
                                        }
                                    });

                                    //Codice di creazione soglie
                                    //Nuova riga
                                    //Set thresholds
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrThrSel" class="col-md-2 control-label">Set thresholds</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="alrThrSel" name="alrThrSel" required>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val('no');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                    $('#alrThrSel').change(alrThrSelListener);
                                    
                                    //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                    newLabel = $('<label for="alrAxisSel" class="col-md-2 control-label">Thresholds target set</label>');
                                    newSelect = $('<select class="form-control" id="alrAxisSel" name="alrAxisSel"></select>');
                                    newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                    newSelect.val(-1);
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Nuova riga
                                    //Threshold field select
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrFieldSel" class="col-md-2 control-label">Thresholds target field</label>');
                                    newSelect = $('<select class="form-control" id="alrFieldSel" name="alrFieldSel">');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Contenitore per tabella delle soglie
                                    addWidgetRangeTableContainer = $('<div id="addWidgetRangeTableContainer" class="row rowCenterContent"></div>');
                                    $("#specificWidgetPropertiesDiv").append(addWidgetRangeTableContainer);
                                    addWidgetRangeTableContainer.hide();
                                    break;

                                case "widgetTable":
                                    var currentParams, i, k, currentFieldIndex, currentSeriesIndex = null;
                                    var metricId = $('#select-metric').val();
                                    var metricData = getMetricData(metricId);
                                    var seriesString = metricData.data[0].commit.author.series;
                                    var series = jQuery.parseJSON(seriesString);
                                    var thrTables1 = new Array();
                                    var thrTables2 = new Array();
                                    
                                    //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                    setGlobals(null, thrTables1, thrTables2, series, $('#select-widget').val());
                                    
                                    //Costruzione THRTables vuote
                                    buildEmptyThrTables();
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').prop("required", false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("10");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    //Proprietà specifiche del widget
                                    //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Visualizzazione campi specifici per questo widget
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Select show first cell
                                    newFormRow = $('<div class="row"></div>');
                                    newLabel = $('<label for="showTableFirstCell" class="col-md-2 control-label">Show first cell</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="showTableFirstCell" name="showTableFirstCell" required></select>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Nuova riga
                                    //First cell font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="tableFirstCellFontSize" class="col-md-2 control-label">First cell font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="tableFirstCellFontSize" name="tableFirstCellFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //First cell font color
                                    newLabel = $('<label for="tableFirstCellFontColor" class="col-md-2 control-label">First cell font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="tableFirstCellFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableFirstCellFontColor" name="tableFirstCellFontColor" required><span class="input-group-addon"><i id="widgetFirstCellFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#tableFirstCellFontColorContainer').show();
                                    $('#tableFirstCellFontColor').show();
                                    $("#widgetFirstCellFontColor").css('display', 'block');
                                    $("#widgetFirstCellFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Rows labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="rowsLabelsFontSize" class="col-md-2 control-label">Rows labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSize" name="rowsLabelsFontSize" value="10" required> ');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Rows labels font color
                                    newLabel = $('<label for="rowsLabelsFontColor" class="col-md-2 control-label">Rows labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="rowsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColor" name="rowsLabelsFontColor" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#rowsLabelsFontColorContainer').show();
                                    $('#rowsLabelsFontColor').show();
                                    $("#widgetRowsLabelsFontColor").css('display', 'block');
                                    $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Cols labels font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="colsLabelsFontSize" class="col-md-2 control-label">Cols labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="colsLabelsFontSize" name="colsLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Cols labels font color
                                    newLabel = $('<label for="colsLabelsFontColor" class="col-md-2 control-label">Cols labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="colsLabelsFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColor" name="colsLabelsFontColor" required><span class="input-group-addon"><i id="widgetColsLabelsFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#colsLabelsFontColorContainer').show();
                                    $('#colsLabelsFontColor').show();
                                    $("#widgetColsLabelsFontColor").css('display', 'block');
                                    $("#widgetColsLabelsFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Rows labels background color
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="rowsLabelsBckColor" class="col-md-2 control-label">Rows labels background color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="rowsLabelsBckColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsBckColor" name="rowsLabelsBckColor" required><span class="input-group-addon"><i id="widgetRowsLabelsBckColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#rowsLabelsBckColorContainer').show();
                                    $('#rowsLabelsBckColor').show();
                                    $("#widgetRowsLabelsBckColor").css('display', 'block');
                                    $("#widgetRowsLabelsBckColor").parent().parent().parent().colorpicker({color: "#FFFFFF", format: "rgba"});
                                    
                                    
                                    //Cols labels background color
                                    newLabel = $('<label for="colsLabelsBckColor" class="col-md-2 control-label">Cols labels background color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="colsLabelsBckColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsBckColor" name="colsLabelsBckColor" required><span class="input-group-addon"><i id="widgetColsLabelsBckColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#colsLabelsBckColorContainer').show();
                                    $('#colsLabelsBckColor').show();
                                    $("#widgetColsLabelsBckColor").css('display', 'block');
                                    $("#widgetColsLabelsBckColor").parent().parent().parent().colorpicker({color: "#FFFFFF", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Table borders
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="tableBorders" class="col-md-2 control-label">Table borders</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="tableBorders" name="tableBorders"></select>');
                                    newSelect.append('<option value="no">No borders</option>');
                                    newSelect.append('<option value="horizontal">Horizontal borders only</option>');
                                    newSelect.append('<option value="all">All borders</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Table borders color
                                    newLabel = $('<label for="tableBordersColor" class="col-md-2 control-label">Table borders color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="tableBordersColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableBordersColor" name="tableBordersColor" required><span class="input-group-addon"><i id="widgetTableBordersColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#tableBordersColorContainer').show();
                                    $('#tableBordersColor').show();
                                    $("#widgetTableBordersColor").css('display', 'block');
                                    $("#widgetTableBordersColor").parent().parent().parent().colorpicker({color: "#EEEEEE", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Set thresholds
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrThrSel" class="col-md-2 control-label">Set thresholds</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="alrThrSel" name="alrThrSel" required>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val('no');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                    $('#alrThrSel').change(alrThrSelListener);
                                    
                                    //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                    newLabel = $('<label for="alrAxisSel" class="col-md-2 control-label">Thresholds target set</label>');
                                    newSelect = $('<select class="form-control" id="alrAxisSel" name="alrAxisSel"></select>');
                                    newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                    newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                    newSelect.val(-1);
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Nuova riga
                                    //Threshold field select
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="alrFieldSel" class="col-md-2 control-label">Thresholds target field</label>');
                                    newSelect = $('<select class="form-control" id="alrFieldSel" name="alrFieldSel">');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.hide();
                                    newInnerDiv.hide();
                                    newSelect.hide();
                                    
                                    //Contenitore per tabella delle soglie
                                    addWidgetRangeTableContainer = $('<div id="addWidgetRangeTableContainer" class="row rowCenterContent"></div>');
                                    $("#specificWidgetPropertiesDiv").append(addWidgetRangeTableContainer);
                                    addWidgetRangeTableContainer.hide(); 

                                    //Funzione che crea e mostra i ckeditors per i campi info del widget
                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, series);
                                    
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetProcess":
                                    $("label[for='inputComuneWidget']").css("display", "");
                                    $("#bckColorLabel").html("Background color");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUrlWidget').attr('disabled', false);
                                    $('#inputUrlWidget').prop('required', true);
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $("#schedulerRow").show();
                                    $("label[for='inputSchedulerWidget']").show();
                                    $('#inputSchedulerWidgetDiv').show();
                                    $('#inputSchedulerWidgetGroupDiv').show();
                                    $('#inputSchedulerWidget').show();
                                    $('#inputSchedulerWidget').prop('selectedIndex', -1);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFontSize').val("");
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();
                                    

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Reperimento elenco dei jobs groups per scheduler
                                    for(var i = 0; i < elencoScheduler.length; i++)
                                    {
                                        $.ajax({
                                            url: "getJobs.php",
                                            data: {action: "getJobGroupsForScheduler", host: elencoScheduler[i].ip, user: elencoScheduler[i].user, pass: elencoScheduler[i].pass},
                                            type: "POST",
                                            async: false,
                                            dataType: 'json',
                                            success: function (data) 
                                            {
                                                for(var j = 0; j < data.length; j++) 
                                                {
                                                    elencoJobsGroupsPerScheduler[i][j] = data[j].id;
                                                }
                                            }
                                        });
                                    }
                                    break;

                                case "widgetProtezioneCivile":
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan = null;
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUrlWidget').attr("disabled", "true");
                                    $('#inputUrlWidget').prop("required", "false");
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $('#inputTitleWidget').val('Protezione Civile');
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputTitleWidget').attr('disabled', true);
                                    $('#inputTitleWidget').prop('required', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val('60');
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontSize').prop('required', false);  
                                    $("#widgetFontColor").parent().parent().colorpicker({color: "#eeeeee", format: "rgba"});
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#inputFontColor').prop('required', false);
                                    $('#inputHeaderFontColorWidget').attr('disabled', true);
                                    $('#inputHeaderFontColorWidget').prop('required', false);
                                    $('#inputHeaderFontColorWidget').val("");
                                    $('#widgetHeaderFontColor').css("background-color", "#eeeeee");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();
                                    
                                    addWidgetConditionsArray["title"] = true;
                                    $("label[for=inputTitleWidget]").css("color", "black");
                                    checkAddWidgetConditions();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    
                                    //Nuova riga
                                    //Default tab
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="inputDefaultTab" class="col-md-2 control-label">Default tab</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="inputDefaultTab" name="inputDefaultTab"></select>');
                                    newSelect.append('<option value="0">General</option>');
                                    newSelect.append('<option value="1">Meteo</option>');
                                    newSelect.append('<option value="-1">None (automatic switch)</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();
                                    
                                    //Meteo tab font size
                                    newLabel = $('<label for="meteoTabFontSize" class="col-md-2 control-label">Meteo tab font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="meteoTabFontSize" name="meteoTabFontSize"></input>');
                                    newInput.val("10");
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //Nuova riga
                                    //General tab font size
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="genTabFontSize" class="col-md-2 control-label">General tab font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="genTabFontSize" name="genTabFontSize"></input>');
                                    newInput.val("12");
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newInput.show();
                                    
                                    //General tab font color
                                    newLabel = $('<label for="genTabFontColor" class="col-md-2 control-label">General tab font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="genTabFontColorContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="genTabFontColor" name="genTabFontColor" required><span class="input-group-addon"><i id="widgetGenTabFontColor"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    $('#genTabFontColorContainer').show();
                                    $('#genTabFontColor').show();
                                    $("#genTabFontColor").css('display', 'block');
                                    $("#widgetGenTabFontColor").parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $("#genTabFontColor").prop("required", true);
                                    $("#genTabFontColor").attr("disabled", false);
                                    
                                    $('#inputComuneWidget').attr('disabled', true);
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetButton":
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Button text");
                                    $("#bckColorLabel").html("Button color");
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').val(14);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', true);
                                    $('#inputFrameColorWidget').attr('disabled', true);
                                    $('#inputFrameColorWidget').val('');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', true);
                                    $('#inputFreqWidget').val('');
                                    $('#inputFreqWidget').prop('required', false);
                                    $('#inputHeaderFontColorWidget').attr('disabled', true);
                                    $('#inputHeaderFontColorWidget').prop('required', false);
                                    $('#inputHeaderFontColorWidget').val("");
                                    $('#widgetHeaderFontColor').css("background-color", "#eeeeee");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();
                                    $('#inputComuneWidget').attr('disabled', true);

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    
                                    //Nuova riga
                                    //Border radius and button image yes/no
                                    newFormRow = $('<div class="row"></div>');
                                    newLabel = $('<label for="addWidgetBtnRadius" class="col-md-2 control-label">Border radius</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    var newControl = $('<input id="addWidgetBtnRadius" name="addWidgetBtnRadius" data-slider-id="addWidgetBtnRadiusSlider" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="0"/>');
                                    newInnerDiv.append(newControl);
                                    newInnerDiv.find('#addWidgetBtnRadius').bootstrapSlider({
                                       formatter: function(value) {
                                          return value + "%";
                                       }
                                    });
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    newLabel = $('<label for="addWidgetBtnImgSelect" class="col-md-2 control-label">Button image</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select id="addWidgetBtnImgSelect" name="addWidgetBtnImgSelect" class="form-control"></select>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val("no");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    //Nuova riga
                                    //Button image file chooser
                                    newFormRow = $('<div class="row"></div>');
                                    newFormRow.hide();
                                    newLabel = $('<label for="addWidgetBtnFile" class="col-md-2 control-label">Image file</label>');
                                    newInnerDiv = $('<div class="col-md-8"></div>');
                                    var btnImgMaxSize = $('<input type="hidden" name="MAX_FILE_SIZE" value="1000000" />');
                                    newInnerDiv.append(btnImgMaxSize);
                                    var newControl = $('<div class="input-group"><label class="input-group-btn"><span class="btn btn-primary">Browse<input id="addWidgetBtnFile" name="addWidgetBtnFile" type="file" style="display: none;" accept="image/*"></span></label><input id="addWidgetBtnFilename" type="text" class="form-control" readonly=""></div>');
                                    
                                    newInnerDiv.append(newControl);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newControl.find("input[type=file]").change(function() 
                                    {
                                        var filename = $(this).val().replace(/\\/g, '/').replace(/.*\//, '');
                                        $("#addWidgetBtnFilename").val(filename);
                                    });
                                    
                                    //Nuova riga
                                    //Button image width and height
                                    newFormRow = $('<div class="row"></div>');
                                    newFormRow.hide();
                                    newLabel = $('<label for="addWidgetBtnImgWidth" class="col-md-2 control-label">Image width</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    var newControl = $('<input id="addWidgetBtnImgWidth" name="addWidgetBtnImgWidth" data-slider-id="addWidgetBtnImgWidthSlider" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="100"/>');
                                    newInnerDiv.append(newControl);
                                    newInnerDiv.find('#addWidgetBtnImgWidth').bootstrapSlider({
                                       formatter: function(value) {
                                          return value + "%";
                                       }
                                    });
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newLabel = $('<label for="addWidgetBtnImgHeight" class="col-md-2 control-label">Image height</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    var newControl = $('<input id="addWidgetBtnImgHeight" name="addWidgetBtnImgHeight" data-slider-id="addWidgetBtnImgHeightSlider" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="100"/>');
                                    newInnerDiv.append(newControl);
                                    newInnerDiv.find('#addWidgetBtnImgHeight').bootstrapSlider({
                                       formatter: function(value) {
                                          return value + "%";
                                       }
                                    });
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    $("#addWidgetBtnImgSelect").off();
                                    $("#addWidgetBtnImgSelect").change(function(){
                                       if($(this).val() === 'yes')
                                       {
                                          $("#specificWidgetPropertiesDiv div.row").eq(1).show();
                                          $("#specificWidgetPropertiesDiv div.row").eq(2).show();
                                       }
                                       else
                                       {
                                          $("#specificWidgetPropertiesDiv div.row").eq(1).hide();
                                          $("#specificWidgetPropertiesDiv div.row").eq(2).hide();
                                       }
                                    });
                                    
                                    //Nuova riga
                                    //Target widgets per cambio metrica
                                    newFormRow = $('<div class="row"></div>');
                                    newLabel = $('<label for="addWidgetChangeMetricWidgets" class="col-md-2 control-label">Available widgets for metric change</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select name="addWidgetChangeMetricWidgets" class="form-control" id="addWidgetChangeMetricWidgets"></select>');

                                    var widgetId, widgetTitle = null;
                                    var widgetsNumber = 0;
                                    var targetsJson = {
                                        changeMetricTargetsJson: {},
                                        geoTargetsJson: []
                                    };
                                    
                                    $("#parameters").val(JSON.stringify(targetsJson));

                                    $("li.gs_w").each(function(){
                                       if((!$(this).attr("id").includes("Alarms"))&&(!$(this).attr("id").includes("Button"))&&(!$(this).attr("id").includes("Clock"))&&(!$(this).attr("id").includes("EvacuationPlans"))&&(!$(this).attr("id").includes("Events"))&&(!$(this).attr("id").includes("ExternalContent"))&&(!$(this).attr("id").includes("FirstAid"))&&(!$(this).attr("id").includes("GenericContent"))&&(!$(this).attr("id").includes("MapBusPosition"))&&(!$(this).attr("id").includes("NetworkAnalysis"))&&(!$(this).attr("id").includes("PrevMeteo"))&&(!$(this).attr("id").includes("Process"))&&(!$(this).attr("id").includes("ProtezioneCivile"))&&(!$(this).attr("id").includes("Resources"))&&(!$(this).attr("id").includes("Sce"))&&(!$(this).attr("id").includes("Separator"))&&(!$(this).attr("id").includes("ServiceMap"))&&(!$(this).attr("id").includes("SmartDS"))&&(!$(this).attr("id").includes("StateRideAtaf"))&&(!$(this).attr("id").includes("TrafficEvents"))&&(!$(this).attr("id").includes("TrendMentions"))&&(!$(this).attr("id").includes("Twitter")))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          targetsJson.changeMetricTargetsJson[widgetId] = "noMetricChange";
                                          widgetsNumber++;
                                       }
                                    });
                                    
                                    newSelect.val(-1);

                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append('<span id="addWidgetChangeMetricWidgetsNoneMsg">None</span>');
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    newLabel = $('<label for="addWidgetChangeMetricMetrics" class="col-md-2 control-label">Available metrics for selected widget</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select name="addWidgetChangeMetricMetrics" class="form-control" id="addWidgetChangeMetricMetrics"></select>');
                                    newInnerDiv.append(newSelect);
                                    newInnerDiv.append('<span id="addWidgetChangeMetricMetricsNoneMsg">None</span>');
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    $("#addWidgetChangeMetricMetricsNoneMsg").hide();
                                    $("#addWidgetChangeMetricMetrics").hide();
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       $("#addWidgetChangeMetricWidgets").change(function(){
                                           if($(this).val() !== -1)
                                           {
                                               //Repere delle metriche applicabili a quel widget
                                               $.ajax({
                                                    url: "process-form.php",
                                                    type: "GET",
                                                    data: {
                                                        getMetricsForWidgetType: true,
                                                        widgetId: $("#addWidgetChangeMetricWidgets").val()
                                                    },
                                                    async: true,
                                                    //dataType: 'json',
                                                    success: function(metricsList) 
                                                    {
                                                        metricsList = JSON.parse(metricsList);
                                                        $("#addWidgetChangeMetricMetrics").empty();
                                                        
                                                        if(metricsList.length === 0)
                                                        {
                                                            $("#addWidgetChangeMetricMetrics").hide();
                                                            $("#addWidgetChangeMetricMetricsNoneMsg").show();
                                                        }
                                                        else
                                                        {
                                                            $("#addWidgetChangeMetricMetrics").append('<option value="noMetricChange">No metric change</option>');
                                                            for(var i = 0; i < metricsList.length; i++)
                                                            {
                                                                $("#addWidgetChangeMetricMetrics").append('<option value="' + metricsList[i] + '">' + metricsList[i] + '</option>');
                                                            }
                                                            
                                                            $("#addWidgetChangeMetricMetrics").val(targetsJson.changeMetricTargetsJson[$("#addWidgetChangeMetricWidgets").val()]);
                                                            $("#addWidgetChangeMetricMetricsNoneMsg").hide();
                                                            $("#addWidgetChangeMetricMetrics").show();
                                                        }
                                                    },
                                                    error: function(errorData)
                                                    {
                                                       $("#addWidgetChangeMetricMetrics").hide(); 
                                                       $("#addWidgetChangeMetricMetricsNoneMsg").show();
                                                       console.log("Errore in caricamento metriche caricabili per widget target");
                                                       console.log(JSON.stringify(errorData));
                                                    }
                                                });
                                           }
                                           else
                                           {
                                               $("#addWidgetChangeMetricMetrics").hide();
                                               $("#addWidgetChangeMetricMetricsNoneMsg").show();
                                           }
                                       }); 
                                       
                                       $("#addWidgetChangeMetricMetrics").change(function(){
                                           targetsJson.changeMetricTargetsJson[$("#addWidgetChangeMetricWidgets").val()] = $(this).val();
                                           $("#parameters").val(JSON.stringify(targetsJson));
                                       });
                                    }
                                    else
                                    {
                                        $("#addWidgetChangeMetricMetrics").hide();
                                        $("#addWidgetChangeMetricMetricsNoneMsg").show();
                                    }
                                    
                                    //Nuova riga
                                    //Show/hide text + target widgets per geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    
                                    newLabel = $('<label for="addWidgetShowButtonText" class="col-md-2 control-label">Show button text</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select name="addWidgetShowButtonText" class="form-control" id="addWidgetShowButtonText"></select>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    newLabel = $('<label for="addWidgetGeolocationWidgets" class="col-md-2 control-label">Available widgets to show link content</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select name="addWidgetGeolocationWidgets" class="form-control" id="addWidgetGeolocationWidgets" multiple></select>');

                                    var widgetId, widgetTitle = null;
                                    widgetsNumber = 0;

                                    $("li.gs_w").each(function(){
                                       if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") !== "gisTarget")&&($(this).find("div.widget").attr("data-role") !== "map"))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          widgetsNumber++;
                                       }
                                    });

                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append("None");
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       $('#addWidgetGeolocationWidgets').selectpicker({
                                          actionsBox: true, 
                                          width: "auto"
                                       });
                                       
                                       $('#addWidgetGeolocationWidgets').on('changed.bs.select', function (e) 
                                       {
                                          if($(this).val() === null)
                                          {
                                             targetsJson.geoTargetsJson = [];
                                          }
                                          else
                                          {
                                             targetsJson.geoTargetsJson = $(this).val();
                                          }
                                          $("#parameters").val(JSON.stringify(targetsJson));
                                       });
                                    }
                                    break;

                                case "widgetSingleContent":
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("24");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", true);
                                    $('#inputUdmWidget').attr("disabled", false);
                                    $('#inputUdmPosition').prop("required", true);
                                    $('#inputUdmPosition').attr("disabled", false);
                                    $('#inputUdmWidget').val("");
                                    $("#inputUdmPosition").val("next");
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Aggiunta campo per registrare il widget presso il notificatore
                                    addWidgetNotificatorAndThresholdFields();
                                    break;

                                case "widgetGenericContent":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetBarContent":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("16");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Aggiunta campo per registrare il widget presso il notificatore
                                    addWidgetNotificatorAndThresholdFields();
                                    break;

                                case "widgetColumnContent":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("20");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Aggiunta campo per registrare il widget presso il notificatore
                                    addWidgetNotificatorAndThresholdFields();
                                    break;

                                case "widgetGaugeChart":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontSize').prop('required', false);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Aggiunta campo per registrare il widget presso il notificatore
                                    addWidgetNotificatorAndThresholdFields();
                                    break;

                                case "widgetPieChart":
                                    var metricId = $('#select-metric').val();
                                    var metricData = getMetricData(metricId);
                                    var series, seriesString, table1Shown, table2Shown, valuePerc, newHiddenColors, colorsTable1, colorsTable2, colorsArray1, colorsArray2, descriptions, defaultColorsArray, newColorsTableContainer, newColorsTable1Container, newColorsTable2Container, newRow, newCell, valuesNum, newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer, thrSimpleTables, thrTables1, thrTables2, currentParams, i, k, currentFieldIndex, currentSeriesIndex = null;
                                    
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontSize').prop('required', false);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#EEEEEE");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    if(metricType.indexOf('Percentuale') >= 0)
                                    {
                                        showInfoWCkeditors($('#select-widget').val(), editorsArray, null);
                                    }
                                    else
                                    {
                                        seriesString = metricData.data[0].commit.author.series;
                                        series = jQuery.parseJSON(seriesString);
                                        showInfoWCkeditors($('#select-widget').val(), editorsArray, series);
                                    }
                                
                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Legend font size e font color
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="legendFontSize" class="col-md-2 control-label">Legend font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="legendFontSize" name="legendFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    newLabel = $('<label for="legendFontColor" class="col-md-2 control-label">Legend font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<div id="legendFontColorPickerContainer" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColorPicker" name="legendFontColorPicker" required><span class="input-group-addon"><i id="widgetLegendFontColorPicker"></i></span></div>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#widgetLegendFontColorPicker").css('display', 'block');
                                    $("#widgetLegendFontColorPicker").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    
                                    //Nuova riga
                                    //Datalabels distance (se Percentuale) oppure Datalabels (se Series)
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    if(metricType.indexOf('Percentuale') >= 0)
                                    {
                                        newLabel = $('<label for="dataLabelsDistance" class="col-md-2 control-label">Data labels distance</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsDistance" name="dataLabelsDistance" value="15" required>');
                                        newInnerDiv.append(newInput);
                                    }
                                    else if(metricType === 'Series')
                                    {
                                        newLabel = $('<label for="dataLabels" class="col-md-2 control-label">Data labels for <i>' + series.firstAxis.desc + '</i></label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="dataLabels" name="dataLabels"></select>');
                                        newSelect.append('<option value="no">No data labels</option>');
                                        newSelect.append('<option value="value">Value only</option>');
                                        newSelect.append('<option value="full">Field name and value</option>');
                                        newSelect.val("value");
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                    }
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Data labels font size
                                    newLabel = $('<label for="dataLabelsFontSize" class="col-md-2 control-label">Data labels font size</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="dataLabelsFontSize" name="dataLabelsFontSize" value="10" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Data labels distances per widget series
                                    if(metricType === 'Series')
                                    {
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificWidgetPropertiesDiv").append(newFormRow);
                                        //Data labels distance per anello più interno
                                        newLabel = $('<label for="dataLabelsDistance1" class="col-md-2 control-label">Data labels distance for <i>' + series.secondAxis.desc + '</i></label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsDistance1" name="dataLabelsDistance1" value="-30" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Data labels distance per anello più esterno
                                        newLabel = $('<label for="dataLabelsDistance2" class="col-md-2 control-label">Data labels distance for <i>' + series.firstAxis.desc + '</i></label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsDistance2" name="dataLabelsDistance2" value="-30" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                    }
                                    
                                    //Nuova riga
                                    //Data labels font color
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="dataLabelsFontColor" class="col-md-2 control-label">Data labels font color</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInputGroup = $('<div class="input-group color-choice">');
                                    newInput = $('<input type="text" class="form-control" id="dataLabelsFontColor" name="dataLabelsFontColor" value="#000000" required>');
                                    newSpan = $('<span class="input-group-addon"><i id="widgetDataLabelsFontColor"></i></span>');
                                    newInputGroup.append(newInput);
                                    newInputGroup.append(newSpan);
                                    newInnerDiv.append(newInputGroup);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newInnerDiv.colorpicker({color: '#000000', format: "rgba"});
                                    
                                    //Inner radius 1
                                    if(metricType.indexOf('Percentuale') >= 0)
                                    {
                                        newLabel = $('<label for="innerRadius1" class="col-md-2 control-label">Inner radius (%)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="innerRadius1" name="innerRadius1" value="0" required>');
                                    }
                                    else if(metricType === 'Series')
                                    {
                                        newLabel = $('<label for="innerRadius1" class="col-md-2 control-label">Inner radius for <i>' + series.secondAxis.desc + '</i> (%)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="innerRadius1" name="innerRadius1" value="15" required>');
                                    }
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Questi raggi sono solo per la versione series
                                    if(metricType === 'Series')
                                    {
                                       //Outer radius 1
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificWidgetPropertiesDiv").append(newFormRow);
                                        newLabel = $('<label for="outerRadius1" class="col-md-2 control-label">Outer radius for <i>' + series.secondAxis.desc + '</i> (%)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="outerRadius1" name="outerRadius1" value="50" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        //Inner radius 2
                                        newLabel = $('<label for="innerRadius2" class="col-md-2 control-label">Inner radius for <i>' + series.firstAxis.desc + '</i> (%)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="innerRadius2" name="innerRadius2" value="50" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv); 
                                    }
                                    
                                    //Nuova riga
                                    //Start angle
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="startAngle" class="col-md-2 control-label">Start angle (°)</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="startAngle" name="startAngle" value="0" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //End angle
                                    newLabel = $('<label for="endAngle" class="col-md-2 control-label">End angle (°)</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="endAngle" name="endAngle" value="360" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    //Center Y
                                    newLabel = $('<label for="centerY" class="col-md-2 control-label">Diagram center Y(%)</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="centerY" name="centerY" value="50" required>');
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Select per colori automatici/manuali
                                    if(metricType.indexOf('Percentuale') >= 0)
                                    {
                                        newLabel = $('<label for="colorsSelect1" class="col-md-2 control-label">Slices colors</label>');
                                    }
                                    else if(metricType === 'Series')
                                    {
                                        newLabel = $('<label for="colorsSelect1" class="col-md-2 control-label">Slices colors for <i>' + series.secondAxis.desc + '</i></label>');
                                    }
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="colorsSelect1" name="colorsSelect1"></select>');
                                    newSelect.append('<option value="auto">Automatic</option>');
                                    newSelect.append('<option value="manual">Manual</option>');
                                    newSelect.val("auto");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Campi hidden per i colori
                                    newHiddenColors = $('<input type="hidden" id="colors1" name="colors1">');
                                    $("#specificWidgetPropertiesDiv").append(newHiddenColors);
                                    newHiddenColors = $('<input type="hidden" id="colors2" name="colors2">');
                                    $("#specificWidgetPropertiesDiv").append(newHiddenColors);

                                    //Div contenitore per la tabella dei colori
                                    newColorsTableContainer = $('<div id="colorsTableContainer" class="row rowCenterContent" style="width: 100%; margin-left: 0px"></div>');
                                    newColorsTable1Container = $('<div id="colorsTable1Container" style="width: 100%; float: left"></div>');
                                    newColorsTable2Container = $('<div id="colorsTable2Container" style="width: 100%; float: left"></div>');
                                    newColorsTableContainer.append(newColorsTable1Container);
                                    
                                    function updateWidgetPieChartColors1(e, params)
                                    {
                                        var newColor = $(this).colorpicker('getValue');
                                        var index = parseInt($(this).parents('tr').index() - 1);
                                        colorsArray1[index] = newColor;
                                        $("#colors1").val(JSON.stringify(colorsArray1));
                                    }
                                    
                                    function updateWidgetPieChartColors2(e, params)
                                    {
                                        var newColor = $(this).colorpicker('getValue');
                                        var index = parseInt($(this).parents('tr').index() - 1);
                                        colorsArray2[index] = newColor;
                                        $("#colors2").val(JSON.stringify(colorsArray2));
                                    }
                                    
                                    defaultColorsArray = ['#ffcc00', '#33ccff', '#00ff00', '#ff99ff', '#cc6600', '#0066ff', '#ff3300', '#cc9900', '#9900cc', '#003300'];
                                    colorsArray1 = [];
                                    colorsArray2 = [];
                                    
                                    //Aggiunta al form dei campi per parametri specifici
                                    if(metricType.indexOf('Percentuale') >= 0)
                                    {
                                        //Form per dati tradizionali percentuali
                                        colorsTable1 = $("<table id='colorsTable1' class='table table-bordered table-condensed thrRangeTable' style='float:left'><tr><td>Field</td><td>Color</td></tr></table>");
                                        
                                        valuePerc = [];
                                        descriptions = [];
                                        valuePerc[0] = metricData.data[0].commit.author.value_perc1;
                                        valuePerc[1] = metricData.data[0].commit.author.value_perc2;
                                        valuePerc[2] = metricData.data[0].commit.author.value_perc3;
                                        
                                        //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                        if((valuePerc[0] !== null) && (valuePerc[1] !== null) && (valuePerc[2] !== null))
                                        {
                                            valuesNum = 3;
                                            descriptions[0] = metricData.data[0].commit.author.field1Desc;
                                            descriptions[1] = metricData.data[0].commit.author.field2Desc;
                                            descriptions[2] = metricData.data[0].commit.author.field3Desc;
                                        }
                                        else if((valuePerc[0] !== null) && (valuePerc[1] !== null) && (valuePerc[2] === null))
                                        {
                                            valuesNum = 2;
                                            descriptions[0] = metricData.data[0].commit.author.field1Desc;
                                            descriptions[1] = metricData.data[0].commit.author.field2Desc;
                                        }
                                        else if((valuePerc[0] !== null) && (valuePerc[1] === null) && (valuePerc[2] === null))
                                        {
                                            valuesNum = 1;
                                            descriptions[0] = metricData.data[0].commit.author.field1Desc;
                                        }
                                        
                                        //Costruzione tabella dei colori iniziale
                                        for(var i = 0; i < valuesNum; i++)
                                        {
                                            colorsArray1[i] = defaultColorsArray[i];
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>' + descriptions[i] + '</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            newRow.find('div.colorPicker').colorpicker({color: colorsArray1[i], format: "rgba"});
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors1);
                                            colorsTable1.append(newRow);
                                        }
                                        
                                        if(valuesNum === 1)
                                        {
                                            colorsArray1[1] = defaultColorsArray[1];
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>Complementary</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            newRow.find('div.colorPicker').colorpicker({color: colorsArray1[1], format: "rgba"});
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors1);
                                            colorsTable1.append(newRow);
                                        }
                                        
                                        $("#colors1").val(JSON.stringify(colorsArray1));    
                                        newColorsTable1Container.append(colorsTable1);
                                        colorsTable1.hide();
                                        newColorsTable1Container.hide();
                                        newColorsTableContainer.hide();
                                    }
                                    else if(metricType === 'Series')
                                    {
                                        //Nuova riga
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificWidgetPropertiesDiv").append(newFormRow);
                                        newLabel = $('<label for="colorsSelect2" class="col-md-2 control-label">Slices colors for <i>' + series.firstAxis.desc + '</i></label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="colorsSelect2" name="colorsSelect2"></select>');
                                        newSelect.append('<option value="auto">Automatic</option>');
                                        newSelect.append('<option value="manual">Manual</option>');
                                        newSelect.val("auto");
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newColorsTableContainer.append(newColorsTable2Container);
                                        
                                        //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                        colorsTable1 = $("<table id='colorsTable1' class='table table-bordered table-condensed thrRangeTable' style='width: 100%;'><tr><td>Fields of set <b>" + series.secondAxis.desc + "</b></td><td>Color</td></tr></table>");
                                        for(var i = 0; i < series.secondAxis.labels.length; i++)
                                        {
                                            colorsArray1[i] = defaultColorsArray[i];
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            newRow.find('div.colorPicker').colorpicker({color: colorsArray1[i], format: "rgba"});
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors1);
                                            colorsTable1.append(newRow);
                                        }
                                        
                                        //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                        colorsTable2 = $("<table id='colorsTable2' class='table table-bordered table-condensed thrRangeTable' style='width: 100%;'><tr><td>Fields of set <b>" + series.firstAxis.desc + "</b></td><td>Color</td></tr></table>");
                                        for(var i = 0; i < series.firstAxis.labels.length; i++)
                                        {
                                            colorsArray2[i] = defaultColorsArray[i];
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>' + series.firstAxis.labels[i] + '</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            newRow.find('div.colorPicker').colorpicker({color: colorsArray2[i], format: "rgba"});
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors2);
                                            colorsTable2.append(newRow);
                                        }
                                        
                                        $("#colors1").val(JSON.stringify(colorsArray1));    
                                        newColorsTable1Container.append(colorsTable1);
                                        $("#colors2").val(JSON.stringify(colorsArray2));    
                                        newColorsTable2Container.append(colorsTable2);
                                        colorsTable1.hide();
                                        colorsTable2.hide();
                                        newColorsTable1Container.hide();
                                        newColorsTable2Container.hide();
                                        newColorsTableContainer.hide();
                                    }
                                    
                                    $("#specificWidgetPropertiesDiv").append(newColorsTableContainer);
                                    
                                    table1Shown = false;
                                    table2Shown = false;

                                    $('#colorsSelect1').change(function () 
                                    {
                                        if($('#colorsSelect1').val() === "manual")
                                        {
                                            $('#colorsTableContainer').css("display", "block");
                                            $('#colorsTable1Container').css("display", "block");
                                            colorsTable1.css("display", "");//CRASH
                                            table1Shown = true;
                                        }
                                        else
                                        {
                                            colorsTable1.css("display", "none");
                                            $('#colorsTable1Container').css("display", "none");
                                            table1Shown = false;
                                            if(table2Shown === false)
                                            {
                                                $('#colorsTableContainer').css("display", "none");
                                            }
                                        }
                                    });
                                    
                                    if(metricType === 'Series')
                                    {
                                        $('#colorsSelect2').change(function () 
                                        {
                                            if($('#colorsSelect2').val() === "manual")
                                            {
                                                $('#colorsTableContainer').css("display", "block");
                                                $('#colorsTable2Container').css("display", "block");
                                                colorsTable2.css("display", "");
                                                table2Shown = true;
                                            }
                                            else
                                            {
                                                colorsTable2.css("display", "none");
                                                $('#colorsTable2Container').css("display", "none");
                                                table2Shown = false;
                                                if(table1Shown === false)
                                                {
                                                    $('#colorsTableContainer').css("display", "none");
                                                }
                                            }
                                        });
                                    }
                                    
                                    //Codice costruzione soglie
                                    if(metricType.indexOf('Percentuale') >= 0)
                                    {
                                        //Tabelle editabili delle soglie
                                        thrSimpleTables = new Array();
        
                                        setSimpleGlobals(null, thrSimpleTables, valuePerc, descriptions);
                                        
                                        //Costruzione THRTables vuote
                                        buildEmptySimpleThrTables();
        
                                        //Nuova riga
                                        //Set thresholds
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificWidgetPropertiesDiv").append(newFormRow);
                                        newLabel = $('<label for="alrThrSel" class="col-md-2 control-label">Set thresholds</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrThrSel" name="alrThrSel" required>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newSelect.val("no");
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                        $('#alrThrSel').change(alrThrSelListenerSimple);
                                        
                                        //Threshold field select
                                        newLabel = $('<label for="alrFieldSel" class="col-md-2 control-label">Thresholds target field</label>');
                                        newSelect = $('<select class="form-control" id="alrFieldSel" name="alrFieldSel">');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Contenitore per tabella delle soglie
                                        addWidgetRangeTableContainer = $('<div id="addWidgetRangeTableContainer" class="row rowCenterContent"></div>');
                                        $("#specificWidgetPropertiesDiv").append(addWidgetRangeTableContainer);
                                        addWidgetRangeTableContainer.hide();
                                    }
                                    else if(metricType === 'Series')
                                    {
                                        //Tabelle editabilidelle soglie
                                        thrTables1 = new Array();
                                        thrTables2 = new Array();

                                        //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                        setGlobals(null, thrTables1, thrTables2, series, $('#select-widget').val());

                                        //Costruzione THRTables vuote
                                        buildEmptyThrTables();
                                        //Nuova riga
                                        //Set thresholds
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificWidgetPropertiesDiv").append(newFormRow);
                                        newLabel = $('<label for="alrThrSel" class="col-md-2 control-label">Set thresholds</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrThrSel" name="alrThrSel" required>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newSelect.val("no");
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                        $('#alrThrSel').change(alrThrSelListener);

                                        //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                        newLabel = $('<label for="alrAxisSel" class="col-md-2 control-label">Thresholds target set</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrAxisSel" name="alrAxisSel"></select>');
                                        newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        newSelect.val(-1);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();

                                        //Nuova riga
                                        //Threshold field select
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificWidgetPropertiesDiv").append(newFormRow);
                                        newLabel = $('<label for="alrFieldSel" class="col-md-2 control-label">Thresholds target field</label>');
                                        newSelect = $('<select class="form-control" id="alrFieldSel" name="alrFieldSel">');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Contenitore per tabella delle soglie
                                        addWidgetRangeTableContainer = $('<div id="addWidgetRangeTableContainer" class="row rowCenterContent"></div>');
                                        $("#specificWidgetPropertiesDiv").append(addWidgetRangeTableContainer);
                                        addWidgetRangeTableContainer.hide();
                                    }
                                    break;

                                case "widgetSce":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontSize').prop('required', false);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetSmartDS":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("16");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontColor').val("#000000");
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetTimeTrend":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("11");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontColor').val("#666666");
                                    $('#widgetFontColor').css("background-color", "#666666");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', false);
                                    $('#select-IntTemp-Widget').prop('required', true);
                                    $('#select-IntTemp-Widget').val("4 Ore");
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Aggiunta campo per registrare il widget presso il notificatore
                                    addWidgetNotificatorAndThresholdFields();
                                    break;

                                case "widgetTimeTrendCompare":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("11");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontColor').val("#666666");
                                    $('#widgetFontColor').css("background-color", "#666666");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', true);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', false);
                                    $('#select-IntTemp-Widget').prop('required', true);
                                    $('#select-IntTemp-Widget').val("4 Ore");
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Aggiunta campo per registrare il widget presso il notificatore
                                    addWidgetNotificatorAndThresholdFields();
                                    break;

                                case "widgetEvents":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("12");
                                    $('#inputFontSize').attr('disabled', false);
                                    $('#inputFontSize').prop('required', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Visualizzazione campi specifici per questo widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                    //Nuova riga
                                    //Widget mode
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="widgetEventsMode" class="col-md-2 control-label">Widget mode</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="widgetEventsMode" name="widgetEventsMode"></select>');
                                    newSelect.append('<option value="list">List</option>');
                                    newSelect.append('<option value="searchAndList">Search filter, results on list</option>');
                                    newSelect.append('<option value="searchAndMap">Search filter, results on map</option>');
                                    newSelect.append('<option value="searchAndListAndMap">Search filter, results on list and map</option>');
                                    newFormRow.append(newLabel);
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Target widgets geolocation
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newLabel = $('<label for="addWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="addWidgetGeolocationWidgets" name="addWidgetGeolocationWidgets"></select>');
                                    
                                    var widgetId, widgetTitle = null;
                                    var widgetsNumber = 0;
                                    //JSON degli eventi da mostrare su ogni widget target di questo widget events: privo di eventi all'inizio
                                    var targetEventsJson = {};
                                    
                                    $("li.gs_w").each(function(){
                                       if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                       {
                                          widgetId = $(this).attr("id");
                                          widgetTitle = $(this).find("div.titleDiv").html();
                                          newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                          targetEventsJson[widgetId] = new Array(); 
                                          widgetsNumber++;
                                       }
                                    });
                                    
                                    $("#parameters").val(JSON.stringify(targetEventsJson));
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newInnerDiv.append(newSelect);
                                    }
                                    else
                                    {
                                       newInnerDiv.append("None");
                                    }
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    
                                    if(widgetsNumber > 0)
                                    {
                                       newSelect.show();
                                       newSelect.val(-1);
                                       newLabel = $('<label for="addWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       var eventTypeSelect = $('<select name="addWidgetEventTypes" class="form-control" id="addWidgetEventTypes" multiple></select>');
                                       eventTypeSelect.append('<option value="Altri eventi">Altri eventi</option>');
                                       eventTypeSelect.append('<option value="Aperture straordinarie, visite guidate">Aperture straordinarie, visite guidate</option>');
                                       eventTypeSelect.append('<option value="Estate Fiorentina">Estate Fiorentina</option>');
                                       eventTypeSelect.append('<option value="Fiere, mercati">Fiere, mercati</option>');
                                       eventTypeSelect.append('<option value="Film festival">Film festival</option>');
                                       eventTypeSelect.append('<option value="Mostre">Mostre</option>');
                                       eventTypeSelect.append('<option value="Musica classica, opera e balletto">Musica classica, opera e balletto</option>');
                                       eventTypeSelect.append('<option value="Musica rock, jazz, pop, contemporanea">Musica rock, jazz, pop, contemporanea</option>');
                                       eventTypeSelect.append('<option value="News">News</option>');
                                       eventTypeSelect.append('<option value="Readings, Conferenze, Convegni">Readings, Conferenze, Convegni</option>');
                                       eventTypeSelect.append('<option value="Readings, incontri letterari, conferenze">Readings, incontri letterari, conferenze</option>');
                                       eventTypeSelect.append('<option value="Sport">Sport</option>');
                                       eventTypeSelect.append('<option value="Teatro">Teatro</option>');
                                       eventTypeSelect.append('<option value="Tradizioni popolari">Tradizioni popolari</option>');
                                       eventTypeSelect.append('<option value="Walking">Walking</option>');
                                       eventTypeSelect.val(-1);
                                       newFormRow.append(newLabel);
                                       newInnerDiv.append(eventTypeSelect);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.hide();
                                       newInnerDiv.hide();
                                       
                                       $('#addWidgetEventTypes').selectpicker({
                                          actionsBox: true, 
                                          width: "auto"
                                       });
                                       
                                       $('#addWidgetEventTypes').on('changed.bs.select', function (e) 
                                       {
                                          if($(this).val() === null)
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = [];
                                          }
                                          else
                                          {
                                             targetEventsJson[$("#addWidgetGeolocationWidgets").val()] = $(this).val();
                                          }
                                          $("#parameters").val(JSON.stringify(targetEventsJson));
                                       });
                                       
                                       $("#addWidgetGeolocationWidgets").change(function(){
                                          newLabel.show();
                                          newInnerDiv.show();
                                          $('#addWidgetEventTypes').selectpicker('val', targetEventsJson[$("#addWidgetGeolocationWidgets").val()]);
                                       });
                                    }
                                    break;

                                case "widgetTrendMentions":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    
                                    //Nuova riga
                                    //Default tab
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="inputDefaultTab" class="col-md-2 control-label">Default tab</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="inputDefaultTab" name="inputDefaultTab"></select>');
                                    newSelect.append('<option value="0">Trends</option>');
                                    newSelect.append('<option value="1">Quotes</option>');
                                    newSelect.append('<option value="-1">None (automatic switch)</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetPrevMeteo":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $("#inputComuneRow").show();
                                    $('#inputComuneWidget').val("");
                                    $('#inputComuneWidget').attr("placeholder", "Type city name's first letters");
                                    $("label[for='inputComuneWidget']").show();
                                    $("label[for='inputComuneWidget']").text("City (autosuggestion)");
                                    $('#inputComuneWidget').show();
                                    $('#inputComuneWidget').attr('disabled', false);
                                    $('#inputComuneWidget').attr('autocomplete', 'on');
                                    $('#inputComuneWidget').prop('required', true);
                                    
                                    $('#inputComuneWidget').autocomplete({
                                        source: comuniLammaArray,
                                        autoFocus: false,
                                        minLength: 1,
                                        delay: 500,
                                    }).data("ui-autocomplete")._resizeMenu = function(){
                                        var ul = this.menu.element;
                                        ul.outerWidth(this.element.outerWidth() + 30);
                                        ul.css("max-height", "300px");
                                        ul.css("overflow-x", "auto");
                                    };
                                    $('#inputUrlWidget').attr('disabled', false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("#000000");
                                    $('#inputFontColor').attr('disabled', false);
                                    $('#inputFontColor').prop('required', true);
                                    $('#widgetFontColor').css("background-color", "#000000");
                                    $("#widgetFontColor").parent().parent().parent().colorpicker({color: "#000000", format: "rgba"});
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();
                                    
                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");

                                    //Nuova riga
                                    //Orientation
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="orientation" class="col-md-2 control-label">Widget mode</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="orientation" name="orientation"></select>');
                                    newSelect.append('<option value="horizontal">Horizontal</option>');
                                    newSelect.append('<option value="vertical">Vertical</option>');
                                    newSelect.append('<option value="verticalCompact">VerticalCompact</option>');
                                    newSelect.append('<option value="today">Today only</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Language
                                    newLabel = $('<label for="language" class="col-md-2 control-label">Language</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="language" name="language"></select>');
                                    newSelect.append('<option value="english">English</option>');
                                    newSelect.append('<option value="italian">Italian</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Space occupation
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="todayDim" class="col-md-2 control-label">Today box dimension</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    var newControl = $('<input id="todayDim" name="todayDim" data-slider-id="todayDimSlider" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="60"/>');
                                    newInnerDiv.append(newControl);
                                    newInnerDiv.find('#todayDim').bootstrapSlider({
                                       formatter: function(value) {
                                          return value + "%";
                                       }
                                    });
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Background option
                                    newLabel = $('<label for="backgroundMode" class="col-md-2 control-label">Background mode</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="backgroundMode" name="backgroundMode"></select>');
                                    newSelect.append('<option value="color">Color</option>');
                                    newSelect.append('<option value="auto">Automatic picture</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Icon type
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="iconSet" class="col-md-2 control-label">Weather symbols</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="iconSet" name="iconSet"></select>');
                                    newSelect.append('<option value="multiColor">Images</option>');
                                    newSelect.append('<option value="singleColor">Icons</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    break;

                                case "widgetServiceMap":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    /*$("#inputComuneRow").css("display", "");
                                    $('#inputComuneWidget').val("");
                                    $("label[for='inputComuneWidget']").css("display", "");
                                    $("label[for='inputComuneWidget']").text("Context");
                                    $('#inputComuneWidget').css("display", "");
                                    $('#inputComuneWidget').attr('disabled', false);*/
                                    $('#inputUrlWidget').attr('disabled', true);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', true);
                                    $('#inputFreqWidget').val("");
                                    $('#inputFreqWidget').prop('required', false);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetSpeedometer":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputZoomControlsColor').attr('disabled', true);
                                    $('#inputZoomControlsColor').prop('required', false);
                                    $('#widgetZoomControlsColor').css("background-color", "#EEEEEE");
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    
                                    //Aggiunta campo per registrare il widget presso il notificatore
                                    addWidgetNotificatorAndThresholdFields();
                                    break;

                                case "widgetStateRideAtaf":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('none');
                                    $('#inputUrlWidget').attr('disabled', false);
                                    $('#inputUrlWidget').prop('required', false);
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    //Nuova riga
                                    //Default tab
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="inputDefaultTab" class="col-md-2 control-label">Default tab</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="inputDefaultTab" name="inputDefaultTab"></select>');
                                    newSelect.append('<option value="0">Stato</option>');
                                    newSelect.append('<option value="1">Linee monitorate</option>');
                                    newSelect.append('<option value="2">Dati</option>');
                                    newSelect.append('<option value="-1">None (automatic switch)</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newLabel.show();
                                    newInnerDiv.show();
                                    newSelect.show();

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;

                                case "widgetExternalContent":
                                    $('#inputTitleWidget').val('');
                                    $('#inputUrlWidget').val('');
                                    $('#inputUrlWidget').prop("required", true);
                                    $('#inputUrlWidget').attr("disabled", false);
                                    $("#titleLabel").html("Title"); 
                                    $("#bckColorLabel").html("Background color");
                                    $('#inputColorWidget').attr('disabled', false);
                                    $('#inputColorWidget').attr('required', true);
                                    $('#inputColorWidget').val("#eeeeee");
                                    $('#color_widget').css("background-color", "#eeeeee");
                                    $('#inputFontSize').val("");
                                    $('#inputFontSize').attr('disabled', true);
                                    $('#inputFontColor').val("");
                                    $('#inputFontColor').attr('disabled', true);
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').val(-1);
                                    $('#select-IntTemp-Widget').attr('disabled', true);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', true);
                                    $('#inputFreqWidget').val("");
                                    $('#inputFreqWidget').prop('required', false);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();
                                    
                                    //Nuova riga
                                    //Modalità del widget (none, map, gis, link esterno)
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="widgetMode" class="col-md-2 control-label">Widget mode</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="widgetMode" name="widgetMode"></select>');
                                    newSelect.append('<option value="link">Web link</option>');
                                    newSelect.append('<option value="map">Map</option>');
                                    newSelect.append('<option value="gisTarget">Selector target</option>');
                                    newSelect.append('<option value="none">None</option>');
                                    newSelect.val("link");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Centro della mappa per modalità GIS target
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    
                                    newLabel = $('<label class="col-md-2 control-label">Start lat</label>');
                                    newInnerDiv = $('<div class="col-md-2">' +
                                                      '<input type="text" id="gisTargetCenterLat" class="form-control" value="43.769789"/>' +
                                                    +'</div>');
                                    newInnerDiv.css("padding-left", "0px");
                                    newInnerDiv.css("padding-right", "0px");
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    newLabel = $('<label class="col-md-2 control-label">Start lng</label>');
                                    newInnerDiv = $('<div class="col-md-2">' +
                                                      '<input type="text" id="gisTargetCenterLng" class="form-control" value="11.255694"/>' +
                                                    +'</div>');
                                    newInnerDiv.css("padding-left", "0px");
                                    newInnerDiv.css("padding-right", "0px");        
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    newLabel = $('<label class="col-md-2 control-label">Start zoom</label>');
                                    newInnerDiv = $('<div class="col-md-2">' +
                                                      '<input type="text" id="gisTargetCenterZoom" class="form-control" value="11"/>' +
                                                    +'</div>');
                                    newLabel.css("padding-left", "8px");
                                    newLabel.css("padding-right", "8px");        
                                    newInnerDiv.css("padding-left", "0px");
                                    newInnerDiv.css("padding-right", "0px");        
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newFormRow.hide();
                                    
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newInnerDiv = $('<div id="gisTargetCenterMapDiv" class="col-md-12"></div>');
                                    newFormRow.append(newInnerDiv);
                                    newFormRow.hide();
                                    
                                    
                                    /*newLabel = $('<label for="gisTargetCenterDiv" class="col-md-2 control-label">Map start center and zoom</label>');
                                    newInnerDiv = $('<div id="gisTargetCenterDiv" class="col-md-10">' +
                                                      '<div class="col-md-4"><input type="text" id="gisTargetCenterLat" class="form-control" value="43.769789"/></div><div class="col-md-4"><input type="text" id="gisTargetCenterLng" class="form-control" value="11.255694"/></div><div class="col-md-4"><input type="text" id="gisTargetCenterZoom" class="form-control" value="11"/></div>' +
                                                      '<div id="gisTargetCenterMapDiv" class="col-md-12">' +
                                                    +'</div>');
                                    
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    newFormRow.hide();*/
                                    
                                    //Nuova riga
                                    //Full screen controls
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="enableFullscreenTab" class="col-md-2 control-label">Enable fullscreen in new tab</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="enableFullscreenTab" name="enableFullscreenTab"></select>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    newLabel = $('<label for="enableFullscreenModal" class="col-md-2 control-label">Enable fullscreen in a popup</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="enableFullscreenModal" name="enableFullscreenModal"></select>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val("yes");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Zoom controls visibility
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="inputControlsVisibility" class="col-md-2 control-label">Zoom controls visibility</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="inputControlsVisibility" name="inputControlsVisibility"></select>');
                                    newSelect.append('<option value="alwaysVisible">Always visible</option>');
                                    newSelect.append('<option value="hidden">Hidden</option>');
                                    newSelect.val("alwaysVisible");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Zoom factor
                                    newLabel = $('<label for="inputZoomFactor" class="col-md-2 control-label">Zoom factor (%)</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newInput = $('<input type="text" class="form-control" id="inputZoomFactor" name="inputZoomFactor" required>');
                                    newInput.val(100);
                                    newInput.attr('disabled', true);
                                    newInnerDiv.append(newInput);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Nuova riga
                                    //Zoom controls position
                                    newFormRow = $('<div class="row"></div>');
                                    $("#specificWidgetPropertiesDiv").append(newFormRow);
                                    newLabel = $('<label for="inputControlsPosition" class="col-md-2 control-label">Zoom controls position</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="inputControlsPosition" name="inputControlsPosition"></select>');
                                    newSelect.append('<option value="topLeft">Top left</option>');
                                    newSelect.append('<option value="topCenter">Top center</option>');
                                    newSelect.append('<option value="topRight">Top right</option>');
                                    newSelect.append('<option value="middleRight">Middle right</option>');
                                    newSelect.append('<option value="bottomRight">Bottom right</option>');
                                    newSelect.append('<option value="bottomMiddle">Bottom middle</option>');
                                    newSelect.append('<option value="bottomLeft">Bottom left</option>');
                                    newSelect.append('<option value="middleLeft">Middle left</option>');
                                    newSelect.val("topLeft");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);
                                    
                                    //Title visibility
                                    /*newLabel = $('<label for="inputShowTitle" class="col-md-2 control-label">Title visibility</label>');
                                    newInnerDiv = $('<div class="col-md-3"></div>');
                                    newSelect = $('<select class="form-control" id="inputShowTitle" name="inputShowTitle"></select>');
                                    newSelect.append('<option value="yes">Yes</option>');
                                    newSelect.append('<option value="no">No</option>');
                                    newSelect.val("yes");
                                    newInnerDiv.append(newSelect);
                                    newFormRow.append(newLabel);
                                    newFormRow.append(newInnerDiv);*/
                                    
                                    $("#widgetMode").change(function(){
                                        switch($(this).val())
                                        {
                                            case "link":
                                                $("#inputUrlWidget").val("");
                                                $("#inputUrlWidget").parents("div.row").show();
                                                $("#enableFullscreenTab").val("yes");
                                                $('#enableFullscreenTab').attr('disabled', false);
                                                $("#inputControlsVisibility").val("alwaysVisible");
                                                $("#inputZoomFactor").val("100");
                                                $("#inputControlsPosition").val("topLeft");
                                                //$("#inputShowTitle").val("yes");
                                                $("#inputControlsVisibility").parents("div.row").show();
                                                $("#inputControlsPosition").parents("div.row").show();
                                                $("#gisTargetCenterLat").parents("div.row").hide();
                                                $("#gisTargetCenterMapDiv").parents("div.row").hide();
                                                break;
                                                
                                            case "map":
                                                $("#inputUrlWidget").val("map");
                                                $("#inputUrlWidget").parents("div.row").hide();
                                                $("#enableFullscreenTab").val("no");
                                                $('#enableFullscreenTab').attr('disabled', true);
                                                $("#inputControlsVisibility").val("hidden");
                                                $("#inputZoomFactor").val("100");
                                                $("#inputControlsPosition").val("topLeft");
                                                //$("#inputShowTitle").val("yes");
                                                $("#inputControlsVisibility").parents("div.row").hide();
                                                $("#inputControlsPosition").parents("div.row").hide();
                                                $("#gisTargetCenterLat").parents("div.row").hide();
                                                $("#gisTargetCenterMapDiv").parents("div.row").hide();;
                                                break;
                                                
                                            case "gisTarget":
                                                $("#inputUrlWidget").val("gisTarget");
                                                $("#inputUrlWidget").parents("div.row").hide();
                                                $("#enableFullscreenTab").val("no");
                                                $('#enableFullscreenTab').attr('disabled', true);
                                                $("#inputControlsVisibility").val("hidden");
                                                $("#inputZoomFactor").val("100");
                                                $("#inputControlsPosition").val("topLeft");
                                                //$("#inputShowTitle").val("yes");
                                                $("#inputControlsVisibility").parents("div.row").hide();
                                                $("#inputControlsPosition").parents("div.row").hide();
                                                $("#gisTargetCenterLat").parents("div.row").show();
                                                $("#gisTargetCenterMapDiv").parents("div.row").show();
                                                
                                                var gisTargetCenterParameters = {
                                                    latLng: [43.769789, 11.255694],
                                                    zoom: 11
                                                };
                                                $("#parameters").val(JSON.stringify(gisTargetCenterParameters));
                                                
                                                if(gisTargetCenterMapDivRef === null)
                                                {
                                                    gisTargetCenterMapDiv = "gisTargetCenterMapDiv";
                                                    gisTargetCenterMapDivRef = L.map(gisTargetCenterMapDiv).setView([43.769789, 11.255694], 11);

                                                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                                       attribution: '&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
                                                       maxZoom: 18
                                                    }).addTo(gisTargetCenterMapDivRef);
                                                    gisTargetCenterMapDivRef.attributionControl.setPrefix('');

                                                    gisTargetCenterMapDivRef.off("zoom");
                                                    gisTargetCenterMapDivRef.on("zoom", function(){
                                                        $("#gisTargetCenterZoom").val(gisTargetCenterMapDivRef.getZoom());
                                                        gisTargetCenterParameters.zoom = $("#gisTargetCenterZoom").val();
                                                        $("#parameters").val(JSON.stringify(gisTargetCenterParameters));
                                                    });
                                                    
                                                    $("#gisTargetCenterZoom").off("input");
                                                    $("#gisTargetCenterZoom").on("input", function(event){
                                                        gisTargetCenterMapDivRef.setZoom($(this).val());
                                                        gisTargetCenterParameters.zoom = $("#gisTargetCenterZoom").val();
                                                        $("#parameters").val(JSON.stringify(gisTargetCenterParameters));
                                                    });
                                                    
                                                    gisTargetCenterMapDivRef.off("move");
                                                    gisTargetCenterMapDivRef.on("move", function(){
                                                        $("#gisTargetCenterLat").val(gisTargetCenterMapDivRef.getCenter().lat);
                                                        $("#gisTargetCenterLng").val(gisTargetCenterMapDivRef.getCenter().lng);
                                                        gisTargetCenterParameters.latLng[0] = $("#gisTargetCenterLat").val();
                                                        gisTargetCenterParameters.latLng[1] = $("#gisTargetCenterLng").val();
                                                        $("#parameters").val(JSON.stringify(gisTargetCenterParameters));
                                                    });
                                                    
                                                    $("#gisTargetCenterLat").off("input");
                                                    $("#gisTargetCenterLat").on("input", function(event){
                                                        gisTargetCenterParameters.latLng[0] = $("#gisTargetCenterLat").val();
                                                        gisTargetCenterMapDivRef.panTo(gisTargetCenterParameters.latLng);
                                                        $("#parameters").val(JSON.stringify(gisTargetCenterParameters));
                                                    });
                                                    
                                                    $("#gisTargetCenterLng").off("input");
                                                    $("#gisTargetCenterLng").on("input", function(event){
                                                        gisTargetCenterParameters.latLng[1] = $("#gisTargetCenterLng").val();
                                                        gisTargetCenterMapDivRef.panTo(gisTargetCenterParameters.latLng);
                                                        $("#parameters").val(JSON.stringify(gisTargetCenterParameters));
                                                    });
                                                }
                                                break;
                                                
                                            case "none":
                                                $("#inputUrlWidget").val("none");
                                                $("#inputUrlWidget").parents("div.row").hide();
                                                $("#enableFullscreenTab").val("no");
                                                $('#enableFullscreenTab').attr('disabled', true);
                                                $("#inputControlsVisibility").val("hidden");
                                                $("#inputZoomFactor").val("100");
                                                $("#inputControlsPosition").val("topLeft");
                                                //$("#inputShowTitle").val("yes");
                                                $("#inputControlsVisibility").parents("div.row").hide();
                                                $("#inputControlsPosition").parents("div.row").hide();
                                                $("#gisTargetCenterLat").parents("div.row").hide();
                                                $("#gisTargetCenterMapDiv").parents("div.row").hide();
                                                break;    
                                        }
                                    });
                                    
                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;    

                                default:
                                    $('#inputUrlWidget').val('none');
                                    $('#inputFontSize').val("");
                                    $('#inputFontColor').val("");
                                    $('#widgetFontColor').css("background-color", "#eeeeee");
                                    $("#titleLabel").html("Title");
                                    $("#bckColorLabel").html("Background color");
                                    $('#link_help_modal-add-widget').css("display", "");
                                    $('#inputUdmWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').attr('disabled', false);
                                    $('#inputFrameColorWidget').val('#eeeeee');
                                    $('#inputFrameColorWidget').prop('required', false);
                                    $('#select-IntTemp-Widget').attr('disabled', false);
                                    $('#select-IntTemp-Widget').prop('required', false);
                                    $('#inputFreqWidget').attr('disabled', false);
                                    $('#inputFreqWidget').val(60);
                                    $('#inputFreqWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').attr('disabled', false);
                                    $('#inputHeaderFontColorWidget').prop('required', true);
                                    $('#inputHeaderFontColorWidget').val("#000000");
                                    $('#widgetHeaderFontColor').css("background-color", "#000000");
                                    $('#inputUdmWidget').prop("required", false);
                                    $('#inputUdmWidget').attr("disabled", true);
                                    $('#inputUdmPosition').prop("required", false);
                                    $('#inputUdmPosition').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').attr("disabled", true);
                                    $('#addWidgetFirstAidHospital').prop("required", false);
                                    $('#addWidgetFirstAidHospital').val(-1);
                                    $('#inputFirstAidRow').hide();

                                    showInfoWCkeditors($('#select-widget').val(), editorsArray, null);

                                    //Parametri specifici del widget
                                    $('#specificWidgetPropertiesDiv .row').remove();

                                    $('#inputComuneWidget').attr('disabled', false);

                                    //Rimozione eventuali campi del subform general per widget process
                                    removeWidgetProcessGeneralFields("addWidget");
                                    break;
                            }//Fine switch
                        
                    }).change();

                    $('#button_add_metric_widget').click(function () 
                    {
                        if($('#widgetCategory').val() === "viewer")
                        {
                            if($('#select-metric').val()) 
                            {
                                var value_selected = $('#select-metric').val();
                                for (var i = 0; i < array_metrics.length; i++) 
                                {
                                    if (array_metrics[i]['id'] == ($("#select-metric option:selected").val())) 
                                    {
                                        for (var k = 0; k < array_metrics[i]['widgets'].length; k++) 
                                        {
                                            if (array_metrics[i]['widgets'][k]['id_type_widget'] == ($("#select-widget option:selected").val())) 
                                            {
                                                if ($('#textarea-selected-metrics').val()) 
                                                {
                                                    var content = $('#textarea-selected-metrics').val();
                                                    if ((content.split("+")).length == array_metrics[i]['widgets'][k]['number_metrics_widget']) 
                                                    {
                                                        alert("Maximum number of metric for widget reached!!!");
                                                    } 
                                                    else 
                                                    {
                                                        content += "+" + value_selected;
                                                        $('#textarea-selected-metrics').val(content);
                                                    }
                                                } 
                                                else 
                                                {
                                                    $('#textarea-selected-metrics').val(value_selected);
                                                }

                                                if (array_metrics[i]['widgets'][k]['number_metrics_widget'] > 1) 
                                                {
                                                    $('#select-metric').empty();
                                                    for (var j = 0; j < array_metrics.length; j++) 
                                                    {
                                                        for (var l = 0; l < array_metrics[j]['widgets'].length; l++) 
                                                        {
                                                            if (array_metrics[j]['widgets'][l]['id_type_widget'] == ($("#select-widget option:selected").val())) 
                                                            {
                                                                $('#select-metric').append('<option>' + array_metrics[j]['id'] + '</option>');
                                                            }
                                                        }
                                                    }
                                                    $('#select-widget').prop('disabled', true);
                                                }
                                            }
                                        }
                                    }
                                }
                                addWidgetConditionsArray["selectedMetricAndWidget"] = true;
                                $('#button_add_metric_widget').css("color", "black");
                            }
                            else
                            {
                               addWidgetConditionsArray["selectedMetricAndWidget"] = false;
                               $('#button_add_metric_widget').css("color", "red");
                            }

                            checkAddWidgetConditions();
                        }
                    });

                    $('.link_help_modal-add-widget').click(function () {
                        $('#modal-info-context').modal('show');
                    });

                    //Salvataggio dashboard
                    $('#link_save_configuration').click(function () {  
                        var gridster_actual = $(".gridster ul").gridster().data('gridster');
                        var widgets = JSON.stringify(gridster_actual.serialize());
                        $.ajax({
                            url: "save_config_widgets.php",
                            data: {configuration_widgets: widgets},
                            type: "POST",
                            async: true,
                            success: function (data) 
                            {
                                if(data == 1) 
                                {
                                    alert('Widgets\' positions have been saved successfully');
                                    window.location.reload(true);
                                } 
                                else 
                                {
                                    alert('Error in widgets\' positions saving: please try again');
                                    window.location.reload(true);
                                }
                            },
                            error: function (errorMsg) 
                            {
                                console.log("Error calling save_config_widgets.php");
                                console.log(errorMsg);
                            }
                        });
                    });


                    //Duplicazione della dashboard
                    $('#duplicateDashboardBtn').click(function () {
                        $('#cloningDashboardFormRow').hide();
                        $('#cloneDashboardModalFooter').hide();
                        $('#duplicateDashboardLoadingRow').show();
                        
                        var dashboardParams = {};
                        dashboardParams['sourceDashboardId'] = "<?= $_SESSION['dashboardId'] ?>";
                        dashboardParams['sourceDashboardTitle'] = $('#currentDashboardTitle').val();
                        dashboardParams['sourceDashboardAuthorName'] = "<?= $_SESSION['dashboardAuthorName'] ?>";
                        dashboardParams['newDashboardTitle'] = $('#newDashboardTitle').val();
                        
                        $.ajax({
                            url: "duplicate_dash.php",
                            data: {dashboardDuplication: dashboardParams},
                            type: "POST",
                            async: true,
                            success: function(data) 
                            {
                                $('#duplicateDashboardLoadingRow').hide();
                                switch(data)
                                {
                                    case "Ok":
                                        $('#duplicateDashboardOkRow').show();
                                        setTimeout(function(){
                                            $('#cloneDashboardModal').modal('hide');
                                            setTimeout(function(){
                                                $('#duplicateDashboardOkRow').hide();
                                                $('#cloningDashboardFormRow').show();
                                                $('#cloneDashboardModalFooter').show(); 
                                                $('#newDashboardTitle').val("");
                                                $('#cloneDashboardTitleMsg').val("Title can't be less than 4 characters long");
                                                $('#duplicateDashboardBtn').attr("disabled", true);
                                            }, 300);
                                        }, 3000);
                                        break;
                                        
                                    case "logoDirCreationKo": case "logoFileCopyKo":
                                        $('#duplicateDashboardWarningRow').show();
                                        setTimeout(function(){
                                            $('#duplicateDashboardWarningRow').hide();
                                            $('#cloningDashboardFormRow').show();
                                            $('#cloneDashboardModalFooter').show(); 
                                        }, 3000);
                                        console.log(data);
                                        break;

                                    case "Ko":
                                        $('#duplicateDashboardKoRow').show();
                                        setTimeout(function(){
                                            $('#duplicateDashboardKoRow').hide();
                                            $('#cloningDashboardFormRow').show();
                                            $('#cloneDashboardModalFooter').show(); 
                                        }, 3000);
                                        console.log(data);
                                        break;
                                }					
                            },
                            error: function(data)
                            {
                                $('#duplicateDashboardLoadingRow').hide();
                                $('#duplicateDashboardKoRow').show();
                                setTimeout(function(){
                                    $('#duplicateDashboardKoRow').hide();
                                    $('#cloningDashboardFormRow').show();
                                    $('#cloneDashboardModalFooter').show(); 
                                }, 3000);
                                console.log(data);
                            }
                        });
                    });



                    $('#link_exit').click(function () {
                        /*var result_exit = window.confirm("Are you sure you want to exit without saving the dashboard configuration?");
                        if (result_exit) {
                            window.location.href = "dashboards.php";
                        }*/
                        window.location.href = "dashboards.php";
                    });

                    //Pulsante di reset eliminato
                    /*$('#button_reset_add_widget').click(function () 
                    {
                        $('#select-widget').removeAttr('disabled');
                        $('#select-widget').find('option').remove();
                        $("#add-n-metrcis-widget").empty();
                        for (var i = 0; i < array_metrics.length; i++) {
                            $('#select-metric').append('<option>' + array_metrics[i]['id'] + '</option>');
                        }
                        updateSelectedMetric();
                    });*/

                    //Listener cancellazione widget
                    $(document).on('click', '.icon-remove-widget', function () {
                        var result_remove = window.confirm("Are you sure you want to permanently delete the selected widget?");
                        
                        if(result_remove) 
                        {
                           var name_widget_r = $(this).parents('li').attr('id');
                           var op = "remove";
                           window.location.href = "update_widget.php?nameWidget=" + name_widget_r + "&operation=" + op;
                        }
                    });

                    //Listener modifica widget
                    $(document).on('click', '.icon-cfg-widget', function () 
                    {
                        var name_widget_m = $(this).parents('li').attr('id');
                        var widgetId = $(this).parents('li').attr('data-widgetId');
                        $('#widgetIdM').val(widgetId);
                        
                        var dimMapRaw = null;
                        var dimMap = null;
                        $("#inputColumn-m").empty();
                        $("#inputRows-m").empty();
                        $("#inputComuneRowM").hide();
                        
                        editWidgetConditionsArray = new Array();
                        setEditWidgetConditionsArray(editWidgetConditionsArray);
                        editWidgetConditionsArray["title"] = true;
                        
                        //Controllo presenza titolo
                        $("#inputTitleWidgetM").off();
                        $("#inputTitleWidgetM").on('input', function(){
                            var pattern = /^$/; 
                            if(pattern.test($(this).val()))
                            {
                                editWidgetConditionsArray["title"] = false;
                                $("label[for=inputTitleWidgetM]").css("color", "red");
                            }
                            else
                            {
                               var newTitle = $(this).val();
                               $("div.titleDiv").each(function(i)
                               {
                                  if($(this).parents("li.gridsterCell").attr("id") !== name_widget_m)
                                  {
                                    if($(this).html() === newTitle)
                                    {
                                       editWidgetConditionsArray["title"] = false;
                                       $("label[for=inputTitleWidgetM]").css("color", "red");
                                       return false;
                                    }
                                    else
                                    {
                                       editWidgetConditionsArray["title"] = true;
                                       $("label[for=inputTitleWidgetM]").css("color", "black");
                                    }
                                  }
                               });
                            }
                            checkEditWidgetConditions();
                        });
                        
                        $.ajax({
                            url: "get_data.php",
                            data: {widget_to_modify: name_widget_m, action: "get_param_widget"},
                            type: "GET",
                            async: true,
                            dataType: 'json',
                            success: function (data) 
                            {
                                var actuatorEntity = data.actuatorEntity;
                                var actuatorAttribute = data.actuatorAttribute;
                                var widgetTypeM = data.type_widget;
                                var paramsRaw = data['param_w'];
                                var styleParamsRaw = data['styleParameters'];
                                var serviceUri = data['serviceUri'];
                                var viewMode = data['viewMode'];
                                
                                var parameters, styleParameters, currentParams, infoJson = null;
                                
                                var infoJsonRaw = data['infoJson'];
                                var info_mess = data['info_mess'];
                                
                                if((data.actuatorEntity !== null)&&(data.actuatorAttribute !== null))
                                {
                                    //Caso widget attuatori
                                    $('#widgetCategoryM').val("actuator");
                                    $('#widgetCategoryHiddenM').val("actuator");
                                    $('#widgetEntityRowM').show();
                                    $('#widgetAttributeRowM').show();
                                    $('#widgetActuatorTypeRowM').show();
                                    $('#widgetEntityM').val(data.actuatorEntity);
                                    
                                    $.ajax({
                                        url: "iframeProxy.php",
                                        data: {
                                            action: "getOrionEntityAttributes", 
                                            entity: actuatorEntity
                                        },
                                        type: "GET",
                                        async: true,
                                        dataType: 'json',
                                        success: function (data2) 
                                        {
                                            $('#widgetAttributeM').empty();

                                            for(var key in data2)
                                            {
                                                $('#widgetAttributeM').append('<option value="' + key + '" data-type="' + data2[key].type + '">' + key + '</option>');
                                            }

                                            $('#widgetAttributeM').val(actuatorAttribute);
                                            
                                            $.ajax({
                                                url: "iframeProxy.php",
                                                data: {
                                                    action: "getActuatorWidgetTypes", 
                                                    type: $('#widgetAttributeM option:selected').attr('data-type')
                                                },
                                                type: "GET",
                                                async: true,
                                                dataType: 'json',
                                                success: function (data3) 
                                                {
                                                    $('#widgetActuatorTypeM').empty();

                                                    for(var key in data3.list)
                                                    {
                                                        $('#widgetActuatorTypeM').append('<option value="' + data3.list[key].id_type_widget + '" data-min_row="' + data3.list[key].min_row + '" + data-max_row="' + data3.list[key].max_row + '" data-min_col="' + data3.list[key].min_col + '" data-max_col="' + data3.list[key].max_col + '">' + data3.list[key].id_type_widget + '</option>')
                                                    }

                                                    $('#widgetActuatorTypeM').val(widgetTypeM);
                                                    
                                                    switch($('#widgetActuatorTypeM').val())
                                                    {
                                                        case "widgetKnob":
                                                            if(styleParamsRaw !== null) 
                                                            {
                                                                styleParameters = JSON.parse(styleParamsRaw);
                                                            }
                                                            $('#link_help_modal-add-widget-m').css("display", "");
                                                            $('#inputTitleWidgetM').attr('disabled', false);
                                                            $("label[for='inputTitleWidgetM']").html("Title");
                                                            $("label[for='inputColorWidgetM']").html("Background color");
                                                            $('#inputColorWidgetM').attr('disabled', false);
                                                            $('#inputColorWidgetM').prop('required', true);
                                                            $('#inputFontSizeM').attr('disabled', false);
                                                            $('#inputFontSizeM').prop('required', true);
                                                            $('#inputFontColorM').attr('disabled', false);
                                                            $('#inputFontColorM').prop('required', true);
                                                            $('#select-frameColor-Widget-m').attr('disabled', false);
                                                            $('#select-frameColor-Widget-m').prop('required', true);
                                                            $('#select-IntTemp-Widget-m').val(-1);
                                                            $('#select-IntTemp-Widget-m').prop('disabled', true);
                                                            $('#select-IntTemp-Widget-m').prop('required', false);
                                                            $('#inputFreqWidgetM').val('');
                                                            $('#inputFreqWidgetM').prop('disabled', true);
                                                            $('#inputFreqWidgetM').prop('required', false);
                                                            $('#inputComuneWidgetM').attr('disabled', true);
                                                            $('#urlWidgetM').attr('disabled', false);
                                                            $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                                            $('#inputHeaderFontColorWidgetM').prop('required', true);
                                                            $('#inputUdmWidgetM').prop("required", false);
                                                            $('#inputUdmWidgetM').attr("disabled", true);
                                                            $('#inputUdmWidgetM').val("");
                                                            $('#inputUdmPositionM').prop("required", false);
                                                            $('#inputUdmPositionM').attr("disabled", true);
                                                            $('#inputUdmPositionM').val(-1);

                                                            //Rimozione eventuali campi del subform general per widget process
                                                            removeWidgetProcessGeneralFields("editWidget");

                                                            showInfoWCkeditorsM($('#widgetActuatorTypeM').val(), editorsArrayM, null, null, info_mess);

                                                            //Parametri specifici del widget
                                                            $('#specificParamsM .row').remove();  
                                                            
                                                            newFormRow = $('<div class="row"></div>');
                                                            newLabel = $('<label for="editKnobStartAngle" class="col-md-2 control-label">Start angle</label>');
                                                            newInnerDiv = $('<div class="col-md-4"></div>');
                                                            newInput = $('<input type="text" name="editKnobStartAngle" class="form-control" value="' + styleParameters.startAngle + '" id="editKnobStartAngle"/>');
                                                            newInnerDiv.append(newInput);
                                                            newFormRow.append(newLabel);
                                                            newFormRow.append(newInnerDiv);

                                                            newLabel = $('<label for="editKnobEndAngle" class="col-md-2 control-label">End angle</label>');
                                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                                            newInput = $('<input type="text" name="editKnobEndAngle" class="form-control" value="' + styleParameters.endAngle + '" id="editKnobEndAngle"/>');
                                                            newInnerDiv.append(newInput);
                                                            newFormRow.append(newLabel);
                                                            newFormRow.append(newInnerDiv);

                                                            $('#specificParamsM').append(newFormRow);
                                                            break;
                                                        }
                                                    
                                                },
                                                error: function(data)
                                                {
                                                    console.log("Ko");
                                                    console.log(data);
                                                }
                                            });
                                        },
                                        error: function(data)
                                        {
                                            console.log("Ko");
                                            console.log(data);
                                        }
                                    });
                                }
                                else
                                {
                                    //Caso widget data viewer
                                    $('#widgetCategoryM').val("viewer");
                                    $('#widgetCategoryHiddenM').val("viewer");
                                    $('#metricWidgetMRow').show();
                                    $('#inputNameWidgetMRow').show();
                                    $('#select-widget-mRow').show();
                                    $('#inputComuneRowM').show();
                                    $('#urlWidgetMRow').show();
                                    $('#textarea-metric-widget-mRow').show();
                                    
                                    $("#metricWidgetM").val(data['id_metric_widget'].replace(/\+/g, ", "));
                                    $("#select-widget-m").find('option').remove().end().append('<option>' + data['widgets_metric'] + '</option>');
                                    $('#select-widget-m').val(data['type_widget']);
                                    $("#inputComuneWidgetM").val(data['municipality_metric_widget']);
                                    $('#select-IntTemp-Widget-m').val(data['temporal_range_widget']);
                                    $("#mod-n-metrcis-widget").text("max " + data['number_metrics_widget'] + " metrics");
                                    $("#textarea-metric-widget-m").val('');
                                    $("#inputUdmWidgetM").val(data['udm']);
                                    $("#urlWidgetM").val(data['url']);
                                }
                                
                                $("#inputTitleWidgetM").val(data['title_widget']);
                                $("#inputFontSizeM").val(data['fontSize']);
                                $("#inputFontColorM").val(data['fontColor']);
                                $("#widgetFontColorM").css("background-color", data['fontColor']);
                                $("#widgetFontColorPickerContainerM").colorpicker('setValue', data['fontColor']);
                                //$("#inputHeaderFontColorWidgetM").val(data['headerFontColor']);
                                //$("#widgetHeaderFontColorM").css("background-color", data['headerFontColor']);
                                $("#inputFreqWidgetM").val(data['frequency_widget']);
                                $("#inputNameWidgetM").val(data['name_widget']);
                                $("#inputShowTitleM").val(data['showTitle']);
                                $("#inputFontFamilyWidgetM").val(data['fontFamily']);
                                
                                
                                
                                if(paramsRaw !== 'undefined')
                                {
                                    parameters = JSON.parse(paramsRaw);
                                    currentParams = parameters;
                                }
                                
                                if(infoJsonRaw !== null)
                                {
                                    infoJson = JSON.parse(infoJsonRaw);
                                }
                                
                                if((data.actuatorEntity === null)&&(data.actuatorAttribute === null))
                                {
                                    for(var i = 0; i < data['metrics_prop'].length; i++) 
                                    {
                                        var value_text_widget = $("#textarea-metric-widget-m").val();
                                        value_text_widget += "Name: " + data['metrics_prop'][i]['id_metric'] + ".\n";
                                        value_text_widget += "Description: " + data['metrics_prop'][i]['descrip_metric_widget'] + ".\n";
                                        value_text_widget += "Metric typology: " + data['metrics_prop'][i]['type_metric_widget'] + ".\n";
                                        metricType = data['metrics_prop'][i]['type_metric_widget'];
                                        value_text_widget += "Data Area: " + data['metrics_prop'][i]['area_metric_widget'] + ".\n";
                                        value_text_widget += "Data Source: " + data['metrics_prop'][i]['source_metric_widget'] + ".\n";
                                        value_text_widget += "Status: " + data['metrics_prop'][i]['status_metric_widget'] + ".";
                                        if(i !== ((data['metrics_prop'].length) - 1)) 
                                        {
                                            value_text_widget += "\n\n";
                                        }
                                        $("#textarea-metric-widget-m").val(value_text_widget);
                                    }
                                }
                                
                                //Titolo obbligatorio per tutti
                                $('#inputTitleWidgetM').prop('required', true);
                                
                                if((actuatorEntity === null)||(actuatorAttribute === null))
                                {
                                    
                                switch($('#select-widget-m').val())
                                {
                                    case "widgetServerStatus":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $("#urlWidgetM").prop('disabled', false);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, data['info_mess']);
                                        
                                        $("#xAxisDatasetM").prop('required', false);
                                        $("#lineWidthM").prop('required', false);
                                        $("#alrLookM").prop('required', false);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        editWidgetServerStatusGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                    
                                    case "widgetSelector":
                                        var imgMaxSizeM, newControlM = null;  
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                        }
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#widgetFontColorM').css("background-color", data['fontColor']);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', true);
                                        $('#inputFreqWidgetM').prop('required', false);
                                        $('#inputFreqWidgetM').val("");
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        var widgetsNumber = 0;
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, editGisParameters, 
                                            widgetId, widgetTitle, newTableRow, newTableCell = null;

                                        var editGisParameters = currentParams;
                                        $("#parametersM").val(JSON.stringify(editGisParameters));
                                        setEditGisParameters(editGisParameters);

                                        //Target widgets geolocation
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="editGisGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                        newInnerDiv = $('<div class="col-md-4"></div>');
                                        newSelect = $('<select name="editGisGeolocationWidgets" class="form-control" id="editGisGeolocationWidgets" multiple></select>');

                                        $("li.gs_w").each(function(){
                                            if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "gisTarget"))
                                            {
                                              widgetId = $(this).attr("id");
                                              widgetTitle = $(this).find("div.titleDiv").html();
                                              newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                              widgetsNumber++;
                                            }
                                        });

                                        if(widgetsNumber > 0)
                                        {
                                            newInnerDiv.append(newSelect);
                                        }
                                        else
                                        {
                                            newInnerDiv.append("None");
                                        }

                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        if(widgetsNumber > 0)
                                        {
                                            $('#editGisGeolocationWidgets').selectpicker({
                                               actionsBox: true, 
                                               width: "auto"
                                            });
                                            
                                            $('#editGisGeolocationWidgets').selectpicker('val', editGisParameters.targets);

                                            $('#editGisGeolocationWidgets').on('changed.bs.select', function (e) 
                                            {
                                                if($(this).val() === null)
                                                {
                                                    editGisParameters.targets = [];
                                                }
                                                else
                                                {
                                                    editGisParameters.targets = $(this).val();
                                                }
                                                $("#parametersM").val(JSON.stringify(editGisParameters));
                                            });
                                        }
                                        
                                        newLabel = $('<label for="editGisRectDim" class="col-md-2 control-label">Rectangles height</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newControlM = $('<input id="editGisRectDim" name="editGisRectDim" data-slider-ticks="[1, 2, 3, 4]" data-slider-id="editGisRectDimSlider" type="text" data-slider-min="1" data-slider-max="4" data-slider-step="1"/>');
                                        newInnerDiv.append(newControlM);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        $('#editGisRectDim').bootstrapSlider({
                                            ticks_labels: ["small", "mid", "large", "fit"],
                                            value: styleParameters.rectDim,
                                            formatter: function(value) {
                                               switch(value)
                                               {
                                                    case 1:
                                                       return "25px";
                                                       break;

                                                    case 2:
                                                        return "50px";
                                                        break;

                                                    case 3:
                                                        return "75px";
                                                        break;

                                                    case 4:
                                                        return "Rectangles fit widget's height";
                                                        break;    
                                               }
                                            }
                                        });
                                        
                                        //Workaround per evitare che le label dello slider vengano tutte ammassate fra di loro: bug del componente?
                                        setTimeout(function(){
                                            $("#editGisRectDimSlider div.slider-tick-label-container").css("margin-left", "-18.6667px");
                                            $("#editGisRectDimSlider div.slider-tick-label-container div.slider-tick-label").css("width", "37.3333px");
                                        }, 250);
                                        
                                        //Nuova riga
                                        //Colore testo quando picker attivo
                                        newFormRow = $('<div class="row"></div>');
                                        newLabel = $('<label for="editGisActiveQueriesFontColor" class="col-md-2 control-label">Active queries font color</label>');
                                        newInnerDiv = $('<div class="col-md-4"></div>');
                                        var newColorPicker = $('<div id="editGisActiveQueriesFontColorContainer" class="input-group colorpicker-component"><input id="editGisActiveQueriesFontColor" name="editGisActiveQueriesFontColor" type="text" class="form-control input"/><span class="input-group-addon"><i></i></span></div>');
                                        newInnerDiv.append(newColorPicker);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        $("#specificParamsM").append(newFormRow);

                                        $('#editGisActiveQueriesFontColorContainer').colorpicker({
                                            format: "rgba",
                                            color: styleParameters.activeFontColor
                                        });
                                        
                                        //Nuova riga
                                        //Contenitore per tabella delle query
                                        var editGisQueryTableContainer = $('<div id="editGisQueryTableContainer" class="row rowCenterContent"></div>');
                                        var editGisQueryTable = $("<table id='editGisQueryTable' class='table table-bordered table-condensed thrRangeTable'><col style='width:64px'><col style='width:64px'><col style='width:64px'><col style='width:128px'><col style='width:76px'><col style='width:128px'><col style='width:128px'><col style='width:128px'><col style='width:50px'><tr><td>Symbol mode</td><td>Symbol choice</td><td>Symbol preview</td><td>Description</td><td>Query</td><td>Color1</td><td>Color2</td><td>Data widgets</td><td><a href='#'><i class='fa fa-plus' style='font-size:24px;color:#337ab7'></i></a></td></tr></table>");
                                        editGisQueryTableContainer.append(editGisQueryTable);
                                        $("#specificParamsM").append(editGisQueryTableContainer);
                                        
                                        for(var i = 0; i < editGisParameters.queries.length; i++)
                                        {
                                            newTableRow = $('<tr></tr>');
                                            
                                            if(editGisParameters.queries[i].symbolMode === 'man')
                                            {
                                                newTableCell = $('<td><input data-param="queryIconOption" type="checkbox"/></td>');
                                            }
                                            else
                                            {
                                                newTableCell = $('<td><input data-param="queryIconOption" type="checkbox" checked/></td>');
                                            }
                                            
                                            newTableCell.find('input').bootstrapToggle({
                                                on: 'Auto',
                                                off: 'Man',
                                                size: 'small',
                                                onstyle: 'primary',
                                                offstyle: 'warning'
                                            });

                                            newTableRow.append(newTableCell);
                                            
                                            newTableCell = $('<td></td>');
                                            var imgMaxSize = $('<input type="hidden" name="MAX_FILE_SIZE" value="1000000" />');
                                            newTableCell.append(imgMaxSize);
                                            var newControl = $('<input type="file" class="form-control" name="editSelectorLogos[]">');
                                            newTableCell.append(newControl);
                                            newTableRow.append(newTableCell);
                                            
                                            newControl.filestyle({
                                                input: false,
                                                buttonText: "",
                                                buttonName: "btn-primary",
                                                size: "sm",
                                                disabled: false,
                                                badge: false
                                            });
                                            
                                            newTableRow.find('input[type=file]').change(function() 
                                            {
                                                var localRowRef = $(this).parents('tr');
                                                var file = this.files[0];
                                                var imagefile = file.type;
                                                var match= ["image/jpeg","image/png","image/jpg", "image/svg+xml"];
                                                if(!((imagefile === match[0]) || (imagefile === match[1]) || (imagefile === match[2]) || (imagefile === match[3])))
                                                {
                                                    return false;
                                                }
                                                else
                                                {
                                                    var reader = new FileReader();
                                                    reader.onload = function(event){
                                                        localRowRef.find('div.selectorMenuCustomIcon').html("");
                                                        localRowRef.find('div.selectorMenuCustomIcon').css("background", "url(" + event.target.result + ")");
                                                        localRowRef.find('div.selectorMenuCustomIcon').css("background-size", "contain");
                                                        localRowRef.find('div.selectorMenuCustomIcon').css("background-repeat", "no-repeat");
                                                        localRowRef.find('div.selectorMenuCustomIcon').css("background-position", "center center");
                                                    };
                                                    reader.readAsDataURL(this.files[0]);
                                                }
                                            });
                                            
                                            newTableCell = $('<td><i class="material-icons selectorMenuDefaultIcon" style="font-size: 34px; display: block;">navigation</i><div class="selectorMenuCustomIcon">None</div></td>');
                                            newTableRow.append(newTableCell);
                                            
                                            if(editGisParameters.queries[i].symbolMode === 'auto')
                                            {
                                                newTableRow.find('div.bootstrap-filestyle').hide();
                                                newTableRow.find('div.selectorMenuCustomIcon').hide();
                                                newTableRow.find('i.selectorMenuDefaultIcon').show();
                                            }
                                            else
                                            {
                                                newTableRow.find('div.bootstrap-filestyle').show();
                                                newTableRow.find('i.selectorMenuDefaultIcon').hide();
                                                newTableRow.find('div.selectorMenuCustomIcon').show();
                                                newTableRow.find('div.selectorMenuCustomIcon').css("width", "52px");
                                                newTableRow.find('div.selectorMenuCustomIcon').css("height", "33px");
                                                newTableRow.find('div.selectorMenuCustomIcon').html("");
                                                newTableRow.find('div.selectorMenuCustomIcon').css("background", "url(" + editGisParameters.queries[i].symbolFile + ")");
                                                newTableRow.find('div.selectorMenuCustomIcon').css("background-size", "contain");
                                                newTableRow.find('div.selectorMenuCustomIcon').css("background-repeat", "no-repeat");
                                                newTableRow.find('div.selectorMenuCustomIcon').css("background-position", "center center");
                                            }
                                            
                                            newTableRow.find('input[data-param=queryIconOption]').change(function(){
                                                var index = parseInt($(this).parents('tr').index() - 1);
                                                if($(this).prop('checked'))
                                                {
                                                    $(this).parents('tr').find('div.bootstrap-filestyle').hide();
                                                    $(this).parents('tr').find('div.selectorMenuCustomIcon').hide();
                                                    $(this).parents('tr').find('i.selectorMenuDefaultIcon').show();
                                                    editGisParameters.queries[index].symbolMode = "auto";
                                                }
                                                else
                                                {
                                                    $(this).parents('tr').find('div.bootstrap-filestyle').show();
                                                    $(this).parents('tr').find('i.selectorMenuDefaultIcon').hide();
                                                    $(this).parents('tr').find('div.selectorMenuCustomIcon').show();
                                                    $(this).parents('tr').find('div.selectorMenuCustomIcon').css("width", $(this).parents('tr').find('div.selectorMenuCustomIcon').parents('td').width() + "px");
                                                    $(this).parents('tr').find('div.selectorMenuCustomIcon').css("height", $(this).parents('tr').find('div.selectorMenuCustomIcon').parents('td').height() + "px");
                                                    editGisParameters.queries[index].symbolMode = "man";
                                                }
                                                
                                                $('#parametersM').val(JSON.stringify(editGisParameters));
                                            });
                                            
                                            newTableCell = $('<td><a href="#" class="toBeEdited" data-type="text" data-mode="popup" data-param="queryDesc"></a></td>');
                                            newTableCell.find('a').editable({
                                                emptytext: "Empty",
                                                display: function(value, response){
                                                    if(value.length > 16)
                                                    {
                                                        $(this).html(value.substring(0, 13) + "...");
                                                    }
                                                    else
                                                    {
                                                       $(this).html(value); 
                                                    }
                                                },
                                                value: editGisParameters.queries[i].desc
                                            });
                                            newTableRow.append(newTableCell);

                                            newTableCell = $('<td><a href="#" class="toBeEdited" data-type="text" data-mode="popup" data-param="queryUrl"></td>');
                                            newTableCell.find('a').editable({
                                                emptytext: "Empty",
                                                display: function(value, response){
                                                    if(value.length > 10)
                                                    {
                                                        $(this).html(value.substring(0, 10) + "...");
                                                    }
                                                    else
                                                    {
                                                       $(this).html(value); 
                                                    }
                                                },
                                                value: editGisParameters.queries[i].query
                                            });
                                            newTableRow.append(newTableCell);

                                            newTableCell = $('<td><div class="input-group colorPicker" data-param="color1"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newTableRow.append(newTableCell);
                                            newTableRow.find('div.colorPicker').colorpicker({color: editGisParameters.queries[i].color1, format: "rgba"});
                                            newTableRow.find('div.colorPicker').on('hidePicker', editGisUpdateParams); 

                                            newTableCell = $('<td><div class="input-group colorPicker" data-param="color2"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newTableRow.append(newTableCell);
                                            newTableRow.find('div.colorPicker').colorpicker({color: editGisParameters.queries[i].color2, format: "rgba"});
                                            newTableRow.find('div.colorPicker').on('hidePicker', editGisUpdateParams);
                                            
                                            newTableCell = $('<td><select data-param="targets" class="form-control" multiple></select></td>');
                                            newTableRow.append(newTableCell);

                                             $("li.gs_w").each(function(){
                                                 if(($(this).attr("id").includes("BarContent"))||($(this).attr("id").includes("ColumnContent"))||($(this).attr("id").includes("GaugeChart"))||($(this).attr("id").includes("PieChart"))||($(this).attr("id").includes("SingleContent"))||($(this).attr("id").includes("Speedometer"))||($(this).attr("id").includes("TimeTrend")))
                                                 {
                                                   widgetId = $(this).attr("id");
                                                   widgetTitle = $(this).find("div.titleDiv").html();
                                                   newTableRow.find('select').append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                                 }
                                             });                               


                                            newTableRow.find('select').selectpicker({
                                                                                actionsBox: true, 
                                                                                width: 110
                                                                             });
                                            newTableRow.find('select').on('changed.bs.select', editGisUpdateParams);
                                            newTableRow.find('select').selectpicker('val', editGisParameters.queries[i].targets);

                                            newTableCell = $('<td><a><i class="fa fa-close" style="font-size:24px;color:red"></i></a></td>');
                                            newTableCell.find('i').click(delGisQueryM);
                                            newTableRow.append(newTableCell);
                                            newTableRow.find('a.toBeEdited').on('save', editGisUpdateParams);

                                            $("#editGisQueryTable").append(newTableRow);     
                                        }
                                        
                                        $("#editGisQueryTable i.fa-plus").click(addGisQueryM);
                                        break; 
                                    
                                    
                                    case "widgetClock":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').attr('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', true);
                                        $('#inputFreqWidgetM').prop('required', false);
                                        $('#inputFreqWidgetM').val('');
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $("#inputUdmPositionM").val(-1);
                                        
                                       showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                       //Parametri specifici del widget
                                       $('#specificParamsM .row').remove();
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                        
                                       var styleParameters, newFormRow, newLabel, newInnerDiv, newSelect, newInput = null;
                                        
                                       if(styleParamsRaw !== null) 
                                       {
                                          styleParameters = JSON.parse(styleParamsRaw);
                                       } 
                                        
                                       //Nuova riga
                                       //Clock data e clock font type
                                       newFormRow = $('<div class="row"></div>');
                                       newLabel = $('<label for="editWidgetClockData" class="col-md-2 control-label">Shown data</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select name="editWidgetClockData" class="form-control" id="editWidgetClockData"></select>');
                                       newSelect.append('<option value="date">Date</option>');
                                       newSelect.append('<option value="time">Time</option>');
                                       newSelect.append('<option value="dateTime">Date and time</option>');
                                       newSelect.val(styleParameters.clockData);
                                       newInnerDiv.append(newSelect);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);

                                       newLabel = $('<label for="editWidgetClockFont" class="col-md-2 control-label">Font type</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select name="editWidgetClockFont" class="form-control" id="editWidgetClockFont"></select>');
                                       newSelect.append('<option value="normal">Normal</option>');
                                       newSelect.append('<option value="lcd">LCD like</option>');
                                       newSelect.val(styleParameters.clockFont);
                                       newInnerDiv.append(newSelect);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);

                                       $("#specificParamsM").append(newFormRow);
                                       break;
                                        
                                   case "widgetNetworkAnalysis":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                       
                                       //Parametri specifici del widget
                                       $('#specificParamsM .row').remove();
                                       var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan = null;
                                    
                                       //Target widgets geolocation
                                       newFormRow = $('<div class="row"></div>');
                                       newLabel = $('<label for="editWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select name="editWidgetGeolocationWidgets" class="form-control" id="editWidgetGeolocationWidgets" multiple></select>');

                                       var widgetId, widgetTitle = null;
                                       var widgetsNumber = 0;
                                       
                                       //JSON degli eventi da mostrare su ogni widget target di questo widget events
                                       var targetsJson = currentParams;
                                       $("#parametersM").val(JSON.stringify(targetsJson));
                                       
                                       //console.log($("#parametersM").val());
                                       
                                       $("li.gs_w").each(function(){
                                          if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                          {
                                             widgetId = $(this).attr("id");
                                             widgetTitle = $(this).find("div.titleDiv").html();
                                             newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                             widgetsNumber++;
                                          }
                                       });

                                       if(widgetsNumber > 0)
                                       {
                                          newInnerDiv.append(newSelect);
                                       }
                                       else
                                       {
                                          newInnerDiv.append("None");
                                       }

                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel.show();
                                       newInnerDiv.show();

                                       if(widgetsNumber > 0)
                                       {
                                          $('#editWidgetGeolocationWidgets').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });
                                          
                                          $('#editWidgetGeolocationWidgets').selectpicker('val', targetsJson);

                                          $('#editWidgetGeolocationWidgets').on('changed.bs.select', function (e) 
                                          {
                                             if($(this).val() === null)
                                             {
                                                targetsJson = [];
                                             }
                                             else
                                             {
                                                targetsJson = $(this).val();
                                             }
                                             $("#parametersM").val(JSON.stringify(targetsJson));
                                          });
                                       }
                                       break;
                                   
                                    case "widgetResources":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                       
                                       //Parametri specifici del widget
                                       $('#specificParamsM .row').remove();
                                       var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan = null;
                                    
                                       //Target widgets geolocation
                                       newFormRow = $('<div class="row"></div>');
                                       newLabel = $('<label for="editWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select name="editWidgetGeolocationWidgets" class="form-control" id="editWidgetGeolocationWidgets" multiple></select>');

                                       var widgetId, widgetTitle = null;
                                       var widgetsNumber = 0;
                                       
                                       //JSON degli eventi da mostrare su ogni widget target di questo widget events
                                       var targetsJson = currentParams;
                                       $("#parametersM").val(JSON.stringify(targetsJson));
                                       
                                       //console.log($("#parametersM").val());
                                       
                                       $("li.gs_w").each(function(){
                                          if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                          {
                                             widgetId = $(this).attr("id");
                                             widgetTitle = $(this).find("div.titleDiv").html();
                                             newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                             widgetsNumber++;
                                          }
                                       });

                                       if(widgetsNumber > 0)
                                       {
                                          newInnerDiv.append(newSelect);
                                       }
                                       else
                                       {
                                          newInnerDiv.append("None");
                                       }

                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel.show();
                                       newInnerDiv.show();

                                       if(widgetsNumber > 0)
                                       {
                                          $('#editWidgetGeolocationWidgets').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });
                                          
                                          $('#editWidgetGeolocationWidgets').selectpicker('val', targetsJson);

                                          $('#editWidgetGeolocationWidgets').on('changed.bs.select', function (e) 
                                          {
                                             if($(this).val() === null)
                                             {
                                                targetsJson = [];
                                             }
                                             else
                                             {
                                                targetsJson = $(this).val();
                                             }
                                             $("#parametersM").val(JSON.stringify(targetsJson));
                                          });
                                       }
                                       break;
                                    
                                    case "widgetEvacuationPlans":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                       
                                       //Parametri specifici del widget
                                       $('#specificParamsM .row').remove();
                                       var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                       //Nuova riga
                                       newFormRow = $('<div class="row"></div>');
                                       $("#specificParamsM").append(newFormRow);

                                       newLabel = $('<label for="editWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select class="form-control" id="editWidgetGeolocationWidgets" name="editWidgetGeolocationWidgets"></select>');

                                       var widgetId, widgetTitle = null;
                                       var widgetsNumber = 0;
                                       
                                       //JSON degli eventi da mostrare su ogni widget target di questo widget events
                                       var targetEventsJson = currentParams;
                                       $("#parametersM").val(JSON.stringify(targetEventsJson));

                                       $("li.gs_w").each(function()
                                       {
                                          if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                          {
                                             widgetId = $(this).attr("id");
                                             widgetTitle = $(this).find("div.titleDiv").html();
                                             newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                             widgetsNumber++;
                                          }
                                       });

                                       if(widgetsNumber > 0)
                                       {
                                          newInnerDiv.append(newSelect);
                                       }
                                       else
                                       {
                                          newInnerDiv.append("None");
                                       }

                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel.show();
                                       newInnerDiv.show();

                                       if(widgetsNumber > 0)
                                       {
                                          newSelect.show();
                                          newSelect.val(-1);
                                          newLabel = $('<label for="editWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                          newInnerDiv = $('<div class="col-md-3"></div>');
                                          var eventTypeSelect = $('<select name="editWidgetEventTypes" class="form-control" id="editWidgetEventTypes" multiple></select>');
                                          
                                          eventTypeSelect.append('<option value="approved">Approved</option>');
                                          eventTypeSelect.append('<option value="closed">Closed</option>');
                                          eventTypeSelect.append('<option value="in_progress">In progress</option>');
                                          eventTypeSelect.append('<option value="proposed">Proposed</option>');
                                          eventTypeSelect.append('<option value="rejected">Rejected</option>');
                                          
                                          eventTypeSelect.val(-1);
                                          newFormRow.append(newLabel);
                                          newInnerDiv.append(eventTypeSelect);
                                          newFormRow.append(newInnerDiv);
                                          newLabel.hide();
                                          newInnerDiv.hide();

                                          $('#editWidgetEventTypes').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });

                                          $('#editWidgetEventTypes').on('changed.bs.select', function (e) 
                                          {
                                             if($(this).val() === null)
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = [];
                                             }
                                             else
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = $(this).val();
                                             }
                                             $("#parametersM").val(JSON.stringify(targetEventsJson));
                                          });

                                          $("#editWidgetGeolocationWidgets").change(function(){
                                             newLabel.show();
                                             newInnerDiv.show();
                                             $('#editWidgetEventTypes').selectpicker('val', targetEventsJson[$("#editWidgetGeolocationWidgets").val()]);
                                          });
                                       }
                                       break;
                                       
                                    case "widgetAlarms":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                       
                                       //Parametri specifici del widget
                                       $('#specificParamsM .row').remove();
                                       var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                       //Nuova riga
                                       newFormRow = $('<div class="row"></div>');
                                       $("#specificParamsM").append(newFormRow);

                                       newLabel = $('<label for="editWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select class="form-control" id="editWidgetGeolocationWidgets" name="editWidgetGeolocationWidgets"></select>');

                                       var widgetId, widgetTitle = null;
                                       var widgetsNumber = 0;
                                       
                                       //JSON degli eventi da mostrare su ogni widget target di questo widget events
                                       var targetEventsJson = currentParams;
                                       $("#parametersM").val(JSON.stringify(targetEventsJson));

                                       $("li.gs_w").each(function()
                                       {
                                          if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                          {
                                             widgetId = $(this).attr("id");
                                             widgetTitle = $(this).find("div.titleDiv").html();
                                             newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                             widgetsNumber++;
                                          }
                                       });

                                       if(widgetsNumber > 0)
                                       {
                                          newInnerDiv.append(newSelect);
                                       }
                                       else
                                       {
                                          newInnerDiv.append("None");
                                       }

                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel.show();
                                       newInnerDiv.show();

                                       if(widgetsNumber > 0)
                                       {
                                          newSelect.show();
                                          newSelect.val(-1);
                                          newLabel = $('<label for="editWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                          newInnerDiv = $('<div class="col-md-3"></div>');
                                          var eventTypeSelect = $('<select name="editWidgetEventTypes" class="form-control" id="editWidgetEventTypes" multiple></select>');
                                          
                                          for(var key in alarmTypes)
                                          {
                                             eventTypeSelect.append('<option value="' + key + '">' + alarmTypes[key].desc + '</option>');
                                          }
                                          
                                          eventTypeSelect.val(-1);
                                          newFormRow.append(newLabel);
                                          newInnerDiv.append(eventTypeSelect);
                                          newFormRow.append(newInnerDiv);
                                          newLabel.hide();
                                          newInnerDiv.hide();

                                          $('#editWidgetEventTypes').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });

                                          $('#editWidgetEventTypes').on('changed.bs.select', function (e) 
                                          {
                                             if($(this).val() === null)
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = [];
                                             }
                                             else
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = $(this).val();
                                             }
                                             $("#parametersM").val(JSON.stringify(targetEventsJson));
                                          });

                                          $("#editWidgetGeolocationWidgets").change(function(){
                                             newLabel.show();
                                             newInnerDiv.show();
                                             $('#editWidgetEventTypes').selectpicker('val', targetEventsJson[$("#editWidgetGeolocationWidgets").val()]);
                                          });
                                       }
                                       break;
                                   
                                    case "widgetTrafficEvents":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                       
                                       //Parametri specifici del widget
                                       $('#specificParamsM .row').remove();
                                       var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                    
                                       //Nuova riga
                                       newFormRow = $('<div class="row"></div>');
                                       $("#specificParamsM").append(newFormRow);

                                       newLabel = $('<label for="editWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select class="form-control" id="editWidgetGeolocationWidgets" name="editWidgetGeolocationWidgets"></select>');

                                       var widgetId, widgetTitle = null;
                                       var widgetsNumber = 0;
                                       
                                       //JSON degli eventi da mostrare su ogni widget target di questo widget events
                                       var targetEventsJson = currentParams;
                                       $("#parametersM").val(JSON.stringify(targetEventsJson));

                                       $("li.gs_w").each(function()
                                       {
                                          if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                          {
                                             widgetId = $(this).attr("id");
                                             widgetTitle = $(this).find("div.titleDiv").html();
                                             newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                             widgetsNumber++;
                                          }
                                       });

                                       if(widgetsNumber > 0)
                                       {
                                          newInnerDiv.append(newSelect);
                                       }
                                       else
                                       {
                                          newInnerDiv.append("None");
                                       }

                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel.show();
                                       newInnerDiv.show();

                                       if(widgetsNumber > 0)
                                       {
                                          newSelect.show();
                                          newSelect.val(-1);
                                          newLabel = $('<label for="editWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                          newInnerDiv = $('<div class="col-md-3"></div>');
                                          var eventTypeSelect = $('<select name="editWidgetEventTypes" class="form-control" id="editWidgetEventTypes" multiple></select>');
                                          
                                          for(var key in trafficEventTypes)
                                          {
                                             eventTypeNum = key.replace("type", "");
                                             eventTypeSelect.append('<option value="' + eventTypeNum + '">' + trafficEventTypes[key].desc + '</option>');
                                          }
                                          
                                          eventTypeSelect.val(-1);
                                          newFormRow.append(newLabel);
                                          newInnerDiv.append(eventTypeSelect);
                                          newFormRow.append(newInnerDiv);
                                          newLabel.hide();
                                          newInnerDiv.hide();

                                          $('#editWidgetEventTypes').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });

                                          $('#editWidgetEventTypes').on('changed.bs.select', function (e) 
                                          {
                                             if($(this).val() === null)
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = [];
                                             }
                                             else
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = $(this).val();
                                             }
                                             $("#parametersM").val(JSON.stringify(targetEventsJson));
                                          });

                                          $("#editWidgetGeolocationWidgets").change(function(){
                                             newLabel.show();
                                             newInnerDiv.show();
                                             $('#editWidgetEventTypes').selectpicker('val', targetEventsJson[$("#editWidgetGeolocationWidgets").val()]);
                                          });
                                       }
                                       break;
         
         
                                    case "widgetFirstAid":
                                       var series = JSON.parse(data['lastSeries']);
                                      
                                       var thrTables1 = new Array();
                                       var thrTables2 = new Array();
                                       var i, j, k, min, max, color, newTableRow, newTableCell, currentFieldIndex, currentSeriesIndex, thrSeries, newFormRow, 
                                           newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer, newSeries = null;
                                        
                                       //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                       setGlobals(currentParams, thrTables1, thrTables2, series, $('#select-widget-m').val());
                                        
                                       //Costruzione THRTables dai parametri provenienti da DB (vuote se non ci sono soglie per quel campo, anche nel caso di nessuna soglia settata in assoluto
                                       buildThrTablesForEditWidget();
                                        
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                        
                                       showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, series, infoJson, data['info_mess']);
                                        
                                       if(styleParamsRaw !== null) 
                                       {
                                          styleParameters = JSON.parse(styleParamsRaw);
                                       } 
                                      
                                       $('#link_help_modal-add-widget-m').css("display", "");
                                       $('#inputComuneWidgetM').attr('disabled', true);
                                       $("label[for='inputTitleWidgetM']").html("Title");
                                       $("label[for='inputColorWidgetM']").html("Background color");
                                       $('#inputTitleWidgetM').attr('disabled', false);
                                       $('#select-frameColor-Widget-m').attr('disabled', false);
                                       $('#select-frameColor-Widget-m').prop('required', true);
                                       $('#select-IntTemp-Widget-m').attr('disabled', true);
                                       $('#select-IntTemp-Widget-m').prop('required', false);
                                       $('#inputFreqWidgetM').prop('disabled', false);
                                       $("#urlWidgetM").prop('disabled', false);
                                       $('#inputFontSizeM').prop('required', true);
                                       $('#inputFontSizeM').prop('disabled', false);
                                       $('#inputFontColorM').prop('required', true);
                                       $('#inputFontColorM').prop('disabled', false);
                                       $('#urlWidgetM').attr('disabled', false);
                                       $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                       $('#inputHeaderFontColorWidgetM').prop('required', true);
                                       $('#inputUdmWidgetM').prop("required", false);
                                       $('#inputUdmWidgetM').attr("disabled", true);
                                       $('#inputUdmWidgetM').val("");
                                       $('#inputUdmPositionM').prop("required", false);
                                       $('#inputUdmPositionM').attr("disabled", true);
                                       $('#inputUdmPositionM').val(-1);
                                       $('#inputFirstAidRowM').show();
                                        
                                       removeWidgetProcessGeneralFields("editWidget");
                                        
                                       //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                       $('#specificParamsM .row').remove();
                                        
                                       //Visualizzazione campi specifici per questo widget
                                        
                                       //Nuova riga
                                       newFormRow = $('<div class="row"></div>');
                                       $("#specificParamsM").append(newFormRow);

                                       newLabel = $('<label for="editWidgetFirstAidMode" class="col-md-2 control-label">Visualization mode</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select class="form-control" id="editWidgetFirstAidMode" name="editWidgetFirstAidMode" required></select>');
                                       newSelect.append('<option value="singleSummary">Single hospital - Totals only</option>');
                                       newSelect.append('<option value="singleDetails">Single hospital - Details</option>');
                                       newSelect.append('<option value="hospitalsOverview">Multiple hospitals overview</option>');
                                       newSelect.val(viewMode);
                                       newInnerDiv.append(newSelect);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.show();
                                       newInnerDiv.show();
                                       newSelect.show();

                                       var hospitalSelect = '<label for="editWidgetFirstAidHospital" class="col-md-2 control-label">First aid</label>' +
                                       '<div class="col-md-3">' +
                                           '<div class="input-group">' +
                                               '<select id="editWidgetFirstAidHospital" name="editWidgetFirstAidHospital" class="form-control">' + 
                                               '</select>' +
                                           '</div>' +
                                       '</div>';

                                       var multipleHospitalSelect = '<label for="editWidgetFirstAidHospitals" class="col-md-2 control-label">First aids</label>' +
                                               '<div class="col-md-3">' +
                                                   '<div class="input-group">' +
                                                       '<select name="editWidgetFirstAidHospitals" class="form-control" id="editWidgetFirstAidHospitals" multiple>' + 
                                                       '</select>' +
                                                   '</div>' +
                                               '</div>';
                                       
                                       newFormRow.append(hospitalSelect);
                                       newFormRow.append(multipleHospitalSelect);
                                       
                                       $('label[for=editWidgetFirstAidHospital]').hide();
                                       $('#editWidgetFirstAidHospital').parent().parent().hide();
                                       $('label[for=editWidgetFirstAidHospitals]').hide();
                                       $('#editWidgetFirstAidHospitals').parent().parent().hide();

                                       var hospitalName, hospitalUrl = null;

                                       for(var i = 0; i < hospitalList.Services.features.length; i++)
                                       {
                                          hospitalName = hospitalList.Services.features[i].properties.name;
                                          hospitalUrl = hospitalList.Services.features[i].properties.serviceUri;
                                          
                                          hospitalName = hospitalName.replace("PRONTO SOCCORSO", "PS");
                                          hospitalName = hospitalName.replace("PRIMO INTERVENTO", "PI");
                                          hospitalName = hospitalName.replace("AZIENDA OSPEDALIERA", "AO");
                                          hospitalName = hospitalName.replace("PRESIDIO OSPEDALIERO", "PO");
                                          hospitalName = hospitalName.replace("ISTITUTO DI PUBBLICA ASSISTENZA", "IPA");
                                          hospitalName = hospitalName.replace("ASSOCIAZIONE DI PUBBLICA ASSISTENZA", "APA");
                                          hospitalName = hospitalName.replace("OSPEDALE DI", "");
                                          hospitalName = hospitalName.replace("OSPEDALE DEL", "");
                                          hospitalName = hospitalName.replace("OSPEDALE DELL'", "");
                                          hospitalName = hospitalName.replace("OSPEDALE DELLA", "");
                                          hospitalName = hospitalName.replace("DELL'OSPEDALE", "");
                                          hospitalName = hospitalName.replace("OSPEDALE", "");
                                          hospitalName = hospitalName.replace("ITALIANA", "");
                                          
                                          if($("#editWidgetFirstAidHospital").find('option[value="' + hospitalUrl + '"]').length <= 0)
                                          {
                                             $("#editWidgetFirstAidHospital").append('<option value="' + hospitalUrl + '">' + hospitalName + '</option>');
                                          }
                                          
                                          if($("#editWidgetFirstAidHospitals").find('option[value="' + hospitalUrl + '"]').length <= 0)
                                          {
                                             $("#editWidgetFirstAidHospitals").append('<option value="' + hospitalUrl + '">' + hospitalName + '</option>');
                                          }
                                       }
                                       
                                       if((viewMode === 'singleSummary')||(viewMode === 'singleDetails'))
                                       {
                                          $('label[for=editWidgetFirstAidHospital]').show();
                                          $('#editWidgetFirstAidHospital').parent().parent().show(); 
                                          $('#editWidgetFirstAidHospital').attr("disabled", false);
                                          $('#editWidgetFirstAidHospital').prop("required", true);
                                          $('#editWidgetFirstAidHospital').val(serviceUri);
                                          $("#serviceUriM").val(serviceUri);
                                          $("#hospitalListM").val("");
                                          $("#editWidgetFirstAidHospital").change(function()
                                          {
                                             $("#serviceUriM").val($(this).val());
                                          });
                                       }
                                       else
                                       {
                                          var selectedHospitals = JSON.parse(data['hospitalList']);
                                          $("#serviceUriM").val("");
                                          $("#hospitalListM").val(data['hospitalList']);
                                          $('label[for=editWidgetFirstAidHospitals]').show();
                                          $('#editWidgetFirstAidHospitals').parent().parent().show();
                                          $('#editWidgetFirstAidHospitals').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });
                                          $('#editWidgetFirstAidHospitals').selectpicker('val', selectedHospitals);
                                          
                                          $('#editWidgetFirstAidHospitals').on('changed.bs.select', function (e) {
                                             $("#hospitalListM").val(JSON.stringify($(this).val()));
                                             var labelsString = $('button[data-id="editWidgetFirstAidHospitals"] span').eq(0).html().replace(/  /g, " ");
                                                   
                                             var localInfoJson = {
                                                "firstAxis":
                                                {
                                                   "Red_code":"",
                                                   "Yellow_code":"",
                                                   "Green_code":"",
                                                   "Blue_code":"",
                                                   "White_code":""
                                                },
                                                "secondAxis": {}
                                             };

                                             var localSeries = {  
                                                "firstAxis":{  
                                                   "desc":"Priority",
                                                   "labels":[  
                                                      "Red code",
                                                      "Yellow code",
                                                      "Green code",
                                                      "Blue code",
                                                      "White code"
                                                   ]
                                                },
                                                "secondAxis":{  
                                                   "desc":"Hospital",
                                                   "labels":[],
                                                   "series":[]
                                                }
                                             };

                                             if(labelsString !== "Nothing selected")
                                             {
                                                var labels = labelsString.split(", ");
                                                var infoLabel = null;

                                                for(var i = 0; i < labels.length; i++)
                                                {
                                                   localSeries.secondAxis.labels[i] = labels[i];
                                                }

                                                for(var j = 0; j < localSeries.secondAxis.labels.length; j++)
                                                {
                                                   infoLabel = localSeries.secondAxis.labels[j].replace(/ /g, "_");
                                                   infoJson.secondAxis[infoLabel] = "";
                                                }
                                             }

                                             showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, localSeries, localInfoJson, data['info_mess']);
                                          });
                                       }
                                       
                                       $("#editWidgetFirstAidMode").change(function()
                                       {
                                          $("#infoMainSelectM").val(-1);
                                          $("#widgetInfoCkEditorTitleM").empty();
                                          $("#widgetInfoCkEditorTitleM").hide();
                                          
                                          switch($(this).val())
                                          {
                                             case "singleSummary": 
                                                $('label[for=editWidgetFirstAidHospitals]').hide();
                                                $('#editWidgetFirstAidHospitals').parent().parent().hide();
                                                $('label[for=editWidgetFirstAidHospital]').show();
                                                $('#editWidgetFirstAidHospital').parent().parent().show();
                                                
                                                $('#editWidgetFirstAidHospital').val(-1);
                                                $("#hospitalListM").val("");
                                                
                                                $("#editWidgetFirstAidHospital").change(function()
                                                {
                                                   $("#serviceUriM").val($(this).val());
                                                });
                                                   
                                                newSeries = {  
                                                   "firstAxis":{  
                                                      "desc":"Priority",
                                                      "labels":[  
                                                         "Red code",
                                                         "Yellow code",
                                                         "Green code",
                                                         "Blue code",
                                                         "White code"
                                                      ]
                                                   },
                                                   "secondAxis":{  
                                                      "desc":"Status",
                                                      "labels":[  
                                                         "Totals"
                                                      ],
                                                      "series":[]
                                                   }
                                                };
                                                
                                                infoJson = {
                                                   "firstAxis":
                                                   {
                                                      "Red_code":"",
                                                      "Yellow_code":"",
                                                      "Green_code":"",
                                                      "Blue_code":"",
                                                      "White_code":""
                                                   },
                                                   "secondAxis":
                                                   {
                                                      "Totals":""
                                                   }
                                                };
                                                
                                                showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, newSeries, infoJson, data['info_mess']);

                                                $('label[for="alrAxisSelM"]').hide();
                                                $("#alrAxisSelM").hide();
                                                $('label[for="alrFieldSelM"]').hide();
                                                $("#alrFieldSelM").hide();
                                                $("#alrAxisSelM").empty();
                                                $("#alrAxisSelM").append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                                $("#alrAxisSelM").val(-1);
                                                $("#addWidgetRangeTableContainerM").hide();
                                                $("#alrThrSelM").attr("disabled", false);
                                                $("#alrThrSelM").prop("required", true);
                                                $("#alrThrSelM").val("no");
                                                
                                                $("#showTableFirstCellM").val(-1);
                                                $("#showTableFirstCellM").prop("required", false);
                                                $("#showTableFirstCellM").attr("disabled", true);

                                                $("#tableFirstCellFontSizeM").val("");
                                                $("#tableFirstCellFontSizeM").prop("required", false);
                                                $("#tableFirstCellFontSizeM").attr("disabled", true);	

                                                $("#widgetFirstCellFontColorM").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                                $("#tableFirstCellFontColorM").val("");
                                                $("#tableFirstCellFontColorM").prop("required", false);
                                                $("#tableFirstCellFontColorM").attr("disabled", true);	

                                                $("#rowsLabelsFontSizeM").val("");
                                                $("#rowsLabelsFontSizeM").prop("required", false);
                                                $("#rowsLabelsFontSizeM").attr("disabled", true);	

                                                $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                                $("#rowsLabelsFontColorM").val("");
                                                $("#rowsLabelsFontColorM").prop("required", false);
                                                $("#rowsLabelsFontColorM").attr("disabled", true);

                                                $("#widgetRowsLabelsBckColorM").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                                $("#rowsLabelsBckColorM").val("");
                                                $("#rowsLabelsBckColorM").attr("disabled", true);
                                                break;

                                             case "singleDetails":
                                                $('label[for=editWidgetFirstAidHospitals]').hide();
                                                $('#editWidgetFirstAidHospitals').parent().parent().hide();
                                                $('label[for=editWidgetFirstAidHospital]').show();
                                                $('#editWidgetFirstAidHospital').parent().parent().show();

                                                $('#editWidgetFirstAidHospital').val(-1);
                                                $("#hospitalListM").val("");

                                                $("#editWidgetFirstAidHospital").change(function()
                                                {
                                                   $("#serviceUriM").val($(this).val());
                                                });

                                                newSeries = {  
                                                   "firstAxis":{  
                                                      "desc":"Priority",
                                                      "labels":[  
                                                         "Red code",
                                                         "Yellow code",
                                                         "Green code",
                                                         "Blue code",
                                                         "White code"
                                                      ]
                                                   },
                                                   "secondAxis":{  
                                                      "desc":"Status",
                                                      "labels":[  
                                                         "Addressed",
                                                         "Waiting",
                                                         "In visit",
                                                         "In observation",
                                                         "Totals"
                                                      ],
                                                      "series":[]
                                                   }
                                                };
                                                
                                                infoJson = {
                                                   "firstAxis":
                                                    {
                                                       "Red_code":"",
                                                       "Yellow_code":"",
                                                       "Green_code":"",
                                                       "Blue_code":"",
                                                       "White_code":""
                                                    },
                                                    "secondAxis":
                                                    {
                                                       "Addressed":"",
                                                       "Waiting":"",
                                                       "In_visit":"",
                                                       "In_observation":"",
                                                       "Totals":""
                                                    }
                                                };
                                                
                                                showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, newSeries, infoJson, data['info_mess']);

                                                $('label[for="alrAxisSelM"]').hide();
                                                $("#alrAxisSelM").hide();
                                                $('label[for="alrFieldSelM"]').hide();
                                                $("#alrFieldSelM").hide();
                                                $("#alrAxisSelM").empty();
                                                $("#alrAxisSelM").append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                                //$("#alrAxisSelM").append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                                $("#alrAxisSelM").val(-1);
                                                $("#addWidgetRangeTableContainerM").hide();
                                                $("#alrThrSelM").attr("disabled", false);
                                                $("#alrThrSelM").prop("required", true);
                                                $("#alrThrSelM").val("no");
                                                
                                                $("#showTableFirstCellM").val(-1);
                                                $("#showTableFirstCellM").prop("required", false);
                                                $("#showTableFirstCellM").attr("disabled", true);

                                                $("#tableFirstCellFontSizeM").val("10");
                                                $("#tableFirstCellFontSizeM").prop("required", true);
                                                $("#tableFirstCellFontSizeM").attr("disabled", false);	

                                                $("#widgetFirstCellFontColorM").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#tableFirstCellFontColorM").val("#000000");
                                                $("#tableFirstCellFontColorM").prop("required", true);
                                                $("#tableFirstCellFontColorM").attr("disabled", false);	

                                                $("#rowsLabelsFontSizeM").val("10");
                                                $("#rowsLabelsFontSizeM").prop("required", true);
                                                $("#rowsLabelsFontSizeM").attr("disabled", false);	

                                                $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#rowsLabelsFontColorM").val("#000000");
                                                $("#rowsLabelsFontColorM").prop("required", true);
                                                $("#rowsLabelsFontColorM").attr("disabled", false);

                                                $("#widgetRowsLabelsBckColorM").parent().parent().parent().colorpicker("setValue","#FFFFFF");
                                                $("#rowsLabelsBckColorM").val("#FFFFFF");
                                                $("#rowsLabelsBckColorM").prop("required", true);
                                                $("#rowsLabelsBckColorM").attr("disabled", false);
                                                break;      

                                             case "hospitalsOverview":
                                                $('label[for=editWidgetFirstAidHospital]').hide();
                                                $('#editWidgetFirstAidHospital').parent().parent().hide();
                                                $('label[for=editWidgetFirstAidHospitals]').show();
                                                $('#editWidgetFirstAidHospitals').parent().parent().show();
                                                $('#editWidgetFirstAidHospitals').selectpicker('deselectAll');
                                                $('#editWidgetFirstAidHospitals').selectpicker('destroy');
                                                $('#editWidgetFirstAidHospitals').selectpicker({
                                                   actionsBox: true, 
                                                   width: "auto"
                                                });

                                                newSeries = {  
                                                   "firstAxis":{  
                                                      "desc":"Priority",
                                                      "labels":[  
                                                         "Red code",
                                                         "Yellow code",
                                                         "Green code",
                                                         "Blue code",
                                                         "White code"
                                                      ]
                                                   },
                                                   "secondAxis":{  
                                                      "desc":"Hospital",
                                                      "labels":[],
                                                      "series":[]
                                                   }
                                                };
                                                
                                                infoJson = {
                                                   "firstAxis":
                                                   {
                                                      "Red_code":"",
                                                      "Yellow_code":"",
                                                      "Green_code":"",
                                                      "Blue_code":"",
                                                      "White_code":""
                                                   },
                                                   "secondAxis": {}
                                                };

                                                $("#serviceUriM").val("");

                                                $('#editWidgetFirstAidHospitals').off('changed.bs.select');
                                                $('#editWidgetFirstAidHospitals').on('changed.bs.select', function (e) 
                                                {
                                                   $("#hospitalListM").val(JSON.stringify($(this).val()));
                                                   
                                                   var labelsString = $('button[data-id="editWidgetFirstAidHospitals"] span').eq(0).html().replace(/  /g, " ");
                                                   
                                                   infoJson = {
                                                      "firstAxis":
                                                      {
                                                         "Red_code":"",
                                                         "Yellow_code":"",
                                                         "Green_code":"",
                                                         "Blue_code":"",
                                                         "White_code":""
                                                      },
                                                      "secondAxis": {}
                                                   };
                                                   
                                                   var localSeries = {  
                                                      "firstAxis":{  
                                                         "desc":"Priority",
                                                         "labels":[  
                                                            "Red code",
                                                            "Yellow code",
                                                            "Green code",
                                                            "Blue code",
                                                            "White code"
                                                         ]
                                                      },
                                                      "secondAxis":{  
                                                         "desc":"Hospital",
                                                         "labels":[],
                                                         "series":[]
                                                      }
                                                   };
                                                   
                                                   if(labelsString !== "Nothing selected")
                                                   {
                                                      var labels = labelsString.split(", ");
                                                      var infoLabel = null;

                                                      for(var i = 0; i < labels.length; i++)
                                                      {
                                                         localSeries.secondAxis.labels[i] = labels[i];
                                                      }

                                                      for(var j = 0; j < localSeries.secondAxis.labels.length; j++)
                                                      {
                                                         infoLabel = localSeries.secondAxis.labels[j].replace(/ /g, "_");
                                                         infoJson.secondAxis[infoLabel] = "";
                                                      }
                                                   }
                                                   
                                                   showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, localSeries, infoJson, data['info_mess']);
                                                });
                                                
                                                showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, newSeries, infoJson, data['info_mess']);

                                                $('label[for="alrAxisSelM"]').hide();
                                                $("#alrAxisSelM").hide();
                                                $('label[for="alrFieldSelM"]').hide();
                                                $("#alrFieldSelM").hide();
                                                $("#alrAxisSelM").empty();
                                                $("#alrAxisSelM").append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                                $("#alrAxisSelM").append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                                $("#alrAxisSelM").val(-1);
                                                $("#addWidgetRangeTableContainerM").hide();
                                                $("#alrThrSelM").val("no");
                                                $("#alrThrSelM").attr("disabled", true);
                                                $("#alrThrSelM").prop("required", false);

                                                $("#showTableFirstCellM").val(-1);
                                                $("#showTableFirstCellM").prop("required", false);
                                                $("#showTableFirstCellM").attr("disabled", true);

                                                $("#tableFirstCellFontSizeM").val("10");
                                                $("#tableFirstCellFontSizeM").prop("required", true);
                                                $("#tableFirstCellFontSizeM").attr("disabled", false);	

                                                $("#widgetFirstCellFontColorM").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#tableFirstCellFontColorM").val("#000000");
                                                $("#tableFirstCellFontColorM").prop("required", true);
                                                $("#tableFirstCellFontColorM").attr("disabled", false);	

                                                $("#rowsLabelsFontSizeM").val("10");
                                                $("#rowsLabelsFontSizeM").prop("required", true);
                                                $("#rowsLabelsFontSizeM").attr("disabled", false);	

                                                $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker("setValue","#000000");
                                                $("#rowsLabelsFontColorM").val("#000000");
                                                $("#rowsLabelsFontColorM").prop("required", true);
                                                $("#rowsLabelsFontColorM").attr("disabled", false);

                                                $("#widgetRowsLabelsBckColorM").parent().parent().parent().colorpicker("setValue","#FFFFFF");
                                                $("#rowsLabelsBckColorM").val("#FFFFFF");
                                                $("#rowsLabelsBckColorM").prop("required", true);
                                                $("#rowsLabelsBckColorM").attr("disabled", false);
                                                break;
                                          }
                                          
                                          //Distruzione thr tables pregresse
                                          thrTables1 = new Array();
                                          thrTables2 = new Array();

                                          //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                          setGlobals(null, thrTables1, thrTables2, newSeries, $('#select-widget-m').val());

                                          //Costruzione THRTables vuote
                                          buildEmptyThrTables();
                                       });
 
                                        //Nuova riga
                                        //Select show first cell
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="showTableFirstCellM" class="col-md-2 control-label">Show first cell</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="showTableFirstCellM" name="showTableFirstCellM" required></select>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        if(viewMode === 'singleSummary')
                                        {
                                           $("#showTableFirstCellM").val(-1);
                                           $("#showTableFirstCellM").prop("required", false);
                                           $("#showTableFirstCellM").attr("disabled", true);
                                        }
                                        
                                        //First cell font size
                                        //Nuova riga
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="tableFirstCellFontSizeM" class="col-md-2 control-label">First cell font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="tableFirstCellFontSizeM" name="tableFirstCellFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();
                                        if(viewMode === 'singleSummary')
                                        {
                                           $("#tableFirstCellFontSizeM").val("");
                                           $("#tableFirstCellFontSizeM").prop("required", false);
                                           $("#tableFirstCellFontSizeM").attr("disabled", true);
                                        }
                                        
                                        //First cell font color
                                        newLabel = $('<label for="tableFirstCellFontColorM" class="col-md-2 control-label">First cell font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="tableFirstCellFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableFirstCellFontColorM" name="tableFirstCellFontColorM" required><span class="input-group-addon"><i id="widgetFirstCellFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#tableFirstCellFontColorContainerM').show();
                                        $('#tableFirstCellFontColorM').show();
                                        $("#widgetFirstCellFontColorM").css('display', 'block');
                                        $("#widgetFirstCellFontColorM").parent().parent().parent().colorpicker({color: styleParameters.tableFirstCellFontColor, format: "rgba"});
                                        if(viewMode === 'singleSummary')
                                        {
                                           $("#widgetFirstCellFontColorM").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                           $("#tableFirstCellFontColorM").val("");
                                           $("#tableFirstCellFontColorM").prop("required", false);
                                           $("#tableFirstCellFontColorM").attr("disabled", true);
                                        }
                                        
                                        //Nuova riga
                                        //Rows labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="rowsLabelsFontSizeM" class="col-md-2 control-label">Rows labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSizeM" name="rowsLabelsFontSizeM" required> ');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();
                                        if(viewMode === 'singleSummary')
                                        {
                                           $("#rowsLabelsFontSizeM").val("");
                                           $("#rowsLabelsFontSizeM").prop("required", false);
                                           $("#rowsLabelsFontSizeM").attr("disabled", true);
                                        }

                                        //Rows labels font color
                                        newLabel = $('<label for="rowsLabelsFontColorM" class="col-md-2 control-label">Rows labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="rowsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColorM" name="rowsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#rowsLabelsFontColorContainerM').show();
                                        $('#rowsLabelsFontColorM').show();
                                        $("#widgetRowsLabelsFontColorM").css('display', 'block');
                                        $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});
                                        if(viewMode === 'singleSummary')
                                        {
                                           $("#rowsLabelsFontColorM").val("");
                                           $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                           $("#rowsLabelsFontColorM").val("");
                                           $("#rowsLabelsFontColorM").prop("required", false);
                                           $("#rowsLabelsFontColorM").attr("disabled", true);
                                        }

                                        //Nuova riga
                                        //Cols labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="colsLabelsFontSizeM" class="col-md-2 control-label">Cols labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="colsLabelsFontSizeM" name="colsLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Cols labels font color
                                        newLabel = $('<label for="colsLabelsFontColorM" class="col-md-2 control-label">Cols labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="colsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColorM" name="colsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetColsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#colsLabelsFontColorContainerM').show();
                                        $('#colsLabelsFontColorM').show();
                                        $("#widgetColsLabelsFontColorM").css('display', 'block');
                                        $("#widgetColsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                    
                                        //Nuova riga
                                        //Rows labels background color
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="rowsLabelsBckColorM" class="col-md-2 control-label">Rows labels background color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="rowsLabelsBckColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsBckColorM" name="rowsLabelsBckColorM" required><span class="input-group-addon"><i id="widgetRowsLabelsBckColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#rowsLabelsBckColorContainerM').show();
                                        $('#rowsLabelsBckColorM').show();
                                        $("#widgetRowsLabelsBckColorM").css('display', 'block');
                                        $("#widgetRowsLabelsBckColorM").parent().parent().parent().colorpicker({color: styleParameters.rowsLabelsBckColor, format: "rgba"});
                                        if(viewMode === 'singleSummary')
                                        {
                                           $("#widgetRowsLabelsBckColorM").parent().parent().parent().colorpicker("setValue","#eeeeee");
                                           $("#rowsLabelsBckColorM").val("");
                                           $("#rowsLabelsBckColorM").prop("required", false);
                                           $("#rowsLabelsBckColorM").attr("disabled", true);	
                                        }
                                        
                                        //Nuova riga
                                        //Table borders
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="tableBordersM" class="col-md-2 control-label">Table borders</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="tableBordersM" name="tableBordersM"></select>');
                                        newSelect.append('<option value="no">No borders</option>');
                                        newSelect.append('<option value="horizontal">Horizontal borders only</option>');
                                        newSelect.append('<option value="all">All borders</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //Table borders color
                                        newLabel = $('<label for="tableBordersColorM" class="col-md-2 control-label">Table borders color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="tableBordersColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableBordersColorM" name="tableBordersColorM" required><span class="input-group-addon"><i id="widgetTableBordersColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#tableBordersColorContainerM').show();
                                        $('#tableBordersColorM').show();
                                        $("#widgetTableBordersColorM").css('display', 'block');
                                        $("#widgetTableBordersColorM").parent().parent().parent().colorpicker({color: styleParameters.tableBordersColor, format: "rgba"});

                                        if(styleParamsRaw !== null) 
                                        {
                                            $("#showTableFirstCellM").val(styleParameters.showTableFirstCell);
                                            $("#tableFirstCellFontSizeM").val(styleParameters.tableFirstCellFontSize);
                                            $("#tableFirstCellFontColorM").val(styleParameters.tableFirstCellFontColor);
                                            $("#widgetFirstCellFontColorM").css("background-color", styleParameters.tableFirstCellFontColor);
                                            $("#rowsLabelsFontSizeM").val(styleParameters.rowsLabelsFontSize);
                                            $("#rowsLabelsFontColorM").val(styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").css("background-color", styleParameters.rowsLabelsFontColor);
                                            $("#colsLabelsFontSizeM").val(styleParameters.colsLabelsFontSize);
                                            $("#colsLabelsFontColorM").val(styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").css("background-color", styleParameters.colsLabelsFontColor);
                                            $("#rowsLabelsBckColorM").val(styleParameters.rowsLabelsBckColor);
                                            $("#widgetRowsLabelsBckColorM").css("background-color", styleParameters.rowsLabelsBckColor);
                                            $("#colsLabelsBckColorM").val(styleParameters.colsLabelsBckColor);
                                            $("#widgetColsLabelsBckColorM").css("background-color", styleParameters.colsLabelsBckColor);
                                            $("#tableBordersM").val(styleParameters.tableBorders);
                                            $("#tableBordersColorM").val(styleParameters.tableBordersColor);
                                            $("#widgetTableBordersColorM").css("background-color", styleParameters.tableBordersColor);
                                        }
                                        
                                        //Nuova riga
                                        //Set thresholds
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrThrSelM" class="col-md-2 control-label">Set thresholds</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrThrSelM" name="alrThrSelM" required>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        if(viewMode === 'hospitalsOverview')
                                        {
                                          $("#alrThrSelM").val("no");
                                          $("#alrThrSelM").attr("disabled", true);
                                          $("#alrThrSelM").prop("required", false);
                                        }
                                        else
                                        {
                                           $("#alrThrSelM").attr("disabled", false);
                                           $("#alrThrSelM").prop("required", true);
                                           if(currentParams === null)
                                           {
                                              $('#alrThrSelM').val("no");
                                              $("label[for='alrAxisSelM']").hide();
                                              $('#alrAxisSelM').val(-1);
                                              $('#alrAxisSelM').hide();
                                              $('#parametersM').val('');
                                           }
                                           else
                                           {
                                              //ESPOSIZIONE DEI CAMPI
                                              $('#alrThrSelM').val("yes");
                                              $('#alrAxisSelM').val(currentParams.thresholdObject.target);
                                              $("label[for='alrAxisSelM']").show();
                                              $('#alrAxisSelM').parent().show();
                                              $('#alrAxisSelM').show();
                                              $('#alrAxisSelM').change(alrAxisSelMListener);
                                              $("label[for='alrFieldSelM']").show();
                                              $('#alrFieldSelM').parent().show();
                                              $('#alrFieldSelM').show();
                                              //POPOLAMENTO DELLA SELECT DEI CAMPI
                                              $('#alrAxisSelM').trigger("change");
                                              $('#alrFieldSelM').change(alrFieldSelMListener);
                                              $('#addWidgetRangeTableContainerM').show();
                                              $('#parametersM').val(JSON.stringify(currentParams));
                                           }
                                        }
                                        
                                        //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                        $('#alrThrSelM').change(alrThrFlagMListener);
                                        
                                        //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                        newLabel = $('<label for="alrAxisSelM" class="col-md-2 control-label">Thresholds target set</label>');
                                        newSelect = $('<select class="form-control" id="alrAxisSelM" name="alrAxisSelM"></select>');
                                        newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        if((viewMode !== 'singleSummary') && (viewMode !== 'singleDetails'))
                                        {
                                           newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                        }
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Nuova riga
                                        //Threshold field select
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrFieldSelM" class="col-md-2 control-label">Thresholds target field</label>');
                                        newSelect = $('<select class="form-control" id="alrFieldSelM" name="alrFieldSelM">');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Contenitore per tabella delle soglie
                                        addWidgetRangeTableContainerM = $('<div id="addWidgetRangeTableContainerM" class="row rowCenterContent"></div>');
                                        $("#specificParamsM").append(addWidgetRangeTableContainerM);
                                        addWidgetRangeTableContainerM.hide();
                                        
                                        if(currentParams === null)
                                        {
                                            $('#alrThrSelM').val("no");
                                            $("label[for='alrAxisSelM']").hide();
                                            $('#alrAxisSelM').val(-1);
                                            $('#alrAxisSelM').hide();
                                            $('#parametersM').val('');
                                        }
                                        else
                                        {
                                            //ESPOSIZIONE DEI CAMPI
                                            $('#alrThrSelM').val("yes");
                                            $('#alrAxisSelM').val(currentParams.thresholdObject.target);
                                            $("label[for='alrAxisSelM']").show();
                                            $('#alrAxisSelM').parent().show();
                                            $('#alrAxisSelM').show();
                                            $('#alrAxisSelM').change(alrAxisSelMListener);
                                            $("label[for='alrFieldSelM']").show();
                                            $('#alrFieldSelM').parent().show();
                                            $('#alrFieldSelM').show();
                                            //POPOLAMENTO DELLA SELECT DEI CAMPI
                                            $('#alrAxisSelM').trigger("change");
                                            $('#alrFieldSelM').change(alrFieldSelMListener);
                                            $('#addWidgetRangeTableContainerM').show();
                                            $('#parametersM').val(JSON.stringify(currentParams));
                                        }
                                       break;
         
                                    case "widgetRadarSeries":
                                        var metricId = $('#metricWidgetM').val();
                                        var metricData = getMetricData(metricId);
                                        var seriesString = metricData.data[0].commit.author.series;
                                        var series = jQuery.parseJSON(seriesString);
                                        var thrSeries, i, j, k, min, max, color, newTableRow, newTableCell, currentFieldIndex, currentSeriesIndex, colorsTable, newRow, 
                                            newCell, newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer, 
                                            barsColorsTableContainerM, index, newThrObj, fieldName, descName = null;
                                        var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                        var colorsArray = new Array();
                                        
                                        //Costruzione THRTable
                                        var thrTable = $("<table class='thrRangeTableRadar table table-bordered'></table>"); 
                                        
                                        //Costruzione intestazione tabella
                                        firstRow = $('<tr></tr>');
                                        cell = $('<td><a href="#"><i class="fa fa-plus" style="font-size:24px;color:#337ab7"></i></a></td>');
                                        cell.find('i.fa-plus').click(addThrRangeRadarM);
                                        firstRow.append(cell);
                                        cell = $('<td class="colorHeader">Color</td>'); 
                                        firstRow.append(cell);
                                        cell = $('<td><span style="display: block; width: 75px">Short description</span></td>');
                                        firstRow.append(cell);
                                        thrTable.append(firstRow);
                                        
                                        for(var i in series.firstAxis.labels)
                                        {
                                            if(series.firstAxis.labels[i].length > 8)
                                            {
                                                descName = series.firstAxis.labels[i].substr(0,8) + "...";
                                            }
                                            else
                                            {
                                                descName = series.firstAxis.labels[i];
                                            }
                                            
                                            cell = $('<td class="boundDesc"><b>' + descName + '</b><br/>limit</td>');
                                            firstRow.append(cell);
                                        }

                                        //Costruzione del corpo della tabella
                                        if(currentParams !== null)
                                        {
                                            for(j = 0; j < currentParams.thresholdArray.length; j++)
                                            {
                                                index = j;

                                                //Aggiunta record alla thrTable
                                                newTableRow = $('<tr></tr>');

                                                //Cella con pulsante rimozione riga
                                                newTableCell = $('<td><a><i class="fa fa-close" data-index="' + index + '" data-field="delBtn" style="font-size:24px;color:red"></i></a></td>');
                                                newTableCell.find('i').click(delThrRangeRadarM);
                                                newTableRow.append(newTableCell);

                                                //Cella per color picker
                                                newTableCell = $('<td><div style="width: 130px" class="input-group colorPicker" data-index="' + index + '" + data-field="color"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                                newTableRow.append(newTableCell);
                                                newTableRow.find('div.colorPicker').colorpicker({color: currentParams.thresholdArray[j].color, format: "rgba"});
                                                newTableRow.find('div.colorPicker').on('hidePicker', updateParamsRadarM);                
                                                newTableRow.append(newTableCell);

                                                //Cella per short description
                                                newTableCell = $('<td class="descValue"><a href="#" data-mode="popup" data-index="' + index + '" data-field="desc" class="toBeEdited">' + currentParams.thresholdArray[j].desc + '</a></td>');
                                                newTableCell.find('a').editable();
                                                newTableRow.append(newTableCell);

                                                //Celle per gli upper bound per ogni campo
                                                for(i = 0; i < series.firstAxis.labels.length; i++)
                                                {
                                                    fieldName = series.firstAxis.labels[i];
                                                    newTableCell = $('<td class="boundValue"><a href="#" data-mode="popup" data-index="' + index + '" data-field="' + fieldName + '" class="toBeEdited">' + currentParams.thresholdArray[j][fieldName] + '</a></td>');
                                                    newTableCell.find('a').editable();
                                                    newTableRow.append(newTableCell);
                                                }

                                                newTableRow.find('a.toBeEdited').on('save', updateParamsRadarM);
                                                thrTable.append(newTableRow);
                                            }
                                        }
                                        
                                        //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                        setGlobalsRadar(currentParams, thrTable, series, $('#select-widget-m').val());
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, series, infoJson, data['info_mess']);
                                        
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                        }
                                        
                                        //AGGIORNA CODICE DA QUI, E' ANCORA IL VECCHIO COPIA/INCOLLA DEGLI ALTRI SERIES
                                        //$("#inputComuneRowM").css("display", "");
                                        $("label[for='inputComuneWidgetM']").css("display", "");
                                        $('#inputComuneWidgetM').css("display", "");
                                        $("label[for='inputComuneWidgetM']").text("Context");
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $("#urlWidgetM").prop('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                        $('#specificParamsM .row').remove();
                                        
                                        //Nuova riga
                                        //Rows labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="rowsLabelsFontSizeM" class="col-md-2 control-label">X-Axis labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSizeM" name="rowsLabelsFontSizeM" required> ');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Rows labels font color
                                        newLabel = $('<label for="rowsLabelsFontColorM" class="col-md-2 control-label">X-Axis labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="rowsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColorM" name="rowsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#rowsLabelsFontColorContainerM').show();
                                        $('#rowsLabelsFontColorM').show();
                                        $("#widgetRowsLabelsFontColorM").css('display', 'block');
                                        $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});

                                        //Nuova riga
                                        //Cols labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="colsLabelsFontSizeM" class="col-md-2 control-label">Y-Axis labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="colsLabelsFontSizeM" name="colsLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Cols labels font color
                                        newLabel = $('<label for="colsLabelsFontColorM" class="col-md-2 control-label">Y-Axis labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="colsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColorM" name="colsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetColsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#colsLabelsFontColorContainerM').show();
                                        $('#colsLabelsFontColorM').show();
                                        $("#widgetColsLabelsFontColorM").css('display', 'block');
                                        $("#widgetColsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Data labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="dataLabelsFontSizeM" class="col-md-2 control-label">Data labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsFontSizeM" name="dataLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Data labels font color
                                        newLabel = $('<label for="dataLabelsFontColorM" class="col-md-2 control-label">Data labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="dataLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="dataLabelsFontColorM" name="dataLabelsFontColorM" required><span class="input-group-addon"><i id="widgetDataLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#dataLabelsFontColorContainerM').show();
                                        $('#dataLabelsFontColorM').show();
                                        $("#widgetDataLabelsFontColorM").css('display', 'block');
                                        $("#widgetDataLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Legend font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="legendFontSizeM" class="col-md-2 control-label">Legend font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="legendFontSizeM" name="legendFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Legend font color
                                        newLabel = $('<label for="legendFontColorM" class="col-md-2 control-label">Legend font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="legendFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColorM" name="legendFontColorM" required><span class="input-group-addon"><i id="widgetLegendFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#legendFontColorContainerM').show();
                                        $('#legendFontColorM').show();
                                        $("#widgetLegendFontColorM").css('display', 'block');
                                        $("#widgetLegendFontColorM").parent().parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Grid lines width
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="gridLinesWidthM" class="col-md-2 control-label">Grid lines width</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="gridLinesWidthM" name="gridLinesWidthM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Grid lines color
                                        newLabel = $('<label for="gridLinesColorM" class="col-md-2 control-label">Grid lines color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="gridLinesColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="gridLinesColorM" name="gridLinesColorM" required><span class="input-group-addon"><i id="widgetGridLinesColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#gridLinesColorContainerM').show();
                                        $('#gridLinesColorM').show();
                                        $("#widgetGridLinesColorM").css('display', 'block');
                                        $("#widgetGridLinesColorM").parent().parent().parent().colorpicker({color: styleParameters.gridLinesColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Lines width
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="linesWidthM" class="col-md-2 control-label">Lines width</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="linesWidthM" name="linesWidthM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();
                                        
                                        //Lines colors
                                        newLabel = $('<label for="barsColorsSelectM" class="col-md-2 control-label">Lines colors</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="barsColorsSelectM" name="barsColorsSelectM"></select>');
                                        newSelect.append('<option value="manual">Manual</option>');
                                        newSelect.append('<option value="auto">Automatic</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        $('#barsColorsSelectM').change(function() 
                                        {
                                            if($('#barsColorsSelectM').val() === "manual")
                                            {
                                                $('#barsColorsTableContainerM').show();
                                            }
                                            else
                                            {
                                                $('#barsColorsTableContainerM').hide();
                                            }
                                        });
                                        
                                        newSelect.show();
                                        
                                        //Parametri specifici del widget
                                        if(styleParamsRaw !== null) 
                                        {
                                            $("#rowsLabelsFontSizeM").val(styleParameters.rowsLabelsFontSize);
                                            $("#rowsLabelsFontColorM").val(styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").css("background-color", styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});
                                            $("#colsLabelsFontSizeM").val(styleParameters.colsLabelsFontSize);
                                            $("#colsLabelsFontColorM").val(styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").css("background-color", styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                            $("label[for='legendFontSizeM']").parent().show();
                                            $("#dataLabelsFontSizeM").val(styleParameters.dataLabelsFontSize);
                                            $("#dataLabelsFontColorM").val(styleParameters.dataLabelsFontColor);
                                            $("#gridLinesWidthM").val(styleParameters.gridLinesWidth);
                                            $("#linesWidthM").val(styleParameters.linesWidth);
                                            $("#widgetDataLabelsFontColorM").css("background-color", styleParameters.dataLabelsFontColor);
                                            $("#widgetDataLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                            $("#legendFontSizeM").val(styleParameters.legendFontSize);
                                            $("#legendFontColorM").val(styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").css("background-color", styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                            $("#barsColorsSelectM").val(styleParameters.barsColorsSelect);
                                        }
                                        
                                        //Contenitore per tabella dei colori
                                        barsColorsTableContainerM = $('<div id="barsColorsTableContainerM" class="row rowCenterContent"></div>');
                                        $("#specificParamsM").append(barsColorsTableContainerM);
                                        
                                        function updateWidgetBarSeriesColorsM(e, params)
                                        {
                                            var newColor = $(this).colorpicker('getValue');
                                            var index = parseInt($(this).parents('tr').index() - 1);
                                            colorsArray[index] = newColor;
                                            $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        }
                                        
                                        colorsTable = $("<table class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                        for(var i in series.secondAxis.labels)
                                        {
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            //Se l'attuale impostazione è per colori automatici, costruiamo JSON e tabella GUI con impostazioni di default, altrimenti con colori da DB
                                            if(styleParameters.barsColorsSelect === 'auto')
                                            {
                                                newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                                colorsArray.push(defaultColorsArray[i%10]);
                                            }
                                            else
                                            {
                                                newRow.find('div.colorPicker').colorpicker({color: styleParameters.barsColors[i], format: "rgba"});
                                                colorsArray.push(styleParameters.barsColors[i]);
                                            }
                                            
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColorsM); 
                                            colorsTable.append(newRow);
                                        }
                                        
                                        $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        $('#barsColorsTableContainerM').append(colorsTable);
                                        
                                        //Per prima visualizzazione in edit
                                        if($('#barsColorsSelectM').val() === "manual")
                                        {
                                            $('#barsColorsTableContainerM').show();
                                        }
                                        else
                                        {
                                            $('#barsColorsTableContainerM').hide();
                                        } 
                                        
                                        //Codice di creazione soglie
                                        //Nuova riga
                                        //Set thresholds
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrThrSelM" class="col-md-2 control-label">Set thresholds</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrThrSelM" name="alrThrSelM" required>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Thresholds lines width
                                        newLabel = $('<label for="alrThrLinesWidthM" class="col-md-2 control-label">Thresholds lines width</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="alrThrLinesWidthM" name="alrThrLinesWidthM" required>');
                                        newInput.val(styleParameters.alrThrLinesWidth);
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newInput.hide();
                                        
                                        //Contenitore per tabella delle soglie
                                        addWidgetRangeTableContainerM = $('<div id="addWidgetRangeTableContainerM" class="row thrRangeTableRadarContainer"></div>');
                                        addWidgetRangeTableContainerM.append(thrTable);
                                        $("#specificParamsM").append(addWidgetRangeTableContainerM);
                                        addWidgetRangeTableContainerM.hide();
                                        
                                        //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                        $('#alrThrSelM').change(alrThrSelListenerRadarM);
                                        
                                        if(currentParams === null)
                                        {
                                            $('#alrThrSelM').val("no");
                                            $("label[for='alrThrLinesWidthM']").hide();
                                            $('#alrThrLinesWidthM').parent().hide();
                                            $('#alrThrLinesWidthM').hide();
                                            $('#parametersM').val('');
                                        }
                                        else
                                        {
                                            //ESPOSIZIONE DEI CAMPI
                                            $('#alrThrSelM').val("yes");
                                            $("label[for='alrThrLinesWidthM']").show();
                                            $('#alrThrLinesWidthM').parent().show();
                                            $('#alrThrLinesWidthM').show();
                                            $('#addWidgetRangeTableContainerM').show();
                                            $('#parametersM').val(JSON.stringify(currentParams));
                                        }
                                        
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
            
                                    case "widgetLineSeries": case "widgetCurvedLineSeries":
                                        var thrTables1 = new Array();
                                        var thrTables2 = new Array();
                                        var thrSeries, i, j, k, min, max, color, newTableRow, newTableCell, currentFieldIndex, currentSeriesIndex, colorsTable, newRow, newCell, newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer, barsColorsTableContainerM = null;
                                        var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                        var colorsArray = new Array();    
                                        var metricId = $('#metricWidgetM').val();
                                        var metricData = getMetricData(metricId);
                                        var seriesString = metricData.data[0].commit.author.series;
                                        var series = jQuery.parseJSON(seriesString);
                                        
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                        setGlobals(currentParams, thrTables1, thrTables2, series, $('#select-widget-m').val());
                                        
                                        //Costruzione THRTables dai parametri provenienti da DB (vuote se non ci sono soglie per quel campo, anche nel caso di nessuna soglia settata in assoluto
                                        buildThrTablesForEditWidget();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, series, infoJson, data['info_mess']);
                                        
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                        }
                                        
                                        //$("#inputComuneRowM").css("display", "");
                                        $("label[for='inputComuneWidgetM']").css("display", "");
                                        //$('#inputComuneWidgetM').css("display", "");
                                        $("label[for='inputComuneWidgetM']").text("Context");
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $("#urlWidgetM").prop('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                        $('#specificParamsM .row').remove();
                                        
                                        //Visualizzazione campi specifici per questo widget
                                        //Nuova riga
                                        //X-Axis dataset
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="xAxisDatasetM" class="col-md-2 control-label">X-Axis dataset</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="xAxisDatasetM" name="xAxisDatasetM" required>');
                                        newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //Line width
                                        newLabel = $('<label for="lineWidthM" class="col-md-2 control-label">Line width</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="lineWidthM" name="lineWidthM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();
                                        
                                        //Nuova riga
                                        //X-Axis labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="rowsLabelsFontSizeM" class="col-md-2 control-label">X-Axis labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSizeM" name="rowsLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //X-Axis labels font color
                                        newLabel = $('<label for="rowsLabelsFontColorM" class="col-md-2 control-label">X-Axis labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="rowsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColorM" name="rowsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#rowsLabelsFontColorContainerM').show();
                                        $('#rowsLabelsFontColorM').show();
                                        $("#widgetRowsLabelsFontColorM").css('display', 'block');
                                        $("#widgetRowsLabelsFontColor").parent().parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Y-Axis labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="colsLabelsFontSizeM" class="col-md-2 control-label">Y-Axis labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="colsLabelsFontSizeM" name="colsLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Y-Axis labels font color
                                        newLabel = $('<label for="colsLabelsFontColorM" class="col-md-2 control-label">Y-Axis labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="colsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColorM" name="colsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetColsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#colsLabelsFontColorContainerM').show();
                                        $('#colsLabelsFontColorM').show();
                                        $("#widgetColsLabelsFontColorM").css('display', 'block');
                                        $("#widgetColsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Data labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="dataLabelsFontSizeM" class="col-md-2 control-label">Data labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsFontSizeM" name="dataLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Data labels font color
                                        newLabel = $('<label for="dataLabelsFontColorM" class="col-md-2 control-label">Data labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="dataLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="dataLabelsFontColorM" name="dataLabelsFontColorM" required><span class="input-group-addon"><i id="widgetDataLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#dataLabelsFontColorContainerM').show();
                                        $('#dataLabelsFontColorM').show();
                                        $("#widgetDataLabelsFontColorM").css('display', 'block');
                                        $("#widgetDataLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Legend font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="legendFontSizeM" class="col-md-2 control-label">Legend font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="legendFontSizeM" name="legendFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Legend font color
                                        newLabel = $('<label for="legendFontColorM" class="col-md-2 control-label">Legend font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="legendFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColorM" name="legendFontColorM" required><span class="input-group-addon"><i id="widgetLegendFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#legendFontColorContainerM').show();
                                        $('#legendFontColorM').show();
                                        $("#widgetLegendFontColorM").css('display', 'block');
                                        $("#widgetLegendFontColorM").parent().parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Lines colors
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="barsColorsSelectM" class="col-md-2 control-label">Lines colors</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="barsColorsSelectM" name="barsColorsSelectM"></select>');
                                        newSelect.append('<option value="auto">Automatic</option>');
                                        newSelect.append('<option value="manual">Manual</option>');
                                        newSelect.val(styleParameters.barsColorsSelect);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        $('#barsColorsSelectM').change(function() 
                                        {
                                            if($('#barsColorsSelectM').val() === "manual")
                                            {
                                                $('#barsColorsTableContainerM').show();
                                            }
                                            else
                                            {
                                                $('#barsColorsTableContainerM').hide();
                                            }
                                        });

                                        //Chart type
                                        newLabel = $('<label for="chartTypeM" class="col-md-2 control-label">Chart type</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="chartTypeM" name="chartTypeM"></select>');
                                        newSelect.append("<option value='lines'>Simple lines</option>");
                                        newSelect.append("<option value='area'>Area lines</option>");
                                        newSelect.append("<option value='stacked'>Stacked area lines</option>");
                                        newSelect.val(styleParameters.chartType);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Nuova riga
                                        //Data labels
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="dataLabelsM" class="col-md-2 control-label">Data labels</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="dataLabelsM" name="dataLabelsM">');
                                        newSelect.append('<option value="no">No data labels</option>');
                                        newSelect.append('<option value="value">Value only</option>');
                                        newSelect.append('<option value="full">Field name and value</option>');
                                        newSelect.val(styleParameters.dataLabels);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Parametri specifici del widget
                                        if(styleParamsRaw !== null) 
                                        {
                                            $("#xAxisDatasetM").val(styleParameters.xAxisDataset);
                                            $("#rowsLabelsFontSizeM").val(styleParameters.rowsLabelsFontSize);
                                            $("#rowsLabelsFontColorM").val(styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").css("background-color", styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});
                                            $("#colsLabelsFontSizeM").val(styleParameters.colsLabelsFontSize);
                                            $("#colsLabelsFontColorM").val(styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").css("background-color", styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                            $("#dataLabelsFontSizeM").val(styleParameters.dataLabelsFontSize);
                                            $("#dataLabelsFontColorM").val(styleParameters.dataLabelsFontColor);
                                            $("#widgetDataLabelsFontColorM").css("background-color", styleParameters.dataLabelsFontColor);
                                            $("#widgetDataLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                            $("#legendFontSizeM").val(styleParameters.legendFontSize);
                                            $("#legendFontColorM").val(styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").css("background-color", styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                            $("#barsColorsSelectM").val(styleParameters.barsColorsSelect);
                                            $("#chartTypeM").val(styleParameters.chartType);
                                            $("#dataLabelsM").val(styleParameters.dataLabels);
                                            $("#lineWidthM").val(styleParameters.lineWidth);
                                            $("#alrLookM").val(styleParameters.alrLook);
                                        }
                                        
                                        //Contenitore per tabella dei colori
                                        barsColorsTableContainerM = $('<div id="barsColorsTableContainerM" class="row rowCenterContent"></div>');
                                        $("#specificParamsM").append(barsColorsTableContainerM);
                                        
                                        function updateWidgetBarSeriesColorsM(e, params)
                                        {
                                            var newColor = $(this).colorpicker('getValue');
                                            var index = parseInt($(this).parents('tr').index() - 1);
                                            colorsArray[index] = newColor;
                                            $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        }
                                        
                                        colorsTable = $("<table class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                        updateXAxisSelectM();
                                        
                                        function updateXAxisSelectM()
                                        {
                                            var colorsTarget = null;

                                            colorsTable.find('tr').remove();
                                            colorsTable.append("<tr><td>Series</td><td>Color</td></tr>");
                                            
                                            $('#alrAxisSelM').empty();

                                            if($("#xAxisDatasetM").val() === series.firstAxis.desc)
                                            {
                                                //Grafico non trasposto
                                                colorsTarget = series.secondAxis.labels;
                                                $('#alrAxisSelM').append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                            }
                                            else
                                            {
                                                //Grafico trasposto
                                                colorsTarget = series.firstAxis.labels;
                                                $('#alrAxisSelM').append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                            }
                                            
                                            alrAxisSelMListener();

                                            for(var i in colorsTarget)
                                            {
                                                newRow = $('<tr></tr>');
                                                newCell = $('<td>' + colorsTarget[i]+ '</td>');
                                                newRow.append(newCell);
                                                newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                                newRow.append(newCell);
                                                
                                                //Se l'attuale impostazione è per colori automatici, costruiamo JSON e tabella GUI con impostazioni di default, altrimenti con colori da DB
                                                if(styleParameters.barsColorsSelect === 'auto')
                                                {
                                                    newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                                    colorsArray.push(defaultColorsArray[i%10]);
                                                }
                                                else
                                                {
                                                    newRow.find('div.colorPicker').colorpicker({color: styleParameters.barsColors[i], format: "rgba"});
                                                    colorsArray.push(styleParameters.barsColors[i]);
                                                }
                                                
                                                newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColorsM); 
                                                colorsTable.append(newRow);
                                            }
                                        }

                                        $("#xAxisDatasetM").off();
                                        $("#xAxisDatasetM").on("change", updateXAxisSelectM);
                                        $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        $('#barsColorsTableContainerM').append(colorsTable);
                                        //Per prima visualizzazione in edit
                                        $('#barsColorsSelectM').trigger("change"); 
                                        
                                        //Codice di creazione soglie
                                        //Nuova riga
                                        //Set thresholds
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrThrSelM" class="col-md-2 control-label">Set thresholds</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrThrSelM" name="alrThrSelM" required>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                        newLabel = $('<label for="alrAxisSelM" class="col-md-2 control-label">Thresholds target set</label>');
                                        newSelect = $('<select class="form-control" id="alrAxisSelM" name="alrAxisSelM"></select>');
                                        if($("#xAxisDatasetM").val() === series.firstAxis.desc)
                                        {
                                            //No trasposizione
                                            newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        }
                                        else
                                        {
                                            //Trasposizione
                                            newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                        }
                                        newSelect.val(-1);
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Nuova riga
                                        //Threshold field select
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrFieldSelM" class="col-md-2 control-label">Thresholds target field</label>');
                                        newSelect = $('<select class="form-control" id="alrFieldSelM" name="alrFieldSelM">');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Threshold look&feel
                                        newLabel = $('<label for="alrLookM" class="col-md-2 control-label">Thresholds look&feel</label>');
                                        newSelect = $('<select class="form-control" id="alrLookM" name="alrLookM">');
                                        newSelect.append('<option value="none">Tooltip only</option>');
                                        newSelect.append('<option value="lines">Lines</option>');
                                        newSelect.append('<option value="areas">Background areas</option>');
                                        newSelect.val(styleParameters.alrLook);
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Contenitore per tabella delle soglie
                                        addWidgetRangeTableContainerM = $('<div id="addWidgetRangeTableContainerM" class="row rowCenterContent"></div>');
                                        $("#specificParamsM").append(addWidgetRangeTableContainerM);
                                        addWidgetRangeTableContainerM.hide();
                                        
                                        //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                        $('#alrThrSelM').change(alrThrFlagMListener);
                                        
                                        if(currentParams === null)
                                        {
                                            $('#alrThrSelM').val("no");
                                            $("label[for='alrAxisSelM']").hide();
                                            $('#alrAxisSelM').val(-1);
                                            $('#alrAxisSelM').hide();
                                            $('#parametersM').val('');
                                        }
                                        else
                                        {
                                            //ESPOSIZIONE DEI CAMPI
                                            $('#alrThrSelM').val("yes");
                                            $('#alrAxisSelM').val(currentParams.thresholdObject.target);
                                            $("label[for='alrAxisSelM']").show();
                                            $('#alrAxisSelM').parent().show();
                                            $('#alrAxisSelM').show();
                                            $("label[for='alrFieldSelM']").show();
                                            $('#alrFieldSelM').parent().show();
                                            $('#alrFieldSelM').show();
                                            $("label[for='alrLookM']").show();
                                            $('#alrLookM').parent().show();
                                            $('#alrLookM').show();
                                            $('#alrLookM').val(styleParameters.alrLook);
                                            //POPOLAMENTO DELLA SELECT DEI CAMPI
                                            alrAxisSelMListener();
                                            $('#addWidgetRangeTableContainerM').show();
                                            $('#parametersM').val(JSON.stringify(currentParams));
                                            //Listener per settaggio/desettaggio campi in base ad asse selezionato
                                            $('#alrAxisSelM').change(alrAxisSelMListener);
                                            //Listener per selezione campo
                                            $('#alrFieldSelM').change(alrFieldSelMListener);
                                        }
                                        break;
            
                                    case "widgetScatterSeries":
                                        //$("#inputComuneRowM").css("display", "");
                                        $("label[for='inputComuneWidgetM']").css("display", "");
                                        //$('#inputComuneWidgetM').css("display", "");
                                        //$("label[for='inputComuneWidgetM']").text("Context");
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $("#urlWidgetM").prop('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        //Parametri specifici del widget
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                            $("#rowsLabelsFontSizeM").val(styleParameters.rowsLabelsFontSize);
                                            $("#rowsLabelsFontColorM").val(styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").css("background-color", styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});
                                            $("#colsLabelsFontSizeM").val(styleParameters.colsLabelsFontSize);
                                            $("#colsLabelsFontColorM").val(styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").css("background-color", styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                            $("label[for='legendFontSizeM']").parent().show();
                                            $("#dataLabelsFontSizeM").val(styleParameters.dataLabelsFontSize);
                                            $("#dataLabelsFontColorM").val(styleParameters.dataLabelsFontColor);
                                            $("#widgetDataLabelsFontColorM").css("background-color", styleParameters.dataLabelsFontColor);
                                            $("#widgetDataLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                            $("#legendFontSizeM").val(styleParameters.legendFontSize);
                                            $("#legendFontColorM").val(styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").css("background-color", styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                            $("#barsColorsSelectM").val(styleParameters.barsColorsSelect);
                                            $("#chartTypeM").val(styleParameters.chartType);
                                            $("#dataLabelsM").val(styleParameters.dataLabels);
                                            $("#dataLabelsRotationM").val(styleParameters.dataLabelsRotation);
                                        }
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                        $('#specificParamsM .row').remove();
                                        
                                        //Visualizzazione campi specifici per questo widget
                                        $("label[for='rowsLabelsFontSizeM']").parent().show();
                                        $("label[for='rowsLabelsFontSizeM']").show();
                                        $("#rowsLabelsFontSizeM").show();

                                        $("label[for='rowsLabelsFontColorM']").show();
                                        $("#rowsLabelsFontColorM").show();
                                        //Questa falla con css sennò la mostra inline e non viene colorato!
                                        $("#widgetRowsLabelsFontColorM").css('display', 'block');

                                        $("label[for='colsLabelsFontSizeM']").parent().show();
                                        $("label[for='colsLabelsFontSizeM']").show();
                                        $("#colsLabelsFontSizeM").show();

                                        $("label[for='colsLabelsFontColorM']").show();
                                        $("#colsLabelsFontColorM").show();
                                        //Questa falla con css sennò la mostra inline e non viene colorato!
                                        $("#widgetColsLabelsFontColorM").css('display', 'block');
                                        
                                        $("label[for='dataLabelsFontSizeM']").parent().show();
                                        $("label[for='dataLabelsFontSizeM']").show();
                                        $("#dataLabelsFontSizeM").show();

                                        $("label[for='dataLabelsFontColorM']").show();
                                        $("#dataLabelsFontColorM").show();
                                        //Questa falla con css sennò la mostra inline e non viene colorato!
                                        $("#widgetDataLabelsFontColorM").css('display', 'block');
                                        $("#widgetDataLabelsFontColorM").colorpicker({color: '#000000', format: "rgba"});
                                        
                                        $("label[for='legendFontSizeM']").parent().show();
                                        $("label[for='legendFontSizeM']").show();
                                        $("#legendFontSizeM").show();

                                        $("label[for='legendFontColorM']").show();
                                        $("#legendFontColorM").show();
                                        //Questa falla con css sennò la mostra inline e non viene colorato!
                                        $("#widgetLegendFontColorM").css('display', 'block');
                                        
                                        $("label[for='barsColorsSelectM']").html("Markers colors");
                                        $("label[for='barsColorsSelectM']").parent().show();
                                        $("label[for='barsColorsSelectM']").show();
                                        $("#barsColorsSelectM").show();
                                        
                                        $("label[for='chartTypeM']").show();
                                        $("#chartTypeM").show();
                                        
                                        $("label[for='dataLabelsM']").parent().show();
                                        $("label[for='dataLabelsM']").show();
                                        $("#dataLabelsM").show();
                                        
                                        $("label[for='dataLabelsRotationM']").show();
                                        $("#dataLabelsRotationM").show();
                                        
                                        var metricId = $('#metricWidgetM').val();
                                        var metricData = getMetricData(metricId);
                                        var seriesString = metricData.data[0].commit.author.series;
                                        var series = jQuery.parseJSON(seriesString);
                                        var thrTables1 = new Array();
                                        var thrTables2 = new Array();
                                        var thrSeries = null;
                                        var i, j, k, min, max, color, newTableRow, newTableCell, currentFieldIndex, currentSeriesIndex = null;
                                        var colorsTable, newRow, newCell = null;
                                        var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                        var colorsArray = new Array();
                                        
                                        setGlobals(currentParams, thrTables1, thrTables2, series, $('#select-widget-m').val());
                                        
                                        function updateWidgetBarSeriesColorsM(e, params)
                                        {
                                            var newColor = $(this).colorpicker('getValue');
                                            var index = parseInt($(this).parents('tr').index() - 1);
                                            colorsArray[index] = newColor;
                                            $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        }
                                        
                                        colorsTable = $("<table class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                        for(var i in series.secondAxis.labels)
                                        {
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            //Se l'attuale impostazione è per colori automatici, costruiamo JSON e tabella GUI con impostazioni di default, altrimenti con colori da DB
                                            if(styleParameters.barsColorsSelect === 'auto')
                                            {
                                                newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                                colorsArray.push(defaultColorsArray[i%10]);
                                            }
                                            else
                                            {
                                                newRow.find('div.colorPicker').colorpicker({color: styleParameters.barsColors[i], format: "rgba"});
                                                colorsArray.push(styleParameters.barsColors[i]);
                                            }
                                            
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColorsM); 
                                            colorsTable.append(newRow);
                                        }
                                        
                                        $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        
                                        $('#barsColorsTableContainerM').append(colorsTable);
                                        
                                        
                                        $('#barsColorsSelectM').change(function () 
                                        {
                                            if($('#barsColorsSelectM').val() === "manual")
                                            {
                                                $('#barsColorsTableContainerM').show();
                                            }
                                            else
                                            {
                                                $('#barsColorsTableContainerM').hide();
                                            }
                                        });
                                        
                                        //Per prima visualizzazione in edit
                                        $('#barsColorsSelectM').trigger("change"); 
                                        
                                        //Mostriamo il campo per settare o meno delle soglie
                                        $("label[for='alrThrFlagM']").parent().show();
                                        $("label[for='alrThrFlagM']").show();
                                        $('#alrThrFlagM').show();
                                        
                                        //Popolamento del select per gli assi
                                        $('#alrAxisSelM').empty();
                                        $('#alrAxisSelM').append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        
                                        //Costruzione THRTables dai parametri provenienti da DB (vuote se non ci sono soglie per quel campo, anche nel caso di nessuna soglia settata in assoluto
                                        buildThrTablesForEditWidget();
                                        
                                        //Listener per settaggio/desettaggio soglie
                                        $('#alrThrFlagM').change(alrThrFlagMListener);
                                        
                                        //Listener per settaggio/desettaggio campi in base ad asse selezionato
                                        $('#alrAxisSelM').change(alrAxisSelMListener);
                                        
                                        //Listener per selezione campo
                                        $('#alrFieldSelM').change(alrFieldSelMListener);
                                        
                                        if(currentParams === null)
                                        {
                                            $('#alrThrFlagM').val("no");
                                            $('#alrAxisSelM').val(-1);
                                            $('#alrAxisSelM').hide();
                                            $("label[for='alrAxisSelM']").hide();
                                            $('#parametersM').val('');
                                        }
                                        else
                                        {
                                            //ESPOSIZIONE DEI CAMPI
                                            $('#alrThrFlagM').val("yes");
                                            $('#alrAxisSelM').val(currentParams.thresholdObject.target);
                                            $("label[for='alrFieldSelM']").parent().show();
                                            $('#alrAxisSelM').show();
                                            $("label[for='alrAxisSelM']").show();
                                            $('#alrFieldSelM').show();
                                            $("label[for='alrFieldSelM']").show();
                                            $("label[for='alrRangeColorM']").parent().show();
                                            $('#alrRangeColorM').show();
                                            $("label[for='alrRangeColorM']").show();
                                            $('#addWidgetRangeTableContainerM').show();
                                            
                                            //POPOLAMENTO DELLA SELECT COI CAMPI
                                            $('#alrAxisSelM').trigger("change");
                                            
                                            $('#parametersM').val(JSON.stringify(currentParams));
                                        }
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, series, infoJson, data['info_mess']);
                                        break;
            
                                    case "widgetBarSeries":
                                        var metricId = $('#metricWidgetM').val();
                                        var metricData = getMetricData(metricId);
                                        var seriesString = metricData.data[0].commit.author.series;
                                        var series = jQuery.parseJSON(seriesString);
                                        var thrTables1 = new Array();
                                        var thrTables2 = new Array();
                                        var thrSeries,i, j, k, min, max, color, newTableRow, newTableCell, currentFieldIndex, currentSeriesIndex, colorsTable, newRow, newCell, newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer, barsColorsTableContainerM = null;
                                        var defaultColorsArray = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
                                        var colorsArray = new Array();
                                        
                                        //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                        setGlobals(currentParams, thrTables1, thrTables2, series, $('#select-widget-m').val());
                                        
                                        //Costruzione THRTables dai parametri provenienti da DB (vuote se non ci sono soglie per quel campo, anche nel caso di nessuna soglia settata in assoluto
                                        buildThrTablesForEditWidget();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, series, infoJson, data['info_mess']);
                                        
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                        }
                                        
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $("#urlWidgetM").prop('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                        $('#specificParamsM .row').remove();
                                        
                                        //Nuova riga
                                        //Rows labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="rowsLabelsFontSizeM" class="col-md-2 control-label">Rows labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSizeM" name="rowsLabelsFontSizeM" required> ');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Rows labels font color
                                        newLabel = $('<label for="rowsLabelsFontColorM" class="col-md-2 control-label">Rows labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="rowsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColorM" name="rowsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#rowsLabelsFontColorContainerM').show();
                                        $('#rowsLabelsFontColorM').show();
                                        $("#widgetRowsLabelsFontColorM").css('display', 'block');
                                        $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});

                                        //Nuova riga
                                        //Cols labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="colsLabelsFontSizeM" class="col-md-2 control-label">Cols labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="colsLabelsFontSizeM" name="colsLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Cols labels font color
                                        newLabel = $('<label for="colsLabelsFontColorM" class="col-md-2 control-label">Cols labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="colsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColorM" name="colsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetColsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#colsLabelsFontColorContainerM').show();
                                        $('#colsLabelsFontColorM').show();
                                        $("#widgetColsLabelsFontColorM").css('display', 'block');
                                        $("#widgetColsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Data labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="dataLabelsFontSizeM" class="col-md-2 control-label">Data labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsFontSizeM" name="dataLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Data labels font color
                                        newLabel = $('<label for="dataLabelsFontColorM" class="col-md-2 control-label">Data labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="dataLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="dataLabelsFontColorM" name="dataLabelsFontColorM" required><span class="input-group-addon"><i id="widgetDataLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#dataLabelsFontColorContainerM').show();
                                        $('#dataLabelsFontColorM').show();
                                        $("#widgetDataLabelsFontColorM").css('display', 'block');
                                        $("#widgetDataLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Legend font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="legendFontSizeM" class="col-md-2 control-label">Legend font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="legendFontSizeM" name="legendFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Legend font color
                                        newLabel = $('<label for="legendFontColorM" class="col-md-2 control-label">Legend font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="legendFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColorM" name="legendFontColorM" required><span class="input-group-addon"><i id="widgetLegendFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#legendFontColorContainerM').show();
                                        $('#legendFontColorM').show();
                                        $("#widgetLegendFontColorM").css('display', 'block');
                                        $("#widgetLegendFontColorM").parent().parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Bars colors
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="barsColorsSelectM" class="col-md-2 control-label">Bars colors</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="barsColorsSelectM" name="barsColorsSelectM"></select>');
                                        newSelect.append('<option value="manual">Manual</option>');
                                        newSelect.append('<option value="auto">Automatic</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        $('#barsColorsSelectM').change(function() 
                                        {
                                            if($('#barsColorsSelectM').val() === "manual")
                                            {
                                                $('#barsColorsTableContainerM').show();
                                            }
                                            else
                                            {
                                                $('#barsColorsTableContainerM').hide();
                                            }
                                        });

                                        //Chart type
                                        newLabel = $('<label for="chartTypeM" class="col-md-2 control-label">Chart type</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="chartTypeM" name="chartTypeM"></select>');
                                        newSelect.append('<option value="horizontal">Horizontal bars</option>');
                                        newSelect.append('<option value="horizontalStacked">Horizontal stacked bars</option>');
                                        newSelect.append('<option value="vertical">Vertical bars</option>');
                                        newSelect.append('<option value="verticalStacked">Vertical stacked bars</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //Nuova riga
                                        //Data labels
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="dataLabelsM" class="col-md-2 control-label">Data labels</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="dataLabelsM" name="dataLabelsM">');
                                        newSelect.append('<option value="no">No data labels</option>');
                                        newSelect.append('<option value="value">Value only</option>');
                                        newSelect.append('<option value="full">Field name and value</option>');
                                        newSelect.val("value");
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //Data labels rotation
                                        newLabel = $('<label for="dataLabelsRotation" class="col-md-2 control-label">Data labels rotation</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="dataLabelsRotation" name="dataLabelsRotation"> ');
                                        newSelect.append('<option value="horizontal">Horizontal</option>');
                                        newSelect.append('<option value="verticalAsc">Vertical ascending</option>');
                                        newSelect.append('<option value="verticalDesc">Vertical descending</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Parametri specifici del widget
                                        if(styleParamsRaw !== null) 
                                        {
                                            $("#rowsLabelsFontSizeM").val(styleParameters.rowsLabelsFontSize);
                                            $("#rowsLabelsFontColorM").val(styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").css("background-color", styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});
                                            $("#colsLabelsFontSizeM").val(styleParameters.colsLabelsFontSize);
                                            $("#colsLabelsFontColorM").val(styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").css("background-color", styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                            $("label[for='legendFontSizeM']").parent().show();
                                            $("#dataLabelsFontSizeM").val(styleParameters.dataLabelsFontSize);
                                            $("#dataLabelsFontColorM").val(styleParameters.dataLabelsFontColor);
                                            $("#widgetDataLabelsFontColorM").css("background-color", styleParameters.dataLabelsFontColor);
                                            $("#widgetDataLabelsFontColorM").parent().parent().colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                            $("#legendFontSizeM").val(styleParameters.legendFontSize);
                                            $("#legendFontColorM").val(styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").css("background-color", styleParameters.legendFontColor);
                                            $("#widgetLegendFontColorM").parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                            $("#barsColorsSelectM").val(styleParameters.barsColorsSelect);
                                            $("#chartTypeM").val(styleParameters.chartType);
                                            $("#dataLabelsM").val(styleParameters.dataLabels);
                                            $("#dataLabelsRotationM").val(styleParameters.dataLabelsRotation);
                                        }
                                        
                                        //Contenitore per tabella dei colori
                                        barsColorsTableContainerM = $('<div id="barsColorsTableContainerM" class="row rowCenterContent"></div>');
                                        $("#specificParamsM").append(barsColorsTableContainerM);
                                        
                                        function updateWidgetBarSeriesColorsM(e, params)
                                        {
                                            var newColor = $(this).colorpicker('getValue');
                                            var index = parseInt($(this).parents('tr').index() - 1);
                                            colorsArray[index] = newColor;
                                            $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        }
                                        
                                        colorsTable = $("<table class='table table-bordered table-condensed thrRangeTable'><tr><td>Series</td><td>Color</td></tr></table>");
                                        for(var i in series.secondAxis.labels)
                                        {
                                            newRow = $('<tr></tr>');
                                            newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                            newRow.append(newCell);
                                            newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                            newRow.append(newCell);
                                            //Se l'attuale impostazione è per colori automatici, costruiamo JSON e tabella GUI con impostazioni di default, altrimenti con colori da DB
                                            if(styleParameters.barsColorsSelect === 'auto')
                                            {
                                                newRow.find('div.colorPicker').colorpicker({color: defaultColorsArray[i%10], format: "rgba"});
                                                colorsArray.push(defaultColorsArray[i%10]);
                                            }
                                            else
                                            {
                                                newRow.find('div.colorPicker').colorpicker({color: styleParameters.barsColors[i], format: "rgba"});
                                                colorsArray.push(styleParameters.barsColors[i]);
                                            }
                                            
                                            newRow.find('div.colorPicker').on('changeColor', updateWidgetBarSeriesColorsM); 
                                            colorsTable.append(newRow);
                                        }
                                        
                                        $("#barsColorsM").val(JSON.stringify(colorsArray));
                                        $('#barsColorsTableContainerM').append(colorsTable);
                                        
                                        //Per prima visualizzazione in edit
                                        if($('#barsColorsSelectM').val() === "manual")
                                        {
                                            $('#barsColorsTableContainerM').show();
                                        }
                                        else
                                        {
                                            $('#barsColorsTableContainerM').hide();
                                        } 
                                        
                                        //Codice di creazione soglie
                                        //Nuova riga
                                        //Set thresholds
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrThrSelM" class="col-md-2 control-label">Set thresholds</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrThrSelM" name="alrThrSelM" required>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                        newLabel = $('<label for="alrAxisSelM" class="col-md-2 control-label">Thresholds target set</label>');
                                        newSelect = $('<select class="form-control" id="alrAxisSelM" name="alrAxisSelM"></select>');
                                        newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        newSelect.val(-1);
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Nuova riga
                                        //Threshold field select
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrFieldSelM" class="col-md-2 control-label">Thresholds target field</label>');
                                        newSelect = $('<select class="form-control" id="alrFieldSelM" name="alrFieldSelM">');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Contenitore per tabella delle soglie
                                        addWidgetRangeTableContainerM = $('<div id="addWidgetRangeTableContainerM" class="row rowCenterContent"></div>');
                                        $("#specificParamsM").append(addWidgetRangeTableContainerM);
                                        addWidgetRangeTableContainerM.hide();
                                        
                                        //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                        $('#alrThrSelM').change(alrThrFlagMListener);
                                        
                                        if(currentParams === null)
                                        {
                                            $('#alrThrSelM').val("no");
                                            $("label[for='alrAxisSelM']").hide();
                                            $('#alrAxisSelM').val(-1);
                                            $('#alrAxisSelM').hide();
                                            $('#parametersM').val('');
                                        }
                                        else
                                        {
                                            //ESPOSIZIONE DEI CAMPI
                                            $('#alrThrSelM').val("yes");
                                            $('#alrAxisSelM').val(currentParams.thresholdObject.target);
                                            $("label[for='alrAxisSelM']").show();
                                            $('#alrAxisSelM').parent().show();
                                            $('#alrAxisSelM').show();
                                            $("label[for='alrFieldSelM']").show();
                                            $('#alrFieldSelM').parent().show();
                                            $('#alrFieldSelM').show();
                                            //POPOLAMENTO DELLA SELECT DEI CAMPI
                                            alrAxisSelMListener();
                                            $('#addWidgetRangeTableContainerM').show();
                                            $('#parametersM').val(JSON.stringify(currentParams));
                                            //Listener per settaggio/desettaggio campi in base ad asse selezionato
                                            $('#alrAxisSelM').change(alrAxisSelMListener);
                                            //Listener per selezione campo
                                            $('#alrFieldSelM').change(alrFieldSelMListener);
                                        }
                                        
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
            
                                    case "widgetTable":
                                        var metricId = $('#metricWidgetM').val();
                                        var metricData = getMetricData(metricId);
                                        var seriesString = metricData.data[0].commit.author.series;
                                        var series = jQuery.parseJSON(seriesString);
                                        var thrTables1 = new Array();
                                        var thrTables2 = new Array();
                                        var i, j, k, min, max, color, newTableRow, newTableCell, currentFieldIndex, currentSeriesIndex, thrSeries, newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                        
                                        //Funzione di settaggio dei globals per il file dashboard_configdash.js
                                        setGlobals(currentParams, thrTables1, thrTables2, series, $('#select-widget-m').val());
                                        
                                        //Costruzione THRTables dai parametri provenienti da DB (vuote se non ci sono soglie per quel campo, anche nel caso di nessuna soglia settata in assoluto
                                        buildThrTablesForEditWidget();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, series, infoJson, data['info_mess']);
                                        
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                        }
                                        
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $("#urlWidgetM").prop('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //RIMOZIONE CAMPI PER TUTTI GLI ALTRI WIDGET
                                        $('#specificParamsM .row').remove();
                                        
                                        //Visualizzazione campi specifici per questo widget
                                        //Nuova riga
                                        //Select show first cell
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="showTableFirstCellM" class="col-md-2 control-label">Show first cell</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="showTableFirstCellM" name="showTableFirstCellM" required></select>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //First cell font size
                                        //Nuova riga
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="tableFirstCellFontSizeM" class="col-md-2 control-label">First cell font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="tableFirstCellFontSizeM" name="tableFirstCellFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();
                                        
                                        //First cell font color
                                        newLabel = $('<label for="tableFirstCellFontColorM" class="col-md-2 control-label">First cell font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="tableFirstCellFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableFirstCellFontColorM" name="tableFirstCellFontColorM" required><span class="input-group-addon"><i id="widgetFirstCellFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#tableFirstCellFontColorContainerM').show();
                                        $('#tableFirstCellFontColorM').show();
                                        $("#widgetFirstCellFontColorM").css('display', 'block');
                                        $("#widgetFirstCellFontColorM").parent().parent().parent().colorpicker({color: styleParameters.tableFirstCellFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Rows labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="rowsLabelsFontSizeM" class="col-md-2 control-label">Rows labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="rowsLabelsFontSizeM" name="rowsLabelsFontSizeM" required> ');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Rows labels font color
                                        newLabel = $('<label for="rowsLabelsFontColorM" class="col-md-2 control-label">Rows labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="rowsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsFontColorM" name="rowsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetRowsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#rowsLabelsFontColorContainerM').show();
                                        $('#rowsLabelsFontColorM').show();
                                        $("#widgetRowsLabelsFontColorM").css('display', 'block');
                                        $("#widgetRowsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.rowsLabelsFontColor, format: "rgba"});

                                        //Nuova riga
                                        //Cols labels font size
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="colsLabelsFontSizeM" class="col-md-2 control-label">Cols labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="colsLabelsFontSizeM" name="colsLabelsFontSizeM" required>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Cols labels font color
                                        newLabel = $('<label for="colsLabelsFontColorM" class="col-md-2 control-label">Cols labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="colsLabelsFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsFontColorM" name="colsLabelsFontColorM" required><span class="input-group-addon"><i id="widgetColsLabelsFontColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#colsLabelsFontColorContainerM').show();
                                        $('#colsLabelsFontColorM').show();
                                        $("#widgetColsLabelsFontColorM").css('display', 'block');
                                        $("#widgetColsLabelsFontColorM").parent().parent().parent().colorpicker({color: styleParameters.colsLabelsFontColor, format: "rgba"});
                                    
                                        //Nuova riga
                                        //Rows labels background color
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="rowsLabelsBckColorM" class="col-md-2 control-label">Rows labels background color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="rowsLabelsBckColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="rowsLabelsBckColorM" name="rowsLabelsBckColorM" required><span class="input-group-addon"><i id="widgetRowsLabelsBckColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#rowsLabelsBckColorContainerM').show();
                                        $('#rowsLabelsBckColorM').show();
                                        $("#widgetRowsLabelsBckColorM").css('display', 'block');
                                        $("#widgetRowsLabelsBckColorM").parent().parent().parent().colorpicker({color: styleParameters.rowsLabelsBckColor, format: "rgba"});


                                        //Cols labels background color
                                        newLabel = $('<label for="colsLabelsBckColorM" class="col-md-2 control-label">Cols labels background color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="colsLabelsBckColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="colsLabelsBckColorM" name="colsLabelsBckColorM" required><span class="input-group-addon"><i id="widgetColsLabelsBckColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#colsLabelsBckColorContainerM').show();
                                        $('#colsLabelsBckColorM').show();
                                        $("#widgetColsLabelsBckColorM").css('display', 'block');
                                        $("#widgetColsLabelsBckColorM").parent().parent().parent().colorpicker({color: styleParameters.colsLabelsBckColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Table borders
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="tableBordersM" class="col-md-2 control-label">Table borders</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="tableBordersM" name="tableBordersM"></select>');
                                        newSelect.append('<option value="no">No borders</option>');
                                        newSelect.append('<option value="horizontal">Horizontal borders only</option>');
                                        newSelect.append('<option value="all">All borders</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //Table borders color
                                        newLabel = $('<label for="tableBordersColorM" class="col-md-2 control-label">Table borders color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="tableBordersColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="tableBordersColorM" name="tableBordersColorM" required><span class="input-group-addon"><i id="widgetTableBordersColorM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        $('#tableBordersColorContainerM').show();
                                        $('#tableBordersColorM').show();
                                        $("#widgetTableBordersColorM").css('display', 'block');
                                        $("#widgetTableBordersColorM").parent().parent().parent().colorpicker({color: styleParameters.tableBordersColor, format: "rgba"});

                                        if(styleParamsRaw !== null) 
                                        {
                                            $("#showTableFirstCellM").val(styleParameters.showTableFirstCell);
                                            $("#tableFirstCellFontSizeM").val(styleParameters.tableFirstCellFontSize);
                                            $("#tableFirstCellFontColorM").val(styleParameters.tableFirstCellFontColor);
                                            $("#widgetFirstCellFontColorM").css("background-color", styleParameters.tableFirstCellFontColor);
                                            $("#rowsLabelsFontSizeM").val(styleParameters.rowsLabelsFontSize);
                                            $("#rowsLabelsFontColorM").val(styleParameters.rowsLabelsFontColor);
                                            $("#widgetRowsLabelsFontColorM").css("background-color", styleParameters.rowsLabelsFontColor);
                                            $("#colsLabelsFontSizeM").val(styleParameters.colsLabelsFontSize);
                                            $("#colsLabelsFontColorM").val(styleParameters.colsLabelsFontColor);
                                            $("#widgetColsLabelsFontColorM").css("background-color", styleParameters.colsLabelsFontColor);
                                            $("#rowsLabelsBckColorM").val(styleParameters.rowsLabelsBckColor);
                                            $("#widgetRowsLabelsBckColorM").css("background-color", styleParameters.rowsLabelsBckColor);
                                            $("#colsLabelsBckColorM").val(styleParameters.colsLabelsBckColor);
                                            $("#widgetColsLabelsBckColorM").css("background-color", styleParameters.colsLabelsBckColor);
                                            $("#tableBordersM").val(styleParameters.tableBorders);
                                            $("#tableBordersColorM").val(styleParameters.tableBordersColor);
                                            $("#widgetTableBordersColorM").css("background-color", styleParameters.tableBordersColor);
                                        }
                                        
                                        //Nuova riga
                                        //Set thresholds
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrThrSelM" class="col-md-2 control-label">Set thresholds</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="alrThrSelM" name="alrThrSelM" required>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newSelect.val('no');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                        $('#alrThrSelM').change(alrThrFlagMListener);
                                        
                                        //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                        newLabel = $('<label for="alrAxisSelM" class="col-md-2 control-label">Thresholds target set</label>');
                                        newSelect = $('<select class="form-control" id="alrAxisSelM" name="alrAxisSelM"></select>');
                                        newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                        newSelect.append("<option value='" + series.secondAxis.desc + "'>" + series.secondAxis.desc + "</option>");
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Nuova riga
                                        //Threshold field select
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="alrFieldSelM" class="col-md-2 control-label">Thresholds target field</label>');
                                        newSelect = $('<select class="form-control" id="alrFieldSelM" name="alrFieldSelM">');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.hide();
                                        newInnerDiv.hide();
                                        newSelect.hide();
                                        
                                        //Contenitore per tabella delle soglie
                                        addWidgetRangeTableContainerM = $('<div id="addWidgetRangeTableContainerM" class="row rowCenterContent"></div>');
                                        $("#specificParamsM").append(addWidgetRangeTableContainerM);
                                        addWidgetRangeTableContainerM.hide();
                                        
                                        if(currentParams === null)
                                        {
                                            $('#alrThrSelM').val("no");
                                            $("label[for='alrAxisSelM']").hide();
                                            $('#alrAxisSelM').val(-1);
                                            $('#alrAxisSelM').hide();
                                            $('#parametersM').val('');
                                        }
                                        else
                                        {
                                            //ESPOSIZIONE DEI CAMPI
                                            $('#alrThrSelM').val("yes");
                                            $('#alrAxisSelM').val(currentParams.thresholdObject.target);
                                            $("label[for='alrAxisSelM']").show();
                                            $('#alrAxisSelM').parent().show();
                                            $('#alrAxisSelM').show();
                                            $('#alrAxisSelM').change(alrAxisSelMListener);
                                            $("label[for='alrFieldSelM']").show();
                                            $('#alrFieldSelM').parent().show();
                                            $('#alrFieldSelM').show();
                                            //POPOLAMENTO DELLA SELECT DEI CAMPI
                                            $('#alrAxisSelM').trigger("change");
                                            $('#alrFieldSelM').change(alrFieldSelMListener);
                                            $('#addWidgetRangeTableContainerM').show();
                                            $('#parametersM').val(JSON.stringify(currentParams));
                                        }
                                        break;
            
                                    case "widgetProcess":
                                        //In questo caso mostriamo tutti i campi ad hoc del Process, sicuramente valorizzati in modifica
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $("#urlWidgetM").prop('disabled', false);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, data['info_mess']);
                                        
                                        $("#xAxisDatasetM").prop('required', false);
                                        $("#lineWidthM").prop('required', false);
                                        $("#alrLookM").prop('required', false);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Reperimento elenco dei jobs groups per scheduler
                                        for(var i = 0; i < elencoScheduler.length; i++)
                                        {
                                            $.ajax({
                                                url: "getJobs.php",
                                                data: {action: "getJobGroupsForScheduler", host: elencoScheduler[i].ip, user: elencoScheduler[i].user, pass: elencoScheduler[i].pass},
                                                type: "POST",
                                                async: false,
                                                dataType: 'json',
                                                success: function (data) 
                                                {
                                                    for(var j = 0; j < data.length; j++) 
                                                    {
                                                        elencoJobsGroupsPerScheduler[i][j] = data[j].id;
                                                    }
                                                }
                                            });
                                        }
                                        
                                        //Campo scheduler
                                        $("#schedulerRowM").css("display", "");
                                        $("label[for='inputSchedulerWidgetM']").css("display", "");
                                        $('#inputSchedulerWidgetDivM').css("display", "");
                                        $('#inputSchedulerWidgetGroupDivM').css("display", "");
                                        $('#inputSchedulerWidgetM').css("display", "");
                                        $('#inputSchedulerWidgetM').val(parameters.schedulerName);
                                        $('#inputSchedulerWidgetM').trigger("change");
                                        
                                        //Job areas solo se presente
                                        if(parameters.jobArea !== "")
                                        {
                                            $('#jobsAreasRowM').css("display", "");
                                            $("label[for='inputJobsAreasWidgetM']").css("display", "");
                                            $('#inputJobsAreasWidgetDivM').css("display", "");
                                            $('#inputJobsAreasWidgetGroupDivM').css("display", "");
                                            $('#inputJobsAreasWidgetM').css("display", "");
                                            $('#inputJobsAreasWidgetM').val(parameters.jobArea);
                                            $('#inputJobsAreasWidgetM').trigger("change");
                                        }
                                        else
                                        {
                                            $('#jobsAreasRowM').css("display", "none");
                                            $("label[for='inputJobsAreasWidgetM']").css("display", "none");
                                            $('#inputJobsAreasWidgetDivM').css("display", "none");
                                            $('#inputJobsAreasWidgetGroupDivM').css("display", "none");
                                            $('#inputJobsAreasWidgetM').css("display", "none");
                                        }
                                        
                                        //Job group
                                        $('#jobsGroupsRowM').css("display", "");
                                        $("label[for='inputJobsGroupsWidgetM']").css("display", "");
                                        $('#inputJobsGroupsWidgetDivM').css("display", "");
                                        $('#inputJobsGroupsWidgetGroupDivM').css("display", "");
                                        $('#inputJobsGroupsWidgetM').css("display", "");
                                        $('#inputJobsGroupsWidgetM').val(parameters.jobGroup);
                                        $('#inputJobsGroupsWidgetM').trigger("change");
                                        
                                        //Job name
                                        $('#jobsNamesRowM').css("display", "");
                                        $("label[for='inputJobsNamesWidgetM']").css("display", "");
                                        $('#inputJobsNamesWidgetDivM').css("display", "");
                                        $('#inputJobsNamesWidgetGroupDivM').css("display", "");
                                        $('#inputJobsNamesWidgetM').css("display", "");
                                        $('#inputJobsNamesWidgetM').val(parameters.jobName);
                                        $('#inputJobsNamesWidgetM').trigger("change");
                                        break;
                                        
                                    case "widgetProtezioneCivile":
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                        }
                                       
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').val('Protezione civile');
                                        $('#inputTitleWidgetM').attr('disabled', true);
                                        $('#inputTitleWidgetM').prop('required', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val("");
                                        $("#widgetFontColorM").parent().parent().colorpicker({color: "#eeeeee", format: "rgba"});
                                        $("#widgetFontColorM").css("background-color", "#eeeeee");
                                        $('#inputFontColorM').val("");
                                        $('#inputFontColorM').attr('disabled', true);
                                        $('#inputFontColorM').prop('required', false);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').prop('required', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').prop('required', false);
                                        $('#inputHeaderFontColorWidgetM').val("");
                                        $('#widgetHeaderFontColorM').css("background-color", "#eeeeee");
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Nuova riga
                                        //Default tab
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="inputDefaultTabM" class="col-md-2 control-label">Default tab</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="inputDefaultTabM" name="inputDefaultTabM"></select>');
                                        newSelect.append('<option value="0">General</option>');
                                        newSelect.append('<option value="1">Meteo</option>');
                                        newSelect.append('<option value="-1">None (automatic switch)</option>');
                                        newSelect.val(data['defaultTab']);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Meteo tab font size
                                       newLabel = $('<label for="meteoTabFontSizeM" class="col-md-2 control-label">Meteo tab font size</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newInput = $('<input type="text" class="form-control" id="meteoTabFontSizeM" name="meteoTabFontSizeM"></input>');
                                       //newInput.val("10");
                                       newInnerDiv.append(newInput);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.show();
                                       newInnerDiv.show();
                                       newInput.show();

                                       //Nuova riga
                                       //General tab font size
                                       newFormRow = $('<div class="row"></div>');
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel = $('<label for="genTabFontSizeM" class="col-md-2 control-label">General tab font size</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newInput = $('<input type="text" class="form-control" id="genTabFontSizeM" name="genTabFontSizeM"></input>');
                                       //newInput.val("12");
                                       newInnerDiv.append(newInput);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.show();
                                       newInnerDiv.show();
                                       newInput.show();

                                       //General tab font color
                                       newLabel = $('<label for="genTabFontColorM" class="col-md-2 control-label">General tab font color</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newInput = $('<div id="genTabFontColorContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="genTabFontColorM" name="genTabFontColorM" required><span class="input-group-addon"><i id="widgetGenTabFontColorM"></i></span></div>');
                                       newInnerDiv.append(newInput);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       newLabel.show();
                                       newInnerDiv.show();
                                       $('#genTabFontColorContainerM').show();
                                       $('#genTabFontColorM').show();
                                       $("#genTabFontColorM").css('display', 'block');
                                       $("#genTabFontColorM").prop("required", true);
                                       $("#genTabFontColorM").attr("disabled", false);
                                       
                                        if(styleParamsRaw !== null) 
                                        {
                                            $("#meteoTabFontSizeM").val(styleParameters.meteoTabFontSize);
                                            $("#genTabFontSizeM").val(styleParameters.genTabFontSize);
                                            $("#widgetGenTabFontColorM").parent().parent().colorpicker({color: styleParameters.genTabFontColor, format: "rgba"});
                                        }
                                        
                                        break;
                                        
                                    case "widgetButton":
                                       if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw);
                                        }
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Button text");
                                        $("label[for='inputColorWidgetM']").html("Button color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').attr('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', true);
                                        $('#select-frameColor-Widget-m').prop('required', false);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').val('');
                                        $('#inputFreqWidgetM').prop('disabled', true);
                                        $('#inputFreqWidgetM').prop('required', false);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').prop('required', false);
                                        $('#inputHeaderFontColorWidgetM').val("");
                                        $('#widgetHeaderFontColorM').css("background-color", "#eeeeee");
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                       //Nuova riga
                                       //Border radius and button image yes/no
                                       newFormRow = $('<div class="row"></div>');
                                       newLabel = $('<label for="editWidgetBtnRadius" class="col-md-2 control-label">Border radius</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       var newControl = $('<input id="editWidgetBtnRadius" name="editWidgetBtnRadius" data-slider-id="editWidgetBtnRadiusSlider" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="0"/>');
                                       newInnerDiv.append(newControl);
                                       newInnerDiv.find('#editWidgetBtnRadius').bootstrapSlider({
                                          value: styleParameters.borderRadius,
                                          formatter: function(value) {
                                             return value + "%";
                                          }
                                       });
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);

                                       newLabel = $('<label for="editWidgetBtnImgSelect" class="col-md-2 control-label">Button image</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select id="editWidgetBtnImgSelect" name="editWidgetBtnImgSelect" class="form-control"></select>');
                                       newSelect.append('<option value="yes">Yes</option>');
                                       newSelect.append('<option value="no">No</option>');
                                       newSelect.val("no");
                                       newInnerDiv.append(newSelect);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       
                                       if(styleParamsRaw !== null) 
                                       {
                                           newSelect.val(styleParameters.hasImage);
                                       }
                                       
                                       $("#specificParamsM").append(newFormRow);
                                       
                                       //Nuova riga
                                       //Button image file chooser
                                       newFormRow = $('<div class="row"></div>');
                                       newFormRow.hide();
                                       newLabel = $('<label for="editWidgetBtnFile" class="col-md-2 control-label">Image file</label>');
                                       newInnerDiv = $('<div class="col-md-8"></div>');
                                       var btnImgMaxSize = $('<input type="hidden" name="MAX_FILE_SIZE" value="1000000" />');
                                       newInnerDiv.append(btnImgMaxSize);
                                       var newControl = $('<div class="input-group"><label class="input-group-btn"><span class="btn btn-primary">Browse<input id="editWidgetBtnFile" name="editWidgetBtnFile" type="file" style="display: none;" accept="image/*"></span></label><input id="editWidgetBtnFilename" type="text" class="form-control" readonly=""></div>');

                                       newInnerDiv.append(newControl);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);

                                       newControl.find("input[type=file]").change(function() 
                                       {
                                          var filename = $(this).val().replace(/\\/g, '/').replace(/.*\//, '');
                                          $("#editWidgetBtnFilename").val(filename);
                                       });
                                       
                                       if(styleParameters.hasImage === 'yes')
                                       {
                                          newFormRow.show();
                                       }

                                       //Nuova riga
                                       //Button image width and height
                                       newFormRow = $('<div class="row"></div>');
                                       newFormRow.hide();
                                       newLabel = $('<label for="editWidgetBtnImgWidth" class="col-md-2 control-label">Image width</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       var newControl = $('<input id="editWidgetBtnImgWidth" name="editWidgetBtnImgWidth" data-slider-id="editWidgetBtnImgWidthSlider" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1"/>');
                                       newInnerDiv.append(newControl);
                                       
                                       var widthValue = null;
                                       if(styleParameters.hasImage === 'yes')
                                       {
                                          widthValue = styleParameters.imageWidth;
                                       }
                                       else
                                       {
                                          widthValue = 100;
                                       }
                                       
                                       newInnerDiv.find('#editWidgetBtnImgWidth').bootstrapSlider({
                                          value: widthValue,
                                          formatter: function(value) {
                                             return value + "%";
                                          }
                                       });
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);

                                       newLabel = $('<label for="editWidgetBtnImgHeight" class="col-md-2 control-label">Image height</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       var newControl = $('<input id="editWidgetBtnImgHeight" name="editWidgetBtnImgHeight" data-slider-id="editWidgetBtnImgHeightSlider" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="100"/>');
                                       newInnerDiv.append(newControl);
                                       
                                       var heightValue = null;
                                       if(styleParameters.hasImage === 'yes')
                                       {
                                          heightValue = styleParameters.imageHeight;
                                       }
                                       else
                                       {
                                          heightValue = 100;
                                       }
                                       newInnerDiv.find('#editWidgetBtnImgHeight').bootstrapSlider({
                                          value: heightValue,
                                          formatter: function(value) {
                                             return value + "%";
                                          }
                                       });
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       
                                       if(styleParameters.hasImage === 'yes')
                                       {
                                          newFormRow.show();
                                       }

                                       $("#editWidgetBtnImgSelect").off();
                                       $("#editWidgetBtnImgSelect").change(function(){
                                          if($(this).val() === 'yes')
                                          {
                                             $("#specificParamsM div.row").eq(1).show();
                                             $("#specificParamsM div.row").eq(2).show();
                                          }
                                          else
                                          {
                                             $("#specificParamsM div.row").eq(1).hide();
                                             $("#specificParamsM div.row").eq(2).hide();
                                          }
                                       });
                                       
                                       
                                        //Nuova riga
                                        //Target widgets per cambio metrica
                                        
                                        //JSON degli eventi da mostrare su ogni widget target di questo widget events
                                        var targetsJson = currentParams;
                                        $("#parametersM").val(JSON.stringify(targetsJson));
                                        
                                        newFormRow = $('<div class="row"></div>');
                                        newLabel = $('<label for="editWidgetChangeMetricWidgets" class="col-md-2 control-label">Available widgets for metric change</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select name="editWidgetChangeMetricWidgets" class="form-control" id="editWidgetChangeMetricWidgets"></select>');

                                        var widgetId, widgetTitle = null;
                                        var widgetsNumber = 0;

                                        $("li.gs_w").each(function(){
                                           if((!$(this).attr("id").includes("Alarms"))&&(!$(this).attr("id").includes("Button"))&&(!$(this).attr("id").includes("Clock"))&&(!$(this).attr("id").includes("EvacuationPlans"))&&(!$(this).attr("id").includes("Events"))&&(!$(this).attr("id").includes("ExternalContent"))&&(!$(this).attr("id").includes("FirstAid"))&&(!$(this).attr("id").includes("GenericContent"))&&(!$(this).attr("id").includes("MapBusPosition"))&&(!$(this).attr("id").includes("NetworkAnalysis"))&&(!$(this).attr("id").includes("PrevMeteo"))&&(!$(this).attr("id").includes("Process"))&&(!$(this).attr("id").includes("ProtezioneCivile"))&&(!$(this).attr("id").includes("Resources"))&&(!$(this).attr("id").includes("Sce"))&&(!$(this).attr("id").includes("Separator"))&&(!$(this).attr("id").includes("ServiceMap"))&&(!$(this).attr("id").includes("SmartDS"))&&(!$(this).attr("id").includes("StateRideAtaf"))&&(!$(this).attr("id").includes("TrafficEvents"))&&(!$(this).attr("id").includes("TrendMentions"))&&(!$(this).attr("id").includes("Twitter")))
                                           {
                                              widgetId = $(this).attr("id");
                                              widgetTitle = $(this).find("div.titleDiv").html();
                                              newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                              widgetsNumber++;
                                           }
                                        });
                                        
                                        newSelect.val(-1);
                                        
                                        if(widgetsNumber > 0)
                                        {
                                           newInnerDiv.append(newSelect);
                                        }
                                        else
                                        {
                                            newInnerDiv.append('<span id="editWidgetChangeMetricWidgetsNoneMsg">None</span>')
                                        }

                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        newLabel = $('<label for="editWidgetChangeMetricMetrics" class="col-md-2 control-label">Available metrics for selected widget</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select name="editWidgetChangeMetricMetrics" class="form-control" id="editWidgetChangeMetricMetrics"></select>');
                                        newInnerDiv.append(newSelect);
                                        newInnerDiv.append('<span id="editWidgetChangeMetricMetricsNoneMsg">None</span>');
                                        newSelect.hide();
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        $("#specificParamsM").append(newFormRow);
                                        
                                        $("#editWidgetChangeMetricMetricsNoneMsg").hide();
                                        $("#editWidgetChangeMetricMetrics").hide();

                                        if(widgetsNumber > 0)
                                        {
                                           $("#editWidgetChangeMetricWidgets").change(function(){
                                               if($(this).val() !== -1)
                                               {
                                                   //Repere delle metriche applicabili a quel widget
                                                   $.ajax({
                                                        url: "process-form.php",
                                                        type: "GET",
                                                        data: {
                                                            getMetricsForWidgetType: true,
                                                            widgetId: $("#editWidgetChangeMetricWidgets").val()
                                                        },
                                                        async: true,
                                                        //dataType: 'json',
                                                        success: function(metricsList) 
                                                        {
                                                            metricsList = JSON.parse(metricsList);
                                                            $("#editWidgetChangeMetricMetrics").empty();

                                                            if(metricsList.length === 0)
                                                            {
                                                                $("#editWidgetChangeMetricMetrics").hide();
                                                                $("#editWidgetChangeMetricMetricsNoneMsg").show();
                                                            }
                                                            else
                                                            {
                                                                $("#editWidgetChangeMetricMetrics").append('<option value="noMetricChange">No metric change</option>');
                                                                for(var i = 0; i < metricsList.length; i++)
                                                                {
                                                                    $("#editWidgetChangeMetricMetrics").append('<option value="' + metricsList[i] + '">' + metricsList[i] + '</option>');
                                                                }

                                                                $("#editWidgetChangeMetricMetrics").val(targetsJson.changeMetricTargetsJson[$("#editWidgetChangeMetricWidgets").val()]);
                                                                $("#editWidgetChangeMetricMetricsNoneMsg").hide();
                                                                $("#editWidgetChangeMetricMetrics").show();
                                                            }
                                                        },
                                                        error: function(errorData)
                                                        {
                                                           $("#editWidgetChangeMetricMetrics").hide();
                                                           $("#editWidgetChangeMetricMetricsNoneMsg").show();
                                                           console.log("Errore in caricamento metriche caricabili per widget target");
                                                           console.log(JSON.stringify(errorData));
                                                        }
                                                    });
                                               }
                                               else
                                               {
                                                   $("#editWidgetChangeMetricMetrics").hide();
                                                   $("#editWidgetChangeMetricMetricsNoneMsg").show();
                                               }
                                           }); 

                                           $("#editWidgetChangeMetricMetrics").change(function(){
                                               targetsJson.changeMetricTargetsJson[$("#editWidgetChangeMetricWidgets").val()] = $(this).val();
                                               $("#parametersM").val(JSON.stringify(targetsJson));
                                           });
                                        }
                                        else
                                        {
                                            $("#editWidgetChangeMetricMetrics").hide();
                                            $("#editWidgetChangeMetricMetricsNoneMsg").show();
                                        }
                                       
                                       //Nuova riga
                                       //Show/hide text + target widgets per geolocation
                                       newFormRow = $('<div class="row"></div>');
                                       
                                       newLabel = $('<label for="editWidgetShowButtonText" class="col-md-2 control-label">Show button text</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select name="editWidgetShowButtonText" class="form-control" id="editWidgetShowButtonText"></select>');
                                       newSelect.append('<option value="yes">Yes</option>');
                                       newSelect.append('<option value="no">No</option>');
                                       newInnerDiv.append(newSelect);
                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       newSelect.val(styleParameters.showText);
                                       
                                       newLabel = $('<label for="editWidgetGeolocationWidgets" class="col-md-2 control-label">Available widgets to show link content</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select name="editWidgetGeolocationWidgets" class="form-control" id="editWidgetGeolocationWidgets" multiple></select>');

                                       var widgetId, widgetTitle = null;
                                       var widgetsNumber = 0;
                                       
                                       $("li.gs_w").each(function(){
                                          if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") !== "gisTarget")&&($(this).find("div.widget").attr("data-role") !== "map"))
                                          {
                                             widgetId = $(this).attr("id");
                                             widgetTitle = $(this).find("div.titleDiv").html();
                                             newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                             widgetsNumber++;
                                          }
                                       });

                                       if(widgetsNumber > 0)
                                       {
                                          newInnerDiv.append(newSelect);
                                       }
                                       else
                                       {
                                          newInnerDiv.append("None");
                                       }

                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel.show();
                                       newInnerDiv.show();

                                       if(widgetsNumber > 0)
                                       {
                                          $('#editWidgetGeolocationWidgets').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });
                                          
                                          $('#editWidgetGeolocationWidgets').selectpicker('val', targetsJson.geoTargetsJson);

                                          $('#editWidgetGeolocationWidgets').on('changed.bs.select', function (e) 
                                          {
                                             if($(this).val() === null)
                                             {
                                                targetsJson.geoTargetsJson = [];
                                             }
                                             else
                                             {
                                                targetsJson.geoTargetsJson = $(this).val();
                                             }
                                             $("#parametersM").val(JSON.stringify(targetsJson));
                                          });
                                       }
                                       break;
                                        
                                    case "widgetGenericContent":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;        
                                        
                                    case "widgetSingleContent":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').attr('disabled', false);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", true);
                                        $('#inputUdmWidgetM').attr("disabled", false);
                                        $('#inputUdmPositionM').prop("required", true);
                                        $('#inputUdmPositionM').attr("disabled", false);
                                        $("#inputUdmPositionM").val(data['udmPos']);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Campo di registrazione widget sul Notificatore
                                        editWidgetGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                        
                                    case "widgetBarContent":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Campo di registrazione widget sul Notificatore
                                        editWidgetGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                        
                                    case "widgetColumnContent":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Campo di registrazione widget sul Notificatore
                                        editWidgetGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                        
                                    case "widgetGaugeChart":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Campo di registrazione widget sul Notificatore
                                        editWidgetGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                        
                                    case "widgetPieChart":
                                        var metricId = $('#metricWidgetM').val();
                                        var metricData = getMetricData(metricId);
                                        var seriesString, series, newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, newHiddenColors, newColorsTableContainer, newColorsTable1Container, newColorsTable2Container, colorsTable1M, colorsTable2M, valuesNum, newRow, newCell, thrSimpleTables, thrTables1, thrTables2, i, j, k, min, max, color, newTableRow, newTableCell, currentFieldIndex, currentSeriesIndex, thrSeries, colorsTable = null;
                                        var defaultColorsArray = ['#ffcc00', '#33ccff', '#00ff00', '#ff99ff', '#cc6600', '#0066ff', '#ff3300', '#cc9900', '#9900cc', '#003300'];
                                        var colorsArray1M = [];
                                        var colorsArray2M = [];
                                        var table1Shown = false;
                                        var table2Shown = false;
                                        
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').val("");
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontColorM').val("");
                                        $('#inputFontColorM').attr('disabled', true);
                                        $('#inputFontColorM').prop('required', false);
                                        $('#widgetFontColorM').css("background-color", "#EEEEEE");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        if(metricType.indexOf('Percentuale') >= 0)
                                        {
                                            showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        }
                                        else
                                        {
                                            seriesString = metricData.data[0].commit.author.series;
                                            series = jQuery.parseJSON(seriesString);
                                            showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, series, infoJson, info_mess);
                                        }
                                        
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw); 
                                        }
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Legend font size e font color
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="legendFontSizeM" class="col-md-2 control-label">Legend font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="legendFontSizeM" name="legendFontSizeM" required>');
                                        newInput.val(styleParameters.legendFontSize);
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel = $('<label for="legendFontColorM" class="col-md-2 control-label">Legend font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<div id="legendFontColorPickerContainerM" class="input-group"><input type="text" class="form-control demo-1 demo-auto" id="legendFontColorPickerM" name="legendFontColorPickerM" required><span class="input-group-addon"><i id="widgetLegendFontColorPickerM"></i></span></div>');
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        $("#widgetLegendFontColorPickerM").css('display', 'block');
                                        $("#widgetLegendFontColorPickerM").parent().parent().parent().colorpicker({color: styleParameters.legendFontColor, format: "rgba"});
                                        
                                        //Nuova riga
                                        //Datalabels distance (se Percentuale) oppure Datalabels (se Series)
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        if(metricType.indexOf('Percentuale') >= 0)
                                        {
                                            newLabel = $('<label for="dataLabelsDistanceM" class="col-md-2 control-label">Data labels distance</label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInput = $('<input type="text" class="form-control" id="dataLabelsDistanceM" name="dataLabelsDistanceM" required>');
                                            newInput.val(styleParameters.dataLabelsDistance);
                                            newInnerDiv.append(newInput);
                                        }
                                        else if(metricType === 'Series')
                                        {
                                            newLabel = $('<label for="dataLabelsM" class="col-md-2 control-label">Data labels for <i>' + series.firstAxis.desc + '</i></label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newSelect = $('<select class="form-control" id="dataLabelsM" name="dataLabelsM"></select>');
                                            newSelect.append('<option value="no">No data labels</option>');
                                            newSelect.append('<option value="value">Value only</option>');
                                            newSelect.append('<option value="full">Field name and value</option>');
                                            newSelect.val(styleParameters.dataLabels);
                                            newInnerDiv.append(newSelect);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);
                                        }
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Data labels font size
                                        newLabel = $('<label for="dataLabelsFontSizeM" class="col-md-2 control-label">Data labels font size</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsFontSizeM" name="dataLabelsFontSizeM" required>');
                                        newInput.val(styleParameters.dataLabelsFontSize);
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Nuova riga
                                        //Data labels distances per widget series
                                        if(metricType === 'Series')
                                        {
                                            newFormRow = $('<div class="row"></div>');
                                            $("#specificParamsM").append(newFormRow);
                                            //Data labels distance per anello più interno
                                            newLabel = $('<label for="dataLabelsDistance1M" class="col-md-2 control-label">Data labels distance for <i>' + series.secondAxis.desc + '</i></label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInput = $('<input type="text" class="form-control" id="dataLabelsDistance1M" name="dataLabelsDistance1M" required>');
                                            newInput.val(styleParameters.dataLabelsDistance1);
                                            newInnerDiv.append(newInput);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);

                                            //Data labels distance per anello più esterno
                                            newLabel = $('<label for="dataLabelsDistance2M" class="col-md-2 control-label">Data labels distance for <i>' + series.firstAxis.desc + '</i></label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInput = $('<input type="text" class="form-control" id="dataLabelsDistance2M" name="dataLabelsDistance2M" required>');
                                            newInput.val(styleParameters.dataLabelsDistance2);
                                            newInnerDiv.append(newInput);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);
                                        }
                                        
                                        //Nuova riga
                                        //Data labels font color
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="dataLabelsFontColorM" class="col-md-2 control-label">Data labels font color</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInputGroup = $('<div class="input-group color-choice">');
                                        newInput = $('<input type="text" class="form-control" id="dataLabelsFontColorM" name="dataLabelsFontColorM" required>');
                                        newSpan = $('<span class="input-group-addon"><i id="widgetDataLabelsFontColorM"></i></span>');
                                        newInputGroup.append(newInput);
                                        newInputGroup.append(newSpan);
                                        newInnerDiv.append(newInputGroup);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newInnerDiv.colorpicker({color: styleParameters.dataLabelsFontColor, format: "rgba"});
                                        
                                        //Inner radius 1
                                        if(metricType.indexOf('Percentuale') >= 0)
                                        {
                                            newLabel = $('<label for="innerRadius1M" class="col-md-2 control-label">Inner radius (%)</label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInput = $('<input type="text" class="form-control" id="innerRadius1M" name="innerRadius1M" required>');
                                            newInput.val(styleParameters.innerRadius1);
                                        }
                                        else if(metricType === 'Series')
                                        {
                                            newLabel = $('<label for="innerRadius1M" class="col-md-2 control-label">Inner radius for <i>' + series.secondAxis.desc + '</i> (%)</label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInput = $('<input type="text" class="form-control" id="innerRadius1M" name="innerRadius1M" required>');
                                            newInput.val(styleParameters.innerRadius1);
                                        }
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Nuova riga
                                        //Questi raggi sono solo per la versione series
                                        if(metricType === 'Series')
                                        {
                                           //Outer radius 1
                                            newFormRow = $('<div class="row"></div>');
                                            $("#specificParamsM").append(newFormRow);
                                            newLabel = $('<label for="outerRadius1M" class="col-md-2 control-label">Outer radius for <i>' + series.secondAxis.desc + '</i> (%)</label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInput = $('<input type="text" class="form-control" id="outerRadius1M" name="outerRadius1M" required>');
                                            newInput.val(styleParameters.outerRadius1);
                                            newInnerDiv.append(newInput);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);

                                            //Inner radius 2
                                            newLabel = $('<label for="innerRadius2M" class="col-md-2 control-label">Inner radius for <i>' + series.firstAxis.desc + '</i> (%)</label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInput = $('<input type="text" class="form-control" id="innerRadius2M" name="innerRadius2M" required>');
                                            newInput.val(styleParameters.innerRadius2);
                                            newInnerDiv.append(newInput);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv); 
                                        }
                                        
                                        //Nuova riga
                                        //Start angle
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="startAngleM" class="col-md-2 control-label">Start angle (°)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="startAngleM" name="startAngleM" required>');
                                        newInput.val(styleParameters.startAngle);
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        //End angle
                                        newLabel = $('<label for="endAngleM" class="col-md-2 control-label">End angle (°)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="endAngleM" name="endAngleM" required>');
                                        newInput.val(styleParameters.endAngle);
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Nuova riga
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        //Center Y
                                        newLabel = $('<label for="centerYM" class="col-md-2 control-label">Diagram center Y(%)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="centerYM" name="centerYM" required>');
                                        newInput.val(styleParameters.centerY);
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Select per colori automatici/manuali
                                        if(metricType.indexOf('Percentuale') >= 0)
                                        {
                                            newLabel = $('<label for="colorsSelect1M" class="col-md-2 control-label">Slices colors</label>');
                                        }
                                        else if(metricType === 'Series')
                                        {
                                            newLabel = $('<label for="colorsSelect1M" class="col-md-2 control-label">Slices colors for <i>' + series.secondAxis.desc + '</i></label>');
                                        }
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="colorsSelect1M" name="colorsSelect1M"></select>');
                                        newSelect.append('<option value="auto">Automatic</option>');
                                        newSelect.append('<option value="manual">Manual</option>');
                                        newSelect.val(styleParameters.colorsSelect1);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        //Campo hidden per i colori
                                        newHiddenColors = $('<input type="hidden" id="colors1M" name="colors1M">');
                                        $("#specificParamsM").append(newHiddenColors);
                                        newHiddenColors = $('<input type="hidden" id="colors2M" name="colors2M">');
                                        $("#specificParamsM").append(newHiddenColors);

                                        //Div contenitore per la tabella dei colori
                                        newColorsTableContainer = $('<div id="colorsTableContainerM" class="row rowCenterContent" style="width: 100%; margin-left: 0px;"></div>');
                                        newColorsTable1Container = $('<div id="colorsTable1ContainerM" style="width: 100%; float: left;"></div>');
                                        newColorsTable2Container = $('<div id="colorsTable2ContainerM" style="width: 100%; float: left;"></div>');
                                        newColorsTableContainer.append(newColorsTable1Container);
                                        
                                        function updateWidgetPieChartColors1M(e, params)
                                        {
                                            var newColor = $(this).colorpicker('getValue');
                                            var index = parseInt($(this).parents('tr').index() - 1);
                                            colorsArray1M[index] = newColor;
                                            $("#colors1M").val(JSON.stringify(colorsArray1M));
                                        }
                                        
                                        function updateWidgetPieChartColors2M(e, params)
                                        {
                                            var newColor = $(this).colorpicker('getValue');
                                            var index = parseInt($(this).parents('tr').index() - 1);
                                            colorsArray2M[index] = newColor;
                                            $("#colors2M").val(JSON.stringify(colorsArray2M));
                                        }
                                        
                                        //Aggiunta al form dei campi per parametri specifici
                                        if(metricType.indexOf('Percentuale') >= 0)
                                        {
                                            $("#specificParamsM").append(newColorsTableContainer);
                                            
                                            newColorsTable1Container.hide();
                                            newColorsTableContainer.hide();
                                            
                                            //Form per dati tradizionali percentuali
                                            var valuePerc = [];
                                            var descriptions = [];
                                            valuePerc[0] = metricData.data[0].commit.author.value_perc1;
                                            valuePerc[1] = metricData.data[0].commit.author.value_perc2;
                                            valuePerc[2] = metricData.data[0].commit.author.value_perc3;
                                            
                                            colorsTable1M = $("<table class='table table-bordered table-condensed thrRangeTable' style='width: 100%;'><tr><td>Field</td><td>Color</td></tr></table>");
                                            
                                            //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                            if((valuePerc[0] !== null) && (valuePerc[1] !== null) && (valuePerc[2] !== null))
                                            {
                                                valuesNum = 3;
                                                descriptions[0] = metricData.data[0].commit.author.field1Desc;
                                                descriptions[1] = metricData.data[0].commit.author.field2Desc;
                                                descriptions[2] = metricData.data[0].commit.author.field3Desc;
                                            }
                                            else if((valuePerc[0] !== null) && (valuePerc[1] !== null) && (valuePerc[2] === null))
                                            {
                                                valuesNum = 2;
                                                descriptions[0] = metricData.data[0].commit.author.field1Desc;
                                                descriptions[1] = metricData.data[0].commit.author.field2Desc;
                                            }
                                            else if((valuePerc[0] !== null) && (valuePerc[1] === null) && (valuePerc[2] === null))
                                            {
                                                valuesNum = 1;
                                                descriptions[0] = metricData.data[0].commit.author.field1Desc;
                                            }
                                            
                                            //Costruzione tabella dei colori iniziale
                                            for(var i = 0; i < valuesNum; i++)
                                            {
                                                colorsArray1M[i] = styleParameters.colors1[i];
                                                newRow = $('<tr></tr>');
                                                //newCell = $('<td>Value ' + parseInt(i+1) + '</td>');
                                                newCell = $('<td>' + descriptions[i] + '</td>');
                                                newRow.append(newCell);
                                                newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                                newRow.append(newCell);
                                                newRow.find('div.colorPicker').colorpicker({color: colorsArray1M[i], format: "rgba"});
                                                newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors1M);
                                                colorsTable1M.append(newRow);
                                            }
                                            
                                            if(valuesNum === 1)
                                            {
                                                colorsArray1M[1] = styleParameters.colors1[1];
                                                newRow = $('<tr></tr>');
                                                newCell = $('<td>Complementary</td>');
                                                newRow.append(newCell);
                                                newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                                newRow.append(newCell);
                                                newRow.find('div.colorPicker').colorpicker({color: colorsArray1M[1], format: "rgba"});
                                                newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors1M);
                                                colorsTable1M.append(newRow);
                                            }
                                            
                                            $("#colors1M").val(JSON.stringify(colorsArray1M));    
                                            newColorsTable1Container.append(colorsTable1M);   
                                            colorsTable1M.hide();
                                        }
                                        else if(metricType === 'Series')
                                        {
                                            //Nuova riga
                                            newFormRow = $('<div class="row"></div>');
                                            $("#specificParamsM").append(newFormRow);
                                            newLabel = $('<label for="colorsSelect2M" class="col-md-2 control-label">Slices colors for <i>' + series.firstAxis.desc + '</i></label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newSelect = $('<select class="form-control" id="colorsSelect2M" name="colorsSelect2M"></select>');
                                            newSelect.append('<option value="auto">Automatic</option>');
                                            newSelect.append('<option value="manual">Manual</option>');
                                            newSelect.val(styleParameters.colorsSelect2);
                                            newInnerDiv.append(newSelect);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);

                                            newColorsTableContainer.append(newColorsTable2Container);
                                            
                                            $("#specificParamsM").append(newColorsTableContainer);
                                            
                                            newColorsTable1Container.hide();
                                            newColorsTable2Container.hide();
                                            newColorsTableContainer.hide();

                                            //Form per dati Series
                                            colorsTable1M = $("<table class='table table-bordered table-condensed thrRangeTable' style='width: 100%;'><tr><td>Fields of set <b>" + series.secondAxis.desc + "</b></td><td>Color</td></tr></table>");
                                            colorsTable2M = $("<table class='table table-bordered table-condensed thrRangeTable' style='width: 100%;'><tr><td>Fields of set <b>" + series.firstAxis.desc + "</b></td><td>Color</td></tr></table>");
                                        
                                            //Costruiamo la tabella dei colori e il corrispondente JSON una tantum e mostriamola/nascondiamola a seconda di cosa sceglie l'utente, per non perdere eventuali colori immessi in precedenza.
                                            for(var i = 0; i < series.secondAxis.labels.length; i++)
                                            {
                                                colorsArray1M[i] = styleParameters.colors1[i];
                                                newRow = $('<tr></tr>');
                                                newCell = $('<td>' + series.secondAxis.labels[i] + '</td>');
                                                newRow.append(newCell);
                                                newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                                newRow.append(newCell);
                                                newRow.find('div.colorPicker').colorpicker({color: colorsArray1M[i], format: "rgba"});
                                                newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors1M);
                                                colorsTable1M.append(newRow);
                                            }
                                            
                                            for(var i = 0; i < series.firstAxis.labels.length; i++)
                                            {
                                                colorsArray2M[i] = styleParameters.colors2[i];
                                                newRow = $('<tr></tr>');
                                                newCell = $('<td>' + series.firstAxis.labels[i] + '</td>');
                                                newRow.append(newCell);
                                                newCell = $('<td><div class="input-group colorPicker"><input type="text" class="form-control"><span class="input-group-addon"><i class="thePicker"></i></span></div></td>');
                                                newRow.append(newCell);
                                                newRow.find('div.colorPicker').colorpicker({color: colorsArray2M[i], format: "rgba"});
                                                newRow.find('div.colorPicker').on('changeColor', updateWidgetPieChartColors2M);
                                                colorsTable2M.append(newRow);
                                            }
                                            
                                            $("#colors1M").val(JSON.stringify(colorsArray1M));    
                                            newColorsTable1Container.append(colorsTable1M);
                                            $("#colors2M").val(JSON.stringify(colorsArray2M));    
                                            newColorsTable2Container.append(colorsTable2M);
                                            colorsTable1M.hide();
                                            colorsTable2M.hide();
                                        }
                                        
                                        if($("#colorsSelect1M").val() === 'manual')
                                        {
                                            $('#colorsTableContainerM').css("display", "block");
                                            $('#colorsTable1ContainerM').css("display", "block");
                                            colorsTable1M.css("display", "");
                                            table1Shown = true;
                                        }
                                        else
                                        {
                                            colorsTable1M.css("display", "none");
                                            $('#colorsTable1ContainerM').css("display", "none");
                                            table1Shown = false;
                                            if(table2Shown === false)
                                            {
                                                $('#colorsTableContainerM').css("display", "none");
                                            }
                                        }
                                        
                                        if(metricType === 'Series')
                                        {
                                            if($("#colorsSelect2M").val() === 'manual')
                                            {
                                                $('#colorsTableContainerM').css("display", "block");
                                                $('#colorsTable2ContainerM').css("display", "block");
                                                colorsTable2M.css("display", "");
                                                table2Shown = true;
                                            }
                                            else
                                            {
                                                colorsTable2M.css("display", "none");
                                                $('#colorsTable2ContainerM').css("display", "none");
                                                table2Shown = false;
                                                if(table1Shown === false)
                                                {
                                                    $('#colorsTableContainerM').css("display", "none");
                                                }
                                            }
                                        }
                                        
                                        $('#colorsSelect1M').change(function () 
                                        {
                                            if($('#colorsSelect1M').val() === "manual")
                                            {
                                                $('#colorsTableContainerM').css("display", "block");
                                                $('#colorsTable1ContainerM').css("display", "block");
                                                colorsTable1M.css("display", "");
                                                table1Shown = true;
                                            }
                                            else
                                            {
                                                colorsTable1M.css("display", "none");
                                                $('#colorsTable1ContainerM').css("display", "none");
                                                table1Shown = false;
                                                if(table2Shown === false)
                                                {
                                                    $('#colorsTableContainerM').css("display", "none");
                                                }
                                            }
                                        });

                                        if(metricType === 'Series')
                                        {
                                            $('#colorsSelect2M').change(function () 
                                            {
                                                if($('#colorsSelect2M').val() === "manual")
                                                {
                                                    $('#colorsTableContainerM').css("display", "block");
                                                    $('#colorsTable2ContainerM').css("display", "block");
                                                    colorsTable2M.css("display", "");
                                                    table2Shown = true;
                                                }
                                                else
                                                {
                                                    colorsTable2M.css("display", "none");
                                                    $('#colorsTable2ContainerM').css("display", "none");
                                                    table2Shown = false;
                                                    if(table1Shown === false)
                                                    {
                                                        $('#colorsTableContainerM').css("display", "none");
                                                    }
                                                }
                                            });
                                        }
                                        
                                        //Codice costruzione soglie
                                        if(metricType.indexOf('Percentuale') >= 0)
                                        {
                                            //Tabelle editabili delle soglie
                                            thrSimpleTables = new Array();

                                            setSimpleGlobals(currentParams, thrSimpleTables, valuePerc, descriptions);

                                            //Costruzione THRTables dai parametri provenienti da DB (vuote se non ci sono soglie per quel campo, anche nel caso di nessuna soglia settata in assoluto
                                            buildThrTablesForEditWidgetSimple();

                                            //Nuova riga
                                            //Set thresholds
                                            newFormRow = $('<div class="row"></div>');
                                            $("#specificParamsM").append(newFormRow);
                                            newLabel = $('<label for="alrThrSelM" class="col-md-2 control-label">Set thresholds</label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newSelect = $('<select class="form-control" id="alrThrSelM" name="alrThrSelM" required>');
                                            newSelect.append('<option value="yes">Yes</option>');
                                            newSelect.append('<option value="no">No</option>');
                                            newInnerDiv.append(newSelect);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);
                                            newLabel.show();
                                            newInnerDiv.show();
                                            newSelect.show();

                                            //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                            $('#alrThrSelM').change(alrThrFlagMListenerSimple);

                                            //Threshold field select
                                            newLabel = $('<label for="alrFieldSelM" class="col-md-2 control-label">Thresholds target field</label>');
                                            newSelect = $('<select class="form-control" id="alrFieldSelM" name="alrFieldSelM">');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInnerDiv.append(newSelect);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);
                                            newLabel.hide();
                                            newInnerDiv.hide();
                                            newSelect.hide();

                                            //Contenitore per tabella delle soglie
                                            addWidgetRangeTableContainerM = $('<div id="addWidgetRangeTableContainerM" class="row rowCenterContent"></div>');
                                            $("#specificParamsM").append(addWidgetRangeTableContainerM);
                                            addWidgetRangeTableContainerM.hide();
                                            
                                            if(currentParams === null)
                                            {
                                                $('#alrThrSelM').val("no");
                                                $('#parametersM').val('');
                                            }
                                            else
                                            {
                                                //ESPOSIZIONE DEI CAMPI
                                                $('#alrThrSelM').val("yes");
                                                $("label[for='alrFieldSelM']").show();
                                                $('#alrFieldSelM').parent().show();
                                                $('#alrFieldSelM').show();
                                                //POPOLAMENTO DELLA SELECT DEI CAMPI
                                                for(var i = 0; i < descriptions.length; i++)
                                                {
                                                    $('#alrFieldSelM').append("<option value='" + descriptions[i] + "'>" + descriptions[i] + "</option>");
                                                }
                                                $('#alrFieldSelM').val(-1);
                                                $('#addWidgetRangeTableContainerM').show();
                                                $('#parametersM').val(JSON.stringify(currentParams));
                                                //Listener per selezione campo
                                                $('#alrFieldSelM').change(alrFieldSelMListenerSimple);
                                            }
                                        }
                                        else if(metricType === 'Series')
                                        {
                                            thrTables1 = new Array();
                                            thrTables2 = new Array();
                                            setGlobals(currentParams, thrTables1, thrTables2, series, $('#select-widget-m').val());
                                            
                                            //Costruzione THRTables dai parametri provenienti da DB (vuote se non ci sono soglie per quel campo, anche nel caso di nessuna soglia settata in assoluto
                                            buildThrTablesForEditWidget();
                                            
                                            //Codice di creazione soglie
                                            //Nuova riga
                                            //Set thresholds
                                            newFormRow = $('<div class="row"></div>');
                                            $("#specificParamsM").append(newFormRow);
                                            newLabel = $('<label for="alrThrSelM" class="col-md-2 control-label">Set thresholds</label>');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newSelect = $('<select class="form-control" id="alrThrSelM" name="alrThrSelM" required>');
                                            newSelect.append('<option value="yes">Yes</option>');
                                            newSelect.append('<option value="no">No</option>');
                                            newInnerDiv.append(newSelect);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);
                                            newLabel.show();
                                            newInnerDiv.show();
                                            newSelect.show();

                                            //Threshold target select - Questa select viene nascosta o mostrata a seconda che nella "Set thresholds" si selezioni yes o no.
                                            newLabel = $('<label for="alrAxisSelM" class="col-md-2 control-label">Thresholds target set</label>');
                                            newSelect = $('<select class="form-control" id="alrAxisSelM" name="alrAxisSelM"></select>');
                                            newSelect.append("<option value='" + series.firstAxis.desc + "'>" + series.firstAxis.desc + "</option>");
                                            newSelect.val(-1);
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInnerDiv.append(newSelect);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);
                                            newLabel.hide();
                                            newInnerDiv.hide();
                                            newSelect.hide();

                                            //Nuova riga
                                            //Threshold field select
                                            newFormRow = $('<div class="row"></div>');
                                            $("#specificParamsM").append(newFormRow);
                                            newLabel = $('<label for="alrFieldSelM" class="col-md-2 control-label">Thresholds target field</label>');
                                            newSelect = $('<select class="form-control" id="alrFieldSelM" name="alrFieldSelM">');
                                            newInnerDiv = $('<div class="col-md-3"></div>');
                                            newInnerDiv.append(newSelect);
                                            newFormRow.append(newLabel);
                                            newFormRow.append(newInnerDiv);
                                            newLabel.hide();
                                            newInnerDiv.hide();
                                            newSelect.hide();

                                            //Contenitore per tabella delle soglie
                                            addWidgetRangeTableContainerM = $('<div id="addWidgetRangeTableContainerM" class="row rowCenterContent"></div>');
                                            $("#specificParamsM").append(addWidgetRangeTableContainerM);
                                            addWidgetRangeTableContainerM.hide();

                                            //Listener per settaggio/desettaggio soglie relativo alla select "Set thresholds"
                                            $('#alrThrSelM').change(alrThrFlagMListener);

                                            if(currentParams === null)
                                            {
                                                $('#alrThrSelM').val("no");
                                                $("label[for='alrAxisSelM']").hide();
                                                $('#alrAxisSelM').val(-1);
                                                $('#alrAxisSelM').hide();
                                                $('#parametersM').val('');
                                            }
                                            else
                                            {
                                                //ESPOSIZIONE DEI CAMPI
                                                $('#alrThrSelM').val("yes");
                                                $('#alrAxisSelM').val(currentParams.thresholdObject.target);
                                                $("label[for='alrAxisSelM']").show();
                                                $('#alrAxisSelM').parent().show();
                                                $('#alrAxisSelM').show();
                                                $("label[for='alrFieldSelM']").show();
                                                $('#alrFieldSelM').parent().show();
                                                $('#alrFieldSelM').show();
                                                //POPOLAMENTO DELLA SELECT DEI CAMPI
                                                alrAxisSelMListener();
                                                $('#addWidgetRangeTableContainerM').show();
                                                $('#parametersM').val(JSON.stringify(currentParams));
                                                //Listener per settaggio/desettaggio campi in base ad asse selezionato
                                                $('#alrAxisSelM').change(alrAxisSelMListener);
                                                //Listener per selezione campo
                                                $('#alrFieldSelM').change(alrFieldSelMListener);
                                            }
                                        }
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
                                        
                                    case "widgetSce":
                                        //$("#inputComuneRowM").css("display", "");
                                        //$("label[for='inputComuneWidgetM']").css("display", "");
                                        //$("label[for='inputComuneWidgetM']").text("Context");
                                        //$('#inputComuneWidgetM').css("display", "");
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
                                        
                                    case "widgetSmartDS":
                                        //$("#inputComuneRowM").css("display", "");
                                        //$("label[for='inputComuneWidgetM']").css("display", "");
                                        //$("label[for='inputComuneWidgetM']").text("Context");
                                        //$('#inputComuneWidgetM').css("display", "");
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        if(data['municipality_metric_widget'] === null) 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', true);
                                        } 
                                        else 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', false);
                                        }
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
                                        
                                    case "widgetTimeTrend":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-IntTemp-Widget-m').prop('disabled', false);
                                        $('#select-IntTemp-Widget-m').attr('required', true);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        if(data['municipality_metric_widget'] == null) 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', true);
                                        } 
                                        else 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', false);
                                        }
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Campo di registrazione widget sul Notificatore
                                        editWidgetGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                    
                                    case "widgetTimeTrendCompare":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').attr('disabled', false);
                                        $('#inputFontColorM').prop('required', true);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val("4 Ore");
                                        $('#select-IntTemp-Widget-m').prop('disabled', false);
                                        $('#select-IntTemp-Widget-m').attr('required', true);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        if(data['municipality_metric_widget'] === null) 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', true);
                                        } 
                                        else 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', false);
                                        }
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Campo di registrazione widget sul Notificatore
                                        editWidgetGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                        
                                    case "widgetEvents":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', true);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                       //Rimozione eventuali campi del subform general per widget process
                                       removeWidgetProcessGeneralFields("editWidget");
                                       
                                       //Parametri specifici del widget
                                       $('#specificParamsM .row').remove();
                                       var newFormRow, newLabel, newInnerDiv, newInputGroup, newSelect, newInput, newSpan, addWidgetRangeTableContainer = null;
                                       
                                       //New row
                                       //Widget mode
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="widgetEventsModeM" class="col-md-2 control-label">Widget mode</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="widgetEventsModeM" name="widgetEventsModeM"></select>');
                                        newSelect.append('<option value="list">List</option>');
                                        newSelect.append('<option value="searchAndList">Search filter, results on list</option>');
                                        newSelect.append('<option value="searchAndMap">Search filter, results on map</option>');
                                        newSelect.append('<option value="searchAndListAndMap">Search filter, results on list and map</option>');
                                        newSelect.val(data['viewMode']);
                                        newFormRow.append(newLabel);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newInnerDiv);

                                       //Nuova riga
                                       newFormRow = $('<div class="row"></div>');
                                       $("#specificParamsM").append(newFormRow);

                                       newLabel = $('<label for="editWidgetGeolocationWidgets" class="col-md-2 control-label">Available geolocation widgets</label>');
                                       newInnerDiv = $('<div class="col-md-3"></div>');
                                       newSelect = $('<select class="form-control" id="editWidgetGeolocationWidgets" name="editWidgetGeolocationWidgets"></select>');

                                       var widgetId, widgetTitle = null;
                                       var widgetsNumber = 0;
                                       
                                       //JSON degli eventi da mostrare su ogni widget target di questo widget events
                                       var targetEventsJson = currentParams;
                                       $("#parametersM").val(JSON.stringify(targetEventsJson));

                                       $("li.gs_w").each(function(){
                                          if($(this).attr("id").includes("ExternalContent")&&($(this).find("div.widget").attr("data-role") === "map"))
                                          {
                                             widgetId = $(this).attr("id");
                                             widgetTitle = $(this).find("div.titleDiv").html();
                                             newSelect.append('<option value="' + widgetId + '">' + widgetTitle + '</option>');
                                             widgetsNumber++;
                                          }
                                       });

                                       if(widgetsNumber > 0)
                                       {
                                          newInnerDiv.append(newSelect);
                                       }
                                       else
                                       {
                                          newInnerDiv.append("None");
                                       }

                                       newFormRow.append(newLabel);
                                       newFormRow.append(newInnerDiv);
                                       $("#specificParamsM").append(newFormRow);
                                       newLabel.show();
                                       newInnerDiv.show();

                                       if(widgetsNumber > 0)
                                       {
                                          newSelect.show();
                                          newSelect.val(-1);
                                          newLabel = $('<label for="editWidgetEventTypes" class="col-md-2 control-label">Events to show on selected map</label>');
                                          newInnerDiv = $('<div class="col-md-3"></div>');
                                          var eventTypeSelect = $('<select name="editWidgetEventTypes" class="form-control" id="editWidgetEventTypes" multiple></select>');
                                          eventTypeSelect.append('<option value="Altri eventi">Altri eventi</option>');
                                          eventTypeSelect.append('<option value="Aperture straordinarie, visite guidate">Aperture straordinarie, visite guidate</option>');
                                          eventTypeSelect.append('<option value="Estate Fiorentina">Estate Fiorentina</option>');
                                          eventTypeSelect.append('<option value="Fiere, mercati">Fiere, mercati</option>');
                                          eventTypeSelect.append('<option value="Film festival">Film festival</option>');
                                          eventTypeSelect.append('<option value="Mostre">Mostre</option>');
                                          eventTypeSelect.append('<option value="Musica classica, opera e balletto">Musica classica, opera e balletto</option>');
                                          eventTypeSelect.append('<option value="Musica rock, jazz, pop, contemporanea">Musica rock, jazz, pop, contemporanea</option>');
                                          eventTypeSelect.append('<option value="News">News</option>');
                                          eventTypeSelect.append('<option value="Readings, Conferenze, Convegni">Readings, Conferenze, Convegni</option>');
                                          eventTypeSelect.append('<option value="Readings, incontri letterari, conferenze">Readings, incontri letterari, conferenze</option>');
                                          eventTypeSelect.append('<option value="Sport">Sport</option>');
                                          eventTypeSelect.append('<option value="Teatro">Teatro</option>');
                                          eventTypeSelect.append('<option value="Tradizioni popolari">Tradizioni popolari</option>');
                                          eventTypeSelect.append('<option value="Walking">Walking</option>');
                                          eventTypeSelect.val(-1);
                                          newFormRow.append(newLabel);
                                          newInnerDiv.append(eventTypeSelect);
                                          newFormRow.append(newInnerDiv);
                                          newLabel.hide();
                                          newInnerDiv.hide();

                                          $('#editWidgetEventTypes').selectpicker({
                                             actionsBox: true, 
                                             width: "auto"
                                          });

                                          $('#editWidgetEventTypes').on('changed.bs.select', function (e) 
                                          {
                                             if($(this).val() === null)
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = [];
                                             }
                                             else
                                             {
                                                targetEventsJson[$("#editWidgetGeolocationWidgets").val()] = $(this).val();
                                             }
                                             $("#parametersM").val(JSON.stringify(targetEventsJson));
                                          });

                                          $("#editWidgetGeolocationWidgets").change(function(){
                                             newLabel.show();
                                             newInnerDiv.show();
                                             $('#editWidgetEventTypes').selectpicker('val', targetEventsJson[$("#editWidgetGeolocationWidgets").val()]);
                                          });
                                       }
                                        break;
                                        
                                    case "widgetTrendMentions":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#inputComuneWidgetM').attr("disabled", true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Nuova riga
                                        //Default tab
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="inputDefaultTabM" class="col-md-2 control-label">Default tab</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="inputDefaultTabM" name="inputDefaultTabM"></select>');
                                        newSelect.append('<option value="0">Trends</option>');
                                        newSelect.append('<option value="1">Quotes</option>');
                                        newSelect.append('<option value="-1">None (automatic switch)</option>');
                                        newSelect.val(data['defaultTab']);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
                                        
                                    case "widgetPrevMeteo":
                                        $("#inputComuneRowM").show();
                                        $("label[for='inputComuneWidgetM']").css("display", "");
                                        $("label[for='inputComuneWidgetM']").text("City (autosuggestion)");
                                        $('#inputComuneWidgetM').css("display", "");
                                        $('#inputComuneWidgetM').attr('disabled', false);
                                        $('#inputComuneWidgetM').attr('autocomplete', 'on');
                                        $('#inputComuneWidgetM').prop('required', true);
                                        $('#inputComuneWidgetM').autocomplete({
                                            source: comuniLammaArray,
                                            autoFocus: false,
                                            minLength: 1,
                                            delay: 500,
                                        }).data("ui-autocomplete")._resizeMenu = function(){
                                            var ul = this.menu.element;
                                            ul.outerWidth(this.element.outerWidth() + 30);
                                            ul.css("max-height", "300px");
                                            ul.css("overflow-x", "auto");
                                            ul.css("overflow-y", "auto");
                                        };
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', false);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').prop('required', true);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#widgetFontColorM').css("background-color", "#" + data['fontColor']);
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', false);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', false);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputComuneWidgetM').attr("disabled", false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Nuova riga
                                        //Orientation
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="orientationM" class="col-md-2 control-label">Widget mode</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="orientationM" name="orientationM"></select>');
                                        newSelect.append('<option value="horizontal">Horizontal</option>');
                                        newSelect.append('<option value="vertical">Vertical</option>');
                                        newSelect.append('<option value="verticalCompact">VerticalCompact</option>');
                                        newSelect.append('<option value="today">Today only</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        if(styleParamsRaw !== null) 
                                        {
                                            styleParameters = JSON.parse(styleParamsRaw); 
                                            newSelect.val(styleParameters.orientation);
                                        }
                                        
                                        newLabel = $('<label for="languageM" class="col-md-2 control-label">Language</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="languageM" name="languageM"></select>');
                                        newSelect.append('<option value="english">English</option>');
                                        newSelect.append('<option value="italian">Italian</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        if(styleParamsRaw !== null) 
                                        {
                                            newSelect.val(styleParameters.language);
                                        }
                                        
                                        //Nuova riga
                                        //Space occupation
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="todayDimM" class="col-md-2 control-label">Today box dimension</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        var newControl = $('<input id="todayDim" name="todayDimM" data-slider-id="todayDimSliderM" type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1"/>');
                                        newInnerDiv.append(newControl);
                                        newInnerDiv.find('#todayDim').bootstrapSlider({
                                           formatter: function(value) {
                                              return value + "%";
                                           }, 
                                           value: styleParameters.todayDim
                                        });
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Background option
                                        newLabel = $('<label for="backgroundModeM" class="col-md-2 control-label">Background mode</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="backgroundModeM" name="backgroundModeM"></select>');
                                        newSelect.append('<option value="color">Color</option>');
                                        newSelect.append('<option value="auto">Automatic picture</option>');
                                        newSelect.val(styleParameters.backgroundMode);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Nuova riga
                                        //Icon type
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="iconSetM" class="col-md-2 control-label">Weather symbols</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="iconSetM" name="iconSetM"></select>');
                                        newSelect.append('<option value="multiColor">Images</option>');
                                        newSelect.append('<option value="singleColor">Icons</option>');
                                        newSelect.val(styleParameters.iconSet);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        break;
                                        
                                    case "widgetServiceMap":
                                        //$("#inputComuneRowM").css("display", "");
                                        //$("label[for='inputComuneWidgetM']").css("display", "");
                                        //$("label[for='inputComuneWidgetM']").text("Context");
                                        //$('#inputComuneWidgetM').css("display", "");
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', false);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', false);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').val("");
                                        $('#inputFreqWidgetM').prop('disabled', true);
                                        $('#inputFreqWidgetM').prop('required', false);
                                        $('#urlWidgetM').attr('disabled', true);
                                        $('#urlWidgetM').prop('required', false);
                                        $('#urlWidgetM').val('');
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break; 
                                        
                                    case "widgetSpeedometer":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', false);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', false);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#urlWidgetM').prop('required', false);
                                        $('#urlWidgetM').val('');
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        if(data['municipality_metric_widget'] === null) 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', true);
                                        } 
                                        else 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', false);
                                        }
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        //Campo di registrazione widget sul Notificatore
                                        editWidgetGeneratorRegisterField(data['notificatorRegistered'], data['notificatorEnabled'], data['param_w']);
                                        break;
                                        
                                    case "widgetStateRideAtaf":
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', true);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', true);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', true);
                                        $('#inputUdmM').attr('disabled', true);
                                        $('#inputUdmM').prop('required', false);
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', true);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        if(data['municipality_metric_widget'] === null) 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', true);
                                        } 
                                        else 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', false);
                                        }
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Nuova riga
                                        //Default tab
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="inputDefaultTabM" class="col-md-2 control-label">Default tab</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="inputDefaultTabM" name="inputDefaultTabM"></select>');
                                        newSelect.append('<option value="0">Stato</option>');
                                        newSelect.append('<option value="1">Linee monitorate</option>');
                                        newSelect.append('<option value="2">Dati</option>');
                                        newSelect.append('<option value="-1">None (automatic switch)</option>');
                                        newSelect.val(data['defaultTab']);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();
                                        
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
                                        
                                    case "widgetExternalContent":
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        
                                        var gisTargetCenterParametersM = null;
                                        $('#inputUrlWidgetM').attr('disabled', false);
                                        $('#inputUrlWidgetM').prop('required', true);
                                        $("#titleLabelM").html("Title"); 
                                        $("#bckColorLabelM").html("Background color");
                                        $('#inputColorWidgetM').val("");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').attr('required', true);
                                        $('#color_widget_M').css("background-color", "#eeeeee");
                                        $('#inputFontSizeM').val("");
                                        $('#inputFontSizeM').attr('disabled', true);
                                        $('#inputFontColorM').val("");
                                        $('#inputFontColorM').attr('disabled', true);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#link_help_modal-add-widgetM').css("display", "");
                                        $('#inputFrameColorWidgetM').attr('disabled', false);
                                        $('#inputFrameColorWidgetM').val('#eeeeee');
                                        $('#inputFrameColorWidgetM').prop('required', false);
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').attr('disabled', true);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').attr('disabled', true);
                                        $('#inputFreqWidgetM').val("");
                                        $('#inputFreqWidgetM').prop('required', false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);

                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        
                                        //Nuova riga
                                        //Modalità del widget (none, map, gis, link esterno)
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="widgetModeM" class="col-md-2 control-label">Widget mode</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="widgetModeM" name="widgetModeM"></select>');
                                        newSelect.append('<option value="link">Web link</option>');
                                        newSelect.append('<option value="map">Map</option>');
                                        newSelect.append('<option value="gisTarget">Selector target</option>');
                                        newSelect.append('<option value="none">None</option>');
                                        $('#urlWidgetM').val(data.url);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Nuova riga
                                        //Centro della mappa per modalità GIS target
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label class="col-md-2 control-label">Start lat</label>');
                                        newInnerDiv = $('<div class="col-md-2">' +
                                                          '<input type="text" id="gisTargetCenterLatM" class="form-control"/>' +
                                                        +'</div>');
                                        newInnerDiv.css("padding-left", "0px");
                                        newInnerDiv.css("padding-right", "0px");
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);   
                                        
                                        newLabel = $('<label class="col-md-2 control-label">Start lng</label>');
                                        newInnerDiv = $('<div class="col-md-2">' +
                                                          '<input type="text" id="gisTargetCenterLngM" class="form-control"/>' +
                                                        +'</div>');
                                        newInnerDiv.css("padding-left", "0px");
                                        newInnerDiv.css("padding-right", "0px");        
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        newLabel = $('<label class="col-md-2 control-label">Start zoom</label>');
                                        newInnerDiv = $('<div class="col-md-2">' +
                                                          '<input type="text" id="gisTargetCenterZoomM" class="form-control"/>' +
                                                        +'</div>');
                                        newLabel.css("padding-left", "8px");
                                        newLabel.css("padding-right", "8px");        
                                        newInnerDiv.css("padding-left", "0px");
                                        newInnerDiv.css("padding-right", "0px");        
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newFormRow.hide();
                                        
                                        //Nuova riga
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newInnerDiv = $('<div id="gisTargetCenterMapDivM" class="col-md-12"></div>');
                                        newFormRow.append(newInnerDiv);
                                        newFormRow.hide();

                                        //Nuova riga
                                        //Full screen controls
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="enableFullscreenTabM" class="col-md-2 control-label">Enable fullscreen in new tab</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="enableFullscreenTabM" name="enableFullscreenTabM"></select>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newSelect.val(data['enableFullscreenTab']);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);

                                        newLabel = $('<label for="enableFullscreenModalM" class="col-md-2 control-label">Enable fullscreen in a popup</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="enableFullscreenModalM" name="enableFullscreenModalM"></select>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        
                                        //Nuova riga
                                        //Zoom controls visibility
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="inputControlsVisibilityM" class="col-md-2 control-label">Zoom controls visibility</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="inputControlsVisibilityM" name="inputControlsVisibilityM"></select>');
                                        newSelect.append('<option value="alwaysVisible">Always visible</option>');
                                        newSelect.append('<option value="hidden">Hidden</option>');
                                        newSelect.val(data['controlsVisibility']);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //Zoom factor - Lo si edita soltanto dai controlli grafici
                                        newLabel = $('<label for="inputZoomFactorM" class="col-md-2 control-label">Zoom factor (%)</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newInput = $('<input type="text" class="form-control" id="inputZoomFactorM" name="inputZoomFactorM" required>');
                                        newInput.val(data['zoomFactor']*100);
                                        newInput.attr('disabled', true);
                                        newInnerDiv.append(newInput);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newInput.show();

                                        //Nuova riga
                                        //Zoom controls position
                                        newFormRow = $('<div class="row"></div>');
                                        $("#specificParamsM").append(newFormRow);
                                        newLabel = $('<label for="inputControlsPositionM" class="col-md-2 control-label">Zoom controls position</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="inputControlsPositionM" name="inputControlsPositionM"></select>');
                                        newSelect.append('<option value="topLeft">Top left</option>');
                                        newSelect.append('<option value="topCenter">Top center</option>');
                                        newSelect.append('<option value="topRight">Top right</option>');
                                        newSelect.append('<option value="middleRight">Middle right</option>');
                                        newSelect.append('<option value="bottomRight">Bottom right</option>');
                                        newSelect.append('<option value="bottomMiddle">Bottom middle</option>');
                                        newSelect.append('<option value="bottomLeft">Bottom left</option>');
                                        newSelect.append('<option value="middleLeft">Middle left</option>');
                                        newSelect.val(data['controlsPosition']);
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);
                                        newLabel.show();
                                        newInnerDiv.show();
                                        newSelect.show();

                                        //Title visibility
                                        /*newLabel = $('<label for="inputShowTitleM" class="col-md-2 control-label">Title visibility</label>');
                                        newInnerDiv = $('<div class="col-md-3"></div>');
                                        newSelect = $('<select class="form-control" id="inputShowTitleM" name="inputShowTitleM"></select>');
                                        newSelect.append('<option value="yes">Yes</option>');
                                        newSelect.append('<option value="no">No</option>');
                                        
                                        newInnerDiv.append(newSelect);
                                        newFormRow.append(newLabel);
                                        newFormRow.append(newInnerDiv);*/
                                        
                                        $("#widgetModeM").change(function(){
                                            switch($(this).val())
                                            {
                                                case "link":
                                                    $("#urlWidgetM").val("");
                                                    $("#urlWidgetM").parents("div.row").show();
                                                    $('#enableFullscreenTabM').attr('disabled', false);
                                                    $("#inputControlsVisibilityM").parents("div.row").show();
                                                    $("#inputControlsPositionM").parents("div.row").show();
                                                    $("#enableFullscreenTabM").val("yes");
                                                    $("#inputControlsVisibilityM").val("alwaysVisible");
                                                    $("#inputZoomFactorM").val("100");
                                                    $("#inputControlsPositionM").val("topLeft");
                                                    //$("#inputShowTitleM").val("yes");
                                                    $("#gisTargetCenterLatM").parents("div.row").hide();
                                                    $("#gisTargetCenterMapDivM").parents("div.row").hide();
                                                    break;

                                                case "map":
                                                    $("#urlWidgetM").val("map");
                                                    $("#urlWidgetM").parents("div.row").hide();
                                                    $('#enableFullscreenTabM').attr('disabled', true);
                                                    $("#inputControlsVisibilityM").parents("div.row").hide();
                                                    $("#inputControlsPositionM").parents("div.row").hide();
                                                    $("#enableFullscreenTabM").val("no");
                                                    $("#inputControlsVisibilityM").val("hidden");
                                                    $("#inputZoomFactorM").val("100");
                                                    $("#inputControlsPositionM").val("topLeft");
                                                    //$("#inputShowTitleM").val("yes");
                                                    $("#gisTargetCenterLatM").parents("div.row").hide();
                                                    $("#gisTargetCenterMapDivM").parents("div.row").hide();
                                                    break;

                                                case "gisTarget":
                                                    $("#urlWidgetM").val("gisTarget");
                                                    $("#urlWidgetM").parents("div.row").hide();
                                                    $('#enableFullscreenTabM').attr('disabled', true);
                                                    $("#inputControlsVisibilityM").parents("div.row").hide();
                                                    $("#inputControlsPositionM").parents("div.row").hide();
                                                    $("#enableFullscreenTabM").val("no");
                                                    $("#inputControlsVisibilityM").val("hidden");
                                                    $("#inputZoomFactorM").val("100");
                                                    $("#inputControlsPositionM").val("topLeft");
                                                    //$("#inputShowTitleM").val("yes");
                                                    $("#gisTargetCenterLatM").parents("div.row").show();
                                                    $("#gisTargetCenterDivM").parents("div.row").show();
                                                    
                                                    gisTargetCenterParametersM = currentParams;
                                                    $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));

                                                    if(gisTargetCenterMapDivRefM === null)
                                                    {
                                                        gisTargetCenterMapDivM = "gisTargetCenterMapDivM";
                                                        gisTargetCenterMapDivRefM = L.map(gisTargetCenterMapDivM).setView(gisTargetCenterParametersM.latLng, gisTargetCenterParametersM.zoom);

                                                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                                           attribution: '&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
                                                           maxZoom: 18
                                                        }).addTo(gisTargetCenterMapDivRefM);
                                                        gisTargetCenterMapDivRefM.attributionControl.setPrefix('');

                                                        gisTargetCenterMapDivRefM.off("zoom");
                                                        gisTargetCenterMapDivRefM.on("zoom", function(){
                                                            $("#gisTargetCenterZoomM").val(gisTargetCenterMapDivRefM.getZoom());
                                                            gisTargetCenterParametersM.zoom = $("#gisTargetCenterZoomM").val();
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        $("#gisTargetCenterZoomM").off("input");
                                                        $("#gisTargetCenterZoomM").on("input", function(event){
                                                            gisTargetCenterMapDivRefM.setZoom($(this).val());
                                                            gisTargetCenterParametersM.zoom = $("#gisTargetCenterZoomM").val();
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        gisTargetCenterMapDivRefM.off("move");
                                                        gisTargetCenterMapDivRefM.on("move", function(){
                                                            $("#gisTargetCenterLatM").val(gisTargetCenterMapDivRefM.getCenter().lat);
                                                            $("#gisTargetCenterLngM").val(gisTargetCenterMapDivRefM.getCenter().lng);
                                                            gisTargetCenterParametersM.latLng[0] = $("#gisTargetCenterLatM").val();
                                                            gisTargetCenterParametersM.latLng[1] = $("#gisTargetCenterLngM").val();
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        $("#gisTargetCenterLatM").off("input");
                                                        $("#gisTargetCenterLatM").on("input", function(event){
                                                            gisTargetCenterParametersM.latLng[0] = $("#gisTargetCenterLatM").val();
                                                            gisTargetCenterMapDivRefM.panTo(gisTargetCenterParametersM.latLng);
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        $("#gisTargetCenterLngM").off("input");
                                                        $("#gisTargetCenterLngM").on("input", function(event){
                                                            gisTargetCenterParametersM.latLng[1] = $("#gisTargetCenterLngM").val();
                                                            gisTargetCenterMapDivRefM.panTo(gisTargetCenterParametersM.latLng);
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });
                                                    }
                                                    break;

                                                case "none":
                                                    $("#urlWidgetM").val("none");
                                                    $("#urlWidgetM").parents("div.row").hide();
                                                    $('#enableFullscreenTabM').attr('disabled', true);
                                                    $("#inputControlsVisibilityM").parents("div.row").hide();
                                                    $("#inputControlsPositionM").parents("div.row").hide();
                                                    $("#enableFullscreenTabM").val("no");
                                                    $("#inputControlsVisibilityM").val("hidden");
                                                    $("#inputZoomFactorM").val("100");
                                                    $("#inputControlsPositionM").val("topLeft");
                                                    $("#inputShowTitleM").val("yes");
                                                    $("#gisTargetCenterLatM").parents("div.row").hide();
                                                    $("#gisTargetCenterMapDivM").parents("div.row").hide();
                                                    break;    
                                            }
                                        });
                                        
                                        switch(data.url)
                                        {
                                            case "gisTarget": case "map": case "none":
                                                $("#widgetModeM").val(data.url);
                                                $("#urlWidgetM").parents("div.row").hide();
                                                break; 
                                                
                                            default:
                                                $("#widgetModeM").val("link");  
                                                $("#urlWidgetM").parents("div.row").show();
                                                break;
                                        }
                                        
                                        switch($('#urlWidgetM').val())
                                        {
                                            case "map":
                                                $('#enableFullscreenTabM').attr('disabled', true);
                                                $("#inputControlsVisibilityM").parents("div.row").hide();
                                                $("#inputControlsPositionM").parents("div.row").hide();
                                                $("#inputShowTitleM").val("yes");
                                                $("#enableFullscreenTabM").val("no");
                                                $("#gisTargetCenterLatM").parents("div.row").hide();
                                                $("#gisTargetCenterMapDivM").parents("div.row").hide();
                                                break;

                                            case "gisTarget":
                                                gisTargetCenterParametersM = currentParams;
                                                $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                $('#enableFullscreenTabM').attr('disabled', true);
                                                $("#inputControlsVisibilityM").parents("div.row").hide();
                                                $("#inputControlsPositionM").parents("div.row").hide();
                                                $("#inputShowTitleM").val("yes");
                                                $("#enableFullscreenTabM").val("no");
                                                
                                                $("#gisTargetCenterLatM").val(gisTargetCenterParametersM.latLng[0]);
                                                $("#gisTargetCenterLngM").val(gisTargetCenterParametersM.latLng[1]);
                                                $("#gisTargetCenterZoomM").val(gisTargetCenterParametersM.zoom);
                                                
                                                if(gisTargetCenterMapDivRefM === null)
                                                {
                                                    $("#gisTargetCenterLatM").parents("div.row").show();
                                                    $("#gisTargetCenterMapDivM").parents("div.row").show();
                                                    
                                                    //Bisogna aspettare che il modale sia completamente in posizione e visibile, sennò il load della mappa dà problemi di visualizzazione dei tiles
                                                    setTimeout(function(){
                                                        gisTargetCenterMapDivM = "gisTargetCenterMapDivM";
                                                        gisTargetCenterMapDivRefM = L.map(gisTargetCenterMapDivM).setView(gisTargetCenterParametersM.latLng, gisTargetCenterParametersM.zoom);

                                                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                                           attribution: '&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
                                                           maxZoom: 18
                                                        }).addTo(gisTargetCenterMapDivRefM);
                                                        gisTargetCenterMapDivRefM.attributionControl.setPrefix('');
                                                        
                                                        gisTargetCenterMapDivRefM.off("zoom");
                                                        gisTargetCenterMapDivRefM.on("zoom", function(){
                                                            $("#gisTargetCenterZoomM").val(gisTargetCenterMapDivRefM.getZoom());
                                                            gisTargetCenterParametersM.zoom = $("#gisTargetCenterZoomM").val();
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        $("#gisTargetCenterZoomM").off("input");
                                                        $("#gisTargetCenterZoomM").on("input", function(event){
                                                            gisTargetCenterMapDivRefM.setZoom($(this).val());
                                                            gisTargetCenterParametersM.zoom = $("#gisTargetCenterZoomM").val();
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        gisTargetCenterMapDivRefM.off("move");
                                                        gisTargetCenterMapDivRefM.on("move", function(){
                                                            $("#gisTargetCenterLatM").val(gisTargetCenterMapDivRefM.getCenter().lat);
                                                            $("#gisTargetCenterLngM").val(gisTargetCenterMapDivRefM.getCenter().lng);
                                                            gisTargetCenterParametersM.latLng[0] = $("#gisTargetCenterLatM").val();
                                                            gisTargetCenterParametersM.latLng[1] = $("#gisTargetCenterLngM").val();
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        $("#gisTargetCenterLatM").off("input");
                                                        $("#gisTargetCenterLatM").on("input", function(event){
                                                            gisTargetCenterParametersM.latLng[0] = $("#gisTargetCenterLatM").val();
                                                            gisTargetCenterMapDivRefM.panTo(gisTargetCenterParametersM.latLng);
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });

                                                        $("#gisTargetCenterLngM").off("input");
                                                        $("#gisTargetCenterLngM").on("input", function(event){
                                                            gisTargetCenterParametersM.latLng[1] = $("#gisTargetCenterLngM").val();
                                                            gisTargetCenterMapDivRefM.panTo(gisTargetCenterParametersM.latLng);
                                                            $("#parametersM").val(JSON.stringify(gisTargetCenterParametersM));
                                                        });
                                                    }, 350);
                                                }
                                                break;

                                            case "none":
                                                $('#enableFullscreenTabM').attr('disabled', true);
                                                $("#inputControlsVisibilityM").parents("div.row").hide();
                                                $("#inputControlsPositionM").parents("div.row").hide();
                                                $("#inputShowTitleM").val("yes");
                                                $("#enableFullscreenTabM").val("no");
                                                $("#gisTargetCenterLatM").parents("div.row").hide();
                                                $("#gisTargetCenterMapDivM").parents("div.row").hide();
                                                break;    
                                                
                                            default:
                                                $('#enableFullscreenTabM').attr('disabled', false);
                                                $("#inputControlsVisibilityM").parents("div.row").show();
                                                $("#inputControlsPositionM").parents("div.row").show();
                                                $("#inputShowTitleM").val(data['showTitle']);
                                                $("#enableFullscreenTabM").val(data['enableFullscreenTab']);
                                                $("#gisTargetCenterLatM").parents("div.row").hide();
                                                $("#gisTargetCenterMapDivM").parents("div.row").hide();
                                                break;    
                                        }
                                        break;       
                                    
                                    default:
                                        $('#link_help_modal-add-widget-m').css("display", "");
                                        $('#inputTitleWidgetM').attr('disabled', false);
                                        $("label[for='inputTitleWidgetM']").html("Title");
                                        $("label[for='inputColorWidgetM']").html("Background color");
                                        $('#inputColorWidgetM').attr('disabled', false);
                                        $('#inputColorWidgetM').prop('required', false);
                                        $('#inputFontSizeM').prop('required', false);
                                        $('#inputFontSizeM').prop('disabled', false);
                                        $('#inputFontSizeM').val('');
                                        $('#inputFontColorM').val('');
                                        $('#inputFontColorM').prop('required', false);
                                        $('#inputFontColorM').prop('disabled', false);
                                        $('#widgetFontColorM').css("background-color", "#eeeeee");
                                        $('#select-frameColor-Widget-m').attr('disabled', false);
                                        $('#select-frameColor-Widget-m').prop('required', false);
                                        $('#select-frameColor-Widget-m').val('');
                                        $('#select-IntTemp-Widget-m').val(-1);
                                        $('#select-IntTemp-Widget-m').prop('disabled', false);
                                        $('#select-IntTemp-Widget-m').prop('required', false);
                                        $('#inputFreqWidgetM').prop('disabled', false);
                                        $('#inputFreqWidgetM').prop('required', false);
                                        $('#urlWidgetM').attr('disabled', false);
                                        $('#inputComuneWidgetM').attr("disabled", false);
                                        $('#inputHeaderFontColorWidgetM').attr('disabled', false);
                                        $('#inputHeaderFontColorWidgetM').prop('required', true);
                                        $('#inputUdmWidgetM').prop("required", false);
                                        $('#inputUdmWidgetM').attr("disabled", true);
                                        $('#inputUdmWidgetM').val("");
                                        $('#inputUdmPositionM').prop("required", false);
                                        $('#inputUdmPositionM').attr("disabled", true);
                                        $('#inputUdmPositionM').val(-1);
                                        if(data['municipality_metric_widget'] == null) 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', true);
                                        } 
                                        else 
                                        {
                                            $('#inputComuneWidgetM').attr('disabled', false);
                                        }
                                        
                                        showInfoWCkeditorsM($('#select-widget-m').val(), editorsArrayM, null, null, info_mess);
                                        
                                        //Parametri specifici del widget
                                        $('#specificParamsM .row').remove();
                                        //Rimozione eventuali campi del subform general per widget process
                                        removeWidgetProcessGeneralFields("editWidget");
                                        break;
                                }
                                }
                                
                                
                                dimMapRaw = data['dimMap'];
                                
                                if((dimMapRaw != null) && (dimMapRaw != "null") && (typeof dimMapRaw != "undefined") && (dimMapRaw != ""))
                                 {
                                    dimMap = JSON.parse(dimMapRaw);
                                 }
                                
                                if(dimMap == null)
                                {
                                    $("#inputRows-m").off();
                                    var min_col_m = parseInt(data['min_col']);                               
                                    var max_col_m = parseInt(data['max_col']);
                                    var min_row_m = parseInt(data['min_row']);
                                    var max_row_m = parseInt(data['max_row']);

                                    if (min_row_m === max_row_m)
                                    {
                                        $("#inputRows-m").append('<option>' + max_row_m + '</option>');
                                        $("#inputRows-m").val(data['size_rows_widget']);
                                    } 
                                    else
                                    {
                                        for (var c = min_row_m; c <= max_row_m; c++)
                                        {
                                            $("#inputRows-m").append('<option>' + c + '</option>');
                                        }
                                        $("#inputRows-m").val(data['size_rows_widget']);
                                    }
                                    
                                    if (min_col_m === max_col_m)
                                    {
                                        $("#inputColumn-m").append('<option>' + min_col_m + '</option>');
                                        $("#inputColumn-m").val(data['size_columns_widget']);
                                    } 
                                    else
                                    {
                                        for (var v = min_col_m; v <= max_col_m; v++)
                                        {
                                            $("#inputColumn-m").append('<option>' + v + '</option>');
                                        }
                                        $("#inputColumn-m").val(data['size_columns_widget']);
                                    }
                                    
                                }
                                else
                                {
                                    //Codice per dim vincolate.
                                    var z;
                                    var selectedIndex = null;
                                    
                                    $("#inputRows-m").empty();
                                    $("#inputRows-m").empty();
                                    
                                    for(z = 0; z < dimMap.dimMap.length; z++)
                                    {
                                        $("#inputRows-m").append('<option>' + dimMap.dimMap[z].rows + '</option>');
                                    }
                                    
                                    $("#inputRows-m").val(data['size_rows_widget']);
                                    $("#inputColumn-m").append('<option>' + data['size_columns_widget'] + '</option>');
                                    $("#inputColumn-m").val(data['size_columns_widget']);

                                    $("#inputRows-m").off();

                                    $("#inputRows-m").change(function() {
                                            selectedIndex = $("#inputRows-m").prop("selectedIndex");
                                            $("#inputColumn-m").empty();
                                            $("#inputColumn-m").append('<option>' + dimMap.dimMap[selectedIndex].cols + '</option>');
                                    });
                                }  
                                
                                $("#urlWidgetM").val(data['url']);
                                
                                //Impostazion colore principale del widget
                                if((!data['color_widget']) || (data['color_widget'] == ""))
                                {
                                    $("#inputColorWidgetM").val("#ffffff");
                                    $("#color_widget_M").css("background-color", "#ffffff");
                                    $("#widgetColorPickerContainer").colorpicker('setValue', '#ffffff');
                                } 
                                else 
                                {
                                    $("#widgetColorPickerContainer").colorpicker('setValue', data['color_widget']);
                                }
                                
                                //Impostazion colore del frame del widget
                                if((!data['frame_color']) || (data['frame_color'] == ""))
                                {
                                    $("#widgetFrameColorPickerContainer").colorpicker({
                                        format: "rgba",
                                        color: "#EEEEEE"
                                    });
                                } 
                                else 
                                {
                                    $("#widgetFrameColorPickerContainer").colorpicker({
                                        format: "rgba",
                                        color: data['frame_color']
                                    });
                                }
                                
                                if((!data['headerFontColor']) || (data['headerFontColor'] == ""))
                                {
                                    $("#widgetFrameFontColorPickerContainer").colorpicker({
                                        format: "rgba",
                                        color: "#000000"
                                    });
                                } 
                                else 
                                {
                                    $("#widgetFrameFontColorPickerContainer").colorpicker({
                                        format: "rgba",
                                        color: data['headerFontColor']
                                    });
                                }
                                
                                
                                
                                //dimensioni range
                                /*if(data['metrics_prop'][0]['timeRangeOption_metric_widget'] == 0) 
                                {
                                    //Div parametri: vecchio codice commentato in attesa di introdurre il nuovo form
                                    $("#value_range_m").hide();
                                } 
                                else if (data['metrics_prop'][0]['timeRangeOption_metric_widget'] == 1) 
                                {
                                    //Div parametri: vecchio codice commentato in attesa di introdurre il nuovo form
                                    $("#value_range_m").show();
                                    $("#textarea-range-value_m").val(data['param_w']);
                                    var dividi_json = data['param_w'];
                                    if (dividi_json) 
                                    {
                                        var obj = JSON.parse(dividi_json);
                                        $('#input-min_range_m').val(obj['rangeMin']);
                                        $('#input-max_range_m').val(obj['rangeMax']);
                                    } 
                                    else 
                                    {
                                        $("#textarea-range-value_m").empty();
                                        $('#input-min_range_m').val('');
                                        $('#input-max_range_m').val('');
                                    }
                                }*/
                                
                                $('#modal-modify-widget').modal('show');
                            },
                            error: function (errorMsg) 
                            {
                                console.log("Error calling get_data.php --> get_param_widget");
                                console.log(errorMsg);
                            }
                        });
                    });
                    
                    //Listener in modifica widget per il menu degli scheduler che carica le jobs areas e/o i jobs groups 
                    $('#inputSchedulerWidgetM').change(update_select_scheduler = function () 
                    {
                        if($('#inputSchedulerWidgetM').css("display") != "none")
                        {
                            var selectedIndex = $('#inputSchedulerWidgetM').prop('selectedIndex');
                            $("#schedulerNameM").val(elencoScheduler[selectedIndex].name);
                            $("#hostM").val(elencoScheduler[selectedIndex].ip);
                            $("#userM").val(elencoScheduler[selectedIndex].user);
                            $("#passM").val(elencoScheduler[selectedIndex].pass);
                            $.ajax({
                                url: "get_data.php",
                                data: {action: "getJobAreas", schedulerId: elencoScheduler[selectedIndex].id},
                                type: "GET",
                                async: false,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    $('#inputJobsAreasWidgetM').empty();
                                    $('#inputJobsGroupsWidgetM').empty();
                                    $('#inputJobsNamesWidgetM').empty();
                                    if(data[0].id == "none")
                                    {
                                        //Nessuna JOBS AREA
                                        $('#jobsAreasRowM').css("display", "none");
                                        $("label[for='inputJobsAreasWidgetM']").css("display", "none");
                                        $('#inputJobsAreasWidgetDivM').css("display", "none");
                                        $('#inputJobsAreasWidgetGroupDivM').css("display", "none");
                                        $('#inputJobsAreasWidgetM').css("display", "none");
                                        
                                        //Caricamento dei jobs groups per lo scheduler selezionato.
                                        $('#inputJobsGroupsWidgetM').empty();
                                        for(var i = 0; i < elencoJobsGroupsPerScheduler[selectedIndex].length; i++)
                                        {
                                            $('#inputJobsGroupsWidgetM').append('<option>' + elencoJobsGroupsPerScheduler[selectedIndex][i] + '</option>');
                                        }
                                        
                                        //Viene mostrato il campo per i jobs groups dello scheduler selezionato
                                        $('#jobsGroupsRowM').css("display", "");
                                        $('#inputJobsGroupsWidgetGroupDivM').css("display", "");
                                        $('#inputJobsGroupsWidgetDivM').css("display", "");
                                        $("label[for='inputJobsGroupsWidgetM']").css("display", "");
                                        $('#inputJobsGroupsWidgetM').css("display", "");
                                        $('#inputJobsGroupsWidgetM').prop('selectedIndex', -1);
                                        
                                        //Viene mostrato il campo dei jobs names per il group selezionato
                                        $('#jobsNamesRowM').css("display", "");
                                        $('#inputJobsNamesWidgetDivM').css("display", "");
                                        $('#inputJobsNamesWidgetGroupDivM').css("display", "");
                                        $("label[for='inputJobsNamesWidgetM']").css("display", "");
                                        $('#inputJobsNamesWidgetM').css("display", "");
                                        $('#inputJobsNamesWidgetM').prop('selectedIndex', -1);
                                    }
                                    else
                                    {
                                        //Ramo con le jobs areas
                                        
                                        //Non mostrare i job groups per scheduler
                                        $('#jobsGroupsRowM').css("display", "none");
                                        $('#inputJobsGroupsWidgetGroupDivM').css("display", "none");
                                        $('#inputJobsGroupsWidgetDivM').css("display", "none");
                                        $("label[for='inputJobsGroupsWidgetM']").css("display", "none");
                                        $('#inputJobsGroupsWidgetM').css("display", "none");
                                        
                                        //Mostrare le JOBS AREAS
                                        $('#jobsAreasRowM').css("display", "");
                                        $("label[for='inputJobsAreasWidgetM']").css("display", "");
                                        $('#inputJobsAreasWidgetDivM').css("display", "");
                                        $('#inputJobsAreasWidgetGroupDivM').css("display", "");
                                        $('#inputJobsAreasWidgetM').css("display", "");
                                        $('#inputJobsAreasWidgetM').empty();
                                        for(var i = 0; i < data.length; i++)
                                        {
                                            $('#inputJobsAreasWidgetM').append('<option>' + data[i]['name'] + '</option>');
                                        }
                                        $('#inputJobsAreasWidgetM').prop("selectedIndex", -1);
                                        
                                        //Viene mostrato il campo per i jobs groups della job area selezionata
                                        $('#jobsGroupsRowM').css("display", "");
                                        $('#inputJobsGroupsWidgetGroupDivM').css("display", "");
                                        $('#inputJobsGroupsWidgetDivM').css("display", "");
                                        $("label[for='inputJobsGroupsWidgetM']").css("display", "");
                                        $('#inputJobsGroupsWidgetM').css("display", "");
                                        $('#inputJobsGroupsWidgetM').prop('selectedIndex', -1);
                                    }

                                },
                                error: function (errorMsg) 
                                {
                                    console.log("Error calling get_data.php --> getJobAreas");
                                    console.log(errorMsg);
                                }
                            });    
                        }
                    }).change();
                    
                    //Listener in modifica widget per il menu delle job areas che carica i jobs groups 
                    $('#inputJobsAreasWidgetM').change(update_select_scheduler = function ()
                    {
                       if($('#inputJobsAreasWidgetM').css("display") !== "none")
                       {
                           $('#inputJobsGroupsWidgetM').empty();
                           var selectedSchedulerIndex = $('#inputSchedulerWidgetM').prop('selectedIndex');
                           var areaSelected = $('#inputJobsAreasWidgetM').val();
                           $("#jobAreaM").val(areaSelected);
                           var keyword = null;
                           switch(areaSelected)
                           {
                                case "Stato linee ATAF":
                                   keyword = "linea";
                                   break;
                                   
                                case "Check RT":
                                   keyword = "check";
                                   break;
                                   
                                case "Eventi a Firenze":
                                   keyword = "Eventi";
                                   break;
                                   
                                case "Parcheggi":
                                   keyword = "parcheggi";
                                   break;
                                   
                                case "Previsioni meteo":
                                   keyword = "meteo";
                                   break;
                                   
                                case "Sensori":
                                   keyword = "sensori";
                                   break;   
                           }
                           $.ajax({
                                url: "getJobs.php",
                                data: {action: "getJobGroupsForJobArea", 
                                       host: elencoScheduler[selectedSchedulerIndex].ip, 
                                       user: elencoScheduler[selectedSchedulerIndex].user, 
                                       pass: elencoScheduler[selectedSchedulerIndex].pass,
                                       keyword: keyword
                                   },
                                type: "POST",
                                async: false,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    $('#inputJobsGroupsWidgetM').empty();
                                    for(var j = 0; j < data.length; j++) 
                                    {
                                        $('#inputJobsGroupsWidgetM').append('<option>' + data[j].jobGroup + '</option>');
                                    }
                                    $('#inputJobsGroupsWidgetM').prop('selectedIndex', -1);
                                    //Viene mostrato il campo dei jobs names per il group selezionato
                                    $('#jobsNamesRowM').css("display", "");
                                    $('#inputJobsNamesWidgetDivM').css("display", "");
                                    $('#inputJobsNamesWidgetGroupDivM').css("display", "");
                                    $("label[for='inputJobsNamesWidgetM']").css("display", "");
                                    $('#inputJobsNamesWidgetM').css("display", "");
                                    $('#inputJobsNamesWidgetM').prop('selectedIndex', -1);
                                }
                            });
                           
                       }
                    }).change();
                    
                    //Listener in modifica widget per il menu dei job groups che carica i jobs names 
                    $('#inputJobsGroupsWidgetM').change(update_select_scheduler = function () 
                    {
                        if($('#inputJobsGroupsWidgetM').css("display") != "none")
                        {
                            $('#inputJobsNamesWidgetM').empty();
                            var selectedScheduler = $('#inputSchedulerWidgetM').prop('selectedIndex');
                            var selectedGroup = $('#inputJobsGroupsWidgetM').val();
                            $("#jobGroupM").val(selectedGroup);
                            //Reperimento elenco dei jobs names per il job group selezionato
                            $.ajax({
                                url: "getJobs.php",
                                data: {
                                    action: "getJobNamesForJobGroup", 
                                    host: elencoScheduler[selectedScheduler].ip, 
                                    user: elencoScheduler[selectedScheduler].user, 
                                    pass: elencoScheduler[selectedScheduler].pass,
                                    jobGroup: selectedGroup
                                },
                                type: "POST",
                                async: false,
                                dataType: 'json',
                                success: function (data) 
                                {
                                    $('#inputJobsNamesWidgetM').empty();
                                    for(var j = 0; j < data.length; j++) 
                                    {
                                        $('#inputJobsNamesWidgetM').append('<option>' + data[j].jobName + '</option>');
                                    }
                                    $('#inputJobsNamesWidgetM').prop('selectedIndex', -1);
                                },
                                error: function (errorMsg) 
                                {
                                   console.log("Error calling getJobs.php --> getJobNamesForJobGroup");
                                   console.log(errorMsg);
                                }
                            });
                        }
                    }).change();
                    
                   //Listener in modifica widget per il menu dei job names che valorizza il campo di form col job name scelto
                   $('#inputJobsNamesWidgetM').change(update_select_scheduler = function () 
                    {
                        if($('#inputJobsNamesWidgetM').css("display") != "none")
                        {
                            $('#jobNameM').val($('#inputJobsNamesWidgetM').val());
                        }
                    }).change();

                    //Handler informazioni generali widget
                    $(document).on('click', '.info_source', function () {
                        var name_widget_m = $(this).parents('li').attr('id');
                        $.ajax({
                            url: "get_data.php",
                            data: {widget_info: name_widget_m, action: "get_info_widget"},
                            type: "GET",
                            async: true,
                            dataType: 'json',
                            success: function (data) {
                                $('#titolo_info').text(data['title_widget']);
                                $('#contenuto_infomazioni').html(data['info_mess']);
                                $('#dialog-information-widget').modal('show');
                                $('#dialog-information-widget').css({
                                    'vertical-align': 'middle',
                                    'position': 'absolute',
                                    'top': '10%'
                                });
                            }
                        });
                    });
                    //fine handler

                    $('.color-choice').colorpicker({
                        format: "rgba"
                    });
                    
                    $("#widgetColorPickerContainer").colorpicker({
                        format: "rgba"
                    });

                    $('#form-setting-widget').submit(function () {
                        $('#select-widget').removeAttr('disabled');
                    });
                });
        </script>	
    </body>
</html>
       
